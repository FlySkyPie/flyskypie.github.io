<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://flyskypie.github.io/blog</id>
    <title>工程屍 FlyPie 的異想世界 Blog</title>
    <updated>2024-02-28T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://flyskypie.github.io/blog"/>
    <subtitle>工程屍 FlyPie 的異想世界 Blog</subtitle>
    <icon>https://flyskypie.github.io/img/favicon.ico</icon>
    <rights>Copyright © 2024 FlyPie (Wei Ji)</rights>
    <entry>
        <title type="html"><![CDATA[我的 Tiddlywiki 之旅 - 插件]]></title>
        <id>https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2</id>
        <link href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2"/>
        <updated>2024-02-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[撰寫 Tiddlywiki 條目的預設語法是 Wikitext，這自然便成為我這個 Markdown 使用者在使用 Tiddlywiki 遇到的第一個問題。幸好這個問題可以透過安裝官方的 Markdown 插件解決。]]></summary>
        <content type="html"><![CDATA[<p>撰寫 Tiddlywiki 條目的預設語法是 Wikitext，這自然便成為我這個 Markdown 使用者在使用 Tiddlywiki 遇到的第一個問題。幸好這個問題可以透過安裝官方的 <a href="https://tiddlywiki.com/plugins/tiddlywiki/markdown/" target="_blank" rel="noopener noreferrer">Markdown 插件</a>解決。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="安裝插件">安裝插件<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E5%AE%89%E8%A3%9D%E6%8F%92%E4%BB%B6" class="hash-link" aria-label="Direct link to 安裝插件" title="Direct link to 安裝插件">​</a></h2>
<p>在 Tiddlywiki 安裝插件的方式有兩種：</p>
<ul>
<li>網頁拖曳<sup><a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#user-content-fn-install-plugin-web-0b8902" id="user-content-fnref-install-plugin-web-0b8902" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></li>
<li>檔案安裝<sup><a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#user-content-fn-install-plugin-nodejs-0b8902" id="user-content-fnref-install-plugin-nodejs-0b8902" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="網頁拖曳">網頁拖曳<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E7%B6%B2%E9%A0%81%E6%8B%96%E6%9B%B3" class="hash-link" aria-label="Direct link to 網頁拖曳" title="Direct link to 網頁拖曳">​</a></h3>
<p>大部分 Tiddlywiki 的插件都有自己的 Tiddlywiki，然後會有像是這樣的連結：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="590" height="155" class="img_UJFd"></p>
<p>對它按下滑鼠，然後拖曳到自己的 Tiddlywiki 上放開，它會引導你匯入東西：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="793" height="326" class="img_UJFd"></p>
<p>部份插件會要求重新載入網頁：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_reload-f2e4610e584948a054b50d900e502841.webp" width="799" height="317" class="img_UJFd"></p>
<hr>
<p>值得注意的是，這個魔法（我猜）是透過瀏覽器實做的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DragEvent/dataTransfer" target="_blank" rel="noopener noreferrer">DataTransfer API</a> 達成的，因此使用 Desktop 版本的 Tiddlywiki 或是其他跨越瀏覽器的情況（從 Chrome 把插件拉到 Firefox 上）是不支援的。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="檔案安裝">檔案安裝<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E6%AA%94%E6%A1%88%E5%AE%89%E8%A3%9D" class="hash-link" aria-label="Direct link to 檔案安裝" title="Direct link to 檔案安裝">​</a></h3>
<p>只能在 Node.js 模式下使用，把插件複製到 <code>/plugins</code> 的資料夾下，像這樣：</p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">├── plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── relink/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── js/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── tiddlers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── plugin.info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── relink-markdown/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── js/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── plugin.info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── readme.tid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── tiddlers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tiddlywiki.info</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="插件系統">插件系統<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%B5%B1" class="hash-link" aria-label="Direct link to 插件系統" title="Direct link to 插件系統">​</a></h2>
<p>插件本質上是由一組名為「影子條目」的特殊的條目 (Tiddlers) 打包而成的。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="影子條目-shadowtiddlers">影子條目 (ShadowTiddlers)<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E5%BD%B1%E5%AD%90%E6%A2%9D%E7%9B%AE-shadowtiddlers" class="hash-link" aria-label="Direct link to 影子條目 (ShadowTiddlers)" title="Direct link to 影子條目 (ShadowTiddlers)">​</a></h3>
<p>相較於一般的條目只是一些使用者可以任意編輯的資料，影子條目是一些跟 Tiddlywiki 核心運作有關的條目，比如：定義按鈕的外觀與行為。</p>
<p>當使用者編輯影子條目時，Tiddlywiki 會創建一個同名的副本，並且覆蓋原始條目的行為，當使用者刪除這個副本，則會切換回使用原本的影子條目，形同預設值一般的作用。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="插件的型態">插件的型態<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9E%8B%E6%85%8B" class="hash-link" aria-label="Direct link to 插件的型態" title="Direct link to 插件的型態">​</a></h3>
<p>當使用「檔案安裝」時，插件是以類似專案資料夾的方式存在，並且以資料夾下的 <code>plugin.info</code> 檔案作為進入點，例如：</p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">├── plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── relink/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── js/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── tiddlers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── plugin.info</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>而使用「網頁拖曳」時，插件中的數個影子條目會被打包成單一 JSON 檔的型態，例如：</p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">├── tiddlers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── $__plugins_tiddlywiki_markdown.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── $__plugins_tiddlywiki_markdown.json.meta</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="幾個目前我正在使用的插件">幾個目前我正在使用的插件<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#%E5%B9%BE%E5%80%8B%E7%9B%AE%E5%89%8D%E6%88%91%E6%AD%A3%E5%9C%A8%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8F%92%E4%BB%B6" class="hash-link" aria-label="Direct link to 幾個目前我正在使用的插件" title="Direct link to 幾個目前我正在使用的插件">​</a></h2>
<ul>
<li><a href="https://tiddlywiki.com/plugins/tiddlywiki/markdown/" target="_blank" rel="noopener noreferrer">https://tiddlywiki.com/plugins/tiddlywiki/markdown/</a>
<ul>
<li>讓條目能夠以 Markdown 撰寫</li>
</ul>
</li>
<li><a href="https://github.com/kookma/TW-Shiraz" target="_blank" rel="noopener noreferrer">https://github.com/kookma/TW-Shiraz</a>
<ul>
<li>提供一些諸如 Alert 或動態表格之類的 UI 組件</li>
</ul>
</li>
<li><a href="https://ibnishak.github.io/Tesseract/projects/tekan/Tekan.html" target="_blank" rel="noopener noreferrer">https://ibnishak.github.io/Tesseract/projects/tekan/Tekan.html</a>
<ul>
<li>並沒有正在使用，但是是一個讓我越陷越深的兔子洞</li>
</ul>
</li>
</ul>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-install-plugin-web-0b8902">
<p>Manually installing a plugin. Retrieved 2024-02-25, from <a href="https://tiddlywiki.com/static/Manually%2520installing%2520a%2520plugin.html" target="_blank" rel="noopener noreferrer">https://tiddlywiki.com/static/Manually%2520installing%2520a%2520plugin.html</a> <a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#user-content-fnref-install-plugin-web-0b8902" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-install-plugin-nodejs-0b8902">
<p>Installing custom plugins on Node.js. Retrieved 2024-02-25, from <a href="https://tiddlywiki.com/static/Installing%2520custom%2520plugins%2520on%2520Node.js.html" target="_blank" rel="noopener noreferrer">https://tiddlywiki.com/static/Installing%2520custom%2520plugins%2520on%2520Node.js.html</a> <a href="https://flyskypie.github.io/blog/2024-02-28_tiddlywiki-journey-2#user-content-fnref-install-plugin-nodejs-0b8902" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="TiddlyWiki" term="TiddlyWiki"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[我的 Tiddlywiki 之旅 - 啟程]]></title>
        <id>https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1</id>
        <link href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1"/>
        <updated>2024-02-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我從接觸 Tiddlywiki 到現在 (2023-10-29~2024-01-30) 也已經三個月了，雖然預計要做的事情還沒完成，不過想把累積的筆記做個階段性的總整理。]]></summary>
        <content type="html"><![CDATA[<p>我從接觸 Tiddlywiki 到現在 (2023-10-29~2024-01-30) 也已經三個月了，雖然預計要做的事情還沒完成，不過想把累積的筆記做個階段性的總整理。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="旅程的起點">旅程的起點<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E6%97%85%E7%A8%8B%E7%9A%84%E8%B5%B7%E9%BB%9E" class="hash-link" aria-label="Direct link to 旅程的起點" title="Direct link to 旅程的起點">​</a></h2>
<p>目前我使用 <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">Docusaurus</a> 撰寫網誌並作為個人網站，但是用來表達我的 Side Project 仍然不夠合適，想來想去還是 wiki 的形式最符合我的需求，不久前跟人聊天的時候提到了 <a href="https://js.wiki/" target="_blank" rel="noopener noreferrer">Wiki.js</a>，於是我便朝這個<a href="https://alternativeto.net/software/wiki-js/" target="_blank" rel="noopener noreferrer">方向</a>去搜尋了。</p>
<p>接著我發現了 Tiddlywiki，當時正戴著耳機聽著<a href="https://www.youtube.com/watch?v=ztzq05IzYds" target="_blank" rel="noopener noreferrer">戰鎚 40K 機械神教的 BGM</a> ，當下我腦海中浮現了一個念頭：</p>
<blockquote>
<p>Goddess of open source just kissed my forehead.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="非線性">非線性<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E9%9D%9E%E7%B7%9A%E6%80%A7" class="hash-link" aria-label="Direct link to 非線性" title="Direct link to 非線性">​</a></h2>
<blockquote>
<p>一個非線性的網頁式筆記
a non-linear personal web notebook</p>
</blockquote>
<p>這是 Tiddlywiki 官方對自己簡介，不過「非線性」一詞其實非常抽象，不過我想它想要相對於「線性」概念應該是指線性敘事 (<a href="https://en.wikipedia.org/wiki/Story_structure#Linear_narrative" target="_blank" rel="noopener noreferrer">Linear narrative</a>)，換句話說 Tiddlywiki 指稱的非線性應該是指非線性敘事 (<a href="https://en.wikipedia.org/wiki/Nonlinear_narrative" target="_blank" rel="noopener noreferrer">Nonlinear narrative</a>)；在紀錄或閱讀資料的時候能夠透過超連結在不同的條目之間穿梭瀏覽。相較之下一般的電子文件是由上而下（線性）閱讀的。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="使用-tiddlywiki">使用 Tiddlywiki<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E4%BD%BF%E7%94%A8-tiddlywiki" class="hash-link" aria-label="Direct link to 使用 Tiddlywiki" title="Direct link to 使用 Tiddlywiki">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="基本模式">基本模式<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E5%9F%BA%E6%9C%AC%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="Direct link to 基本模式" title="Direct link to 基本模式">​</a></h3>
<p>一個"經典"的 Tiddlywiki 檔案會是一個單一的 HTML 檔案，一個 Wiki 的資料（條目、檔案...等）和 Tiddlywiki 的程式都被放在這個單一的 HTML 檔案裡面，使用者可以透過網頁瀏覽器開啟這個檔案使用 Tiddlywiki。</p>
<p>當使用者編輯內容，所有修改都會<strong>暫時</strong>存在瀏覽器的記憶體之中，直到使用者按下"儲存"紐，這時瀏覽器會下載一個新的 HTML，這個新的檔案是原本檔案的副本，但是包含了剛才修改的內容。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="進階模式">進階模式<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E9%80%B2%E9%9A%8E%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="Direct link to 進階模式" title="Direct link to 進階模式">​</a></h3>
<p>在基本模式中，使用者必須反覆下載更新版來實現「存檔」功能，這是因為出於安全考量，一般情況下瀏覽器不具有任意讀寫硬碟上資料的權限。透過一些輔助工具可以提高 Tiddlywiki 的使用者體驗：</p>
<ul>
<li>應用程式</li>
<li>瀏覽器插件</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_Hj9u" id="應用程式">應用程式<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F" class="hash-link" aria-label="Direct link to 應用程式" title="Direct link to 應用程式">​</a></h4>
<p><a href="https://github.com/TiddlyWiki/TiddlyDesktop" target="_blank" rel="noopener noreferrer">TiddlyDesktop</a> 或是 <a href="https://github.com/tiddly-gittly/TidGi-Desktop" target="_blank" rel="noopener noreferrer">TidGi</a> 等應用程式在執行 Tiddlywiki 的同時，允許使用者直接進行存檔（或自動存檔）而無須額外重複下載更新，有些應用程式甚至提供管理多個 Tiddlywiki 檔案的功能。</p>
<h4 class="anchor anchorWithStickyNavbar_Hj9u" id="瀏覽器插件">瀏覽器插件<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E7%80%8F%E8%A6%BD%E5%99%A8%E6%8F%92%E4%BB%B6" class="hash-link" aria-label="Direct link to 瀏覽器插件" title="Direct link to 瀏覽器插件">​</a></h4>
<p><a href="https://github.com/ibnishak/Timimi/" target="_blank" rel="noopener noreferrer">Timimi</a> 同樣可以允許使用者直接對 Tiddlywiki 進行存檔，只是不是以應用程式的方式實現，而是以瀏覽器插件的形式存在。</p>
<p>使用它需要完成兩個前置作業：</p>
<ul>
<li>下載並執行 "Timimi 程式"</li>
<li>安裝 "Timimi 瀏覽器插件"</li>
</ul>
<p>這個方案允許使用者使用自己熟悉的網頁瀏覽器編輯 Tiddlywiki，只是額外的步驟可能會讓人覺得不方便。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="伺服器-nodejs-模式">伺服器 (Node.js) 模式<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E4%BC%BA%E6%9C%8D%E5%99%A8-nodejs-%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="Direct link to 伺服器 (Node.js) 模式" title="Direct link to 伺服器 (Node.js) 模式">​</a></h3>
<p>Tiddlywiki 允許以 Node.js 執行，至於 Node.js 與 NPM (或其他套件管理工具) 的安裝與環境設定我就不在此多做解釋了。安裝 <code>tiddlywiki</code> 指令：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -g tiddlywiki</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>新增一個 Tiddlywiki Node.js 專案：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">tiddlywiki &lt;Name&gt; --init server</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>這個指令會初始化一個 Tiddlywiki 並設定一些在 Node.js 模式下需要的插件，諸如：<code>tiddlywiki/tiddlyweb</code> 和 <code>tiddlywiki/filesystem</code>。</p>
<p>接著執行：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">tiddlywiki &lt;Name&gt; --listen</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再打開 <a href="http://127.0.0.1:8080/" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080</a> 就能看到你的 Tiddlywiki 了！</p>
<p>與「基本模式」和「進階模式」不同是，新增的條目並不會被打包成單一 HTML，而是一個條目對應一（或兩個）檔案的方式儲存在資料夾中。</p>
<hr>
<p>另外值得一提的是，<code>tiddlywiki</code> 不只能夠以 Node.js 啟動一個伺服器，還提供了一系列的 CLI 操作，比如：建構 (Build) 靜態版本、從 HTML 抽出指定條目...等。</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ tiddlywiki --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usage: tiddlywiki [&lt;wikifolder&gt;] [--&lt;command&gt; [&lt;args&gt;...]...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Available commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* build: Automatically run configured commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* clearpassword: Clear a password for subsequent crypto operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* commands: Run commands returned from a filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* deletetiddlers: Deletes a group of tiddlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* editions: Lists the available editions of TiddlyWiki</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* fetch: Fetch tiddlers from wiki by URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* help: Display help for TiddlyWiki commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* import: Import tiddlers from a file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* init: Initialise a new wiki folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* listen: Provides an HTTP server interface to TiddlyWiki</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* load: Load tiddlers from a file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* makelibrary: Construct library plugin required by upgrade process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* output: Set the base output directory for subsequent commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* password: Set a password for subsequent crypto operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* render: Renders individual tiddlers to files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* rendertiddler: Render an individual tiddler as a specified ContentType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* rendertiddlers: Render tiddlers matching a filter to a specified ContentType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* save: Saves individual raw tiddlers to files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* savelibrarytiddlers: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* savetiddler: Saves a raw tiddler to a file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* savetiddlers: Saves a group of raw tiddlers to a directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* savewikifolder: Saves a wiki to a new wiki folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* server: Provides an HTTP server interface to TiddlyWiki (deprecated in favour of the new listen command)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* setfield: Prepares external tiddlers for use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* unpackplugin: Unpack the payload tiddlers from a plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* verbose: Triggers verbose output mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* version: Displays the version number of TiddlyWiki</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="變體與其他衍生">變體與其他衍生<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E8%AE%8A%E9%AB%94%E8%88%87%E5%85%B6%E4%BB%96%E8%A1%8D%E7%94%9F" class="hash-link" aria-label="Direct link to 變體與其他衍生" title="Direct link to 變體與其他衍生">​</a></h2>
<p>基於 Tiddlywiki 的設計哲學，而造就了「基本模式」、「進階模式」或是「伺服器模式」這幾種不同的使用方式，不過其實它們都不太符合一般使用者使用軟體的習慣，因此有不少衍生專案正是為了改善它的使用體驗而存在的。這裡是一些我在爬文的過程發現的衍生型 Tiddlywiki<sup><a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#user-content-fn-variant-57f790" id="user-content-fnref-variant-57f790" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<ul>
<li><a href="https://noteself.org/" target="_blank" rel="noopener noreferrer">NoteSelf</a>
<ul>
<li>使用 <a href="https://pouchdb.com/" target="_blank" rel="noopener noreferrer">PouchDB</a> 將資料儲存在瀏覽器</li>
</ul>
</li>
<li><a href="https://tiddlyhost.com/" target="_blank" rel="noopener noreferrer">Tiddlyhost</a>
<ul>
<li>使用 Ruby 作為後端語言</li>
<li>可以直接註冊使用</li>
</ul>
</li>
<li><a href="https://feather.wiki/" target="_blank" rel="noopener noreferrer">Feather Wiki</a>
<ul>
<li>追求輕量化實現的網頁 Wiki</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="補充說明">補充說明<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#%E8%A3%9C%E5%85%85%E8%AA%AA%E6%98%8E" class="hash-link" aria-label="Direct link to 補充說明" title="Direct link to 補充說明">​</a></h2>
<p>「基本模式」、「進階模式」或是「伺服器模式」是我為了方便解釋而使用的詞彙，並以單純使用者的角度去區分，實際上 Tiddlywiki 本身並不是以這樣的方式區分或是稱呼它們。</p>
<p>本文使用的「條目」同樣是為了方便解釋而沿用 Wikipedia 的使用習慣，實際上在 Tiddlywiki 中，條目被稱作 「Tiddler」。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-variant-57f790">
<p>知識連結的工具：TiddlyWiki. (n.d.). Retrieved 2024-01-30, from <a href="https://roulesophy.github.io/%E7%9F%A5%E8%AD%98%E9%80%A3%E7%B5%90%E7%9A%84%E5%B7%A5%E5%85%B7-tiddlywiki/" target="_blank" rel="noopener noreferrer">https://roulesophy.github.io/知識連結的工具-tiddlywiki/</a> <a href="https://flyskypie.github.io/blog/2024-02-25_tiddlywiki-journey-1#user-content-fnref-variant-57f790" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="TiddlyWiki" term="TiddlyWiki"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[淺談 Mapbox GL JS 的渲染邏輯]]></title>
        <id>https://flyskypie.github.io/blog/2024-01-02_mapbox-layer</id>
        <link href="https://flyskypie.github.io/blog/2024-01-02_mapbox-layer"/>
        <updated>2024-01-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本人因為公司的專案而接觸 GIS (Geographic Information System)，並且在 Three.js 和 Mapbox GL JS 兩個函式庫都已經累積了基本的經驗。最近為了跟客戶的後端工程師解釋資料結構而寫了一些文件，個人感到十分滿意就整理一下發成一篇文章好了。]]></summary>
        <content type="html"><![CDATA[
<p>本人因為公司的專案而接觸 GIS (Geographic Information System)，並且在 Three.js 和 Mapbox GL JS 兩個函式庫都已經累積了基本的經驗。最近為了跟客戶的後端工程師解釋資料結構而寫了一些文件，個人感到十分滿意就整理一下發成一篇文章好了。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="不是-mapbox-gl-的方式">不是 Mapbox GL 的方式<a href="https://flyskypie.github.io/blog/2024-01-02_mapbox-layer#%E4%B8%8D%E6%98%AF-mapbox-gl-%E7%9A%84%E6%96%B9%E5%BC%8F" class="hash-link" aria-label="Direct link to 不是 Mapbox GL 的方式" title="Direct link to 不是 Mapbox GL 的方式">​</a></h2>
<p>這是資料和 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model" target="_blank" rel="noopener noreferrer">DOM</a>：</p>
<p><img decoding="async" loading="lazy" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjI0NS4xN21tIiBoZWlnaHQ9IjEwOS41bW0iIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI0NS4xNyAxMDkuNSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjIuNTM1IC0xMTY0LjYpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjYuMTc0IC0xMi42OTYpIj48cmVjdCB4PSI0OC43NTgiIHk9IjExNzcuMyIgd2lkdGg9IjI0NS4wNyIgaGVpZ2h0PSIxMDkuNCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iLjEiIHN0eWxlPSJwYWludC1vcmRlcjpzdHJva2UgZmlsbCBtYXJrZXJzIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE5Ny41NiA4OTYuMTQpIj48ZWxsaXBzZSBjeD0iNDE2LjIxIiBjeT0iMzU4LjM2IiByeD0iNC45NTg1IiByeT0iMi4yMDk4IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxwYXRoIGQ9Im00MjMuNjUgMzQzLjkzYy01LjQwNjcgNC4zMjQtNC44MDc3IDkuMzY4NC00LjEwNDMgMTQuNDI1IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzIi8+PGVsbGlwc2UgdHJhbnNmb3JtPSJzY2FsZSgtMSwxKSIgY3g9Ii00MzguMTkiIGN5PSIzNTguNjkiIHJ4PSI0Ljk1ODUiIHJ5PSIyLjIwOTgiIHN0eWxlPSJwYWludC1vcmRlcjpzdHJva2UgZmlsbCBtYXJrZXJzIi8+PHBhdGggZD0ibTQzMC41NiAzNDQuMDhjNS40MDY3IDQuMzI0IDQuODA3NyA5LjM2ODQgNC4xMDQzIDE0LjQyNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMyIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDUwLjIgMTExMi41KSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjMiPjxwYXRoIGQ9Im02NjUuMDMgODYtMTUuMDEgOC43NTg4IDE1LjAxIDguNzU4OCIvPjxwYXRoIGQ9Im02OTIuODggODYgMTUuMDEgOC43NTg4LTE1LjAxIDguNzU4OCIvPjxwYXRoIGQ9Im02ODkuMjEgODUuMjEzLTkuMDE4OCAxOS4wOTEiLz48L2c+PGc+PHBhdGggZD0ibTg3LjkyMyAxMjQwLjJjLTIuMDQwMS0wLjU1NzEtMy43MzM0LTIuMDMwMS00LjY5MTEtNC4wODA2bC0wLjU3MjMzLTEuMjI1NXYtNDAuNjQ0bDAuNTcyMzMtMS4yMjU0YzAuNjI0LTEuMzM2MSAxLjY1Mi0yLjUyNCAyLjg0ODgtMy4yOTIxIDEuNjI0Ny0xLjA0MjcgMi4yOTk0LTEuMDk5IDEzLjE1Ni0xLjA5OSA2Ljk5NTUgMCAxMC4yIDAuMDY5IDEwLjUyNiAwLjIyODMgMC41NzMyNSAwLjI3ODkgMTIuMzc0IDEzLjA1MSAxMi44ODIgMTMuOTQyIDAuMzQwMjggMC41OTcyIDAuMzU5MjkgMS42MTE3IDAuMzA2MzYgMTYuMzYzbC0wLjA1NjQgMTUuNzI2LTAuNTQ3MzcgMS4xNjc5Yy0wLjc2NjUzIDEuNjM1NC0yLjE1NDEgMy4wNDczLTMuNjkzOCAzLjc1ODVsLTEuMjczMyAwLjU4ODEtMTQuMTk1IDAuMDQyYy0xMS43NiAwLjAzNC0xNC4zNzgtMC4wMS0xNS4yNjMtMC4yNXptMjkuMjkxLTMuMTc0NmMwLjc3MTQ4LTAuMjkxNCAxLjY1MDEtMS4xNDggMi4xMjU0LTIuMDcyMyAwLjM3MjIyLTAuNzIzNiAwLjM4OTc3LTEuMzc5MyAwLjM4OTc3LTE0LjU1MnYtMTMuNzk0aC0zLjAxMjVjLTEuODYyNCAwLTMuNDAyNC0wLjEwNjgtNC4wMzM3LTAuMjc1Ny0yLjQ4NTUtMC42NjQ5LTQuMTYzOS0yLjAyMjYtNS4xODA1LTQuMTkwNy0wLjUyMjc0LTEuMTE0OC0wLjU0MDE3LTEuMjc4Ni0wLjYwNjMzLTUuNjk4MWwtMC4wNjgxLTQuNTUwMi05LjI2MSAwLjA1N2MtMTAuNDEzIDAuMDY0LTkuNjE1My0wLjA1Ny0xMS4wMTUgMS42NzJsLTAuNjI0NTQgMC43NzE2LTAuMDU5MSAxOS42MzljLTAuMDMyNSAxMC44MDItOGUtMyAxOS45MjMgMC4wNTQxIDIwLjI3IDAuMDYyMiAwLjM0NjggMC40Mjg5MSAwLjk5OTUgMC44MTQ4NiAxLjQ1MDQgMS4zNDUzIDEuNTcxNiAwLjM5ODcxIDEuNDgzNCAxNS45NzUgMS40ODg2IDkuMzUzOCAwIDE0LjExNS0wLjA2NyAxNC41MDEtMC4yMTI2em0tMjMuODQ3LTcuMTE5NmMtMC4zMjgzNS0wLjMyODQtMC41OTcwMS0wLjc5NS0wLjU5NzAxLTEuMDM2OSAwLTAuMjQyIDAuMjY4NjYtMC43MDg2IDAuNTk3MDEtMS4wMzY5bDAuNTk3MDEtMC41OTdoMTQuMzA1bDAuNTU2MDMgMC40NzgzYzAuMzk3MyAwLjM0MTcgMC41NTYwMyAwLjY3MTYgMC41NTYwMyAxLjE1NTZzLTAuMTU4NzMgMC44MTM5LTAuNTU2MDMgMS4xNTU2bC0wLjU1NjAzIDAuNDc4M2gtMTQuMzA1em0tMmUtMyAtNy45NTQ3Yy0wLjM0MTU4LTAuMjc2Ni0wLjQ3MTk2LTAuNTk0Mi0wLjQ3MTk2LTEuMTQ5NiAwLTAuNTU1NSAwLjEzMDM4LTAuODczMSAwLjQ3MTk2LTEuMTQ5NyAwLjQ0NDI2LTAuMzU5NyAwLjk3MTgtMC4zODIxIDguOTkxNy0wLjM4MjFoOC41MTk4bDAuNDQ0MDggMC40NzI3YzAuNTY1MTggMC42MDE2IDAuNTgyMDYgMS42MzU5IDAuMDM1NiAyLjE4MjQtMC4zOTU0OSAwLjM5NTQtMC42ODA4IDAuNDA4NS04Ljk2MzkgMC40MDg1LTguMDU0NyAwLTguNTgzLTAuMDIyLTkuMDI3My0wLjM4MjJ6bTAuMDIzNC03Ljk4NjRjLTAuODkzODMtMC44OTM5LTAuNjI5MDUtMi4yMjkgMC41MjkzOC0yLjY2OTUgMC4yOTY1LTAuMTEyNyA0LjA2NTMtMC4xOTM4IDguOTI0OC0wLjE5MjEgOS4wODIzIDAgOS4xOTExIDAuMDE1IDkuNzA2NSAxLjA5MDUgMC4zNDc5NiAwLjcyNTcgMC4wMjY5IDEuNjA5OC0wLjcwNTY0IDEuOTQzNi0wLjM1MTI3IDAuMTYwMS0zLjE5NDEgMC4yMzA3LTkuMjc5MSAwLjIzMDctOC40NjI3IDAtOC43ODY5LTAuMDE0LTkuMTc1OS0wLjQwMzJ6bTI1LjE4OS0xMS4wODVjLTAuMzQwOTgtMC4zNjUxLTIuMzU0MS0yLjU0NzktNC40NzM1LTQuODUwN3MtMy45MzYzLTQuMjIwOC00LjAzNzQtNC4yNjIyYy0wLjEwNjM2LTAuMDQ0LTAuMTUgMS4yOTA1LTAuMTAzNTcgMy4xNjU3IDAuMDY1MyAyLjYzNjIgMC4xNTAwNiAzLjM3NDQgMC40NTQzMSAzLjk1NTkgMS4wOTk2IDIuMTAxNCAyLjMwMjggMi41OTMxIDYuNDQyNCAyLjYzMjdsMi4zMzc4IDAuMDIyeiIgc3Ryb2tlLXdpZHRoPSIuNzcxOTMiLz48Y2lyY2xlIGN4PSI2NS45MDkiIGN5PSIxMjI4LjIiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48ZWxsaXBzZSBjeD0iOTEuNzU1IiBjeT0iMTI1My41IiByeD0iNC45NTg1IiByeT0iMi4yMDk4IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjwvZz48cGF0aCBkPSJtNjUuMTMyIDEyMjguN2M0LjU5MjItNy4yMjMyIDEwLjczNy0xMC45ODUgMTguNjUzLTEwLjc5NyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMyIvPjxjaXJjbGUgdHJhbnNmb3JtPSJzY2FsZSgtMSwxKSIgY3g9Ii0xNDAuNzIiIGN5PSIxMjI3LjkiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48cGF0aCBkPSJtMTQxLjQ5IDEyMjguNGMtNC41OTIyLTcuMjIzMS0xMC43MzctMTAuOTg1LTE4LjY1My0xMC43OTciIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48cGF0aCBkPSJtOTkuMTk2IDEyMzkuMWMtNS40MDY3IDQuMzIzOS00LjgwNzcgOS4zNjgzLTQuMTA0MyAxNC40MjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48ZWxsaXBzZSB0cmFuc2Zvcm09InNjYWxlKC0xLDEpIiBjeD0iLTExMy43MyIgY3k9IjEyNTMuOCIgcng9IjQuOTU4NSIgcnk9IjIuMjA5OCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48cGF0aCBkPSJtMTA2LjEgMTIzOS4yYzUuNDA2NyA0LjMyNCA0LjgwNzcgOS4zNjg0IDQuMTA0MyAxNC40MjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48Y2lyY2xlIHRyYW5zZm9ybT0ibWF0cml4KC0uODY2MDMgLS41IC0uNSAuODY2MDMgMCAwKSIgY3g9Ii04NDkuMyIgY3k9Ijk0NCIgcj0iMy42OTA0IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxwYXRoIGQ9Im0yNjMuOTQgMTI0M2MtMC4zNjUzOC04LjU1MTUtMy44MDU4LTE0Ljg4Mi0xMC43NTUtMTguNjc3IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIzIi8+PGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgtMzApIiBjeD0iLTQ1My4wNyIgY3k9IjExNzMuNSIgcj0iMy42OTA0IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxnIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJtMTkzLjk1IDEyNDMuNmMwLjM2NTM4LTguNTUxNSAzLjgwNTgtMTQuODgyIDEwLjc1NS0xOC42NzciIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMyIvPjxjaXJjbGUgY3g9Ijg5LjM2OSIgY3k9IjEyMDQuMiIgcj0iOS4xMjM1IiBmaWxsPSIjZmZmIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxjaXJjbGUgY3g9IjExNS43MSIgY3k9IjEyMDQuMiIgcj0iOS4xMjM1IiBmaWxsPSIjZmZmIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjwvZz48Y2lyY2xlIGN4PSI4OS4zNjkiIGN5PSIxMjA0LjIiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48Y2lyY2xlIGN4PSIxMTUuNzEiIGN5PSIxMjA0LjIiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48Y2lyY2xlIGN4PSIyMTYuNjgiIGN5PSIxMjE4LjUiIHI9IjkuMTIzNSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0eWxlPSJwYWludC1vcmRlcjpzdHJva2UgZmlsbCBtYXJrZXJzIi8+PGNpcmNsZSBjeD0iMjQzLjAyIiBjeT0iMTIxOC41IiByPSI5LjEyMzUiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxjaXJjbGUgY3g9IjIxNi42OCIgY3k9IjEyMTguNSIgcj0iMy42OTA0IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxjaXJjbGUgY3g9IjI0My4wMiIgY3k9IjEyMTguNSIgcj0iMy42OTA0IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjx0ZXh0IHg9IjgyLjYxMzUxIiB5PSIxMjc0LjkzNzUiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4LjkwMXB4IiBsZXR0ZXItc3BhY2luZz0iMHB4IiBzdHJva2Utd2lkdGg9Ii40NzI1MyIgd29yZC1zcGFjaW5nPSIwcHgiIHN0eWxlPSJsaW5lLWhlaWdodDoxLjI1IiB4bWw6c3BhY2U9InByZXNlcnZlIj48dHNwYW4geD0iODIuNjEzNTEiIHk9IjEyNzQuOTM3NSIgc3Ryb2tlLXdpZHRoPSIuNDcyNTMiPkRhdGE8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSIyMDcuMzQ3MjEiIHk9IjEyNzQuNTk3NCIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTguOTAxcHgiIGxldHRlci1zcGFjaW5nPSIwcHgiIHN0cm9rZS13aWR0aD0iLjQ3MjUzIiB3b3JkLXNwYWNpbmc9IjBweCIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEuMjUiIHhtbDpzcGFjZT0icHJlc2VydmUiPjx0c3BhbiB4PSIyMDcuMzQ3MjEiIHk9IjEyNzQuNTk3NCIgc3Ryb2tlLXdpZHRoPSIuNDcyNTMiPkRPTTwvdHNwYW4+PC90ZXh0PjwvZz48L2c+PC9zdmc+Cg==" width="927" height="414" class="img_UJFd"></p>
<p>一般來說，網頁前端的開發者會透過資料的屬性 (properties) 來決定渲染的樣式 (Style)：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_data-properties-styles-f8d53cc2bea14c33baf6b69c5e8a2cd8.webp" width="905" height="350" class="img_UJFd"></p>
<p>如果不經過特殊的處理，當大量的資料進入程式，程式就會試圖渲染大量的 DOM：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_data-properties-styles-heavy-15a88d4a544afe503fc61a4468d03df4.webp" width="1086" height="424" class="img_UJFd"></p>
<p>因此基於 DOM 的 GIS 函式庫通常無法用來顯示巨量的資料點。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="mapbox-gl-js-的方式">Mapbox GL JS 的方式<a href="https://flyskypie.github.io/blog/2024-01-02_mapbox-layer#mapbox-gl-js-%E7%9A%84%E6%96%B9%E5%BC%8F" class="hash-link" aria-label="Direct link to Mapbox GL JS 的方式" title="Direct link to Mapbox GL JS 的方式">​</a></h2>
<p>Mapbox GL JS 預設是以 WebGL 模式處理資料的，並且額外支援 DOM 的渲染（部份 GIS 函式庫剛好相反，預設是 DOM，WebGL 的支援是附帶的）。</p>
<p>而這是 <a href="https://docs.mapbox.com/help/glossary/layer/" target="_blank" rel="noopener noreferrer">圖層 (Layer)</a>：</p>
<p><img decoding="async" loading="lazy" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjEyMy45MW1tIiBoZWlnaHQ9IjEwOS43OG1tIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjMuOTEgMTA5Ljc4IiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zMy4zMjQgLTE1NDkpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTcuNzUyIC01MS4wNDYpIj48cmVjdCB4PSI1MS4xMjYiIHk9IjE2MDAuMSIgd2lkdGg9IjEyMy44MSIgaGVpZ2h0PSIxMDkuNjgiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjx0ZXh0IHg9IjgyLjMwNDcwMyIgeT0iMTY5Ny42ODMyIiBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOC45MDFweCIgbGV0dGVyLXNwYWNpbmc9IjBweCIgc3Ryb2tlLXdpZHRoPSIuNDcyNTMiIHdvcmQtc3BhY2luZz0iMHB4IiBzdHlsZT0ibGluZS1oZWlnaHQ6MS4yNSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHRzcGFuIHg9IjgyLjMwNDcwMyIgeT0iMTY5Ny42ODMyIiBzdHJva2Utd2lkdGg9Ii40NzI1MyI+TGF5ZXI8L3RzcGFuPjwvdGV4dD48Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKC0xNi4zMDYpIiBjeD0iLTM5OS4yNCIgY3k9IjE2MDEuMiIgcj0iMy42OTA0IiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxlbGxpcHNlIGN4PSI5OC45MTMiIGN5PSIxNjc0LjQiIHJ4PSI0Ljk1ODUiIHJ5PSIyLjIwOTgiIHN0eWxlPSJwYWludC1vcmRlcjpzdHJva2UgZmlsbCBtYXJrZXJzIi8+PHBhdGggZD0ibTY1Ljc5MSAxNjQ5LjZjMi4zNzk1LTguMjIyIDcuMjIwNy0xMy41NTggMTQuODcxLTE1LjYiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48Y2lyY2xlIHRyYW5zZm9ybT0ibWF0cml4KC0uOTU5NzcgLS4yODA3NyAtLjI4MDc3IC45NTk3NyAwIDApIiBjeD0iLTYwNy41NiIgY3k9IjE1NDEiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48cGF0aCBkPSJtMTUxLjA2IDE2NTAuM2MtMi4zNzk1LTguMjIyLTcuMjIwNy0xMy41NTgtMTQuODcxLTE1LjYiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48cGF0aCBkPSJtMTA2LjM1IDE2NjBjLTUuNDA2NyA0LjMyNC00LjgwNzcgOS4zNjg0LTQuMTA0MyAxNC40MjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjMiLz48ZWxsaXBzZSB0cmFuc2Zvcm09InNjYWxlKC0xLDEpIiBjeD0iLTEyMC44OSIgY3k9IjE2NzQuNyIgcng9IjQuOTU4NSIgcnk9IjIuMjA5OCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48cGF0aCBkPSJtMTEzLjI2IDE2NjAuMWM1LjQwNjcgNC4zMjM5IDQuODA3NyA5LjM2ODMgNC4xMDQzIDE0LjQyNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMyIvPjxwYXRoIGQ9Im0xMDYuNiAxNjU5LjVjLTMuNzQ1OS0wLjM5NC02LjQ1ODgtMS4xNjk5LTkuNDUwNC0yLjcwMjktMy45NzkzLTIuMDM5Mi03LjQ5MDQtNS4yNTc0LTkuODQyNS05LjAyMTQtMC44MDgzNS0xLjI5MzYtMS43NjM4LTMuMjExNS0yLjI0ODQtNC41MTMzLTAuMjE2ODMtMC41ODI0LTAuNDE1MDQtMS4wNzk3LTAuNDQwNS0xLjEwNTItMC4wMjUxLTAuMDI1LTEuMTQ0NyAwLjAzMS0yLjQ4NyAwLjEyNDktMS4zNDIzIDAuMDk0LTIuNDQ5NCAwLjE2MDgtMi40NjAyIDAuMTQ4MS0wLjAxOTEtMC4wMjMgMS4zMjM1LTEuNzU2IDQuNjUzOC02LjAwNDMgMC45ODAwMS0xLjI1MDEgMS44MTcxLTIuMjU0NSAxLjg2MDMtMi4yMzE5IDAuMjkzMzkgMC4xNTMgNy40NTY5IDcuMjE0OCA3LjM4ODQgNy4yODM0LTAuMDI0MSAwLjAyNC0xLjA1OTMgMC4xMDkxLTIuMzAwOSAwLjE4OTZsLTIuMjU3NiAwLjE0NjIgMC4wMjMxIDAuMzMyNGMwLjAyOTIgMC40MjIyIDEuMTgyNCAyLjcyNSAxLjkxODYgMy44MzIzIDIuMzYyOSAzLjU1NDMgNS44NzQ3IDYuNDQ0MyA5LjY4MTQgNy45NjcxIDIuODI0MiAxLjEyOTggNC43NDMgMS40OTAxIDcuOTM1NiAxLjQ5MDEgMi41MDYyIDAgMy43Nzc3LTAuMTYwOCA1Ljc0Mi0wLjcyNjUgNi4yNjExLTEuODAyOSAxMS4zODItNi40MTQ3IDEzLjc5My0xMi40MjJsMC40MzE5NS0xLjA3NiAyLjA5ODUtMC4wMzNjMS4yMDgtMC4wMTkgMi4wOTg2IDAuMDEzIDIuMDk4NiAwLjA3NiAwIDAuMzQxNy0xLjA2MTMgMy4wOTg5LTEuNjI2OSA0LjIyNjctMS4zMjI4IDIuNjM3NS0yLjU1MTMgNC4zNzE4LTQuNTc5NyA2LjQ2NS0zLjg0NDkgMy45Njc4LTguNzA1NCA2LjQ3ODctMTQuMTkzIDcuMzMxOS0xLjE2NzMgMC4xODE1LTQuNzkwMSAwLjMyMTUtNS43Mzg1IDAuMjIxOHptLTEuMzc1Ni0xMS4yMTh2LTIuMjAwMWwtMC4zMjA0NS0wLjA4Yy0wLjE3NjE5LTAuMDQ0LTAuNzQ1MDctMC4yNzQ1LTEuMjY0LTAuNTExN2wtMC45NDM1OC0wLjQzMTMtMS41NDc5IDEuNTQ0NC0xLjU0NzkgMS41NDQ1LTQuNzIxNy00LjcyMTggMS41NDQ0LTEuNTQ3OSAxLjU0NDUtMS41NDc5LTAuNDIyNy0wLjkzNWMtMC4yMzI0Mi0wLjUxNDItMC40NTc5LTEuMDgzLTAuNTAwOTYtMS4yNjRsLTAuMDc4NS0wLjMyOWgtNC40MjE2di02LjY5OWgyLjIwNWMyLjE4NDkgMCAyLjIwNTYtMWUtMyAyLjI3OTQtMC4yNjkyIDAuMDQxMy0wLjE0OCAwLjI2ODU0LTAuNzE3MiAwLjUwNTktMS4yNjQ4bDAuNDMxNjUtMC45OTU3LTEuNTQzNi0xLjU0NzEtMS41NDM2LTEuNTQ2OSA0LjcyMTctNC43MjE4IDEuNTQ3OSAxLjU0NDQgMS41NDc5IDEuNTQ0NSAwLjk0MzU5LTAuNDMxNGMwLjUxODk4LTAuMjM3MiAxLjA4NzgtMC40Njc0IDEuMjY0LTAuNTExN2wwLjMyMDQ1LTAuMDh2LTQuNDAwMmg2LjY5OXY0LjQwMDJsMC4zMjA0NiAwLjA4YzAuMTc2MTggMC4wNDQgMC43NDUwNyAwLjI3NDUgMS4yNjQgMC41MTE3bDAuOTQzNTkgMC40MzE0IDEuNTQ3OS0xLjU0NDUgMS41NDc5LTEuNTQ0NCA0LjcyMTggNC43MjE4LTMuMDg4OCAzLjA5NTcgMC40MjI2OSAwLjkzNWMwLjIzMjQzIDAuNTE0MyAwLjQ1NzkxIDEuMDgzMSAwLjUwMDk4IDEuMjY0bDAuMDc4NCAwLjMyOWg0LjQyMTZ2Ni43MDg5bC0yLjAwMzctMC4wMWMtMS4xMDIxLTAuMDEtMi4wOTM4LTAuMDEtMi4yMDM4IDAtMC4xMjQzMSAwLTAuMjUzNDUgMC4xNzUxLTAuMzQxMDkgMC40NTM4LTAuMDc3NSAwLjI0NjctMC4zMDY0OCAwLjgxNTItMC41MDg4MiAxLjI2MzNsLTAuMzY3NzUgMC44MTQ2IDEuNTQ1MiAxLjU0ODcgMS41NDUyIDEuNTQ4Ni0yLjM2MDkgMi4zNjA5LTIuMzYwOSAyLjM2MDgtMS41NDc5LTEuNTQ0NC0xLjU0NzktMS41NDQ1LTAuOTM1MDMgMC40MjI3Yy0wLjUxNDI1IDAuMjMyNS0xLjA4MyAwLjQ1NzktMS4yNjQgMC41MDExbC0wLjMyOTAyIDAuMDc4djQuNDIxNmgtNi42OTl2LTIuMjAwMXptNS4yMDg0LTUuOTk4YzIuNzc1OS0wLjcxMzMgNC44MDg1LTIuNjA3NSA1LjgyNDgtNS40MjgyIDAuMzQzMDEtMC45NTIzIDAuNDI4NDMtMy4xNTA5IDAuMTYzMDEtNC4yMDEtMC43NzQ1Ny0zLjA2NDQtMi45MzkxLTUuMjM1NC01Ljk4OTEtNi4wMDY3LTEuMzQwOC0wLjMzOTEtMy4yMTkyLTAuMjUzNS00LjQ2NzUgMC4yMDM1LTMuMTgwNyAxLjE2NDQtNS4yMDIgMy44MjY0LTUuMzczOSA3LjA3NzEtMC4wNzk0IDEuNTA4NyAwLjEwMTM2IDIuNTQ2MyAwLjY2NTU5IDMuODEzMyAwLjkzMTcxIDIuMDkyMiAyLjUyNTQgMy41NDUgNC43MTI3IDQuMjk2MSAxLjE1ODEgMC4zOTc3IDEuMTY3NyAwLjM5OTMgMi41NTAzIDAuNDE1MyAwLjczMzYgMC4wMSAxLjQ3ODYtMC4wNTcgMS45MTQtMC4xNjk0em0xOS40OTQtOC41MTM0Yy0yLjEyNDYtMi4wMzY1LTYuMzk1My02LjMwMTEtNi4zNTI3LTYuMzQzNyAwLjAyNDEtMC4wMjQgMS4wNTkzLTAuMTA5MSAyLjMwMDktMC4xODk1bDIuMjU3NC0wLjE0NjMtMC4wMjMxLTAuMzMyNGMtMC4wMzEyLTAuNDQyNy0xLjIxNjItMi43ODg0LTEuOTc1OC0zLjkxMDEtMy4zMjc1LTQuOTE0MS04LjIyLTguMTA5MS0xNC4wMzEtOS4xNjI1LTEuNjczNi0wLjMwMzQtNS4zODQzLTAuMzAzNC03LjA1NzkgMC03LjI4NzcgMS4zMjExLTEzLjI5NCA2LjE3MzMtMTYuMDA3IDEyLjkzMWwtMC40MzE5NSAxLjA3Ni0yLjA5ODUgMC4wMzNjLTEuMjA4IDAuMDE5LTIuMDk4Ni0wLjAxMy0yLjA5ODYtMC4wNzYgMC0wLjM0MTcgMS4wNjEzLTMuMDk5IDEuNjI2OS00LjIyNjcgMS4zMjI3LTIuNjM3NSAyLjU1MTMtNC4zNzE5IDQuNTc5Ny02LjQ2NTEgMy44NTkzLTMuOTgyNyA4LjYzMDgtNi40NDI2IDE0LjI1NS03LjM0OTIgMS43MjItMC4yNzc1IDUuNjgyOS0wLjI3NzUgNy40MDUgMCA0LjQ2NjMgMC43MTk5IDguMTI4MiAyLjI5OTEgMTEuNzQzIDUuMDY0IDEuMzE5OCAxLjAwOTUgMy41NjI0IDMuMjczNSA0LjU0MzggNC41ODc0IDEuNDEyNyAxLjg5MDkgMi43NjU0IDQuMzM5NSAzLjUyNTcgNi4zODE4IDAuMjE2NzMgMC41ODI0IDAuNDE0OTYgMS4wNzk3IDAuNDQwNTEgMS4xMDUyIDAuMDI1MSAwLjAyNiAxLjE0NDYtMC4wMzEgMi40ODctMC4xMjQ5IDEuMzQyMy0wLjA5NCAyLjQ0OTMtMC4xNjA5IDIuNDU5OS0wLjE0ODIgMC4wMTkxIDAuMDIzLTAuNzgwMjggMS4wNTQzLTQuNDE0MiA1LjY5NzItMS4wMDA2IDEuMjc4NS0xLjg3MzIgMi4zOTM2LTEuOTM5IDIuNDc3OS0wLjA5MDUgMC4xMTY3LTAuMzc4MDMtMC4wOTQtMS4xOTYyLTAuODc4NnoiIHN0cm9rZS13aWR0aD0iLjExOTYyIi8+PGNpcmNsZSBjeD0iOTUuNDk4IiBjeT0iMTYyMy44IiByPSI5LjEyMzUiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxjaXJjbGUgY3g9IjEyMS44NCIgY3k9IjE2MjMuOSIgcj0iOS4xMjM1IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48Y2lyY2xlIGN4PSI5NS40OTgiIGN5PSIxNjIzLjgiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48Y2lyY2xlIGN4PSIxMjEuODQiIGN5PSIxNjIzLjkiIHI9IjMuNjkwNCIgc3R5bGU9InBhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnMiLz48L2c+PC9nPjwvc3ZnPgo=" width="468" height="415" class="img_UJFd"></p>
<p>你可以把 Layer 想像成這樣：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_layer-power-0a127750a6c307def72367047402d7c2.webp" width="1809" height="645" class="img_UJFd"></p>
<p>Layer 運作起來就像這樣：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_layer-working-0216d8ee3870da88431514ef05889487.webp" width="2045" height="1640" class="img_UJFd"></p>
<p>可以注意到，它的運作方式和一般 (Data→Style) 的有所差異，要渲染成什麼樣子什麼不是資料決定的，而是 Layer 決定的，它喪失了對單一資料點進行 Style 客製化的彈性，但是獲得了大量渲染資料的能力。</p>
<p>關於如何設定 Layer，Mapbox 的<a href="https://docs.mapbox.com/style-spec/reference/layers/" target="_blank" rel="noopener noreferrer">官方文件</a>提供了十分充足的資訊，即便是透過 Mapbox 官方的編輯器製作的「客製化地圖」也完全遵守這些 Style 的設定，只是官方提供的<a href="https://www.mapbox.com/gallery" target="_blank" rel="noopener noreferrer">樣式</a> 一個大約有 200 層 Layer 左右。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="Mapbox GL JS" term="Mapbox GL JS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中用增強式學習訓練完全視覺化之遞迴布林類神經網路以產出二維條碼人造語言那檔事]]></title>
        <id>https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language</id>
        <link href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language"/>
        <updated>2023-10-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>關於我的 Side Project 「環驅之鑰」其實是一個很複雜、很難三言兩語說清楚東西，試著用一些像是<a href="https://flyskypie.github.io/docs/the-key-of-huanche/" target="_blank" rel="noopener noreferrer">條目</a>的東西來解釋它，作為我現場跟其他人解釋的參考資料算是蠻方便的輔助，但是讓人自行閱讀一目了然似乎還是稍嫌不足。</p>
<p>於是我決定試試用其他方式向一個可能沒什麼背景知識的解釋我想做的東西：先把其中一個主線用輕小說一般標題展開，再根據其中的內容慢慢解釋。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="ecs-entity-component-system">ECS (Entity Component System)<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#ecs-entity-component-system" class="hash-link" aria-label="Direct link to ECS (Entity Component System)" title="Direct link to ECS (Entity Component System)">​</a></h2>
<blockquote>
<p>關於我<strong>想用 ECS 實作 Minecraft</strong> 以分散式架構運行並在其中用增強式學習訓練完全視覺化之遞迴布林類神經網路以產出二維條碼人造語言那檔事</p>
</blockquote>
<p>ECS 是種軟體架構，鬥陣特攻 (Overwatch) 的團隊在遊戲上使用並且在 GDC 2017 中介紹而遊戲開發圈廣為人知，Unity3D 更在 2018 將 ECS 框架引入遊戲引擎中。它的核心概念是不使用原本流行的物件導向 (OOP, Object-oriented programming) 的軟體抽象化方式轉而使用資料導向 (Data Oriented)。</p>
<p>OOP 的邏輯是：把程式邏輯抽象化成一個一個的「物件」，然後透過「方法」去操作物件，隨著專案越來越複雜，這些物件通常會一層包一層。而 ECS 的邏輯是：把資料跟運算邏輯分離，Component 只有資料、Entity 是 Component 的索引、System 則不儲存狀態專注於運算邏輯。</p>
<p>關於 ECS 的介紹我就點到這裡為止，至於我想在專案中使用這種架構的原因源自 2018 年我試著寫一個 Minecraft <a href="https://youtu.be/vH0KOeijNeQ?si=NnObrN-XhnVk9zFc" target="_blank" rel="noopener noreferrer">插件</a>的時候經歷了非常痛苦的開發體驗，以我當時想修改的殭屍實體為例：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_minecraft-npc-8ebe3b7b05f99bc5c9204aed503ae661.webp" width="873" height="496" class="img_UJFd"></p>
<p>Minecraft 裡充滿了多層繼承 (Multilevel Inheritance)，這使得釐清物件之間如何交互作用的認知負荷變得非常高，雪上加霜的是 Minecraft 插件源自逆向工程的產物，並不是所有變數和方法都是人類可讀的。</p>
<p>雖然當時體驗的困難並不是所有都是軟體架構造成的，然而後來我才知道這種開發風格在遊戲開發圈也算是很有爭議的主題之一，在知道 Minecraft 的程式碼有多難除錯，看著它那滿坑滿谷的 <a href="https://bugs.mojang.com/projects/MC/issues" target="_blank" rel="noopener noreferrer">Bug 清單</a>，當中不少還直接被標記「這個不會被修復」似乎也不奇怪了。</p>
<p>作為一個想開發類似於 Minecraft 這等高度複雜的沙盒開放世界遊戲的後進者，自然會想避免步上 Minecraft 的後塵，而 ECS 便是我目前優先考慮的架構。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="分散式架構">分散式架構<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E5%88%86%E6%95%A3%E5%BC%8F%E6%9E%B6%E6%A7%8B" class="hash-link" aria-label="Direct link to 分散式架構" title="Direct link to 分散式架構">​</a></h2>
<blockquote>
<p>關於我想用 ECS 實作 Minecraft <strong>以分散式架構運行</strong>並在其中用增強式學習訓練完全視覺化之遞迴布林類神經網路以產出二維條碼人造語言那檔事</p>
</blockquote>
<p>Minecraft 大部分的運算是在同一個執行緒 (Thread) 上完成的，這在 Minecraft 的圈子也算是很有名的特性，因為你不能單純拿著多核心處理器去架遊戲伺服器就很神奇的可以容納更多的玩家。</p>
<p>這限制源自於它的遊戲運算不能簡單的被化為獨立的任務並分配成平行運算，作為一個寫網站的工程師，我並沒有足夠的知識與經驗去設計一個多執行緒的架構或系統，但是作為一個 Web 工程師我知道一種叫做微服務 (Microservices) 的東西，那麼我何不把遊戲拆成一組 Microservices 叢集，使其成為一個方便水平擴充的系統。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="增強式學習-rl-reinforcement-learning">增強式學習 (RL, Reinforcement learning)<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E5%A2%9E%E5%BC%B7%E5%BC%8F%E5%AD%B8%E7%BF%92-rl-reinforcement-learning" class="hash-link" aria-label="Direct link to 增強式學習 (RL, Reinforcement learning)" title="Direct link to 增強式學習 (RL, Reinforcement learning)">​</a></h2>
<blockquote>
<p>關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中<strong>用增強式學習訓練</strong>完全視覺化之遞迴布林類神經網路以產出二維條碼人造語言那檔事</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="https://ictinstitute.nl/ai-machine-learning-and-neural-networks-explained/" src="https://flyskypie.github.io/assets/images/02_ai-f629980bbc540947c35b61a08f06019a.webp" width="700" height="296" class="img_UJFd"></p>
<p>增強式學習是機器學習 (Machine Learning) 領域的一個子集（分支），相較於其他著重資料分析、統計之類的機器學習主題，RL 著重於玩家 (Agent) 與環境 (Environment) 互動 (Action/Observe)，透過獎勵 (Reward) 來最佳化策略 (Policy)。RL 可以說是「遊戲感」最重的機器學習分支。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="遞迴布林類神經網路-rbnn-recurrent-boolean-neural-network">遞迴布林類神經網路 (RBNN, Recurrent Boolean Neural Network)<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E9%81%9E%E8%BF%B4%E5%B8%83%E6%9E%97%E9%A1%9E%E7%A5%9E%E7%B6%93%E7%B6%B2%E8%B7%AF-rbnn-recurrent-boolean-neural-network" class="hash-link" aria-label="Direct link to 遞迴布林類神經網路 (RBNN, Recurrent Boolean Neural Network)" title="Direct link to 遞迴布林類神經網路 (RBNN, Recurrent Boolean Neural Network)">​</a></h2>
<blockquote>
<p>關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中用增強式學習訓練完全視覺化之<strong>遞迴布林類神經網路</strong>以產出二維條碼人造語言那檔事</p>
</blockquote>
<p>人工智慧 (AI, Artificial Intelligence)與深度學習 (Deep Learning) 算是近幾年被用到爛大街的詞彙了，起因來自於一個被稱作類神經網路 (Neural Network) 的不新鮮的數學模型在晶片性能提昇以及算法改善的現代而終於獲得實用化，又因為 AlphaGo 在 2016 擊敗人類棋手等事件而形成話題才終於進入大眾的視野。</p>
<p>而布林類神經網路 (BNN)<sup><a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#user-content-fn-bnn-ce8ad3" id="user-content-fnref-bnn-ce8ad3" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> 則是參考了類神經網路的設計，但是不使用實數而是使用布林代數的一種算法，這個選擇並不是基於性能或實用性考量，老實說因為不是使用實數體系的代數，因此不能用微積分作弊（倒傳遞算法 Backpropagation），也不能直接以類神經模型主流的方式用顯示卡加速運算。</p>
<p>而是一種基於哲學上的選擇，私以為「因為類神經網路是對人類神經元的數學建模，因此類神經網路是通往『通用型人工<strong>智慧</strong>』的道路」是一種身為人類的傲慢。如果基於二進制的電腦能夠產生「通用智慧」，那它應該回歸二進制運算的本質，即布林代數本身，而不是透過浮點數 (IEEE 754) 運算去模仿神經元，這種模仿終究只能得到偽物。</p>
<p>根據奧卡姆剃刀 (Occam's razor)，簡單的解釋通常比較接近真理，因此我想嘗試這條用布林代數去探索的道路。</p>
<p>RBNN 單純是參考了遞迴類神經網路 (RNN) 加入了遞迴的要素使該演算法具備記憶性。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="完全視覺化">完全視覺化<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E5%AE%8C%E5%85%A8%E8%A6%96%E8%A6%BA%E5%8C%96" class="hash-link" aria-label="Direct link to 完全視覺化" title="Direct link to 完全視覺化">​</a></h2>
<blockquote>
<p>關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中用增強式學習訓練<strong>完全視覺化</strong>之遞迴布林類神經網路以產出二維條碼人造語言那檔事</p>
</blockquote>
<p>拿 Minecraft 來做機器學習訓練 AI 的專案不少，不過它們並不是沈浸式 (Immersive Experience) 的。在 Minecraft 之中除了第一人稱視角 (PFV, First-person view) 之外還有大量基於滑鼠操作的 UX。</p>
<p>對增強式學習而言，玩家與環境的互動來自操作 (Action) 與觀察 (Observe)，對人類而言可以觀察到 Minecraft 的兩個資訊：第一人稱 3D 渲染與 HUD/UI；而操作同樣有兩個：第一人稱控制器與滑鼠。</p>
<p>但是對大多數的 Minecraft AI 專案而言，AI 觀察與操作都與人類大相逕庭。以 <a href="https://github.com/cabaletta/baritone" target="_blank" rel="noopener noreferrer">Baritone</a> （知名 Minecraft 自動外掛）為例，程式是直接讀取地圖上的方塊資料來規劃路徑，操作則是直接丟封包給伺服器，所以可以作到諸如隔著牆壁打開箱子之類的事情。</p>
<p>另外一個機器學習專案 <a href="https://github.com/MineDojo/Voyager" target="_blank" rel="noopener noreferrer">Voyager</a>則是包了一層的 Minecraft Client，真正操作與觀察的程式是一個叫做 <a href="https://github.com/PrismarineJS/mineflayer" target="_blank" rel="noopener noreferrer">Mineflayer</a> 的 Javascript 函式庫，與 Baritone 相同，直接讀取地圖資訊並呼叫函式來丟封包給伺服器完成操作。不同的是 Voyager 透過機器學習的 GPT-4 模型負責撰寫 Javascript 程式碼來控制玩家。</p>
<p>據我所知唯一使用視覺化資料的是一個名為 <a href="https://minerl.io/" target="_blank" rel="noopener noreferrer">MineRL</a> 的專案，它其實是一個 AI 競賽，目標就是用 AI 玩 Minecraft 挖到鑽石，但是 AI 只能跟玩家一樣觀察到一張 3D 渲染的第一人稱畫面，即便如此，它的操作依然不是沈浸式的<sup><a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#user-content-fn-minerl-api-ce8ad3" id="user-content-fnref-minerl-api-ce8ad3" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_minerl-action-cd55e139cb6f050ff6876af4c65b6d98.webp" width="719" height="357" class="img_UJFd"></p>
<p>它直接提供一個函式，當玩家附近有工作台並且身上有足夠的原料，就直接完成合成，以人類可以理解的體驗就像是：</p>
<blockquote>
<p>你桌上放著一排按鈕，只要附近有工作台，按下對應的按鈕自動完成合成，過程中於需操作遊戲中的那個操作界面用滑鼠拖拉材料。</p>
</blockquote>
<p>因為 MineRL 設計上就是為了挖到鑽石，因此只需要提供部份必要的界面 (Interface) 供玩家操作即可。</p>
<p>「完全視覺化」意味著在這個專案中，視覺資料是 AI 唯一能夠獲得環境資訊的方式，FPV 控制器是 AI 唯一能和環境互動的手段，因此，沒有血量或體力值的變數、沒有額外的裝備欄變數、沒有任何基於滑鼠操作的彈出視窗、沒有快捷的 function call。</p>
<p>「完全視覺化」意味著必須重新設計一套完全基於 FPV 控制器的遊戲體驗。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="二維條碼人造語言">二維條碼人造語言<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#%E4%BA%8C%E7%B6%AD%E6%A2%9D%E7%A2%BC%E4%BA%BA%E9%80%A0%E8%AA%9E%E8%A8%80" class="hash-link" aria-label="Direct link to 二維條碼人造語言" title="Direct link to 二維條碼人造語言">​</a></h2>
<blockquote>
<p>關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中用增強式學習訓練完全視覺化之遞迴布林類神經網路以產出<strong>二維條碼人造語言</strong>那檔事</p>
</blockquote>
<p>其實我還期望從這個專案中獲得其他產物，不過「二維條碼人造語言」算是這個專案的主線之一。</p>
<p>如果你看過或是知道異星入境 (Arrival) 這部電影，要理解這個概念就會顯得很容易，沒有沒有也沒關係。</p>
<details class="details_i8Zw alert alert--info details_L596" data-collapsed="true"><summary>可能涉及「異星入境」的劇透，請斟酌點閱</summary><div><div class="collapsibleContent_EtHX"><div><div>劇中的外星人不具備基於聲音的「語言」，</div><div>它們透過操控懸浮的沙粒構成文字來傳達意思：</div><img src="data:image/webp;base64,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" alt="https://brand-new-life.org/b-n-l/learning-from-time/"></div></div></div></details>
<p>我希望訓練 AI 在遊戲中表現出「部落」的特性，也就是複數個獨立的 AI 能夠溝通並且協調作業，在這個基礎上透過解析它們的溝通方式來實現「人類對某種數位智慧進行溝通」這件事。</p>
<p>一般玩家在 Minecraft 內使用文字頻道溝通，但是這有違前述的「完全視覺化」原則，因此我需要另外一種能夠讓玩家在遊戲內溝通的方式。在遊戲內重建聲學模型又過於複雜。</p>
<p>「基於<strong>視覺化</strong>的語言」這樣的概念便自然而然的被到這個專案之中，現實中其實也有這種東西：手語，而我所想像在 Minecraft 中的視覺化語言會像這個樣子：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_barcode_language-33fbd182e107dc4451880a0192a0180f.svg" width="541" height="556" class="img_UJFd"></p>
<p>後來想想，基於二進制的智能體，溝通用的語言是二維條碼好像也很合理？</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-bnn-ce8ad3">
<p>Boolean Neural Network. (R. Kohut, B. Steinbach). Retrieved 2023-10-08, from <a href="https://www.semanticscholar.org/paper/Boolean-Neural-Networks-Kohut-Steinbach/1c472945ab2970a709efe97f81d9a5e7bf37baae" target="_blank" rel="noopener noreferrer">https://www.semanticscholar.org/paper/Boolean-Neural-Networks-Kohut-Steinbach/1c472945ab2970a709efe97f81d9a5e7bf37baae</a> <a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#user-content-fnref-bnn-ce8ad3" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-minerl-api-ce8ad3">
<p>MineRL 0.3.0 documentation. (William H. Guss, Brandon Houghton). Retrieved 2023-10-08, from <a href="https://minerl.io/docs/environments/index.html#id20" target="_blank" rel="noopener noreferrer">https://minerl.io/docs/environments/index.html#id20</a> <a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language#user-content-fnref-minerl-api-ce8ad3" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="The Key of Huanche" term="The Key of Huanche"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ECS 學習與 aimAndShoot 重構之旅]]></title>
        <id>https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs</id>
        <link href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs"/>
        <updated>2023-09-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/00_hero-e6a285351e1adeec8573e4484429069c.webp" width="1440" height="762" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>隨著 Polis 專案的串流功能完成，開發開始往下一個階段發展，PoC 還剩下兩個功能需要實作：</p>
<ul>
<li>基本遊戲系統</li>
<li>P2P 連線</li>
</ul>
<p>因為 P2P 連線還需要解決遊戲狀態同步的問題，因此它在某種程度上仰賴遊戲系統，所以遊戲系統的實作就是我下一個階段要處理的事情。而遊戲系統預計要使用 ECS (Entity Component System) 實作則是很早就決定的事。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="ecs-entity-component-system">ECS (Entity Component System)<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#ecs-entity-component-system" class="hash-link" aria-label="Direct link to ECS (Entity Component System)" title="Direct link to ECS (Entity Component System)">​</a></h3>
<p>關於 ECS 的具體細節本文就不再贅述，簡言之就是使用 ECS 架構的遊戲在做職責分離的時候會跟物件導向 (OOP) 中抽象化的思考方式不相同，這對我而言是一個挑戰，因為我沒有真正用 ECS 架構去寫遊戲過。</p>
<p>最早會接觸 ECS 這個新鮮玩意兒是因為工作的關係接觸了 <a href="https://github.com/bberak/react-game-engine" target="_blank" rel="noopener noreferrer">React Game Engine</a> 但是它只是 ECS 的弱實現 (loose implementation)，因此與實際 ECS 的思考方式之間還是存在落差，加上同事其實跟我提過我的寫法很大程度還是一般的 React 程式，並沒有發揮 ECS 的特性。</p>
<p>另外一個困擾我的點是，部分 Javascript/Typescript 實作的 ECS 函式庫著重於 ECS 中「資料緊湊」的特性，它們使用 TypedArray 定義的基本型態來儲存資料，這使得它們的原始設計與 Three.js 或 Rapier 這種有自己定義 class 的函式庫之間不好協調。</p>
<p>因此我認為在正式引入 ECS 這個技術棧 (Tech Stack) 到 Polis 以前應該先寫一個短期專案對選定函式庫的可行性做驗證，以及累積足夠的「ECS 思維」。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="aimandshoot">aimAndShoot<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#aimandshoot" class="hash-link" aria-label="Direct link to aimAndShoot" title="Direct link to aimAndShoot">​</a></h3>
<p><a href="https://github.com/victorqribeiro/aimAndShoot" target="_blank" rel="noopener noreferrer">aimAndShoot</a> 便是我的實驗對象。在「<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence/">底火的芬芳 - 專案起源</a>」一文中有提到過這個 repository，它是一個有點像 <code>diep.io</code> 的簡單小遊戲，作為重構改寫的對象是再適合不過了。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="miniplex">Miniplex<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#miniplex" class="hash-link" aria-label="Direct link to Miniplex" title="Direct link to Miniplex">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_ecs-libs-ff9c1ec0cb14d9a23114b45e93215095.webp" width="1333" height="456" class="img_UJFd"></p>
<p>Javascript/Typescript 中有不少 <a href="https://npmtrends.com/@javelin/ecs-vs-ape-ecs-vs-bitecs-vs-ecs-lib-vs-ecsy-vs-miniplex-vs-yagl-ecs" target="_blank" rel="noopener noreferrer">ECS 套件</a>，雖然跟一般的熱門套件相較之下都算是冷門套件。</p>
<p>正如我提過得，它們之中的大部分著重於資料緊湊的設計，或是有著不支援/不友善 Typescript 的問題，另外一點則是一些套件更預設了一套框架，開發者必須在這個架構下開發。</p>
<p>相較之下 <a href="https://github.com/hmans/miniplex" target="_blank" rel="noopener noreferrer">Miniplex</a> 更深刻的體現了「一次做好一件事」的哲學，讓我們來看看它的介紹：</p>
<blockquote>
<p>A 👩‍💻 developer-friendly entity management system for 🕹 games and similarly demanding applications, based on 🛠 ECS architecture.</p>
</blockquote>
<p>是的，它只把自己定位在「Entity Management」的部份，既不管資料緊不僅湊，也不管開發者想怎麼實作 System，即便看著範例程式碼，我也不會浮現「這玩意兒到底要怎麼跟 Three.js 或 Rapier 整合？」的問題，我只需要煩惱如何把問題使用 ECS 的架構去實現就好。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="重構">重構<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#%E9%87%8D%E6%A7%8B" class="hash-link" aria-label="Direct link to 重構" title="Direct link to 重構">​</a></h2>
<p>很快就完成了從 Javascript 轉換成 Typescript 的重構 (2023-09-13~2023-09-15)，這個部份應該算是整個重構中最簡單的，畢竟遷移 Legacy Code 我也不是第一次幹了，有一些工具可以協助完成這種事：</p>
<ul>
<li>AMD to es6<!-- -->
<ul>
<li><a href="https://github.com/jonbretman/amd-to-as6" target="_blank" rel="noopener noreferrer">https://github.com/jonbretman/amd-to-as6</a></li>
</ul>
</li>
<li>Prototype to Class<!-- -->
<ul>
<li><a href="https://github.com/lebab/lebab" target="_blank" rel="noopener noreferrer">https://github.com/lebab/lebab</a></li>
</ul>
</li>
<li>Javascript to Typescript<!-- -->
<ul>
<li><a href="https://github.com/gregjacobs/js-to-ts-converter" target="_blank" rel="noopener noreferrer">https://github.com/gregjacobs/js-to-ts-converter</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="web-component-custom-element-初體驗">Web Component (Custom Element) 初體驗<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#web-component-custom-element-%E5%88%9D%E9%AB%94%E9%A9%97" class="hash-link" aria-label="Direct link to Web Component (Custom Element) 初體驗" title="Direct link to Web Component (Custom Element) 初體驗">​</a></h3>
<p>微前端 (Micro frontends) 其實也不是什麼新鮮的玩意了，不過一直沒有機會或動機去使用它。第一次知道這個東西是為了解決客戶的（相對）大型專案而查資料查到的，只是客戶方面的技術相對落後（沒有 CI/CD、整合仰賴客戶的工程師手動複製程式碼、預計使用 iframe 作為大型專案的 solution...），而公司作為代工方並沒有技術決策的權限，自己本身也沒有 side project 有面臨類似的問題。</p>
<p>作為一個網頁前端工程師，UI 之類的問題我一律想用 React 解決，在 Canvas 上刻 UI 根本浪費時間效果又差。但是這個 ECS 的練習我並不想直接讓它跟 React App 耦合，發現這似乎是使用 Web Component 這個 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components" target="_blank" rel="noopener noreferrer">Web API</a> 的好時機。</p>
<p>於是一開始 (2023-09-16) 我先根據我預想的排版用 React 實作，再把它包裝成 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements" target="_blank" rel="noopener noreferrer">Custom Element</a>，透過一個 callback (EventListener) 當 Canvas 被掛上 DOM 之後回傳 <code>HTMLCanvasElement</code> ，再用遊戲的實例去接收它來繪製遊戲內容。</p>
<p>當我把遊戲邏輯實作的差不多之後 (2023-09-20)，發現應該反過來操作：</p>
<blockquote>
<p>把遊戲封裝成 Custom Element 給 React 使</p>
</blockquote>
<p>因為整個遊戲其實只仰賴一塊 Canvas 作為 I/O，只要能夠恰當的完成初始化跟釋放資源，就能被封裝到 React 的 Cycle life 內才對。</p>
<p>另一方面也是因為我已經在 React 內寫過諸如 Three.js 和 MapBox GL JS 的東西，對於這種「非 React 原生的套件如何整合進 React App 內」已經很直覺的知道怎麼做了：用 <code>ref</code> 取得實例並搭配 <code>useEffect</code> 來把事件掛上去跟釋放 callback。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="ecs">ECS<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#ecs" class="hash-link" aria-label="Direct link to ECS" title="Direct link to ECS">​</a></h3>
<p>Miniplex 的 Typescript 友善程度算是比我預期的的還好，關於 Entity 的型別如何聲明，Github 上面有一則討論算是給出了蠻明確的方向<sup><a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#user-content-fn-miniplex-entity-type-b6b5a5" id="user-content-fnref-miniplex-entity-type-b6b5a5" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<div class="language-typescript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-typescript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">IPosition</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  position</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Vector3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">IHealth</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  health</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> current</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Entity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Partial</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">IPosition </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> IHealth </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我個人是使用類似但是有一點差異的方式：</p>
<div class="language-typescript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-typescript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">AgentEntity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  particle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ParticleComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  health</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> HealthComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  projectileEmitter</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ProjectileEmitterComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  warrior</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WarriorMiscComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  brain</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> DejavuComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  statistics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WarriorStatisticsComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">BulletEntity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  particle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ParticleComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attackEffect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AttackEffectComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Entity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Partial</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TimeEntity </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> EventEntity </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> AgentEntity </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> BulletEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以 ECS 的思考模式，其實並不在乎 Entity 要多具體，而是以 Component 為操作單元，而 Component 在中 Miniplex 實質等於 Entity 的 properties，因此如果思考方式依然受到 OOP 影響，至少可以用這種方式輔助產生一種介於「依照物件設計邏輯的切割方式」與「依照 Component 邏輯的切割方之」之間的過渡狀態。</p>
<p>另外因為我是從一個既存專案做重構，因此我懶得重新用「The Component Way」的思考模式去重新設計資料結構，所以我把物件的屬性隨便包成 Component 丟進去。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="joy-ui-初體驗">Joy UI 初體驗<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#joy-ui-%E5%88%9D%E9%AB%94%E9%A9%97" class="hash-link" aria-label="Direct link to Joy UI 初體驗" title="Direct link to Joy UI 初體驗">​</a></h3>
<p>工作上很常要寫一些 B2B 的後台 (Dashboard)，<a href="https://mui.com/material-ui/" target="_blank" rel="noopener noreferrer">Material UI</a> 算是我最常使用的 React 套件之一，可以快速搭建出有模有樣的網頁，作用跟 <a href="https://getbootstrap.com/docs/5.2/getting-started/introduction/" target="_blank" rel="noopener noreferrer">Bootstrap</a> 其實差不多。只是它內置了一套設計系統 (Design System)，對於沒有引入 Design System 的專案來說，反而要為了那些缺乏一致性的客製化 style 去覆蓋掉原本的設計而花費很多心力。並且對於個人使用的小專案來說又稍嫌笨重了一點。</p>
<p>直到前一陣子注意到這個套件出了一個衍生套件 <a href="https://mui.com/joy-ui/getting-started/" target="_blank" rel="noopener noreferrer">Joy UI</a>，它的所有組件與 Material UI 幾乎是一對一對應的，只是少了 <a href="https://en.wikipedia.org/wiki/Material_Design" target="_blank" rel="noopener noreferrer">Material Design</a> 的部份。看上去也還算順眼，於是便趁著這個機會來用用看。</p>
<p>於是在完成了遊戲本體之後，便用這個套件新增了一些 UI，包含：玩家列表、記分板。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="小插曲">小插曲<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#%E5%B0%8F%E6%8F%92%E6%9B%B2" class="hash-link" aria-label="Direct link to 小插曲" title="Direct link to 小插曲">​</a></h3>
<p>因為要重構成 ECS 架構的關係，所有的實作我都必須逐行閱讀了解其意義之後才能將邏輯從 class 內抽出然後丟到特定的 System 去，也因此讓我有了意外收穫。</p>
<p>幾年前 (2020)，我曾經改寫了同一個專案，移除了玩家、讓 Bot 分成兩隊互毆，但是成效不佳，跑了 300 多代依然蠢蠢的。</p>
<p>重構的過程我發現了有這麼一段程式：</p>
<div class="language-typescript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-typescript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">selectParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queries</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> IQueries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bot </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">botPlayer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      total </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> bot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statistics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fitness</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> prob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bot </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">botPlayer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prob </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> bot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statistics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fitness</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> bot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prob </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> bot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statistics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fitness</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>原作者想用加權抽籤的方式抽出 AI 進行繁殖，其中的 <code>fitness</code> 是分數的意思，也就是這裡的權重值。然而這個實作會造成一個 AI 只要有一回合表現不好拿了 0 分，它被刷掉機率會達到 100%。並且只要有一回合大家運氣不好都拿了 0 分，就會整代被刷掉，演算法會直接 Random 一組 0 經驗的類神經網路來繁殖。</p>
<p>因此在不考慮評分標準的數學模型到底合理不合理的前提下，AI 被重置的機率其實很高，這也解釋了為什麼我之前跑了 300 多代 Bot 依然蠢蠢的原因。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="收官-yose-ヨセ">收官 (Yose, ヨセ)<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#%E6%94%B6%E5%AE%98-yose-%E3%83%A8%E3%82%BB" class="hash-link" aria-label="Direct link to 收官 (Yose, ヨセ)" title="Direct link to 收官 (Yose, ヨセ)">​</a></h3>
<p>重構過程其實讓我對這個專案產生了不少額外的想像，比如說：利用 ECS 的特性，我其實可以把當前遊戲幀的所有資料 dump 出來，之後重開網頁再把資料倒回去理論上可以很輕易的實現「遊戲讀擋」的功能，畢竟關於遊戲的所有狀態都塞在一個由 Entity 填充的 Array 裡面；又或是寫一個視覺化的組件呈現 AI 當前類神經網路的激發狀態；甚至是製作另一個模式實現我曾經實現過得 Zero-player game，理論上只要置換 System 就能輕易實現。</p>
<p>然而我其實對這個專案的定位有立下一個明確的目標：</p>
<blockquote>
<p>以 ECS 實現原專案的所有或大部份機能，藉此累積使用 Miniplex 的經驗</p>
</blockquote>
<p>目的已經達成，該收官了，於是我藉著這個星期六 (2023-09-23) 進行最後打磨，讓它至少看起來有模有樣，然後把原本分散在兩個 repo 的 commit 用 subtree 和 rebase 整理到 fork 的 repo 去。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="結論">結論<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#%E7%B5%90%E8%AB%96" class="hash-link" aria-label="Direct link to 結論" title="Direct link to 結論">​</a></h2>
<ul>
<li>Demo<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/aimAndShoot/" target="_blank" rel="noopener noreferrer">https://flyskypie.github.io/aimAndShoot/</a></li>
</ul>
</li>
<li>Source Code<!-- -->
<ul>
<li><a href="https://github.com/FlySkyPie/aimAndShoot" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/aimAndShoot</a></li>
</ul>
</li>
</ul>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-miniplex-entity-type-b6b5a5">
<p>Does Entity need to know all possible components?. Retrieved 2023-09-24, from <a href="https://github.com/hmans/miniplex/discussions/295" target="_blank" rel="noopener noreferrer">https://github.com/hmans/miniplex/discussions/295</a> <a href="https://flyskypie.github.io/blog/2023-09-24_a-journey-about-learning-ecs#user-content-fnref-miniplex-entity-type-b6b5a5" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="ECS" term="ECS"/>
        <category label="Miniplex" term="Miniplex"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[開源的 Robocraft Clone 專案 - Own War]]></title>
        <id>https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft</id>
        <link href="https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft"/>
        <updated>2023-08-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/00_hero-b8dbf0cecc9c79291c393ed977dff702.webp" width="1406" height="900" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p><a href="https://store.steampowered.com/app/301520/Robocraft/" target="_blank" rel="noopener noreferrer">Robocraft</a> 是一款載具建造戰鬥遊戲，屬於 (<a href="https://en.wikipedia.org/wiki/List_of_vehicular_combat_games" target="_blank" rel="noopener noreferrer">Vehicular Combat</a>) 的衍生種類，玩家可以設計自己的載具然後投入遊戲中與其他玩家進行 PvP 競技，是能帶給我樂趣的遊戲之一。</p>
<p>在某次更新之後這個遊戲的開發商大幅度削減 (Nerf) 獎勵系統，讓遊戲資源的獲取變得十分困難，使得創作方面的遊玩體驗上受到限制，使我一度退坑。</p>
<p>2022 左右再次回鍋的時候，獎勵系統與遊戲資源的限制已經被消除，雖然遊戲機制已經和以前有所不同了，但至少可以肯定開發商在遊戲平衡性上的努力，不過玩家基數下降，造成自動批配系統中的野團高機率會碰到有組團的對手，遇到這種情況通常會被慘虐。後來我注意到這遊戲在較冷門的階級 (Tier) 中為了減少玩家在自動批配系統中的等待，會加入 BOT 來促成 5v5 的遊戲，於是我就很不解開發商為什麼不願意內建 PVE (Player Versus Environment) 模式。</p>
<p>「在 Robocraft 的遊玩體驗之上引入 PVE 模式」便是我尋找替代方案的動機之一。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="替代方案的嘗試">替代方案的嘗試<a href="https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft#%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88%E7%9A%84%E5%98%97%E8%A9%A6" class="hash-link" aria-label="Direct link to 替代方案的嘗試" title="Direct link to 替代方案的嘗試">​</a></h2>
<p>然而遺憾的是，幾次搜尋下來，都沒有找到這種類型的開源專案，在 <a href="https://alternativeto.net/software/robocraft/" target="_blank" rel="noopener noreferrer">AlternativeTo</a> 上沒有找到滿意的結果。評價似乎不錯的 Crossout 並不支援 Linux，而且在 Steam 上還鎖區了一陣子。在 Reddit 的<a href="https://www.reddit.com/r/Robocraft/comments/87hoff/" target="_blank" rel="noopener noreferrer">討論串</a>中提到了 Procelio ，在早期（這專案剛啟動沒多久）有試著下載下來玩玩看，不過 Linux 版跑起來十分卡頓，而且我記得是用 Unity3D 做的。</p>
<p>直到上週 (2023-08-20)，我終於找到了 <a href="https://github.com/Demindiro/OwnWar" target="_blank" rel="noopener noreferrer">OwnWar</a>，一眼就能看出它是衝著 Robocraft Clone 去的開源專案。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="dpendency-chain">Dpendency Chain<a href="https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft#dpendency-chain" class="hash-link" aria-label="Direct link to Dpendency Chain" title="Direct link to Dpendency Chain">​</a></h2>
<p>拿到開源專案的第一件事當然就是自己 Build 看看，然而事情並沒有這麼簡單，這個專案是用 Godot 引擎撰寫的，但是是有打過 Patch 的 Godot 引擎,因此我需要自己編譯 Godot 引擎，而 Patch 本身又仰賴另外一個物理運算的函式庫 Rapier3D。那個函式庫是用 Rust 寫的，而且必須使用特定版本的編譯器才能編譯。加上我明顯感受到原作者留下的文件有缺失，並沒有完整描述 Build 的所有步驟。</p>
<p>於是我翻閱了 Godot 的文件，試著搞懂這個專案如何跟外部函式庫做 Binding ，接著我發現了了這個<a href="https://github.com/Demindiro/OwnWar/blob/a2a500991b786aed95977051fe91ac06699ff25e/gdn/ownwar/Cargo.toml#L15" target="_blank" rel="noopener noreferrer">東西</a>：</p>
<div class="language-toml codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-toml codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdnative = "*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lazy_static = "*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">godot_rapier3d = { path = "../../../../game-assets/godot/godot_rapier3d/rapier3d" }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fxhash = "*"</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>那個相對路徑指向一個超出專案根目錄的位置，換句話說複數個專案的仰賴關係是隨意的擺在原作者的電腦內，無法根據留下的文件直接完成開發環境的準備，「原作者並沒有花太多心思考慮到接手的人，而是匆匆上傳專案」的假設基本上得到了驗證。</p>
<p>於是我花了一點時間從配置文件內的紀錄的外部仰賴路徑，推敲出數個庫之間的仰賴關係：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_dependency-chain-dfc9647d13a61212cd2ee5eeb2c2c834.webp" width="2071" height="2195" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="成功編譯只是修改專案程式碼的第一步">成功編譯只是修改專案程式碼的第一步<a href="https://flyskypie.github.io/blog/2023-08-27_opensource-robocraft#%E6%88%90%E5%8A%9F%E7%B7%A8%E8%AD%AF%E5%8F%AA%E6%98%AF%E4%BF%AE%E6%94%B9%E5%B0%88%E6%A1%88%E7%A8%8B%E5%BC%8F%E7%A2%BC%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5" class="hash-link" aria-label="Direct link to 成功編譯只是修改專案程式碼的第一步" title="Direct link to 成功編譯只是修改專案程式碼的第一步">​</a></h2>
<p>於是我 <a href="https://github.com/FlySkyPie/OwnWar" target="_blank" rel="noopener noreferrer">Fork</a> 了這個專案並把編譯仰賴的 Godot 引擎和外部函式庫等等瑣碎的操作通通丟到 Docker 裡面。最後終於把這個專案編譯出來了。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="Godot" term="Godot"/>
        <category label="Robocraft" term="Robocraft"/>
        <category label="voxel" term="voxel"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Electron 學習筆記 - IPC]]></title>
        <id>https://flyskypie.github.io/blog/2023-08-08_electron-learning-note</id>
        <link href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note"/>
        <updated>2023-08-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[行程間通訊 (IPC, Inter Process Communication) 是兩個行程（或以上）或執行緒間傳送資料或訊號的一些技術或方法。 如果有在 Node.js 玩過 childprocess 模組的 spawn 或是使用過 Web API 的 Worker 的話，應該對如何在 Javascript 中使用複數行程 (process) 並不陌生。]]></summary>
        <content type="html"><![CDATA[
<p>行程間通訊 (IPC, Inter Process Communication) 是兩個行程（或以上）或執行緒間傳送資料或訊號的一些技術或方法。 如果有在 Node.js 玩過 <code>child_process</code> 模組的 <a href="https://nodejs.org/api/child_process.html#child_processspawncommand-args-options" target="_blank" rel="noopener noreferrer">spawn</a> 或是使用過 Web API 的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank" rel="noopener noreferrer">Worker</a> 的話，應該對如何在 Javascript 中使用複數行程 (process) 並不陌生。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="區塊之間的通訊方式一覽">區塊之間的通訊方式一覽<a href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note#%E5%8D%80%E5%A1%8A%E4%B9%8B%E9%96%93%E7%9A%84%E9%80%9A%E8%A8%8A%E6%96%B9%E5%BC%8F%E4%B8%80%E8%A6%BD" class="hash-link" aria-label="Direct link to 區塊之間的通訊方式一覽" title="Direct link to 區塊之間的通訊方式一覽">​</a></h2>
<p>在<a href="https://flyskypie.github.io/blog/2023-04-01_electron_learning_note_intro">前一篇文章</a>提到，在 Electron 中 Render 和 Main 彼此之間是獨立的，必須透過 Preload 和 API 來實現兩者之間的溝通。參考了官方的範例程式碼以及一篇文章<sup><a href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note#user-content-fn-electron-ipc-bef557" id="user-content-fnref-electron-ipc-bef557" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>之後，整理成一個圖表：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_electron-ipc-api-2614c898ac2d7076cfc25d7ca88f52c4.webp" width="1377" height="1354" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="後記">後記<a href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note#%E5%BE%8C%E8%A8%98" class="hash-link" aria-label="Direct link to 後記" title="Direct link to 後記">​</a></h2>
<p>這篇文章原本在 2023-04-05 就已經寫好草稿了，沒想到完全忘記這篇還沒歸檔，然後圖表的 SVG 也已經刪掉了。</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji 以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-electron-ipc-bef557">
<p>[ Day 9 ] - 動物聊天室(二) - IPC 與訊息交換 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天. Retrieved 2023-08-08, from <a href="https://ithelp.ithome.com.tw/articles/10235110" target="_blank" rel="noopener noreferrer">https://ithelp.ithome.com.tw/articles/10235110</a> <a href="https://flyskypie.github.io/blog/2023-08-08_electron-learning-note#user-content-fnref-electron-ipc-bef557" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="javascript" term="javascript"/>
        <category label="Electron" term="Electron"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[WebRTC 學習筆記]]></title>
        <id>https://flyskypie.github.io/blog/2023-08-07_webrtc-learning-note</id>
        <link href="https://flyskypie.github.io/blog/2023-08-07_webrtc-learning-note"/>
        <updated>2023-08-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本篇學習筆記以 Javascript 在應用上的實作為切入點，關於 WebRTC 背後的技術並不是本文的重點。]]></summary>
        <content type="html"><![CDATA[
<div class="theme-admonition theme-admonition-note admonition_NjQu alert alert--secondary"><div class="admonitionHeading_5fcf"><span class="admonitionIcon_jlo4"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_r4oJ"><p>本篇學習筆記以 Javascript 在應用上的實作為切入點，關於 WebRTC 背後的技術並不是本文的重點。</p></div></div>
<p>看了幾篇教學仍然對 WebRTC Web API 的使用不是很理解，因為這些文章不是都著墨在 WebRTC 協定本身然後程式碼的實作就簡略帶過；就是跟使用 WebSocket 處理 SDP (Session Description Protocol) 的部份一起講，造成程式碼充滿了各種事件 callback，讓程式碼變得比較不好理解。</p>
<p>後來看到了一個<a href="https://github.com/Tinywan/WebRTC-tutorial/tree/master/docs/demo-02" target="_blank" rel="noopener noreferrer">範例程式</a>，單純針對 <code>RTCPeerConnection</code> 如何建立連線，從而省略實務上會透過其他機制完成 SDP，讓程式碼變得稍微好理解一點。</p>
<p>經過重構、Reivew 之後終於看懂使用 Javascript 建立 WebRTC 連線的流程，我把它整理成一張圖：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_create-webrtc-b478fce1aac1c446153b8f810dc9c964.webp" width="1024" height="1141" class="img_UJFd"></p>
<p>大致有三個重點：</p>
<ol>
<li>兩邊的 Connection 都分別要從自己跟對方獲得 SessionDescription。</li>
<li>成對的 ICE (Interactive Connectivity Establishment) 處理程式 (handler)。</li>
<li><code>addTrack()</code> 與 <code>.on("track")</code> 用來發送/接收串流。</li>
</ol>
<hr>
<p>另外我練習<a href="https://github.com/FlySkyPie/canvas-webrtc-sample" target="_blank" rel="noopener noreferrer">使用 WebRTC 的程式</a>試著用不同的界面分離職責：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_architecture-5e396c8f943429a3e6cc2bea1d560c1b.webp" width="886" height="958" class="img_UJFd"></p>
<ul>
<li><code>ITransmittable</code>: 發送端應用領域對傳輸領域的界面，專住於「對外串流」的職責。</li>
<li><code>IReceivable</code>: 接收端應用領域對傳輸領域的界面，，專注於「接收串流」的職責。</li>
<li><code>IRTCOfferable</code>: 發送端對連線建立領域的界面，專注於「發送方的 WebRTC 構成要件」的職責上。</li>
<li><code>IRTCAnswerable</code>: 接收端對連線建立領域的界面，專注於「接收方的 WebRTC 構成要件」的職責上。</li>
</ul>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji 以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="javascript" term="javascript"/>
        <category label="typescript" term="typescript"/>
        <category label="WebRTC" term="WebRTC"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Polis 專案研究進度]]></title>
        <id>https://flyskypie.github.io/blog/2023-08-05_polis-progress</id>
        <link href="https://flyskypie.github.io/blog/2023-08-05_polis-progress"/>
        <updated>2023-08-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[稍微把 Polis 挖坑至今 (2023-08-05) 累積的嘗試做個紀錄。]]></summary>
        <content type="html"><![CDATA[
<p>稍微把 Polis 挖坑至今 (2023-08-05) 累積的嘗試做個紀錄。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="基本概念">基本概念<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" class="hash-link" aria-label="Direct link to 基本概念" title="Direct link to 基本概念">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_polis-concept-8e1d6be862b17dfeebc30b8d8cdd83ac.webp" width="1080" height="993" class="img_UJFd"></p>
<p>整個開放世界會被拆分成不同的區域，每個區域由獨立的節點 (Polis Node) 負責運算，節點跟節點之間會構成 P2P 網路，形成一個可以橫向擴展的架構，而 Client 端則會在由 Polis Node 構成的 P2P 網路所運算的開放世界中進行漫遊 (Roaming)。其實這種分散式的架構在 ITUGV 的時宜就令我十分著迷，不過那就是另外一段故事了，在這裡稍微提及只是為了讓讀者理解筆者對分散式架構抱有特別的偏好，並且這種構想早就存在於早期的其他專案之中。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="poc-proof-of-concept">POC (Proof Of Concept)<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#poc-proof-of-concept" class="hash-link" aria-label="Direct link to POC (Proof Of Concept)" title="Direct link to POC (Proof Of Concept)">​</a></h2>
<p>雖然 Polis 作為 Hakoniwa 的子專案，目的一樣是為了建造一個程序化生成 Voxel 開放世界，但是 Polis 將會把重點放在兩個目標上：</p>
<ul>
<li>建立 P2P 網路</li>
<li>能夠透過 Client 程式連線</li>
</ul>
<p>因此在 Polis 的第一個原型中，達到這些條件就算成功完成了概念驗證：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_POC-c0c7aaf1dd8fb44ae4dcba0c3c5f130b.webp" width="1568" height="1195" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="2023-05-13--2023-05-26">2023-05-13 ~ 2023-05-26<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#2023-05-13--2023-05-26" class="hash-link" aria-label="Direct link to 2023-05-13 ~ 2023-05-26" title="Direct link to 2023-05-13 ~ 2023-05-26">​</a></h2>
<p>在這個階段我想用 Deno 作為實作 Polis Node 的手段，有幾個原因：</p>
<ol>
<li>Typescript 目前是我最熟練的語言。</li>
<li>WebGPU 已經納入 Web API 中，而部份版本的 Deno 已經實作，因此我能使用 Typescript 解決 server side render 的需求，這麼部份是 Node.js 無法達成的。</li>
<li>Deno 內建跨平台編譯 (Cross Compiling)，因此寫一次程式我就能把節點佈署到除了 Linux 以外的 Windows 或是 macOS 上。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="網路連接技術">網路連接技術<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E7%B6%B2%E8%B7%AF%E9%80%A3%E6%8E%A5%E6%8A%80%E8%A1%93" class="hash-link" aria-label="Direct link to 網路連接技術" title="Direct link to 網路連接技術">​</a></h3>
<p>在挖了坑並且對技術棧 (Technology Stack) 有了粗略的方向之後，首先我想先處理 Polis 中最關鍵的問題：</p>
<blockquote>
<p>如何建立 Polis 網路 （P2P 網路）？</p>
</blockquote>
<p>在 2020-03-22 的時候我就有使用 ZeroMQ 進行過傳輸相關的<a href="https://github.com/FlySkyPie/the-key-of-huanche-recipe/tree/main/src/core/gym/Test_of_Image_Transfer_with_Different_Decode" target="_blank" rel="noopener noreferrer">實驗</a>，也是我在 The Key of Huanche 中一直考慮投入使用的函式庫。直到我因為 Polis 的分散式架構回過頭去翻閱它的官方文件的時候，才發現了一件事：</p>
<blockquote>
<p>And this is the world we’re targeting with ZeroMQ. When we talk of “scale”, we don’t mean hundreds of computers, or even thousands. Think of clouds of tiny smart and perhaps self-replicating machines surrounding every person, filling every space, covering every wall, filling the cracks and eventually, becoming so much a part of us that we get them before birth and they follow us to death. <sup><a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fn-zeromq-8-ba688f" id="user-content-fnref-zeromq-8-ba688f" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
</blockquote>
<p>ZeroMQ 在官方文件 <a href="https://zguide.zeromq.org/docs/chapter8/" target="_blank" rel="noopener noreferrer">Chapter 8 - A Framework for Distributed Computing</a> 中描述了他們那野心勃勃的願景，老實說這非常打動我。</p>
<p>然而調查下來，發現 Deno 在這方面並沒有多少函式庫可以使用、專案的活躍度也都很低：</p>
<ul>
<li><a href="https://github.com/jjeffcaii/deno-zeromq" target="_blank" rel="noopener noreferrer">https://github.com/jjeffcaii/deno-zeromq</a></li>
<li><a href="https://github.com/rracariu/deno-jszmq" target="_blank" rel="noopener noreferrer">https://github.com/rracariu/deno-jszmq</a></li>
<li>似乎只有實作 WekSocket</li>
<li><a href="https://github.com/trs/zmq" target="_blank" rel="noopener noreferrer">https://github.com/trs/zmq</a>
<ul>
<li>deno-jszmq 的 fork</li>
</ul>
</li>
<li><a href="https://github.com/lenkan/deno-amqp" target="_blank" rel="noopener noreferrer">https://github.com/lenkan/deno-amqp</a></li>
<li>兼容 RabbitMQ</li>
<li>只支援 Server-Client 模式</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="資料傳輸載體">資料傳輸載體<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E8%B3%87%E6%96%99%E5%82%B3%E8%BC%B8%E8%BC%89%E9%AB%94" class="hash-link" aria-label="Direct link to 資料傳輸載體" title="Direct link to 資料傳輸載體">​</a></h3>
<p>Protobuf (Protocol Buffers) 是另外一個我有意投入 The Key of Huanche 使用的 Technology Stack，第一次知道它的存在是工作上使用 Mapbox 的並因此接觸 <a href="https://github.com/mapbox/vector-tile-spec" target="_blank" rel="noopener noreferrer">Mapbox Vector Tile</a> 的時候發現它所使用的資料格式。簡言之就是一種預先定義資料結構後，把資料壓成密度比較高的格式進行傳輸，到達目的地之後再用預先定義的資料結構進行解碼，比起使用 JSON 傳輸可以省下很多頻寬。</p>
<p>然而在 Deno 的生態戲中依然有類似的問題，能選用的函式庫很少、而且專案活躍路很低：</p>
<ul>
<li><a href="https://github.com/soootaleb/ddapps" target="_blank" rel="noopener noreferrer">https://github.com/soootaleb/ddapps</a>
<ul>
<li>Deno distributed applications framework</li>
</ul>
</li>
<li><a href="https://deno.land/x/protobuf_ts@v1.2.2" target="_blank" rel="noopener noreferrer">https://deno.land/x/protobuf_ts@v1.2.2</a>
<ul>
<li><a href="https://github.com/dancrumb/protobuf.ts" target="_blank" rel="noopener noreferrer">https://github.com/dancrumb/protobuf.ts</a></li>
</ul>
</li>
<li><a href="https://deno.land/x/deno_google_protobuf@4.0.0-rc.2" target="_blank" rel="noopener noreferrer">https://deno.land/x/deno_google_protobuf@4.0.0-rc.2</a>
<ul>
<li><a href="https://github.com/marcushultman/deno-google-protobuf" target="_blank" rel="noopener noreferrer">https://github.com/marcushultman/deno-google-protobuf</a></li>
</ul>
</li>
<li><a href="https://pbkit.dev/" target="_blank" rel="noopener noreferrer">https://pbkit.dev/</a>
<ul>
<li><a href="https://deno.land/x/pbkit@v0.0.61" target="_blank" rel="noopener noreferrer">https://deno.land/x/pbkit@v0.0.61</a></li>
<li><a href="https://github.com/pbkit/pbkit" target="_blank" rel="noopener noreferrer">https://github.com/pbkit/pbkit</a></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_Hj9u" id="如何分辨序列化資料-protobuf-的型別">如何分辨序列化資料 Protobuf 的型別？<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E5%A6%82%E4%BD%95%E5%88%86%E8%BE%A8%E5%BA%8F%E5%88%97%E5%8C%96%E8%B3%87%E6%96%99-protobuf-%E7%9A%84%E5%9E%8B%E5%88%A5" class="hash-link" aria-label="Direct link to 如何分辨序列化資料 Protobuf 的型別？" title="Direct link to 如何分辨序列化資料 Protobuf 的型別？">​</a></h4>
<p>Polis Node 之間的通訊基本上是一個事件系統，而事件的種類千奇百怪，需要的資料結構當然也是五花八門，但是它們之間會使用同一個序列化的通道，接收端街收到一組序列化資料後要怎麼區分 Protobuf 的類型並使用不同的結構來解碼呢？</p>
<p>沒有辦法直接區分，但是可以透過幾個方法解決這個問題<sup><a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fn-protobuf-type-detect-ba688f" id="user-content-fnref-protobuf-type-detect-ba688f" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<ul>
<li>定義一個 Protobuf 封裝來夾帶型別資訊<!-- -->
<ul>
<li>用 oneof 封裝 (也被稱作 union)<!-- -->
<ul>
<li><a href="https://stackoverflow.com/a/40040658" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/40040658</a></li>
<li><a href="https://protobuf.dev/programming-guides/proto2/#oneof" target="_blank" rel="noopener noreferrer">https://protobuf.dev/programming-guides/proto2/#oneof</a></li>
<li><a href="https://protobuf.dev/programming-guides/proto3/#oneof" target="_blank" rel="noopener noreferrer">https://protobuf.dev/programming-guides/proto3/#oneof</a></li>
</ul>
</li>
<li>將另外一組 proto 封裝成 any 屬性<!-- -->
<ul>
<li><a href="https://protobuf.dev/programming-guides/techniques/#self-description" target="_blank" rel="noopener noreferrer">https://protobuf.dev/programming-guides/techniques/#self-description</a></li>
</ul>
</li>
</ul>
</li>
<li>在 buffer 加入幾個 bytes 的前輟作為辨識符</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="壓垮-deno-對我的專案而言的最後一根稻草">壓垮 Deno （對我的專案而言）的最後一根稻草<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E5%A3%93%E5%9E%AE-deno-%E5%B0%8D%E6%88%91%E7%9A%84%E5%B0%88%E6%A1%88%E8%80%8C%E8%A8%80%E7%9A%84%E6%9C%80%E5%BE%8C%E4%B8%80%E6%A0%B9%E7%A8%BB%E8%8D%89" class="hash-link" aria-label="Direct link to 壓垮 Deno （對我的專案而言）的最後一根稻草" title="Direct link to 壓垮 Deno （對我的專案而言）的最後一根稻草">​</a></h3>
<p>我其實很難找到支援 WebGPU 或是活躍的 WebGL 的 Javascript 函式庫進行 "denolize"。</p>
<p>WebGPU 在那個當下只有 0.04% 的覆蓋率，就算打開先行版 Chrome 的 WebGPU flag 也是充滿破圖，因此鮮少有函式庫有支援 WebGPU。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_webgpu-usage-a72772a075cdcaf6b42490f78498faf1.webp" width="797" height="262" class="img_UJFd"></p>
<p>活躍的 Javascript 3D 繪圖函式庫，諸如：Three.js, Babylon.js，即便當下是基於 WebGL 實作，在 WebGPU 逐漸普及下應該也會逐步支援 WebGPU 才對，但是它們多是基於 Canvas 的繪圖方式，而 Deno 環境下的 WebGPU 實作並不包含 Canvas 相關方法。</p>
<p>加上 WebGPU 的 API 在 1.8 被加入 Deno 之後<sup><a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fn-deno-1.8-ba688f" id="user-content-fnref-deno-1.8-ba688f" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>，又在 1.32.0 中基於性能考量被移除了<sup><a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fn-deno-1.32.0-ba688f" id="user-content-fnref-deno-1.32.0-ba688f" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>。</p>
<p>也就是「在 Deno 中使用 WebGPU」這件是的前景並不樂觀，我可能必須要面對「使用舊版的 Deno 和相對底層的 WebGPU 手刻整個應用」的問題。</p>
<p>Deno 的 Cross Compiling 的能力是真的很吸引我，但是在繪圖跟網路連線兩面不討好的情況下，加上 IDE 在寫 Deno 程式的時候開發體驗並不好，我決定放棄這條路。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="2023-05-27--2023-06-11">2023-05-27 ~ 2023-06-11<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#2023-05-27--2023-06-11" class="hash-link" aria-label="Direct link to 2023-05-27 ~ 2023-06-11" title="Direct link to 2023-05-27 ~ 2023-06-11">​</a></h2>
<p>在 2022-10-06 的時候我就已經嘗試過把網頁上渲染的 Canvas 畫面壓成 Webp 並透過 WebSocket 傳送給伺服器播放了<sup><a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fn-simple-stream-ba688f" id="user-content-fnref-simple-stream-ba688f" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup>，但是當時只是寫了 POC 等級的程式，並不能很好的管理每次連線的 Session，因此良好的串流機制就成了我下一個研究目標。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="串流方案">串流方案<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#%E4%B8%B2%E6%B5%81%E6%96%B9%E6%A1%88" class="hash-link" aria-label="Direct link to 串流方案" title="Direct link to 串流方案">​</a></h3>
<p><img decoding="async" loading="lazy" alt="https://www.wowza.com/wp-content/uploads/latency-continuum-2021-with-protocols-700x300-1.png" src="https://flyskypie.github.io/assets/images/04_stream-latency-2d1415ec6bf572221ff968e2888a9f31.webp" width="700" height="380" class="img_UJFd"></p>
<p>花了一點時間 (2023-05-27~2023-05-28) 查資料了解有哪些可能的方案能夠實現我的需求：</p>
<ul>
<li>Websocket<!-- -->
<ul>
<li>✅ Web API 十分普及</li>
<li>❌ 需額外處理影像的解碼與渲染，消費更多的運算與延遲</li>
</ul>
</li>
<li>WebRTC<!-- -->
<ul>
<li>✅ Web API 十分普及</li>
<li>✅ 原生設計支援低延遲</li>
<li>❌ 協定複雜</li>
<li>❌ P2P 架構，雖然可能可以透過在伺服器實作底層來欺騙 client 端，但是需付出額外開發成本</li>
</ul>
</li>
<li>WebTransport/QUIC<!-- -->
<ul>
<li>✅ 支援 UDP，可降低延遲</li>
<li>✅ 次世代 API</li>
<li>❌ Web API 尚未普及<!-- -->
<ul>
<li>瀏覽器支援覆蓋率低</li>
<li>Nodejs 僅實驗性支援 QUIC</li>
<li>Deno 尚不支援</li>
</ul>
</li>
</ul>
</li>
<li>HTML5 video tag<!-- -->
<ul>
<li>✅ Web API 十分普及</li>
<li>❌ 高延遲</li>
</ul>
</li>
<li>Video.js</li>
<li>MPEG-DASH<!-- -->
<ul>
<li>✅ 開放的標準</li>
<li>❌ 有點複雜</li>
</ul>
</li>
<li>FLV<!-- -->
<ul>
<li>✅ 歷史性因素，仍有許多資源</li>
<li>❌ 過時</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="node-media-server">Node-Media-Server<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#node-media-server" class="hash-link" aria-label="Direct link to Node-Media-Server" title="Direct link to Node-Media-Server">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_Node-Media-Server-f6c9a6eaf1b0d27f12dc5399fe257ff0.webp" width="1223" height="762" class="img_UJFd"></p>
<p>之後 (2023-06-04) 發現了 <a href="https://github.com/illuspas/Node-Media-Server" target="_blank" rel="noopener noreferrer">Node-Media-Server</a> 這個專案，透過 RTMP (Real-Time Messaging Protocol) 向 Node-Media-Server 串流影像，接著能夠使用 <a href="https://github.com/illuspas/Node-Media-Server-Admin" target="_blank" rel="noopener noreferrer">Node-Media-Server-Admin</a> 打開串流，而且能夠流暢的關閉與重新開啟串流，Session 的管理便是我在 POC 階段所缺失的，並且它能夠使用以 Javascript 撰寫的 code base 對外進行串流，那我只要有辦法用 Javascript 產生 RTMP 流，就能整合成符合我需求的程式。</p>
<p>於是我便試著透過用 Typescript <a href="https://github.com/FlySkyPie/Node-Media-Server-ts" target="_blank" rel="noopener noreferrer">重構專案</a>的方式理解它是如何實現串流推流的。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="2023-06-11--2023-06-25">2023-06-11 ~ 2023-06-25<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#2023-06-11--2023-06-25" class="hash-link" aria-label="Direct link to 2023-06-11 ~ 2023-06-25" title="Direct link to 2023-06-11 ~ 2023-06-25">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="rtmp">RTMP<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#rtmp" class="hash-link" aria-label="Direct link to RTMP" title="Direct link to RTMP">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_RTMP-learning-note-db26060598ed37f00e25f95e196510ad.webp" width="5411" height="4079" class="img_UJFd"></p>
<p>接著我發現單靠程式碼無法理解它解析 RTMP 封包的邏輯，於是我便打開 <a href="https://rtmp.veriskope.com/docs/spec" target="_blank" rel="noopener noreferrer">RTMP 的規範文件</a>並搭配一些教學文章試著理解它，不過大約只讀到 Header 的部份，我就意識到就算我能製造 RTMP 堆流，還是需要把影像做編碼，然而 Javascript 的生態系在做這件事情上有點貧弱，於是我把目光轉而投向 WebRTC。</p>
<p>至於 RTMP 的學習筆記我應該會發到另外一篇獨立的文章去，雖然因為我其實沒有把 Spec 完整看完，發個不完整的筆記感覺怪彆扭的。=w="</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="2023-06-25--2023-08-05">2023-06-25 ~ 2023-08-05<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#2023-06-25--2023-08-05" class="hash-link" aria-label="Direct link to 2023-06-25 ~ 2023-08-05" title="Direct link to 2023-06-25 ~ 2023-08-05">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="webrtc">WebRTC<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#webrtc" class="hash-link" aria-label="Direct link to WebRTC" title="Direct link to WebRTC">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_webrtc-demo-7de5ea33f86178327ce1788fadade79a.webp" width="1308" height="382" class="img_UJFd"></p>
<p>7 月份因為工作上的壓力比較大，加上充滿了親戚過世、Steam 夏季特賣、COSUP...等等事件，所以學習 WebRTC 的進度可以說是其極緩慢，不過終於在昨天 (2023-08-05) 理解如何使用這個 Web API 並把<a href="https://github.com/FlySkyPie/canvas-webrtc-sample" target="_blank" rel="noopener noreferrer">範例</a>做出來了。</p>
<p>同樣的，關於 WebRTC 的學習筆記我會放在另外一篇獨立的文章。</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji 以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-zeromq-8-ba688f">
<p>Chapter 8 - A Framework for Distributed Computing. Retrieved 2023-08-05, from <a href="https://zguide.zeromq.org/docs/chapter8" target="_blank" rel="noopener noreferrer">https://zguide.zeromq.org/docs/chapter8</a> <a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fnref-zeromq-8-ba688f" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-protobuf-type-detect-ba688f">
<p>c# - Protocol buffers detect type from raw message - Stack Overflow. Retrieved 2023-08-06, from <a href="https://stackoverflow.com/a/9125119" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/9125119</a> <a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fnref-protobuf-type-detect-ba688f" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-deno-1.8-ba688f">
<p>Deno 1.8 Release Notes. Retrieved 2023-08-05, from <a href="https://deno.com/blog/v1.8" target="_blank" rel="noopener noreferrer">https://deno.com/blog/v1.8</a> <a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fnref-deno-1.8-ba688f" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-deno-1.32.0-ba688f">
<p>Release v1.32.0 · denoland/deno. Retrieved 2023-08-05, from <a href="https://github.com/denoland/deno/releases/tag/v1.32.0" target="_blank" rel="noopener noreferrer">https://github.com/denoland/deno/releases/tag/v1.32.0</a> <a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fnref-deno-1.32.0-ba688f" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-simple-stream-ba688f">
<p>Day 22 Streaming POC - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天. Retrieved 2023-08-05, from <a href="https://ithelp.ithome.com.tw/articles/10305097" target="_blank" rel="noopener noreferrer">https://ithelp.ithome.com.tw/articles/10305097</a> <a href="https://flyskypie.github.io/blog/2023-08-05_polis-progress#user-content-fnref-simple-stream-ba688f" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="Polis" term="Polis"/>
        <category label="Hakoniwa" term="Hakoniwa"/>
        <category label="The Key of Huanche" term="The Key of Huanche"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Polis Project]]></title>
        <id>https://flyskypie.github.io/blog/2023-05-14_project-polis</id>
        <link href="https://flyskypie.github.io/blog/2023-05-14_project-polis"/>
        <updated>2023-05-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[- 一種去中心化叢集運算架構，用以建構運算 Hakoniwa 的網路。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="1080" height="233" class="img_UJFd"></p>
<ul>
<li>一種去中心化叢集運算架構，用以建構運算 Hakoniwa 的網路。</li>
<li>Polis 是「古希臘城邦」的意思。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="基本概念-concept">基本概念 Concept<a href="https://flyskypie.github.io/blog/2023-05-14_project-polis#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-concept" class="hash-link" aria-label="Direct link to 基本概念 Concept" title="Direct link to 基本概念 Concept">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="技術痛點">技術痛點<a href="https://flyskypie.github.io/blog/2023-05-14_project-polis#%E6%8A%80%E8%A1%93%E7%97%9B%E9%BB%9E" class="hash-link" aria-label="Direct link to 技術痛點" title="Direct link to 技術痛點">​</a></h3>
<p>具我所知 Minecraft 在軟體層面有兩個瓶頸：</p>
<ul>
<li>複雜的 OOP 結構</li>
<li>伺服器端使用單執行緒</li>
</ul>
<p>以前我試著寫 Minecraft <a href="https://youtu.be/vH0KOeijNeQ" target="_blank" rel="noopener noreferrer">插件</a>的時候，因為有使用到 NMS (net.minecraft.server) 的 API，因此大概知道 Minecraft 的程式碼大量使用了多層繼承 (Multilevel Inheritance)，然而這種 OOP 模式不只增加了開發者的負擔（本人認為多層繼承是一種反模式），更會造成在處理 Minecraft 這樣複雜的遊戲內容時，狀態的管理不容易控制而造成 bug 並且難以排除。</p>
<p>於是我打算使用 ECS (Entity Component System) 架構來解決，其概念就是單純化資料容器 (Entity 與 Component)，由 System 執行邏輯運算，透過分離資料和邏輯達到更清晰的程式碼，並且複數 System 有序執行的方式讓狀態管理單純化。然而這個架構有個問題，就是 System 有序執行的特性讓我不知道如何搭配多執行緒來提高軟體對硬體資源的利用率。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="遊戲運算平行化">遊戲運算平行化<a href="https://flyskypie.github.io/blog/2023-05-14_project-polis#%E9%81%8A%E6%88%B2%E9%81%8B%E7%AE%97%E5%B9%B3%E8%A1%8C%E5%8C%96" class="hash-link" aria-label="Direct link to 遊戲運算平行化" title="Direct link to 遊戲運算平行化">​</a></h3>
<p>其中一個合理的解方是以地圖的 Chunk 為單位切割最小的運算區塊 (Game Block)，一個 Game Block 由一個執行緒處理運算，Game Block 之間（也就是執行緒之間）的通訊則由事件驅動。</p>
<p>舉例來說，有一支箭矢飛越運算區塊的邊界：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_chunk-roaming-7938eb8ed8d93d87318b6ac271c7cfc7.webp" width="1004" height="681" class="img_UJFd"></p>
<p>來源 Game Block 會把箭矢的資訊包裝成一個事件，發送給目標 Game Block，並且從資料集中移除。目標 Game Block 則是根據事件創建一個箭矢實體並繼續運算。兩個 Game Block 使用獨立的執行緒，並且運算週期並不同步，因此不會凍結彼此。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="何不乾脆-p2p">何不乾脆 P2P?<a href="https://flyskypie.github.io/blog/2023-05-14_project-polis#%E4%BD%95%E4%B8%8D%E4%B9%BE%E8%84%86-p2p" class="hash-link" aria-label="Direct link to 何不乾脆 P2P?" title="Direct link to 何不乾脆 P2P?">​</a></h3>
<p>不知道為什麼，我直覺覺得比起寫成一個 APP 管理一堆 Game Block，不如乾脆全部做成微服務，讓它們自己構成一個叢集比較好。於是一個新的坑 (Polis) 就產生了。</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji 以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="Polis" term="Polis"/>
        <category label="Hakoniwa" term="Hakoniwa"/>
        <category label="The Key of Huanche" term="The Key of Huanche"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在 C++ 專案中處理仰賴套件的幾種方式]]></title>
        <id>https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project</id>
        <link href="https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project"/>
        <updated>2023-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[這裡整理幾種 C++ 專案常見的處理仰賴函式庫的模式（或是工具）。]]></summary>
        <content type="html"><![CDATA[<p>這裡整理幾種 C++ 專案常見的處理仰賴函式庫的模式（或是工具）。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="copypaste-source">Copy/Paste Source<a href="https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project#copypaste-source" class="hash-link" aria-label="Direct link to Copy/Paste Source" title="Direct link to Copy/Paste Source">​</a></h2>
<p>最簡單暴力的方式，把仰賴函式庫的 source 跟 header 直接複製到專案的資料夾下，直接編譯進去專案本身。舉例來說 <a href="https://github.com/fogleman/Craft" target="_blank" rel="noopener noreferrer">fogleman/Craft</a> 是屬於這類。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="native-cmake">Native CMake<a href="https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project#native-cmake" class="hash-link" aria-label="Direct link to Native CMake" title="Direct link to Native CMake">​</a></h2>
<p>在 <a href="https://cmake.org/" target="_blank" rel="noopener noreferrer">CMake</a> 中有個指令 <code>find_library</code> 允許在專案的 config 階段先偵測環境中是否有指定的函式庫，找不到的話就會拋出錯誤。這種專案配置將安裝仰賴函式庫責任交給 host 本身，通常專案的 build guild 會寫著 「先執行 <code>sudo apt install ....</code>」之類的。舉例來說 <a href="https://github.com/LibreSprite/LibreSprite/blob/18e16ef410d410f18c180ec7282861ea61def68f/CMakeLists.txt#L144-L187" target="_blank" rel="noopener noreferrer">LibreSprite</a> 是屬於這類。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="git">Git<a href="https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project#git" class="hash-link" aria-label="Direct link to Git" title="Direct link to Git">​</a></h2>
<p>利用 Git 的 submodule 功能，把其他 repository 參考到專案中。舉例來說 <a href="https://github.com/cuberite/cuberite/tree/master/lib" target="_blank" rel="noopener noreferrer">Cuberite</a> 是屬於這類。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="dependencies-tool">Dependencies Tool<a href="https://flyskypie.github.io/blog/2023-04-11_dependencies-in-cpp-project#dependencies-tool" class="hash-link" aria-label="Direct link to Dependencies Tool" title="Direct link to Dependencies Tool">​</a></h2>
<p>就像 PHP 有 Composer；Node.js 有 NPM；Python 有 pip；Rust 有 Cargo 一樣，C++ 的開發者們當然也製作了工具來處理專案仰賴函式庫的問題，不過受限於 C++ 的語言特性，目前並沒有一勞永逸的殺手級工具，仍然處於百家爭鳴的狀態。</p>
<ul>
<li><a href="https://github.com/cpm-cmake/CPM.cmake" target="_blank" rel="noopener noreferrer">CPM.cmake</a></li>
<li><a href="https://conan.io/" target="_blank" rel="noopener noreferrer">Conan</a></li>
<li><a href="https://github.com/microsoft/vcpkg" target="_blank" rel="noopener noreferrer">Vcpkg</a></li>
<li><a href="https://github.com/cpp-pm/hunter" target="_blank" rel="noopener noreferrer">Hunter</a></li>
<li><a href="https://buckaroo.pm/" target="_blank" rel="noopener noreferrer">Buckaroo</a></li>
</ul>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="c++" term="c++"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Electron 學習筆記 - 概敘]]></title>
        <id>https://flyskypie.github.io/blog/2023-04-01_electron_learning_note_intro</id>
        <link href="https://flyskypie.github.io/blog/2023-04-01_electron_learning_note_intro"/>
        <updated>2023-04-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Electron in the frontend roadmap]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" alt="Electron in the frontend roadmap" src="https://flyskypie.github.io/assets/images/electron-in-the-frontend-roadmap-216770b605c3467e5fb83d37d3ee6c1e.webp" width="688" height="300" class="img_UJFd"></p>
<p>Electron 可以說是前端軟體工程師必學的經典工具之一 (2023 年)，也是我個人有興趣學習的主題之一，只是一直缺乏明確的動機或目的去使用它，直到那天 (2023-03-30) 協助友人改善他 Side Project UI，同一天另外一個朋友又剛好問我 Electron 的問題，看來這是要我學習 Electron 的天意啊（？）</p>
<p>稍微試了幾個專案樣板，然後讀了一點官方文件，我稍微整理出它的架構：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/architecture-d21d8d19a8463fb1078ac51cee8db333.svg" width="1450" height="923" class="img_UJFd"></p>
<p>這裡有幾個知識點最好在學習 Electron 之前先知道：</p>
<ul>
<li>Javascript 是一種程式語言，但是它的直譯器不只一種</li>
<li>瀏覽器上的 Javascript 執行環境和 Node.js 的執行環境不同</li>
<li>在瀏覽器上開發者可以用 Javascript 使用 Web API (<code>window.*</code>, <code>CSS</code>, <code>DOM</code>...等)和 ES Module (符合 ES6 規範的 Javascript 模組)</li>
<li>在 Node.js 上開發者可以使用 Node.js 的內建模組 (<code>fs</code>, <code>os</code>, <code>path</code>...等)和 NPM 上提供的 CommonJS Module</li>
<li>在瀏覽器上 Javascript 沒有權限進行一些涉及作業系統的操作，如：對檔案系統進行讀寫</li>
</ul>
<p>然後我整理了幾個關於 Electron 的知識點整理：</p>
<ul>
<li>Electron 應用程式分成兩個區塊<!-- -->
<ul>
<li>瀏覽器（基於 Chromium）</li>
<li>Node.js</li>
</ul>
</li>
<li>兩個區塊彼此獨立<!-- -->
<ul>
<li>Main Process 不能操作 DOM</li>
<li>Render Process 不能使用 Node.js 模組讀寫檔案系統或是 spawn 子行程</li>
</ul>
</li>
<li>一個應用程式可能有複數個視窗</li>
<li>Preload Prcess 能夠同時訪問瀏覽器區塊和 Node.js 區塊<!-- -->
<ul>
<li>我們可以把原本被隔離的兩個區塊曝露部份操作給彼此</li>
<li>透過 Electron 提供的 IPC API</li>
</ul>
</li>
</ul>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="javascript" term="javascript"/>
        <category label="electron" term="electron"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[一場關於 2D Skeletal animation 動畫的 Web Runtime 的旅程]]></title>
        <id>https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime</id>
        <link href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime"/>
        <updated>2023-01-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>如果對我的 Side Project 「底火的芬芳」不清楚的讀者可能需要先閱讀<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence">底火的芬芳 - 專案起源</a>才能理解這場旅程是怎麼開始的。而最近 (2022-12-19) 在逛 Github 的時候晃到一個 <a href="https://github.com/neko-gg/gfl-combat-simulator" target="_blank" rel="noopener noreferrer">repo</a>，它是<a href="https://en.wikipedia.org/wiki/Girls%27_Frontline" target="_blank" rel="noopener noreferrer">少女前線</a>這款遊戲的數值模擬器，往程式語言構成一看是用 Typescript 寫的立刻勾起了我的興趣。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="neko-gggfl-combat-simulator"><code>neko-gg/gfl-combat-simulator</code><a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#neko-gggfl-combat-simulator" class="hash-link" aria-label="Direct link to neko-gggfl-combat-simulator" title="Direct link to neko-gggfl-combat-simulator">​</a></h2>
<p>2022-12-19 在 Github 上閒逛的時候，看到一個 <a href="https://github.com/neko-gg/gfl-combat-simulator" target="_blank" rel="noopener noreferrer">repo</a>。</p>
<blockquote>
<p>喔啦啦，這不是 Typescript 嗎？
喔啦啦，這不是 React 嗎？
是我的主場呢 = =+</p>
</blockquote>
<p>於是就 <code>clone</code> 下來研究研究。</p>
<p>後來（約 2022-12-20）照著 <code>README.md</code> 的指示：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">yarn update-resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn update-assets</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>找到了 <a href="https://github.com/neko-gg/gfl-combat-simulator/blob/senpai/src/app/data/ResourcesUpdater.ts" target="_blank" rel="noopener noreferrer">ResourcesUpdater</a> 和 <a href="https://github.com/neko-gg/gfl-combat-simulator/blob/senpai/src/app/data/AssetsUpdater.ts" target="_blank" rel="noopener noreferrer">AssetsUpdater</a> 這兩個程式，發現它把遊戲素材放在另外一個 <a href="https://github.com/36base/girlsfrontline-resources" target="_blank" rel="noopener noreferrer">repo</a>。以及會從遊戲官方的 cdn 下載名為 <code>ResData.ab</code> 的檔案，因為不知道是什麼檔案類型，就用 Hex 瀏覽器打開來看：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/unity-asset-bundle-binary-bbcfbbe578f898920ce7ab41171aa256.webp" width="355" height="260" class="img_UJFd"></p>
<p>啊啦啦，原來是 Unity ResData Bundle。</p>
<p>另外，從 <code>ResourcesUpdater</code> 看到它呼叫了來自 <a href="https://github.com/neko-gg/gfl-combat-simulator/blob/senpai/src/app/data/ChibiUpdater.ts" target="_blank" rel="noopener noreferrer">ChibiUpdater.ts</a> 的方法，稍微研究一下內容發現它使用 Puppeteer 打開一個<a href="https://naganeko.github.io/spine-gif/" target="_blank" rel="noopener noreferrer">網站</a>並做了某些事，不過因為程式碼已經有點過時了，網站已經被移到<a href="https://naganeko.pages.dev/" target="_blank" rel="noopener noreferrer">其他地方</a>，DOM 的操作也和原本腳本內的方式有點落差。研究了它使用 Puppeteer 的方式，看得出來目的是取得一張 Chibi 站立的圖片。</p>
<ul>
<li>原始的 Chibi （程式內對人偶的稱呼）檔案是將人偶拆件，並透過組態檔組裝的。</li>
<li>naganeko 的網站能夠上傳 Spine 檔案，並播放動畫。</li>
<li>naganeko 的網站也能下載組裝後的圖檔。</li>
</ul>
<p>試著逆向工程 naganeko 的網站，發現它應該是使用了 Spine 的 Runtime。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="2d-骨架動畫">2D 骨架動畫<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#2d-%E9%AA%A8%E6%9E%B6%E5%8B%95%E7%95%AB" class="hash-link" aria-label="Direct link to 2D 骨架動畫" title="Direct link to 2D 骨架動畫">​</a></h2>
<p>在 3D 模型/動畫中，會使用骨架 (Armature) 綁定模型節點，並透過權重、關鍵影格等方式讓模型執行動畫。</p>
<p>透過把模型壓扁，將這種技術應用在 2D 場景就是 2D 骨架動畫，可以解決傳統 Sprite 的一些<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#sprite-%E9%99%90%E5%88%B6">限制</a>。另外還有三渲二之類在遊戲開發上常見的手段，不過不在本次題目的討論範圍內。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="spine">Spine<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#spine" class="hash-link" aria-label="Direct link to Spine" title="Direct link to Spine">​</a></h3>
<p><a href="http://esotericsoftware.com/" target="_blank" rel="noopener noreferrer">Spine</a> 是目前極為普及的 2D 骨架動畫 tool chain。用工業建模比喻的話就像 SolidWork，或是美術產業中的 PhotoShop 以及 Illustrator。原因在於其應用端成功的布局，包含 Unity3D, 又或是網頁遊戲開發 Three.js, Phaser, PixiJS...之類的執行環境，有著非常廣泛的 <a href="http://en.esotericsoftware.com/spine-runtimes" target="_blank" rel="noopener noreferrer">Runtime</a> 支援。換句話使用它的產品，佈署目標的選擇十分多元。</p>
<p>然而這個格式終究是商業產品，編輯器本身需要付費，使用者（如：遊戲開發者）也需要購買<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#spine-%E6%8E%88%E6%AC%8A">授權</a>。即便有 Runtime 的原始碼，其授權範圍仍不算開源的範疇，對我而言尋找替代方案就很重要了，因為我只是想寫寫 side project。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="替代方案">替代方案<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88" class="hash-link" aria-label="Direct link to 替代方案" title="Direct link to 替代方案">​</a></h3>
<p>與 Spine 類似的產品還有 <a href="https://creature.kestrelmoon.com/" target="_blank" rel="noopener noreferrer">Creature Animation</a>、<a href="https://rive.app/" target="_blank" rel="noopener noreferrer">Rive</a> 之類的，不過它們跟 Spine 一樣都有一股商業味，自然就排除在我的選項之外了。</p>
<p>往開源的生態系望去，則有 Blender 的生態系內有個名為 <a href="https://github.com/ndee85/coa_tools" target="_blank" rel="noopener noreferrer">COA Tools</a> 的工具能夠製作 2D 動畫。或是 Godot 作為開源的遊戲引擎也有內建的 <a href="https://docs.godotengine.org/en/stable/tutorials/animation/cutout_animation.html" target="_blank" rel="noopener noreferrer">2D 骨架動畫系統</a>。</p>
<p>只是我懶得自己重頭綁骨架跟刷權重，能夠直接用<del>撿到</del>的少女前線檔案轉檔是在好不過了。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="dragonbones">DragonBones<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#dragonbones" class="hash-link" aria-label="Direct link to DragonBones" title="Direct link to DragonBones">​</a></h3>
<p>最後 (2022-12-22) 決定使用 <a href="https://docs.egret.com/dragonbones/en" target="_blank" rel="noopener noreferrer">DragonBones</a> 的格式，雖然編輯軟體本身沒開源而且只能在 Windows 執行，但是至少是免費的而且能夠用 Wine 跑起來。這個工具背後的中國公司的 Tech Stack 算是從 Flash 長出來的，後來往 Javascript 轉型。因此它的 <a href="https://github.com/DragonBones/DragonBonesJS" target="_blank" rel="noopener noreferrer">runtime</a> 支援不少諸如 Three.js Pixi, Phaser 等知名的 Javascript 的套件。</p>
<p>最重要的是，它能夠匯入 Spine 格式的檔案，並輸出成 DragonBones 的格式。~~這樣我就可以直接撿 Chibi 的檔案來用囉～~~還有其他考量就是，如果編輯器也是基於 Javascript 的話，日後逆向工程起來比較容易。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/smile-80f08926f2ee3bb5bbf8f30446881436.webp" width="540" height="360" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="dragonbonesjs-重構">DragonBonesJS 重構<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#dragonbonesjs-%E9%87%8D%E6%A7%8B" class="hash-link" aria-label="Direct link to DragonBonesJS 重構" title="Direct link to DragonBonesJS 重構">​</a></h2>
<p>然而 DragonBonesJS 的 Javascript Runtime 自 2020 就沒有維護了，而且並不支援 ES6 的模組載入方式。從程式碼看得出來它使用的設計是有一個處理事務邏輯的核心，以及針對各種不同套件實作的 Runtime 。因此即便我重構了核心，也無法直接測試，必須選用一個 Runtime 作為測試用途。</p>
<p>原本支援的 Runtime 中，Three.js 是我的目標，但是沒有充足的 Demo code 能夠測試重構，當中的 Phaser 是我有接觸過得遊戲引擎，但是它的<a href="https://github.com/DragonBones/DragonBonesJS/tree/master/Phaser/3.x/src/dragonBones/phaser" target="_blank" rel="noopener noreferrer">實作</a>較為複雜，而 PixiJS 的版本我雖然沒使用過，但是<a href="https://github.com/DragonBones/DragonBonesJS/tree/master/Pixi/4.x/src/dragonBones/pixi" target="_blank" rel="noopener noreferrer">實作</a>比較簡單，只有 4 個檔案，於是重構的任務就拆成了 3 個部份：</p>
<ul>
<li>Core<!-- -->
<ul>
<li>真正處理動畫邏輯的部份</li>
</ul>
</li>
<li>PixiJS Runetime<!-- -->
<ul>
<li>主要是為了完整的 Demo 範例，好測試 Core 的重構運作正不正常</li>
</ul>
</li>
<li>Three.js Runtime<!-- -->
<ul>
<li>目標，因為我想把 Chibi 丟進 3D 的空間中</li>
</ul>
</li>
</ul>
<p>Core 跟 PixiJS Runtime 的重構過程沒什麼好紀錄的，就是要轉換成 ES6 的寫法跟解決 <code>tsconfig</code> 設定不同的問題。Three.js Runtime 的重構過程倒是問題不少。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="threejs-runtime-重構">Three.js Runtime 重構<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#threejs-runtime-%E9%87%8D%E6%A7%8B" class="hash-link" aria-label="Direct link to Three.js Runtime 重構" title="Direct link to Three.js Runtime 重構">​</a></h3>
<p>DragonBones 提供的 Demo 中，只有線性變換的部份（Translate, Rotation, Scale），並沒有包含網格變形，當我匯入 Chibi 的檔案時，得到了破圖的結果：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/glitch-433919c2c301c10f480f1b177486567c.gif" width="252" height="228" class="img_UJFd"></p>
<p>慶幸的是在 issues 撿到野生的 <a href="https://github.com/DragonBones/DragonBonesJS/issues/133" target="_blank" rel="noopener noreferrer">patch</a>。</p>
<p>接著要處理的要件是升級 Three.js 的版本，DragonBones 遺留的程式碼僅支援到 0.89.0，而目前版本是 0.148.0。升級的過程遇到一個問題是 Three.js 在 0.125.0 的時候棄用了一個名為 Geometry 的物件，而在 DragonBones 的實作中是仰賴這個物件的，即使可以透過 <a href="https://discourse.threejs.org/t/three-geometry-will-be-removed-from-core-with-r125/22401" target="_blank" rel="noopener noreferrer">Legacy Code</a> 拿來使用，卻會有性能問題。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="重構成果">重構成果<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#%E9%87%8D%E6%A7%8B%E6%88%90%E6%9E%9C" class="hash-link" aria-label="Direct link to 重構成果" title="Direct link to 重構成果">​</a></h3>
<ul>
<li>Runtime Demo<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/dragonbones-pixi/demo/" target="_blank" rel="noopener noreferrer">https://flyskypie.github.io/dragonbones-pixi/demo/</a></li>
</ul>
</li>
<li>Github Repo<!-- -->
<ul>
<li><a href="https://github.com/FlySkyPie/dragonbones-js" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/dragonbones-js</a></li>
<li><a href="https://github.com/FlySkyPie/dragonbones-pixi" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/dragonbones-pixi</a></li>
<li><a href="https://github.com/FlySkyPie/dragonbones-threejs" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/dragonbones-threejs</a></li>
</ul>
</li>
<li>NPM Package<!-- -->
<ul>
<li><a href="https://www.npmjs.com/package/@flyskypie/dragonbones-js" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/dragonbones-js</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/dragonbones-pixi" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/dragonbones-pixi</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/dragonbones-threejs" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/dragonbones-threejs</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="threejs-chibi-game-sample">Three.js Chibi Game Sample<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#threejs-chibi-game-sample" class="hash-link" aria-label="Direct link to Three.js Chibi Game Sample" title="Direct link to Three.js Chibi Game Sample">​</a></h2>
<p>就只是想做個概念驗證：</p>
<ul>
<li>如果我有一個 2D 人偶</li>
<li>放進 3D 空間，像是<a href="https://threejs.org/examples/?q=control#misc_controls_orbit" target="_blank" rel="noopener noreferrer">Three.js 的範例</a></li>
<li>做成類似<a href="https://youtu.be/xXOa4xqtnfE" target="_blank" rel="noopener noreferrer">尼爾：自動人形</a>駭客小遊戲的風格</li>
</ul>
<p><a href="https://youtu.be/lVCbXohxvPQ" target="_blank" rel="noopener noreferrer" title="Three.js Chibi Animation Shoot Game Prototype"><img decoding="async" loading="lazy" src="http://img.youtube.com/vi/lVCbXohxvPQ/0.jpg" alt="" class="img_UJFd"></a></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="註解">註解<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#%E8%A8%BB%E8%A7%A3" class="hash-link" aria-label="Direct link to 註解" title="Direct link to 註解">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="sprite-限制">Sprite 限制<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#sprite-%E9%99%90%E5%88%B6" class="hash-link" aria-label="Direct link to Sprite 限制" title="Direct link to Sprite 限制">​</a></h3>
<p>傳統 Sprite 是透過切換數張點陣圖達到視覺暫留的動畫效果，點陣圖除了繪製費工之外、檔案較大還有幀數受限制等問題。</p>
<p>與之相對的 3D 模型是用點數據構成的，也就是所謂的向量圖檔。透過綁定骨架就重複使用同一張貼圖製作不同的動畫。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="spine-授權">Spine 授權<a href="https://flyskypie.github.io/blog/2023-01-17_a-journey-about-2D-skeletal-animation-of-runtime#spine-%E6%8E%88%E6%AC%8A" class="hash-link" aria-label="Direct link to Spine 授權" title="Direct link to Spine 授權">​</a></h3>
<p>Spine 的授權規則很哆嗦：</p>
<ul>
<li><a href="http://zh.esotericsoftware.com/spine-editor-license#s2" target="_blank" rel="noopener noreferrer">http://zh.esotericsoftware.com/spine-editor-license#s2</a></li>
<li><a href="https://github.com/EsotericSoftware/spine-runtimes/blob/4.1/LICENSE" target="_blank" rel="noopener noreferrer">https://github.com/EsotericSoftware/spine-runtimes/blob/4.1/LICENSE</a></li>
</ul>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="development note" term="development note"/>
        <category label="The Key of Huanche" term="The Key of Huanche"/>
        <category label="Gear Redolence" term="Gear Redolence"/>
        <category label="2d animation" term="2d animation"/>
        <category label="skeletal-animation" term="skeletal-animation"/>
        <category label="DragonBones" term="DragonBones"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[底火的芬芳 - 專案起源]]></title>
        <id>https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence</id>
        <link href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence"/>
        <updated>2023-01-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[大約 2019 年四月的時候，身邊有玩少女前線的朋友，並且當時又接觸一個名為 Dental Defender: Saga of the Candy Horde 的小遊戲，它使用 Phaser 引擎撰寫，於是我稍微試著了解一下 Phaser 引擎的運作方式與 Tiled 劃地圖的方法並分別在 FB 留下了兩篇貼文。]]></summary>
        <content type="html"><![CDATA[
<p>大約 2019 年四月的時候，身邊有玩少女前線的朋友，並且當時又接觸一個名為 <a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#dental-defender-saga-of-the-candy-horde">Dental Defender: Saga of the Candy Horde</a> 的<a href="https://github.com/cshepp/candyjam" target="_blank" rel="noopener noreferrer">小遊戲</a>，它使用 Phaser 引擎撰寫，於是我稍微試著了解一下 Phaser 引擎的運作方式與 Tiled 劃地圖的方法並分別在 FB 留下了<a href="https://www.facebook.com/wei.ji.355/videos/1201535273352416/" target="_blank" rel="noopener noreferrer">兩篇</a><a href="https://www.facebook.com/wei.ji.355/videos/1220239104815366/" target="_blank" rel="noopener noreferrer">貼文</a>。</p>
<p>2020 年六月份的時候在 Github 晃到一個 <a href="https://github.com/victorqribeiro/aimAndShoot" target="_blank" rel="noopener noreferrer">repo</a>，它是一個有點像 diep.io 的簡單小遊戲，只是主軸是人類玩家對抗一堆 BOT，並且這些 BOT 透過簡單的機器學習理（論上應該）會越來越強，然後當玩家輸掉時遊戲還會嘲諷「你真是人類之恥」。因為我很好奇這個機器學習的效果如何，於是就簡單的改寫程式變成 BOT 4v4 的形式。</p>
<p><a href="https://youtu.be/li8QD1xyldo" target="_blank" rel="noopener noreferrer" title="aim and shoot test"><img decoding="async" loading="lazy" src="http://img.youtube.com/vi/li8QD1xyldo/0.jpg" alt="" class="img_UJFd"></a></p>
<p>接著我又想「何不把機器學習包裝成類似少女前線這樣的角色蒐集遊戲？角色的強度依靠機器學習的性能而不是由開發商設定參數決定」，並且把這個概念寫成簡單的 UI。</p>
<p><a href="https://youtu.be/P_3_XaCzm5I" target="_blank" rel="noopener noreferrer" title="UI Prototype"><img decoding="async" loading="lazy" src="http://img.youtube.com/vi/P_3_XaCzm5I/0.jpg" alt="" class="img_UJFd"></a></p>
<p>2020 年七月底，透過<a href="https://github.com/FlySkyPie/dental-defender" target="_blank" rel="noopener noreferrer">重構</a> Dental Defender 來熟悉 Typescript 與 Phaser 引擎，就是為了實作這個概念而做的準備。也大約是這個時間，這個專案的名稱敲定為「底火的芬芳」。然而後來 Sprite 畫得有點煩加上工作忙碌再加上又跑去追其他<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#%E8%9D%B4%E8%9D%B6">蝴蝶</a>，因為跟 AI 相關，這個專案就併入 The Key Of Huanche 作為子專案並暫時被冷凍了起來。</p>
<hr>
<p>後來斷斷續續有畫一些素材也是為了這個專案：</p>
<p><img decoding="async" loading="lazy" src="data:image/gif;base64,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" width="512" height="128" class="img_UJFd"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/spirte-b74242b98daa8037124587f829a49e5b.png" width="970" height="654" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="名詞解釋">名詞解釋<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B" class="hash-link" aria-label="Direct link to 名詞解釋" title="Direct link to 名詞解釋">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="dental-defender-saga-of-the-candy-horde">Dental Defender: Saga of the Candy Horde<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#dental-defender-saga-of-the-candy-horde" class="hash-link" aria-label="Direct link to Dental Defender: Saga of the Candy Horde" title="Direct link to Dental Defender: Saga of the Candy Horde">​</a></h3>
<p>遊戲開發圈有一種活動叫做 <a href="https://zh.wikipedia.org/wiki/Game_Jam" target="_blank" rel="noopener noreferrer">Game Jam</a>，就是聚集一群愛好者在數小時到數天之內完成一款遊戲。而這個小遊戲來自一場名為 candyjam 的 Game Jam，原因是一間名為 <code>King.com</code> 的公司（就是 Candy Crush 的那間公司）在 2014 年將 "candy" 一詞申請商標，並指控一些獨立開發公司侵犯他們的商標。這一舉動激怒了獨立開發圈，於是他們舉辦一場 Game Jam 專門製作 "Cahndy" 相關的遊戲來對 <code>King.com</code> 表示抗議。<sup><a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#user-content-fn-candy-crush-b965c0" id="user-content-fnref-candy-crush-b965c0" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="蝴蝶">蝴蝶<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#%E8%9D%B4%E8%9D%B6" class="hash-link" aria-label="Direct link to 蝴蝶" title="Direct link to 蝴蝶">​</a></h3>
<p>本人有嚴重的<a href="https://en.wikipedia.org/wiki/Shiny_object_syndrome" target="_blank" rel="noopener noreferrer">閃亮事物症候群</a>，習慣將自己跑去玩其他 Side Project 比喻成追蝴蝶。</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-candy-crush-b965c0">
<p>Indie Developers Troll King Games Hard With 'Candy Jam' | WIRED. Retrieved 2023-01-17, from <a href="https://www.wired.com/2014/02/candy-crush/" target="_blank" rel="noopener noreferrer">https://www.wired.com/2014/02/candy-crush/</a> <a href="https://flyskypie.github.io/blog/2023-01-04_origin-of-gear-redolence#user-content-fnref-candy-crush-b965c0" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="development note" term="development note"/>
        <category label="The Key of Huanche" term="The Key of Huanche"/>
        <category label="Gear Redolence" term="Gear Redolence"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javascript x Bad Apple x Ascii 筆記]]></title>
        <id>https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node</id>
        <link href="https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node"/>
        <updated>2022-12-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[從影片逐幀取出畫面]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="從影片逐幀取出畫面">從影片逐幀取出畫面<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node#%E5%BE%9E%E5%BD%B1%E7%89%87%E9%80%90%E5%B9%80%E5%8F%96%E5%87%BA%E7%95%AB%E9%9D%A2" class="hash-link" aria-label="Direct link to 從影片逐幀取出畫面" title="Direct link to 從影片逐幀取出畫面">​</a></h2>
<p>這個步驟不難，使用 FFmpeg 只要一行指令就能完成：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -i bad_apple.mp4 -vf fps=5 output/%04d.png</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="將畫面轉換成-ascii-純文字檔">將畫面轉換成 ASCII 純文字檔<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node#%E5%B0%87%E7%95%AB%E9%9D%A2%E8%BD%89%E6%8F%9B%E6%88%90-ascii-%E7%B4%94%E6%96%87%E5%AD%97%E6%AA%94" class="hash-link" aria-label="Direct link to 將畫面轉換成 ASCII 純文字檔" title="Direct link to 將畫面轉換成 ASCII 純文字檔">​</a></h2>
<p>這個步驟也不難，把剛剛生成的畫面載入、轉換再吐出去，搞定。</p>
<div class="language-javascript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-javascript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">fs</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'fs'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">asciify</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'asciify-image'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mkdirSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">recursive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">fit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'none'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">width</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">c_ratio</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">color</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">{</span><span class="token doc-comment comment class-name" style="color:#999988;font-style:italic">string</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">}</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">path</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@returns</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">{</span><span class="token doc-comment comment class-name" style="color:#999988;font-style:italic">Promise</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">&lt;</span><span class="token doc-comment comment class-name" style="color:#999988;font-style:italic">string</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">}</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">imageToAsciiPromise</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">asciify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> asciified</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">asciified</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replaceAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> _files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readdirSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'img'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">file</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sourcePath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">img/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">file</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> targetPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">data/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">index </span><span class="token template-string interpolation operator" style="color:#393A34">+</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa">1</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">toString</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">padStart</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation number" style="color:#36acaa">4</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">'0'</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.txt</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sourcePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> targetPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> sourcePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> targetPath </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> acsii </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">imageToAsciiPromise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sourcePath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeFileSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">targetPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> acsii</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sourcePath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="播放">播放<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node#%E6%92%AD%E6%94%BE" class="hash-link" aria-label="Direct link to 播放" title="Direct link to 播放">​</a></h2>
<div class="language-javascript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-javascript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#393A34">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#00009f">as</span><span class="token imports"> os</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"os"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#393A34">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#00009f">as</span><span class="token imports"> std</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"std"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">drawFrame</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drawFrame</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> f </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> std</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">loadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">data/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">count</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">toString</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">padStart</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation number" style="color:#36acaa">4</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">'0'</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.txt</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">clearTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'\x1B[2J'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\n'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">drawFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要特別注意的是，這個執行環境是 QuickJs，<code>os</code> 和 <code>std</code> 都是該直譯器提供的模組。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="3ds" term="3ds"/>
        <category label="javascript" term="javascript"/>
        <category label="quickjs" term="quickjs"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[3DS x Linux x Javascript x Bad Apple]]></title>
        <id>https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple</id>
        <link href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple"/>
        <updated>2022-12-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文以敘述的方式紀錄我在這個專案上的過程，並省略技術細節。若對實作細節有興趣，以下是以技術筆記的形式紀錄的文章：]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/touch-65310ce8b7222c3e34008a6c0e585a87.webp" width="432" height="324" class="img_UJFd"></p>
<p>本文以敘述的方式紀錄我在這個專案上的過程，並省略技術細節。若對實作細節有興趣，以下是以技術筆記的形式紀錄的文章：</p>
<ul>
<li><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note">3DS 刷機筆記</a></li>
<li><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note">3DS 刷 Linux 筆記</a></li>
<li><a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note">交叉編譯 QuickJs 筆記</a></li>
<li><a href="https://flyskypie.github.io/blog/2022-12-03_3ds_bad_apple_node">Javascript x Bad Apple x Ascii 筆記</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>最近 (2022-11-06) 從天上掉下來的一台 3DS (?)</p>
<p>老實說對於一般過時 N 年的消費性電子產品，我是完全沒興趣多花時間去玩它，根據以往的經驗，hack 這種東西多半吃力不討好；花費大量的時間也只能獲得相對於現代設備少得可憐的算力。 不過個人對於這種「有機械輸入的橫式手持行動裝置」有著莫名憧憬，隨手搜尋看看刷機的資料，發現資源蠻多的，教學也很詳細，就想著來刷刷看。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="閃亮亮症候群再次發作">閃亮亮症候群再次發作<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#%E9%96%83%E4%BA%AE%E4%BA%AE%E7%97%87%E5%80%99%E7%BE%A4%E5%86%8D%E6%AC%A1%E7%99%BC%E4%BD%9C" class="hash-link" aria-label="Direct link to 閃亮亮症候群再次發作" title="Direct link to 閃亮亮症候群再次發作">​</a></h2>
<p>跟朋友表示想在 3DS 上刷 Linux 之後，「工程師的成就清單」的話題就這樣被打開了，對話中除了提 「在非常見或非通用功能電腦上安裝 Linux」還提到了「在非常見的顯示器上播放 Bad Apple」。</p>
<p>過幾天 (2022-11-09)，我便利用下班之餘試著在 3DS 上刷 Linux。刷機的第一部就是透過系統漏洞刷入 CFW (Custom firmware)，讓 3DS 能夠從 SD Card 讀取 bootloader 開機，因為<a href="https://3ds.hacks.guide/get-started" target="_blank" rel="noopener noreferrer">教學</a>很詳細，照著步驟做沒有花太多時間就成功刷機了，當中有些教學性質的步驟也讓我看了 <a href="https://www.gamebrew.org/wiki/Linux_for_3DS" target="_blank" rel="noopener noreferrer">3DS Linux</a> 的頁面之後就知道大概要做什麼，也成功的在 3DS 上進入 Linux 了。</p>
<p>到目前為止都出乎我意料之外的順利，於是我想：</p>
<blockquote>
<p>我都有一台跑著 Linux 的 3DS 了，寫個程式讓它跑 Bad Apple 應該不難吧？</p>
</blockquote>
<p>接著我又想：</p>
<blockquote>
<p>如果能用我熟悉的 Javascript 寫程式就好了</p>
</blockquote>
<p>於是「在 3DS 上跑 Linux 跑 Javascript 顯示 Bad Apple」就變成一個 side project 的目標了，接著這個 side project 就一發不可收拾了。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="這個-linux-是金魚腦">這個 Linux 是金魚腦<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#%E9%80%99%E5%80%8B-linux-%E6%98%AF%E9%87%91%E9%AD%9A%E8%85%A6" class="hash-link" aria-label="Direct link to 這個 Linux 是金魚腦" title="Direct link to 這個 Linux 是金魚腦">​</a></h2>
<p>試著新增檔案並寫入一些資料，重開機之後卻發現檔案消失了，後來才了解到整個檔案樹是放在啟動 Linux 用的映像檔裡面，那些資料夾在開機之後是掛在 Ram Disk 上 <sup><a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#user-content-fn-linux-3ds-files-0ba2fc" id="user-content-fnref-linux-3ds-files-0ba2fc" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>，自然沒有儲存的功能。</p>
<p>解決的辦法就是把資料存在 SD 卡上，但是這個 Linux 預設並不會掛載 SD 卡，研究了一會兒才知道它在 <code>/dev/vda1</code>，但是每次開機都要打一次指令顯得有點麻煩（提醒，3DS 沒辦法外接鍵盤，我只能用觸控筆敲指令）。</p>
<p>寫個腳本讓它在開機的時候執行便理所當然的變成必須完成的任務，然而它並沒有 systemd, rc.local 這類高級的東西。<code>/etc/init.d/rcS</code> 承擔 start 的功能 <code>/etc/init.d/rcK</code> 承擔 kill(stop) 的功能，會依序執行 <code>/etc/init.d/rcS/S(\d\d.*)</code>。</p>
<p>腳本倒是容易搞定，但是我要怎麼把它包進去開機用的 img 裡面？建置 3DS Linux 的過程涉及一個 <code>rootfs.cpio.gz</code> 檔案，我必須把它解包之後加入我要的修改再包回去。</p>
<p>花了一點時間搞懂上述這些東西，才終於讓我的 Linux 開機會自動掛載 SD 卡 (2022-11-12)。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="第�一個挫折">第一個挫折<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#%E7%AC%AC%E4%B8%80%E5%80%8B%E6%8C%AB%E6%8A%98" class="hash-link" aria-label="Direct link to 第一個挫折" title="Direct link to 第一個挫折">​</a></h2>
<p>依照自己的以往經驗：「要在 Host 上跑 Javascript 就先裝 Node.js」，然而最新版的 Node.js 並沒有 Armv6 的 prebuild release，不過一直到 11 版，還是有官方版的 armv6 prebuild 可以<a href="https://nodejs.org/dist/latest-v11.x/" target="_blank" rel="noopener noreferrer">下載</a>。下載之後在 3DS 上執行會拋出 <code>-sh: ./node: not found</code> 的錯誤，原因是官方的 prebuild 是仰賴 glibc，但是 3DS Linux 使用的是 musl libc。好吧，這個問題我也不是太陌生，之前在包 Docker 接觸過 Alpine Linux，所以對這類問題有個概念。</p>
<blockquote>
<p>好唄，自己 build 就是了</p>
</blockquote>
<p>雖然網路上找了一些 build 參數，但是怎麼試怎麼有問題，畢竟我平常又不寫 C，對專案的編譯配置不熟悉。後來找到一個叫做 <a href="https://github.com/dockcross/dockcross" target="_blank" rel="noopener noreferrer">Dockcross</a> 的工具專門用來處理交叉編譯 (Cross Compiling)。但是相對舊版的 Node.js 仰賴 Python 2.X，Dockcross 的 Image 只有 3.X，這時我才知道 Node.js 的編譯過程居然仰賴 Python，我內心 OS：「SHAME， 程式語言之恥，Node.js 你作為一個直譯語言的直譯器的編譯過程居然仰賴另外一種直譯語言」。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/shame-334ebdb49c394aaa13e1aaf95bdd5121.webp" width="1536" height="2048" class="img_UJFd"></p>
<p>好加在 Dockcross 允許<a href="https://github.com/dockcross/dockcross#how-to-extend-dockcross-images" target="_blank" rel="noopener noreferrer">擴充</a> Docker image 以符合專案需要，然而事情並沒有這麼簡單。Node.js 的編譯過程仰賴了編譯的產出物，也就是當我指定了編譯目標為 <code>linux-armv6-musl</code> ，會生成一些 tool，接著在編譯出 <code>node</code> 以前，它會在 host 呼叫這些 tool，但是我的 host 不是 <code>linux-armv6-musl</code>；於是拋出錯誤，編譯中止。<code>(#╯O皿O)╯┻━┻</code></p>
<p>接著我發現在建置 3DS Linux 過程中使用的工具：<a href="https://github.com/linux-3ds/buildroot" target="_blank" rel="noopener noreferrer">buildroot</a> 其實提供了一個界面可以勾選 node，而它的實作方式就是先編譯一份 x86 的版本，再跑 arm 的編譯，而編譯過程中用到的 tool 就回去 call x86 的版本。經過一波三折我終於弄出了「musl-armv6 版本的 Node.js v14」，然而問題並沒有因此解決，不然段落標題就不會是「第一個挫折」了。</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ node --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v14.18.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ node -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process node (pid: 153, stack limit = 0xc6135dc6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[&lt;c0111610&gt;] (v6_coherent_kern_range) from [&lt;c01094c0&gt;] (arm_syscall+0x15c/0x26c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[&lt;c01094c0&gt;] (arm_syscall) from [&lt;c0100060&gt;] (res_fast_syscall+0x0/0x58)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exception stack (0xc15elfa8 to 0xc15elff0)</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/too-powerful-7bc66d604bf88ca99154b3ebebe25038.webp" width="800" height="450" class="img_UJFd"></p>
<p>總之 Node.js 對於那個年代的 3DS 來說 too powerful 了。(2022-11-13)</p>
<p>作為 ECMAScript 的信徒，這個挫折讓我很不甘心。</p>
<blockquote>
<p>如果能用 node.js 跑的話感覺真的滿酷的，用 C 或 shell 就感覺很一般</p>
</blockquote>
<p>並且正如我朋友說的，雖然我也不是不會寫 Shell 或是 C，但是感覺這樣就太無聊了（？）既然都難得要解 Bad Apple 的成就了，當然是加點料比較有趣，而且作為網頁前端工程師，窩真的不是很想用 Shell 或是 C 寫啊 <code>_(:3」∠)_</code>。誰知道 Node.js 毫無反應，就只是一團 stack 直接死在 Armv6 上。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/rake-9113dbba7c8351351e4f18c878d3bfea.webp" width="720" height="479" class="img_UJFd"></p>
<p>碰巧那天 (2022-11-13) 跟朋友聊天的時候有提到在 Javascript 的圈子有個叫做「包」的東西，後來趁著放假整理瀏覽器書籤的時候發現 Bun 相關的東西，稍微查一下資料才想起來除了 Node.js 之外還有 Deno 跟 Bun 兩個實作 Javascript 的專案。</p>
<p>Bun 因為是後起之秀，Deno 又是用 Rust 寫的，具我所知 Rust 也能拿來寫嵌入式韌體，移植到 3DS Linux 的機率比較高一點，於是我便朝著這個方向去研究。</p>
<p>雖然 Deno 本身有一些很酷的 feature，包含交叉編譯的功能，可以把 Javascript 編譯成目標平台的執行檔。但是它本身卻沒有 arm linux 的 prebuild。就算自己跑編譯也會在下載仰賴套件 <code>rusty_v8</code> 的時候失敗，加上官方關於 32 bit ARM 支援的 <a href="https://github.com/denoland/deno/issues/2295" target="_blank" rel="noopener noreferrer">issue</a> 仍然開著。這些都還不包括 musl libc 可能會遇到的問題。看來此路仍然不通。我甚至一度產生了「乾脆用 Rust 寫吧，順便學一下這個我有興趣但是保持觀望一段時間的語言」的念頭。(2022-11-18)</p>
<p>等等，既然 Javascript 都有諸如 Node.js, Bun, Deno 這些不同的實作，甚至使用不同的 runtime 引擎(V8, JavaScriptCore)，ECMAScript 單純作為標準，它的實作應該不只這樣吧？我也應該不是第一個想在嵌入式系統跑 Javascript 的人吧？</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="any-application-that-can-be-written-in-javascript-will-eventually-be-written-in-javascript">「Any application that can be written in JavaScript, will eventually be written in JavaScript.」<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#any-application-that-can-be-written-in-javascript-will-eventually-be-written-in-javascript" class="hash-link" aria-label="Direct link to 「Any application that can be written in JavaScript, will eventually be written in JavaScript.」" title="Direct link to 「Any application that can be written in JavaScript, will eventually be written in JavaScript.」">​</a></h2>
<p><a href="https://stackoverflow.com/questions/5384762" target="_blank" rel="noopener noreferrer">事實</a>證明我不孤單：</p>
<ul>
<li><a href="https://duktape.org/" target="_blank" rel="noopener noreferrer">https://duktape.org/</a></li>
<li><a href="https://github.com/gfwilliams/tiny-js" target="_blank" rel="noopener noreferrer">https://github.com/gfwilliams/tiny-js</a></li>
<li><a href="https://github.com/cesanta/mjs" target="_blank" rel="noopener noreferrer">https://github.com/cesanta/mjs</a></li>
<li><a href="https://github.com/jerryscript-project/jerryscript" target="_blank" rel="noopener noreferrer">https://github.com/jerryscript-project/jerryscript</a></li>
</ul>
<p>一開始我嘗試了 tiny-js，因為在問答串的分數也相對高，它看起來足夠精簡，背後又是 Google。然而很快又遇到了 Musl libc 的問題，透過 <a href="https://github.com/richfelker/musl-cross-make" target="_blank" rel="noopener noreferrer">musl-cross-make</a> 這個工具沒有花多久就排除問題了，但是執行後直接跳 Segmentation fault，畢竟是個年久失修的專案，會這樣似乎也不怎麼意外。</p>
<p>後來我在<a href="https://github.com/topics/javascript-engine?l=c&amp;o=asc&amp;s=stars" target="_blank" rel="noopener noreferrer">這裡</a>發現 <a href="https://github.com/bellard/quickjs" target="_blank" rel="noopener noreferrer">quickjs</a> 不只有中文資源，README 也有提到可以直接執行而不是只有 lib，相較於 <a href="https://github.com/jerryscript-project/jerryscript" target="_blank" rel="noopener noreferrer">jerryscript</a> 的 README 沒有明講是 lib 還是可以直接跑，又有仰賴 Python 編譯，我就先選擇了 quickjs 嘗試。（對，我就歧視 Python，OHO）</p>
<p>它跟 Node.js 一樣，編譯過程仰賴自己編譯的 tool (<code>qjsc</code>)，一樣要 build 兩次來解決，因為有前面的經驗，沒有花太久就把問題排除並成功在 3DS Linux 上跑起來了。 (2022-11-20)</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/3ds_linux-d08e47870b383941835e0267a7f618d7.webp" width="2048" height="1296" class="img_UJFd"></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="voila">Voila!<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#voila" class="hash-link" aria-label="Direct link to Voila!" title="Direct link to Voila!">​</a></h2>
<p>Javascript 能夠跑起來，實作的部份就簡單了（？）</p>
<ol>
<li>用 FFmpeg 對影片以 5 FPS 取樣轉成圖片（原本試過 10 FPS，無奈設備太老舊跟不上）</li>
<li>把圖片轉成 ASCII 文字檔</li>
<li>用 Javascript 讀擋然後 print 出來</li>
</ol>
<p>因為我現在手上同時有 arm 跟 x86 版本的 qjs 直譯器，改 Javascript 程式執行 debug 的速度就很快了，不用重新編譯，只要在 dev 環境測試到沒問題直接複製到 3DS 去再做第二次測試。</p>
<p><a href="https://youtu.be/xYr9pNCv0YQ" target="_blank" rel="noopener noreferrer" title="3DS x Linux x Javascript x Bad Apple"><img decoding="async" loading="lazy" src="http://img.youtube.com/vi/xYr9pNCv0YQ/0.jpg" alt="" class="img_UJFd"></a></p>
<p>(縮圖有影片連結)</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-linux-3ds-files-0ba2fc">
<p><a href="https://github.com/linux-3ds/linux/wiki" target="_blank" rel="noopener noreferrer">https://github.com/linux-3ds/linux/wiki</a> <a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple#user-content-fnref-linux-3ds-files-0ba2fc" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="3ds" term="3ds"/>
        <category label="javascript" term="javascript"/>
        <category label="quickjs" term="quickjs"/>
        <category label="cross compilation" term="cross compilation"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[交叉編譯 QuickJs 筆記]]></title>
        <id>https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note</id>
        <link href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note"/>
        <updated>2022-11-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="前情提要">前情提要<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>我已經成功的完成了 3DS 刷機並且在它上面跑起了 Linux，作為一個網頁前端工程師，我一點也不想為了在上面跑點東西跑去寫 C，而是想把我的舒適圈帶進去，也就是我要弄一個 Javascript runtime 進去 3DS Linux。</p>
<p>然而 3DS Linux 算是一個相對罕見的環境：Armv6 的硬體以及使用 musl libc，主流的 Javascript runtime 並沒有提供官方版本的 pre-build release，而是需要自己想辦法編譯。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="musl-libc">musl libc<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#musl-libc" class="hash-link" aria-label="Direct link to musl libc" title="Direct link to musl libc">​</a></h3>
<p>C 語言程式的執行其實仰賴 libc (C Run-Time Library)，並且 libc 的實作<a href="https://wdv4758h-notes.readthedocs.io/zh_TW/latest/libc.html" target="_blank" rel="noopener noreferrer">不只一種</a>，musl libc 便是其中的一種，而且被不少 Linux 發行版作為 C 標準函式庫。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="交叉編譯-cross-compilation">交叉編譯 (Cross Compilation)<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#%E4%BA%A4%E5%8F%89%E7%B7%A8%E8%AD%AF-cross-compilation" class="hash-link" aria-label="Direct link to 交叉編譯 (Cross Compilation)" title="Direct link to 交叉編譯 (Cross Compilation)">​</a></h3>
<p><img decoding="async" loading="lazy" alt="https://preshing.com/images/gcc-cross-compiler.png" src="https://flyskypie.github.io/assets/images/cross_compilation-ea4a5f6193c4232b545e0746c3eaa312.webp" width="596" height="291" class="img_UJFd"></p>
<p>交叉編譯就是先在 host 編譯出交叉編譯器 (cross compiler)，再用這個交叉編譯器去編譯你的程式，最終目的是你的程式能夠跑在 target 上。</p>
<p>另外一個方法就是直接在 target 上跑編譯，但是 target 有可能是性能很低的晶片，這種方法效率非常差甚至無法完成（沒有足夠的記憶體完成編譯之類的），交叉編譯就是為了解決這種問題而存在的。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="quickjs">QuickJs<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#quickjs" class="hash-link" aria-label="Direct link to QuickJs" title="Direct link to QuickJs">​</a></h2>
<p>眾所皆知 ECMAScript 是一個語言的規範，而不是實作，因此遵守該規範的直譯器 (runtime) 其實有百百種。除了 <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js</a> 之外，Javascript runtime 還有後起之秀 <a href="https://deno.land/" target="_blank" rel="noopener noreferrer">Deno</a> 和 <a href="https://bun.sh/" target="_blank" rel="noopener noreferrer">Bun</a>，而引擎 (engnine) 自然也不少，被各種瀏覽器、 Node.js 以及 Deno 使用的 V8 或是被 Bun 使用的 JavaScriptCore，除了這些之外還有<a href="https://en.wikipedia.org/wiki/List_of_ECMAScript_engines" target="_blank" rel="noopener noreferrer">諸多</a>的實作。</p>
<p><a href="https://bellard.org/quickjs/" target="_blank" rel="noopener noreferrer">QuickJS</a> 是一個嬌小且可嵌入式的 Javascript 引擎。它支援 ES2020 規範，包含模組、非同步 Generator、Proxy、BigInt。它是以 C 語言撰寫並且沒有仰賴其他函式酷。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="編譯-cross-compiler">編譯 Cross Compiler<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#%E7%B7%A8%E8%AD%AF-cross-compiler" class="hash-link" aria-label="Direct link to 編譯 Cross Compiler" title="Direct link to 編譯 Cross Compiler">​</a></h2>
<p>已經有人準備了方便的工具 <a href="https://github.com/richfelker/musl-cross-make" target="_blank" rel="noopener noreferrer">musl-cross-make</a> 讓我們能簡單的製作交叉編譯器。</p>
<p>首先下載這個 repo：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">git clone git@github.com:richfelker/musl-cross-make.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd musl-cross-make</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>新增 <code>config.mak</code> 檔案：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">touch config.mak</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>加入以下內容：</p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">TARGET = arm-linux-musleabihf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMON_CONFIG += CFLAGS="-g0 -Os" CXXFLAGS="-g0 -Os" LDFLAGS="-s"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GCC_CONFIG += --with-arch=armv6 --with-mode=arm --with-fpu=vfp</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行編譯：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">make -j ${nproc}</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安裝（輸出執行檔），預設會輸出到專案目錄下的 <code>output/</code> 資料夾：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">make install</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>複製到 <code>home</code></p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">touch ~/.musl-cross-make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp output/* ~/.musl-cross-make/.</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>把環境變數加到 <code>.bashrc</code></p>
<div class="language-bash codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-bash codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">export MUSL_CROSS_INSTALL="$HOME/.musl-cross-make" </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH="$MUSL_CROSS_INSTALL/bin:$PATH"</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="編譯-quickjs">編譯 QuickJs<a href="https://flyskypie.github.io/blog/2022-11-29_3ds_cross_compilation_note#%E7%B7%A8%E8%AD%AF-quickjs" class="hash-link" aria-label="Direct link to 編譯 QuickJs" title="Direct link to 編譯 QuickJs">​</a></h2>
<p>下載 quickjs</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/bellard/quickjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd quickjs</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要更動 <code>Makefile</code> 的一些內容：</p>
<p>新增 <code>CROSS_PREFIX=arm-linux-musleabihf-</code></p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">  CROSS_PREFIX=arm-linux-musleabihf-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HOST_CC=gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CC=$(CROSS_PREFIX)gcc</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">LIBS+=-ldl -lpthread          #找到這行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LIBS+=-ldl -lpthread -latomic #增加參數</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接著跑編譯：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">make -j ${nproc}</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>檢查編譯結果是不是符合我們的目標：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ file qjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qjs: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-armhf.so.1, with debug_info, not stripped</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="3ds" term="3ds"/>
        <category label="javascript" term="javascript"/>
        <category label="cross compilation" term="cross compilation"/>
        <category label="quickjs" term="quickjs"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[3DS 刷機筆記]]></title>
        <id>https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note</id>
        <link href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note"/>
        <updated>2022-11-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[關於刷機流程，已經有非常詳盡的教學，並且操作細節跟跟當前 3DS 版本或是機型會有一些落差， 繁瑣過得流程我就不在本文一一介紹。]]></summary>
        <content type="html"><![CDATA[<p>關於刷機流程，已經有非常詳盡的<a href="https://3ds.hacks.guide/zh_TW/get-started.html" target="_blank" rel="noopener noreferrer">教學</a>，並且操作細節跟跟當前 3DS 版本或是機型會有一些落差， 繁瑣過得流程我就不在本文一一介紹。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="刷-cfw-custom-firmware">刷 CFW (Custom firmware)<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#%E5%88%B7-cfw-custom-firmware" class="hash-link" aria-label="Direct link to 刷 CFW (Custom firmware)" title="Direct link to 刷 CFW (Custom firmware)">​</a></h2>
<p>不論型號，第一步就是刷 CFW，如此一來我們就能透過 CFW 作為 bootloader 去載入其他 bootloader 程式。</p>
<p>根據不同的系統版本，能夠利用的漏洞會有所差異，而本人持有的 3DS 處於 5.x.x 版的狀態，因此選擇 <a href="https://3ds.hacks.guide/zh_TW/installing-boot9strap-(soundhax)" target="_blank" rel="noopener noreferrer">soundhax</a> 來安裝 <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#boot9strap">boot9strap</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="luma3ds">Luma3DS<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#luma3ds" class="hash-link" aria-label="Direct link to Luma3DS" title="Direct link to Luma3DS">​</a></h2>
<p>Luma3DS 是一個系統補丁，允許使用者獲得更多權限或功能，並且能夠安裝非官方的 3DS 應用程式。</p>
<p>並且它能夠進行 chainload，也就是 boot9strap 引導到 Luma3DS；Luma3DS 再引導到其他韌體，如：Linux。</p>
<p>在「<a href="https://3ds.hacks.guide/zh_TW/finalizing-setup" target="_blank" rel="noopener noreferrer">完成安裝</a>」的步驟中，包含了安裝 Luma3DS、更新系統、安裝第三方應用程式等操作。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="名詞註解">名詞註解<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#%E5%90%8D%E8%A9%9E%E8%A8%BB%E8%A7%A3" class="hash-link" aria-label="Direct link to 名詞註解" title="Direct link to 名詞註解">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="boot9strap">boot9strap<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#boot9strap" class="hash-link" aria-label="Direct link to boot9strap" title="Direct link to boot9strap">​</a></h3>
<p>boot9strap 是一個漏洞利用工具，效果是能夠使 3DS 載入並執行第三方的程式。</p>
<p>Boot9 (ARM9 BootROM) 是任天堂在晶片內燒錄的韌體，它會對載入的韌體進行加密驗證，來確保韌體來自任天堂官方，然而這個算法存在漏洞，允許第三方韌體欺騙 BootROM 並被載入到 3DS 中執行獲得控制權。該漏洞由 derrekr 在 <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#33C3">33C3</a> 發表<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fn-33c3-derrekr-9a8f08" id="user-content-fnref-33c3-derrekr-9a8f08" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。 網路上有<a href="http://www.databusworld.cn/9963.html" target="_blank" rel="noopener noreferrer">中文的資料</a>對漏洞的具體技術細節做更進一步的解釋，有興趣的朋友可以參考看看。</p>
<p>並且更進一步的 boot9strap 透過 NDMA 漏洞對受保護的 Boot9 記憶體位址寫入資料，從而執行其他程式<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fn-boot9strap-hack-9a8f08" id="user-content-fnref-boot9strap-hack-9a8f08" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="33c3">33C3<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#33c3" class="hash-link" aria-label="Direct link to 33C3" title="Direct link to 33C3">​</a></h3>
<p>全名是 「The 33rd Chaos Communication Congress」，總之就是一個非常大的駭客年會。<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fn-33c3-intro-9a8f08" id="user-content-fnref-33c3-intro-9a8f08" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="ndma-dsi-new-dma">NDMA (DSi New DMA)<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#ndma-dsi-new-dma" class="hash-link" aria-label="Direct link to NDMA (DSi New DMA)" title="Direct link to NDMA (DSi New DMA)">​</a></h3>
<p>暫存器的名稱。<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fn-ndma-1-9a8f08" id="user-content-fnref-ndma-1-9a8f08" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup><sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fn-dma_registers-9a8f08" id="user-content-fnref-dma_registers-9a8f08" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup></p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-33c3-derrekr-9a8f08">
<p>Nintendo Hacking 2016 - Game Over 33C3. derrekr. Retrieved 2022-11-25, from <a href="https://derrekr.github.io/3ds/33c3" target="_blank" rel="noopener noreferrer">https://derrekr.github.io/3ds/33c3</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fnref-33c3-derrekr-9a8f08" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-boot9strap-hack-9a8f08">
<p>sighax and boot9strap. SciresM. Retrieved 2022-11-25, from <a href="https://sciresm.github.io/33-and-a-half-c3/" target="_blank" rel="noopener noreferrer">https://sciresm.github.io/33-and-a-half-c3/</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fnref-boot9strap-hack-9a8f08" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-33c3-intro-9a8f08">
<p>33c3 intro | Just for noting. (n.d.). Retrieved 2022-11-25, from <a href="https://blog.m157q.tw/posts/2016/12/27/33c3-0/" target="_blank" rel="noopener noreferrer">https://blog.m157q.tw/posts/2016/12/27/33c3-0/</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fnref-33c3-intro-9a8f08" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-ndma-1-9a8f08">
<p>GBATEK - GBA/NDS Technical Info. (n.d.). Retrieved 2022-11-25, from <a href="https://problemkaputt.de/gbatek.htm#dsinewdmandma" target="_blank" rel="noopener noreferrer">https://problemkaputt.de/gbatek.htm#dsinewdmandma</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fnref-ndma-1-9a8f08" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-dma_registers-9a8f08">
<p>Super NES Programming/DMA tutorial - Wikibooks, open books for an open world. (n.d.). Retrieved 2022-11-25, from <a href="https://en.wikibooks.org/wiki/Super_NES_Programming/DMA_tutorial#DMA_registers" target="_blank" rel="noopener noreferrer">https://en.wikibooks.org/wiki/Super_NES_Programming/DMA_tutorial#DMA_registers</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_hack_note#user-content-fnref-dma_registers-9a8f08" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="3ds" term="3ds"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[3DS 刷 Linux 筆記]]></title>
        <id>https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note</id>
        <link href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note"/>
        <updated>2022-11-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[刷 Linux]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="刷-linux">刷 Linux<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E5%88%B7-linux" class="hash-link" aria-label="Direct link to 刷 Linux" title="Direct link to 刷 Linux">​</a></h2>
<p>如果已經刷完 CFW，並且安裝 Luma3DS 的話，在 3DS 上跑起來並不會太困難，只要照著<a href="https://www.gamebrew.org/wiki/Linux_for_3DS" target="_blank" rel="noopener noreferrer">指示</a>下載檔案並放到 SD 卡內，接著從 Luma3DS 的 ChainLoader 開機就能成功進入 Linux 了。使用者為 <code>root</code> ，密碼為 <code>toor</code> 。</p>
<p>然而這個 Linux 的檔案系統是跑在 Ram Disk 上，並且預設不會掛載記憶卡，因此在系統內進行任何修改在開機之後都會消失。要把檔案弄進去的方法有兩種：</p>
<ol>
<li>將檔案放到 SD 卡內，並掛載 <code>/dev/vda1</code></li>
<li>將檔案放到開機映像檔 <code>zImage</code> 內</li>
</ol>
<p>其實單論我的目的是在 Linux 跑一個 Jvascript 程式，大可直接用掛載的方式處理，但是使用 3DS Linux 的觸控板打指令真的是一件頗麻煩的事情（包含掛載指令），如果可以預載並自動執行一些腳本免除我手動輸入的步驟是再好不過了。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="製作開機映像檔">製作開機映像檔<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E8%A3%BD%E4%BD%9C%E9%96%8B%E6%A9%9F%E6%98%A0%E5%83%8F%E6%AA%94" class="hash-link" aria-label="Direct link to 製作開機映像檔" title="Direct link to 製作開機映像檔">​</a></h2>
<p>在處理自動掛載以前，我們要知道如何把東西放進 <code>zImage</code> 內，這過程涉及兩個步驟：</p>
<ol>
<li>產生 <code>rootfs.cpio.gz</code></li>
<li>製作 <code>zImage</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="產生-rootfscpiogz">產生 <code>rootfs.cpio.gz</code><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E7%94%A2%E7%94%9F-rootfscpiogz" class="hash-link" aria-label="Direct link to 產生-rootfscpiogz" title="Direct link to 產生-rootfscpiogz">​</a></h3>
<p>cpio 是 UNIX 作業系統的一個檔案備份程式及檔案格式<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fn-cpio-intro-b62f93" id="user-content-fnref-cpio-intro-b62f93" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。cpio 是一個比較古老的備份命令，也是用於磁帶機備份的工具，雖然如此現在許多時侯仍然需要使用這命令，例如製作系統內存映像檔時等。像是系統映像檔通常位於 /boot 中，文件名以 initrd 開頭。<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fn-cpio-command-b62f93" id="user-content-fnref-cpio-command-b62f93" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
<p>因為它是基於磁帶的備份工具，因此無法直接替換掉該檔案裡面的特定文件，必須要把整個 cpio 解包進行編輯後再包回去。</p>
<p><a href="https://github.com/linux-3ds" target="_blank" rel="noopener noreferrer">linux-3ds</a> 的專案有提供一個樣板可以直接下載：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://github.com/linux-3ds/buildroot/releases/download/latest/rootfs.cpio.gz</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或是你也可以從 buildroot 自己 build ，Buildroot 是一個可高度客製化的嵌入式 Linux 映像檔生成工具。Buildroot很強大，也很容易上手使用。<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fn-buildroot-intro-b62f93" id="user-content-fnref-buildroot-intro-b62f93" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> Linux 3DS 專案下有一個已經與先準備好相關設定的 <a href="https://github.com/linux-3ds/buildroot" target="_blank" rel="noopener noreferrer">buildroot fork</a>，照著<a href="https://github.com/linux-3ds/buildroot/wiki" target="_blank" rel="noopener noreferrer">指示</a>做一樣很快就能生成 <code>cpio</code> 檔了。</p>
<p>cpio 作為 initrd 的格式，而 initrd 的英文含義是 boot loader initialized RAM disk，就是由 boot loader 初始化的 RAM Disk。在 linux 核心啟動前， boot loader 會將儲存介質中的 initrd 檔案載入到記憶體，核心啟動時會在訪問真正的根檔案系統前先訪問該記憶體中的 initrd 檔案系統。在 boot loader 組態了 initrd 的情況下，核心啟動被分成了兩個階段，第一階段先執行 initrd檔案系統中的"某個檔案"，完成載入驅動模組等任務，第二階段才會執行真正的根檔案系統中的 /sbin/init 處理程序。<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fn-initrd-b62f93" id="user-content-fnref-initrd-b62f93" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup></p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="編輯-cpio-檔">編輯 <code>cpio</code> 檔<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E7%B7%A8%E8%BC%AF-cpio-%E6%AA%94" class="hash-link" aria-label="Direct link to 編輯-cpio-檔" title="Direct link to 編輯-cpio-檔">​</a></h3>
<p>我寫了一個小腳本來處理解包、覆蓋、包回去的步驟，
只要把檔案放在 <code>original/rootfs.cpio</code>，
要覆蓋的檔案樹放在 <code>override/</code> 下。</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXTRACT_TEMPD=$(mktemp -d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_TEMPD=$(mktemp -d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORK_PATH=$(pwd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ ! -e "$EXTRACT_TEMPD" ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt;&amp;2 echo "Failed to create temp directory"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo Extract Path: ${EXTRACT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo Output Path: ${OUTPUT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Extract and Archive again, /dev/console would missing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir ${EXTRACT_TEMPD}/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ${EXTRACT_TEMPD}/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpio -idv &lt; "${WORK_PATH}/original/rootfs.cpio" 2&gt; ${EXTRACT_TEMPD}/log.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -rf "${WORK_PATH}"/override/* ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#find . &gt; ${OUTPUT_TEMPD}/log-1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . | cpio -ov -H newc &gt; ${OUTPUT_TEMPD}/rootfs.cpio 2&gt; ${OUTPUT_TEMPD}/log.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ${OUTPUT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gzip -c rootfs.cpio &gt; rootfs.cpio.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown &lt;Normal-User&gt; -R ${OUTPUT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chgrp &lt;Normal-User&gt; -R ${OUTPUT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown &lt;Normal-User&gt; -R ${EXTRACT_TEMPD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chgrp &lt;Normal-User&gt; -R ${EXTRACT_TEMPD}</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比如，編譯出來的程式會仰賴 <code>/usr/lib/ld-linux-armhf.so.3</code>，但是 linux 3ds 提供的 cpio 並沒有這個路徑，就可以在 <code>override/</code> 下加入：</p>
<div class="codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-text codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">./usr/lib:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld-linux-armhf.so.3 -&gt; ../lib/libc.so</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>記得執行操作的時候要有 root 權限，因為 <code>rootfs.cpio</code> 裡面有些檔案類型需要 root 才能新增。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="製作-zimage">製作 <code>zImage</code><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E8%A3%BD%E4%BD%9C-zimage" class="hash-link" aria-label="Direct link to 製作-zimage" title="Direct link to 製作-zimage">​</a></h3>
<p>照著<a href="https://github.com/linux-3ds/linux/wiki" target="_blank" rel="noopener noreferrer">指引</a>安裝仰賴的函式庫、clone repo、把 <code>rootfs.cpio.gz</code> 放到專案目錄下，接著執行：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ $ ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- make -j$(nproc) nintendo3ds_defconfig all</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>它就會 build 出包含 <code>zImage</code> 在內，在 3DS 上跑起 Linux 需要的一些檔案。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="自動掛載">自動掛載<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E8%87%AA%E5%8B%95%E6%8E%9B%E8%BC%89" class="hash-link" aria-label="Direct link to 自動掛載" title="Direct link to 自動掛載">​</a></h2>
<p>這個 Linux 並沒有諸如 systemd, rc.local 之類的高級玩意，倒是有這些東西：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls /etc/init.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rcK  rcS  S01syslogd  S02klogd  S02sysctl</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>/etc/init.d/rcS</code> 承擔 start 的功能 <code>/etc/init.d/rcK</code> 承擔 kill(stop) 的功能，會依序執行 <code>/etc/init.d/rcS/S(\d\d.*)</code>，很好理解。</p>
<p>於是我就做了一個 <code>/etc/init.d/S03sdmnt</code> 來自動掛載 SD 卡：</p>
<div class="language-shell codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-shell codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case "$1" in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Mount SD card"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mount SD card</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /mnt/sdcard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mount /dev/vda1 /mnt/sdcard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Unmount SD card"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Todo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Usage: /etc/init.d/S03sdmnt {start|stop}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 0</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="小結">小結<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#%E5%B0%8F%E7%B5%90" class="hash-link" aria-label="Direct link to 小結" title="Direct link to 小結">​</a></h2>
<p>研究到這裡，會發現 Chain Loading<sup><a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fn-chain_loading-b62f93" id="user-content-fnref-chain_loading-b62f93" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup> 的影子非常明顯：
刷進去的 boot9strap 會 boot Luma3DS；
Luma3DS 會從 <code>luma/payloads/</code> boot <code>firm_linux_loader.firm</code>；
<code>firm_linux_loader.firm</code> 再去 boot <code>arm9linuxfw.bin</code>；
<code>arm9linuxfw.bin</code> 再用 <code>zImage</code> 開機（？）</p>
<hr>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="創用 CC 授權條款" class="img_UJFd"></a><br>
<!-- -->Wei Ji以<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">創用CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>釋出。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_Hj9u sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-cpio-intro-b62f93">
<p>Cpio - 維基百科，自由的百科全書. Retrieved 2022-11-25, from <a href="https://zh.wikipedia.org/zh-tw/Cpio" target="_blank" rel="noopener noreferrer">https://zh.wikipedia.org/zh-tw/Cpio</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fnref-cpio-intro-b62f93" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-cpio-command-b62f93">
<p>會紅的 Linux 筆記: cpio指令. Retrieved 2022-11-25, from <a href="http://canred.blogspot.com/2013/04/cpio.html" target="_blank" rel="noopener noreferrer">http://canred.blogspot.com/2013/04/cpio.html</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fnref-cpio-command-b62f93" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-buildroot-intro-b62f93">
<p>精通嵌入式Linux 第三章：Buildroot – LotLab. Retrieved 2022-11-25, from <a href="https://www.lotlab.org/2020/04/08/mastering-embedded-linux-part-3-buildroot/" target="_blank" rel="noopener noreferrer">https://www.lotlab.org/2020/04/08/mastering-embedded-linux-part-3-buildroot/</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fnref-buildroot-intro-b62f93" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-initrd-b62f93">
<p>【Linux技術】Linux核心Initrd機制解析，核心更新步驟，grub組態說明-阿里雲開發者社區. Retrieved 2022-11-25, from <a href="https://developer.aliyun.com/article/445357" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/445357</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fnref-initrd-b62f93" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-chain_loading-b62f93">
<p>Chain loading - Wikipedia. Retrieved 2022-11-25, from <a href="https://en.wikipedia.org/wiki/Chain_loading" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Chain_loading</a> <a href="https://flyskypie.github.io/blog/2022-11-25_3ds_linux_note#user-content-fnref-chain_loading-b62f93" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="learning note" term="learning note"/>
        <category label="3ds" term="3ds"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在 Hordes.io 實現市場監控 (Market Monitor)]]></title>
        <id>https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor</id>
        <link href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor"/>
        <updated>2022-06-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[說起來這已經是我快接近兩年前（2020年9月）做的 side project 了，最近想說把資料整理一下發個文。]]></summary>
        <content type="html"><![CDATA[
<p>說起來這已經是我快接近兩年前（2020年9月）做的 side project 了，最近想說把資料整理一下發個文。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="hordesio">Hordes.io<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#hordesio" class="hash-link" aria-label="Direct link to Hordes.io" title="Direct link to Hordes.io">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/hordes-2d0a98c0ec747230c05a587cbd12ad72.png" width="1440" height="900" class="img_UJFd"></p>
<p>先簡單介紹一下這個遊戲，它就是一個經典的 MMORPG，等級、技能、道具、職業、組隊、團戰...等基本的要素都有，但是沒有像一般 MMORPG 那般廣大的地圖、豐富的 NPC 跟細緻的模型，並且可以直接用網頁瀏覽器遊玩。</p>
<p>有一陣子我還蠻享受這個遊戲的，甚至有考慮剋金，不過營運方過於側重 PvP，不定期舉辦的活動也給我一種 Minecraft 伺服器那種娛樂 OP 吃力不討好的感覺，不過那又是另外一段故事了，總之最後就棄坑了。</p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="動機">動機<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E5%8B%95%E6%A9%9F" class="hash-link" aria-label="Direct link to 動機" title="Direct link to 動機">​</a></h2>
<p>個人在 MMORPG 最享受兩種角色：補師跟生產者（偏偏正是主流遊戲較為不重視的兩種類型<code>_(:3」∠)_</code>），而在這遊戲確實滿足了我對補師職業的喜好，不過並沒有生產系統，所有道具與裝備都是透過打怪掉落，並且玩家與玩家之間的交易只能透過和重生點的商人對話開啟拍賣界面：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/hordes_auction-ff4549457f5aae778de15c4731240550.png" width="788" height="480" class="img_UJFd"></p>
<p>而且遊戲系統還會抽上架手續費，換句話說遊戲的經濟系統不夠強大，讓我「想對它做點什麼」，而這幾個前提成立下：</p>
<ul>
<li>遊戲是以 Javascript 跑在網頁上的</li>
<li>有集中交易的拍賣功能</li>
</ul>
<p>讓我「能對它做點什麼」，讓我手癢想把市場資料倒出來畫折線圖分析。</p>
<blockquote>
<p>這世界上有兩樣東西能讓我開心：</p>
<ol>
<li>Data</li>
<li>More data</li>
</ol>
<p>by 我那特別喜歡 Data 的一部分靈魂</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="正文">正文<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E6%AD%A3%E6%96%87" class="hash-link" aria-label="Direct link to 正文" title="Direct link to 正文">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/hordes_auction_monitor_hero-90e4f06513c8705c1f2bdf4641b5c34e.svg" width="2076" height="1257" class="img_UJFd"></p>
<p>一張圖解釋我做了什麼，流程大致上是：</p>
<ol>
<li>逆向工程遊戲的 Javascript</li>
<li>在當中嵌入程式碼來獲取拍賣資訊</li>
<li>執行遊戲時以修改過得 client.js 取代官方原本的版本</li>
<li>修改過得腳本會把攔截到的拍賣資訊回傳到資料庫</li>
<li>分析資料</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="逆向工程主程式">逆向工程主程式<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E4%B8%BB%E7%A8%8B%E5%BC%8F" class="hash-link" aria-label="Direct link to 逆向工程主程式" title="Direct link to 逆向工程主程式">​</a></h3>
<p>Javascript 是直譯語言，即便一般開發者會經過 minify, uglify 等步驟降低腳本的可讀性，但是獲得程式後仍然是明碼可讀的，而遊戲的主程式是放在這個路徑中：</p>
<p><code>https://hordes.io/client.js?v=4305950</code></p>
<p>把程式下載後經過 beautify 加上縮排，再透過 Javascript 的基本語法跟一些沒有被混淆的變數名稱加上一些技巧來試圖了解程式運作，具體怎麼做的我就不贅述了，任何會寫 Javascript 的人應該都知道這些方法（？）</p>
<p>透過逆向工程了解程式運作之後就能添加程式碼來達成我的目的，比如：把拍賣資料送到我的資料庫。</p>
<div class="language-javascript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-javascript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/api/item/get"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">auction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">ids</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token parameter">t</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">//edition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">//e: object from json string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fail</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">P</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">t</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dbid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			i </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">C</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">C</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Wt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hydrate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> item </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">item_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auctionprice</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">amount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stacks</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stacks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">tier</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tier</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">upgrade</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">upgrade</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">attributes</span><span class="token operator" style="color:#393A34">:</span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromEntries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">temp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">posted_by</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">posted_at</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			items</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#999988;font-style:italic">//console.log(JSON.stringify(item));</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">//console.log(JSON.stringify(items)),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http://0.0.0.0:8989/stack"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'POST'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// *GET, POST, PUT, DELETE, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'cors'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// no-cors, *cors, same-origin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				  </span><span class="token string-property property" style="color:#36acaa">'Content-Type'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text/plain'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				  </span><span class="token comment" style="color:#999988;font-style:italic">// 'Content-Type': 'application/x-www-form-urlencoded',</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// body data type must match "Content-Type" header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 </span><span class="token function" style="color:#d73a49">s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> g </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比較麻煩的是每次他們改版我就要重新逆向工程一次，流程其實應該可以用透過程序化來自動完成，不過那需要更多心力，加上先前提過得，我對於這遊戲的熱情正在冷卻，加上逆向工程並不是什麼輕鬆愉快的過程，這算是我最後棄坑的原因之一。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="瀏覽器插件">瀏覽器插件<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E7%80%8F%E8%A6%BD%E5%99%A8%E6%8F%92%E4%BB%B6" class="hash-link" aria-label="Direct link to 瀏覽器插件" title="Direct link to 瀏覽器插件">​</a></h3>
<p>我使用 Tampermonkey 來載入腳本：</p>
<div class="language-javascript codeBlockContainer_z6dZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RyLF"><pre tabindex="0" class="prism-code language-javascript codeBlock_bsg3 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_THWG"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> pattern </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://hordes.io/client.js*"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">requestDetails</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Redirecting: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> requestDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">requestDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">matchAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\?</span><span class="token regex regex-source language-regex" style="color:#36acaa">v=</span><span class="token regex regex-source language-regex group punctuation" style="color:#393A34">(</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class char-set class-name" style="color:#36acaa">\d</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">+</span><span class="token regex regex-source language-regex group punctuation" style="color:#393A34">)</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">redirectUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://0.0.0.0:8123/"</span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">"/client.js"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://hordes.io/client.js?v=4305950"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">redirectUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://0.0.0.0:8123/4305950/client.js"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://hordes.io/client.js?v=4298202"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">redirectUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://0.0.0.0:8123/4298202/client.js"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://hordes.io/client.js?v=4308820"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">redirectUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://0.0.0.0:8123/4308820/client.js"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Version unmatch! using origin."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">redirectUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> requestDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">browser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">webRequest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">onBeforeRequest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  redirect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">urls</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">types</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"script"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"blocking"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_QEM_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_quMU" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fVOy"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uthV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>作用就是當遊戲網頁試圖載入主程式的時候，導向到我的 local server 取得修改過得版本。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="資料庫">資料庫<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E8%B3%87%E6%96%99%E5%BA%AB" class="hash-link" aria-label="Direct link to 資料庫" title="Direct link to 資料庫">​</a></h3>
<p>當時用 PHP + Slim 寫了個簡單的後端來接收資料。程式碼可以在<a href="https://github.com/FlySkyPie/hordes-auction-monitor" target="_blank" rel="noopener noreferrer">這裡</a>找到。</p>
<h3 class="anchor anchorWithStickyNavbar_Hj9u" id="分析">分析<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 分析" title="Direct link to 分析">​</a></h3>
<p>從遊戲中撈到的資料包含了賣單的創立時間，而遊戲機制讓賣單只會在拍賣系統中掛上 12 小時，而付費會員則是 24 小時，由此可推測出賣單的失效時間。</p>
<p>當掛單失效時就物品會從拍賣中消失回到賣家的倉庫，當然玩家也可以手動取消掛單，但是因為物品會凍結在倉庫中直到原本掛單失效的時間，相較之下發生的機率很低，因此推論皆以「掛單消失是因為逾時自動失效」為前提。</p>
<p>每次進行抽樣時，腳本會遍歷拍賣系統的所有頁面，並把資料送到資料庫，換句話說一次抽樣就代表一次掛單的快照。透過複數個抽樣就能推估掛單是逾時消失的，還是因為交易而消失的。</p>
<p>依據抽樣推測掛單逾時消失：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/sampling-1-83571b2cc25625f3a0a37158078fcc14.svg" width="870" height="417" class="img_UJFd"></p>
<p>掛單在逾時之前消失，很高的可能性是因為完成交易：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/sampling-2-e179edff3e1082263138e7b2b3695090.svg" width="869" height="410" class="img_UJFd"></p>
<p>透過這種方式把成交的掛單價格拉出來統計，就能知道物品的當前行情。</p>
<p>那個時候遊戲改版的蠻頻繁的，我又還沒完成腳本的程序化，每次改玩程式只能採個幾小時的資料，根據 <code>2020-08-27T15:54:49Z</code> 到 <code>2020-08-29T09:46:35Z</code> 這段時間的資料，我計算出 T0 符文石的交易情況為：</p>
<table><thead><tr><th>統計量</th><th>價格</th></tr></thead><tbody><tr><td>最小值</td><td>40</td></tr><tr><td>最大值</td><td>808</td></tr><tr><td>平均值</td><td>360.7</td></tr><tr><td>標準差</td><td>92.3</td></tr></tbody></table>
<p>如果完成腳本程序化，抽樣的時間跨度大一點，應該就能做成折線圖了（或是更棒的盒鬚圖）。不過這個如果應該是永遠不會發生的如果了。 <code>(=w=)</code></p>
<h2 class="anchor anchorWithStickyNavbar_Hj9u" id="後記">後記<a href="https://flyskypie.github.io/blog/2022-06-18_hordes_auction_monitor#%E5%BE%8C%E8%A8%98" class="hash-link" aria-label="Direct link to 後記" title="Direct link to 後記">​</a></h2>
<p>回去翻當時進行逆向工程寫的東西之後，發現我確實已經開始進行一些重構以利逆向工程能夠程序化，只是還沒完成，比如：fetch hook, auto clicker, data transform...</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="development note" term="development note"/>
        <category label="Hordes.io" term="Hordes.io"/>
    </entry>
</feed>
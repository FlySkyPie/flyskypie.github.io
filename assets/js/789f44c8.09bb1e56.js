"use strict";(self.webpackChunkflyskypie_github_io=self.webpackChunkflyskypie_github_io||[]).push([[84375],{20726:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var r=i(11527),o=i(88717);const t={slug:"2025-12-13_numpy-issue",authors:["weiji"],tags:["Python","Biomes","numpy"]},s="ModuleNotFoundError: No module named 'numpy.core.multiarray'",a={permalink:"/posts/2025-12-13_numpy-issue",source:"@site/post/2025-12-13_numpy-issue/index.md",title:"ModuleNotFoundError: No module named 'numpy.core.multiarray'",description:"\u91cd\u69cb Biomes \u904e\u7a0b\u9047\u5230\u7684\u554f\u984c\uff0c\u6d89\u53ca\u6bd4\u8f03\u6280\u8853\u7d30\u7bc0\u7684\u6545\u969c\u6392\u9664\u6240\u4ee5\u984d\u5916\u767c\u4e00\u7bc7\u6587\u5206\u958b\u8b1b\u3002",date:"2025-12-13T00:00:00.000Z",formattedDate:"December 13, 2025",tags:[{label:"Python",permalink:"/posts/tags/python"},{label:"Biomes",permalink:"/posts/tags/biomes"},{label:"numpy",permalink:"/posts/tags/numpy"}],hasTruncateMarker:!1,authors:[{name:"Wei Ji",title:"\u9583\u4eae\u75c7\u5019\u7fa4\u5de5\u7a0b\u5c4d",url:"https://github.com/FlySkyPie",imageURL:"https://avatars.githubusercontent.com/u/9475660",key:"weiji"}],frontMatter:{slug:"2025-12-13_numpy-issue",authors:["weiji"],tags:["Python","Biomes","numpy"]},unlisted:!1,prevItem:{title:"Biomes \u7814\u7a76\u7b46\u8a18 6",permalink:"/posts/2025-12-14_biomes"},nextItem:{title:"Biomes \u7814\u7a76\u7b46\u8a18 5",permalink:"/posts/2025-12-07_biomes"}},c={authorsImageUrls:[void 0]},l=[{value:"\u539f\u59cb\u932f\u8aa4",id:"\u539f\u59cb\u932f\u8aa4",level:2},{value:"\u57f7\u884c\u4e0a\u4e0b\u6587",id:"\u57f7\u884c\u4e0a\u4e0b\u6587",level:2},{value:"\u89e3\u6c7a\u65b9\u6cd5",id:"\u89e3\u6c7a\u65b9\u6cd5",level:2},{value:"\u63a8\u8ad6\u904e\u7a0b",id:"\u63a8\u8ad6\u904e\u7a0b",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["\u91cd\u69cb ",(0,r.jsx)(n.a,{href:"https://github.com/ill-inc/biomes-game",children:"Biomes"})," \u904e\u7a0b\u9047\u5230\u7684\u554f\u984c\uff0c\u6d89\u53ca\u6bd4\u8f03\u6280\u8853\u7d30\u7bc0\u7684\u6545\u969c\u6392\u9664\u6240\u4ee5\u984d\u5916\u767c\u4e00\u7bc7\u6587\u5206\u958b\u8b1b\u3002"]})}),"\n",(0,r.jsx)(n.h2,{id:"\u539f\u59cb\u932f\u8aa4",children:"\u539f\u59cb\u932f\u8aa4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Exception occurred during build:\nTraceback (most recent call last):\n  File "impl/materializers.py", line 1783, in materialize\n  File "impl/materializers.py", line 716, in materialize_ToIcon_Flora\n  File "impl/vox.py", line 739, in iconify_voxel_array\n  File "impl/render_voxels.py", line 111, in render_map\nModuleNotFoundError: No module named \'numpy.core.multiarray\'\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File "build.py", line 65, in exec_program\n  File "impl/lru_cache_by_hash.py", line 30, in set_default\n  File "impl/lru_cache_by_hash.py", line 24, in make_value_cached\n  File "build.py", line 66, in <lambda>\n  File "impl/materializers.py", line 1785, in materialize\nimpl.types.MaterializationError: Error materializing node: DerivedNode(kind=\'ToIcon_Flora\', deps=[Flora:0x1fc2cb2e4002fa67], dep_hashes=[\'57036fed7713db64e4fb917e35d1c6cc5436883b\'])\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u57f7\u884c\u4e0a\u4e0b\u6587",children:"\u57f7\u884c\u4e0a\u4e0b\u6587"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(17177).Z+"",width:"1028",height:"411"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6574\u500b\u547c\u53eb\u93c8\u662f\u5f9e HTTP request \u89f8\u767c\uff0c\u5728 Nest.js \u5167\u90e8 ",(0,r.jsx)(n.code,{children:"spawn"})," \u4e00\u500b\u526f\u7a0b\u5f0f\uff0c\n\u800c\u8a72\u526f\u7a0b\u5f0f\u662f\u900f\u904e ",(0,r.jsx)(n.code,{children:"pyinstaller"})," \u6253\u5305\u7684 Python \u7a0b\u5f0f\uff0c\n\u4e26\u4e14\u8a72\u7a0b\u5f0f\u53c8 ",(0,r.jsx)(n.code,{children:"import"})," \u4e86\u53e6\u5916\u4e00\u500b\u900f\u904e ",(0,r.jsx)(n.code,{children:"pybind11"})," \u6253\u5305\u7684 C++ \uff08\u5be6\u4f5c\u7684\uff09\u52d5\u614b\u51fd\u5f0f\u5eab\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u51fa\u73fe\u554f\u984c\u7684 ",(0,r.jsx)(n.code,{children:"render_voxels.py"})," \u5247\u662f\u300c\u900f\u904e ",(0,r.jsx)(n.code,{children:"pyinstaller"})," \u6253\u5305\u7684 Python \u7a0b\u5f0f\u300d\u7576\u4e2d\u7684\u4e00\u90e8\u5206\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u89e3\u6c7a\u65b9\u6cd5",children:"\u89e3\u6c7a\u65b9\u6cd5"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"build.py"})," \u6240\u5728\u7684\u5c08\u6848\u6539\u8b8a numpy \u7684\u7248\u672c\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'// pyproject.toml\n\n-    "numpy>=1.26.0",\n+    "numpy==1.26.4",\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u76f4\u5f8c\u91cd\u65b0\u7528 ",(0,r.jsx)(n.code,{children:"pyinstaller"})," \u6253\u5305\u4e00\u4efd\u65b0\u7684\u57f7\u884c\u6a94\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u63a8\u8ad6\u904e\u7a0b",children:"\u63a8\u8ad6\u904e\u7a0b"}),"\n",(0,r.jsxs)(n.p,{children:["\u67e5\u8cc7\u6599\u7684\u904e\u7a0b\u6703\u767c\u73fe\u5e38\u898b\u7684\u932f\u8aa4\u8a0a\u606f\u8ddf\u6211\u7684\u6709\u4e00\u9ede\u9ede\u4e0d\u540c\uff0c\u4e0d\u662f ",(0,r.jsx)(n.code,{children:"numpy.core.multiarray"})," \u800c\u662f ",(0,r.jsx)(n.code,{children:"numpy._core.multiarray"}),"\uff1a",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-multiarray-error-451c99",id:"user-content-fnref-multiarray-error-451c99","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"E   DeprecationWarning: numpy.core.multiarray is deprecated and has been renamed to numpy._core.multiarray. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core.multiarray._ARRAY_API."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u65bc\u662f\u9019\u500b\u554f\u984c\u53ef\u80fd\u662f\u4f86\u81ea numpy \u7684\u7834\u58de\u6027\u66f4\u65b0\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u78ba\u8a8d\u4e00\u4e0b Biomes \u5c08\u6848\u4e0b ",(0,r.jsx)(n.code,{children:"requirements.txt"})," \u4f7f\u7528\u7684\u7248\u672c\uff1a",(0,r.jsx)(n.code,{children:"numpy==1.24.2"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6aa2\u67e5\u4e00\u4e0b\u81ea\u5df1\u7684\u5c08\u6848\u914d\u7f6e\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:'"numpy>=1.26.0'}),"\uff0c\u4e26\u4e14 lock \u6a94\u986f\u793a\u5be6\u969b\u5b89\u88dd ",(0,r.jsx)(n.code,{children:"2.3.5"}),"\uff0c\u5230\u9019\u908a\u70ba\u6b62\u5e7e\u4e4e\u53ef\u4ee5\u78ba\u5b9a\u662f numpy \u7248\u672c\u7684\u554f\u984c\uff0c\u4e0d\u904e\u4ee5\u9632\u842c\u4e00\u9084\u662f\u505a\u66f4\u56b4\u8b39\u7684\u9a57\u8b49\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u6211\u5011\u6839\u64da\u932f\u8aa4\u8a0a\u606f ",(0,r.jsx)(n.code,{children:'File "impl/render_voxels.py", line 111, in render_map'})," \u53ef\u4ee5\u627e\u5230\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"    proj = rays.render_orthographic_color(\n        cm=cm,\n        normals=dense_normals,\n        size=size,\n        src=src_after_padding,\n        dir=dir,\n        lighting_dir=lighting_dir,\n        up=up,\n        far=1000.0,\n        zoom=zoom,\n        distance_capacity=0.5,\n    )\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u800c ",(0,r.jsx)(n.code,{children:"rays.render_orthographic_color"})," \u7684\u5be6\u505a\u5be6\u969b\u662f\u5728 C++ \u5167\u5b8c\u6210\u7684\uff0c\u73fe\u5728\u6211\u5011\u56de\u53bb\u770b\u4e00\u4e0b C++ \u5be6\u4f5c\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"#include <pybind11/numpy.h>\n#include <pybind11/pybind11.h>\n#include <pybind11/stl.h>\n// ...\nauto render_orthographic_color(\n    const ColorMap& cm,\n    const py::array_t<float>& normals,\n    Vec2i size,\n    Vec3f src,\n    Vec3f dir,\n    Vec3f lighting_dir,\n    Vec3f up = {0.0f, -1.0f, 0.0f},\n    float far = 100.0f,\n    float zoom = 1.0f,\n    float distance_capacity = 0.5f) {\n  auto [w, h] = size;\n  Vec3f z_dir = normalized(dir);\n  Vec3f x_dir = normalized(cross(z_dir, up));\n  Vec3f y_dir = normalized(cross(x_dir, z_dir));\n\n  auto ret = py::array_t<float>({h, w, 4});\n  auto acc = ret.mutable_unchecked<3>();\n  auto inv_zoom = 1.0f / zoom;\n\n  for (int i = 0; i < h; i += 1) {\n    auto x_shift = 0.5f * (w - 1) * x_dir;\n    auto y_shift = (0.5f * (h - 1) - i) * y_dir;\n    auto pos = src - inv_zoom * (x_shift - y_shift);\n    for (int j = 0; j < w; j += 1) {\n      auto val = integrate_color(\n          cm, normals, pos, z_dir, lighting_dir, far, distance_capacity);\n      acc(i, j, 0) = val.x;\n      acc(i, j, 1) = val.y;\n      acc(i, j, 2) = val.z;\n      acc(i, j, 3) = val.w;\n      pos += x_dir * inv_zoom;\n    }\n  }\n\n  return ret;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u56e0\u6b64\u6211\u5011\u77e5\u9053\u9019\u500b\u8a66\u5716 import ",(0,r.jsx)(n.code,{children:"numpy.core.multiarray"})," \u7684 numpy \u5be6\u969b\u4e0a\u61c9\u8a72\u662f ",(0,r.jsx)(n.code,{children:"pybind11"})," \u63d0\u4f9b\u7684\uff0c\u78ba\u8a8d\u4e00\u4e0b\u6211\u5011\u6b63\u5728\u4f7f\u7528\u54ea\u500b\u7248\u672c\uff1a",(0,r.jsx)(n.code,{children:"pybind/pybind11@2.9.2"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"README.md"})," \u8aaa\u5f97\u5f88\u6e05\u695a\u4e86",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-pybind11-451c99",id:"user-content-fnref-pybind11-451c99","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})}),"\uff1a"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Integrated NumPy support (NumPy 2 requires pybind11 2.12+)"}),"\n"]}),"\n",(0,r.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,r.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{id:"user-content-fn-multiarray-error-451c99",children:["\n",(0,r.jsxs)(n.p,{children:["MAINT: NumPy _ARRAY_API import deprecation warning \xb7 Issue #4886 \xb7 pybind/pybind11. Retrieved 2025-12-13, from ",(0,r.jsx)(n.a,{href:"https://github.com/pybind/pybind11/issues/4886",children:"https://github.com/pybind/pybind11/issues/4886"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-multiarray-error-451c99","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-pybind11-451c99",children:["\n",(0,r.jsxs)(n.p,{children:["pybind/pybind11: Seamless operability between C++11 and Python. Retrieved 2025-12-13, from ",(0,r.jsx)(n.a,{href:"https://github.com/pybind/pybind11",children:"https://github.com/pybind/pybind11"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-pybind11-451c99","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},17177:(e,n,i)=>{i.d(n,{Z:()=>r});const r=i.p+"assets/images/01_dependency-03011884509efa3eb834f8d7193bfd1b.webp"},88717:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>s});var r=i(50959);const o={},t=r.createContext(o);function s(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-post" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">廢文雜談 | 工程屍 FlyPie 的異想世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://flyskypie.github.io/posts"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" property="og:locale" content="zh_tw"><meta data-rh="true" property="og:title" content="廢文雜談 | 工程屍 FlyPie 的異想世界"><meta data-rh="true" name="description" content="Random post just like FB or Twitter."><meta data-rh="true" property="og:description" content="Random post just like FB or Twitter."><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><meta data-rh="true" property="og:image" content="https://raw.githubusercontent.com/FlySkyPie/flyskypie.github.io/main/post/2025-12-28_learn-k8s/00_cover.webp"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://flyskypie.github.io/posts"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts" hreflang="en"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="工程屍 FlyPie 的異想世界 JSON Feed">




<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4a9022c6.css">
<script src="/assets/js/runtime~main.36ea9584.js" defer="defer"></script>
<script src="/assets/js/main.c50b120e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LBgp" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--light_RyNI"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--dark_ntqO"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/the-key-of-huanche/">專案文件</a><a class="navbar__item navbar__link" href="/blogs">數位手記</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/posts">廢文雜談</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_s2nU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_DonJ colorModeToggle_KBLq"><button class="clean-btn toggleButton_qwn5 toggleButtonDisabled_tRn_" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_bYdl"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_D9Q4"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Cbrq"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_GUBX"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_UgN6 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_PkUw margin-bottom--md">Recent posts</div><ul class="sidebarItemList_HFnO clean-list"><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-05_k8s-is-framework">K8s 學習筆記 - K8s 只是框架</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-05_k8s-longhorn-install-and-helm">K8s 學習筆記 - Longhorn 安裝與 Helm</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-05_k8s-longhorn-intro">K8s 學習筆記 - Longhorn 簡介</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-03_desktop-lighting">老兄，你真的找錯人推銷桌面照明了</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-03_laptop-homelab">筆記型 Homelab 飼養注意事項</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="K8s 不是一個完整解決方案，K8s 只是框架。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-is-framework">K8s 學習筆記 - K8s 只是框架</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<blockquote>
<p>K8s 不是一個完整解決方案，K8s 只是框架。</p>
</blockquote>
<p>驚不驚喜？意不意外？</p>
<p>當你安裝了 Docker 之後就可以開始打包 image 並運行程式，甚至可以使用 Dokcer Compose 指令開始進行容器編排 (Orchestration)。</p>
<p>反觀，對於一個 K8s 使用者而言，生態系內有很多「口味」供你選擇：Minikube、MicroK8s、K3s、GKE、EKS...但是當你選擇原味 (Vanilla)時，你可能會發現歷經一番波折安裝完成之後，你還是什麼都不能幹：不能正常建立網路連線、不能正常的掛載持久化實體 (Volume)...</p>
<p>為什麼？因為 K8s 本身不是開箱即用解決方案，它只是一種框架。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的網路">不是開箱即用的網路<a href="#不是開箱即用的網路" class="hash-link" aria-label="Direct link to 不是開箱即用的網路" title="Direct link to 不是開箱即用的網路">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落會多次提及 OSI 的 L4 和 L7，對兩者差異不清楚的讀者建議先去查點資料，不然閱讀起來可能會有點吃力。</p></div></div>
<p>我在<a href="https://flyskypie.github.io/posts/2026-01-01_learn-k8s/" target="_blank" rel="noopener noreferrer">前一篇文章</a>中介紹了 Service，以及內網模式 ClusterIP 與節點開埠 NodePort，即便是 NodePort 也不像是標準佈署使用的模式，因為它只能開奇怪的埠號。這是因為 Service 其實還有兩個生產環境在使用的模式：LoadBalancer 模式或是加掛一個 Ingress。</p>
<p>以 ServiceLB (LoadBalancer) 為例，K8s 只提供一個 L4 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_lb-controller-9a70bb19a4e58307ba30e54f7e361770.webp" width="917" height="458" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>LB (LoadBalancer) Controller 是一個方便讀者理解的稱呼，實際情況比較複雜，有其他專門的術語用來稱呼這個東西。</p></div></div>
<p>在雲端環境（如 Google, AWS）這是由雲端供應商實作的，可能是一團閉源商業軟體和硬體級 LB 整合而成；在 K3s 中這是由 <a href="https://github.com/k3s-io/klipper-lb" target="_blank" rel="noopener noreferrer">klipper-lb</a> 透過 <code>hostPort</code> 實作的。</p>
<p>Ingress 也是相同的狀況，K8s 只提供一個 L7 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_ingress-controller-b0104efe4f8fed322b5ed08be65ff649.webp" width="1224" height="447" class="img_RpFt"></p>
<p>實作可以是 Nginx 也可以是 Traefik。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的持久化儲存">不是開箱即用的持久化儲存<a href="#不是開箱即用的持久化儲存" class="hash-link" aria-label="Direct link to 不是開箱即用的持久化儲存" title="Direct link to 不是開箱即用的持久化儲存">​</a></h2>
<p>K8s 在設計上就是一個分散式運行的框架，當 Pod 可能分散在多個不同的主機（節點）時，我們就不能像 Docker 那樣直接用某個路徑當作持久化實體。</p>
<p>在 K8s 的世界中，Volume 通常是一個 SDS (Software-defined storage)；
在 K8s 的世界中，網路線就是 SATA 線。</p>
<p>細節我不在此解釋，簡單來說在 K8s 要幫 Container 掛載 Volume 需要經過層層抽象，並且最後實際的儲存實體並不在 K8s 內實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>你也可以在 K8s 設定 <code>storageClassName: local-storage</code> 的 Volume，但是這樣你可能需要額外配置讓 Pod 只能佈署在特定的 Node 上。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Storage Backend 同樣是一個方便讀者理解的稱呼，並不是 K8s 內的標準術語。</p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Longhorn 可以用很多方式安裝，包含最基本的 kubectl 指令："><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-longhorn-install-and-helm">K8s 學習筆記 - Longhorn 安裝與 Helm</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>Longhorn 可以用很多方式安裝，包含最基本的 <code>kubectl</code> 指令：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不過等等！不要急著下指令！讓我們瞄一眼裡面有些什麼：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/01_longhorn-install-yaml-1f7ad17473887f8aa9a4cda144d179b1.webp" width="521" height="589" class="img_RpFt"></p>
<p>是的，這是一個有四千多行的 YAML，善於偷懶的聰明開發者們當然不會想直接跟這團東西打交道。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個數字可以當作一個參考，一個完整的雲原生軟體佈署到 K8s 需要的聲明的資訊大概會達到這個量體。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="helm">Helm<a href="#helm" class="hash-link" aria-label="Direct link to Helm" title="Direct link to Helm">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_helm-4306e187254cfeaddb4fbe25fa2d74ca.webp" width="1859" height="1035" class="img_RpFt"></p>
<p>就像 Longhorn 需要四千多行的 YAML 一樣，還有許許多多的雲原生應用軟體實際都  是由大量的 K8s 資源或實體交錯編排而成，於是就有了 Helm 這個工具的誕生：一個 K8s 世界的 APT (Advanced Packaging Tool)。</p>
<p>在 Helm 的世界，這一堆聲明的 YAML 被包裝成一個稱作 Chart 的東西，「安裝」(佈署應用程式到 K8s)大概像這樣：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add longhorn https://charts.longhorn.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Helm 還有另外一個重要的功能：對 Chart 傳入變數，也是今天我要使用 Helm 的主要原因。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="用-helm-安裝-longhorn">用 Helm 安裝 Longhorn<a href="#用-helm-安裝-longhorn" class="hash-link" aria-label="Direct link to 用 Helm 安裝 Longhorn" title="Direct link to 用 Helm 安裝 Longhorn">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落的內容主要參考 Longhorn 的官方文件<sup><a href="#user-content-fn-longhorn-config-6a8af0" id="user-content-fnref-longhorn-config-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p></div></div>
<p>首先下載參數檔：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -Lo values.yaml https://raw.githubusercontent.com/longhorn/longhorn/refs/tags/v1.10.1/chart/values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根據需求修改 <code>values.yaml</code>，以我目前的需求為例，分別是：</p>
<ul>
<li>持久化須儲存到外部 DAS 的掛載點。</li>
<li>目前只有一個工作節點，所以副本只有一份。</li>
</ul>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">defaultSettings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultDataPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /mnt/das</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安裝 Longhorn 到 K8s：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --values values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>拉取 Image 需要時間，過程中可以使用指令檢查是不是所有 Pod 已經就位：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n longhorn-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS              RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine-image-ei-3154f3aa-tsq6p              0/1     ContainerCreating   0             23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-driver-deployer-58768fb7fd-ktpq8   1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-manager-bsqms                      2/2     Running             2 (44s ago)   2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-j8bxb                 1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-w2l6b                 1/1     Running             0             2m58s</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行 Tunnel 連線到 Longhorn 的 Dashboard<sup><a href="#user-content-fn-longhorn-ui-access-6a8af0" id="user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service/longhorn-frontend \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -n longhorn-system 3002:80 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --address 0.0.0.0</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/03_longhorn-frontend-181644ffe13d8e290aad61e70bb1b0b7.webp" width="1440" height="923" class="img_RpFt"></p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-longhorn-config-6a8af0">
<p>Longhorn | Documentation. Retrieved 2026-01-05, from <a href="https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/" target="_blank" rel="noopener noreferrer">https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/</a> <a href="#user-content-fnref-longhorn-config-6a8af0" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-longhorn-ui-access-6a8af0">
<p>Longhorn 部署筆記 | 翠鳥圖書館 Project Halcyon Library. Retrieved 2026-01-05, from <a href="https://wiki.pha.pub/books/109-TAs/page/longhorn" target="_blank" rel="noopener noreferrer">https://wiki.pha.pub/books/109-TAs/page/longhorn</a> <a href="#user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="接續我在前一篇貼文指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作："><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-longhorn-intro">K8s 學習筆記 - Longhorn 簡介</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>接續我在<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework/" target="_blank" rel="noopener noreferrer">前一篇貼文</a>指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<p><a href="https://github.com/longhorn/longhorn" target="_blank" rel="noopener noreferrer">Longhorn</a> 則是其中一種 SDS 實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_longhorn-1983f6aeeeb627c39461978dd959b7fe.webp" width="1089" height="715" class="img_RpFt"></p>
<p>Longhorn 巧妙的運用 K8s 作為基礎設施，將 SDS 運行在 Cluster 內部，並且利用 K8s 的多節點特性運行多個實例，並在多個實例上建立資料冗餘實現分散式副本：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_longhorn-4e94a43f1813ec3e0cc932bd7e179964.webp" width="1040" height="802" class="img_RpFt"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-03_desktop-lighting">老兄，你真的找錯人推銷桌面照明了</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_lighting-690afe05eadfcf1199665470bbd0cf5c.webp" width="1024" height="542" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_lighting-26256caa9acafeb02a72529baacff36a.webp" width="1024" height="566" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_lighting-09ba04689c734ff899b541ee68538d75.webp" width="1024" height="506" class="img_RpFt"></p>
<p>就算真的有興趣想買的，大概也是手術燈那種東西，畢竟在做事的時候光源被手或是頭擋住真的很煩。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="背景"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-03_laptop-homelab">筆記型 Homelab 飼養注意事項</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-ea0a7e8308dd3ceda73995b20ee0532a.webp" width="1110" height="537" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="背景">背景<a href="#背景" class="hash-link" aria-label="Direct link to 背景" title="Direct link to 背景">​</a></h2>
<p>我的 Homelab 是透過筆電和 USB 外接 DAS (Direct Attached Storage) 建構的，並且採過一些小坑。最近在建置新的節點時，發現我把相關的資訊分散在不同的筆記和 IaC (Infrastructure as Code) 裡面，於是想說趁這個機會整理一下資訊。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="電池充電上限">電池充電上限<a href="#電池充電上限" class="hash-link" aria-label="Direct link to 電池充電上限" title="Direct link to 電池充電上限">​</a></h2>
<p>Framework 的話可以在 BIOS 設定充電上限：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_fw-bios-21176c994ed1627b3bac398a51874f91.webp" width="1600" height="900" class="img_RpFt"></p>
<p>（從 Framework 的論壇<a href="https://community.frame.work/t/framework-laptop-13-ryzen-7040-bios-3-07-release-held/65582" target="_blank" rel="noopener noreferrer">借用螢幕截圖</a>）</p>
<p>另外一台 Lenovo 的筆電則是靠這個設定：</p>
<p><a href="https://github.com/makifdb/lenopow" target="_blank" rel="noopener noreferrer">https://github.com/makifdb/lenopow</a></p>
<p>我會把把充電上限設在 80% 避免筆電作為伺服器長時間插著充電造成電池膨脹。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="筆電螢幕問題">筆電螢幕問題<a href="#筆電螢幕問題" class="hash-link" aria-label="Direct link to 筆電螢幕問題" title="Direct link to 筆電螢幕問題">​</a></h2>
<p>讓筆電不會因為螢幕蓋上而進入休眠模式，編輯 <code>/etc/systemd/logind.conf</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">HandleLidSwitch=ignore</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行指令重啟服務：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-logind.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是上述設定會造成另外一個問題：螢幕蓋著還是繼續發光，於是還需要一個步驟，編輯 <code>/etc/default/grub</code>：</p>
<p>在 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 插入 <code>consoleblank=60</code>。</p>
<p>這會讓螢幕在 60 秒後熄滅。</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>完整 Ansible Playbook</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup laptop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> arachne</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> check if consoleblank is configured in the boot command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^GRUB_CMDLINE_LINUX_DEFAULT=&quot;.*consoleblank=60&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> absent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">check_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">register</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">changed_when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> insert consoleblank if missing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^(GRUB_CMDLINE_LINUX_DEFAULT=&quot;.*)&quot;$&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\1 consoleblank=60&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check.found == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set HandleLidSwitch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/systemd/logind.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#?(HandleLidSwitch=)(?:.*)$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\1ignore&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.systemd_service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> systemd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> restarted</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-掛載">DAS 掛載<a href="#das-掛載" class="hash-link" aria-label="Direct link to DAS 掛載" title="Direct link to DAS 掛載">​</a></h2>
<p>當服務透過 Docker 跑在容器內，持久化資料卻儲存在透過 USB 連線的外部儲存中，這個仰賴關係需要額外處理。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="自動化載">自動化載<a href="#自動化載" class="hash-link" aria-label="Direct link to 自動化載" title="Direct link to 自動化載">​</a></h3>
<p>編輯 <code>/etc/fstab</code> 加入以下內容：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># DAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID=7f858b7e-f942-45b3-92dd-8c99b497b6a4 /mnt/das-storage ext4 defaults,nofail,x-systemd.automount 0 2</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改後執行：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>UUID 可以透過 <code>lsblk -f</code> 之類的指令獲得。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="設定仰賴">設定仰賴<a href="#設定仰賴" class="hash-link" aria-label="Direct link to 設定仰賴" title="Direct link to 設定仰賴">​</a></h3>
<p>新增檔案 <code>/etc/systemd/system/docker.service.d/override.conf</code>：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=mnt-das\\x2dstorage.automount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConditionPathExists=/mnt/das-storage</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>確保 Docker Daemon 在 DAS 掛載後才運行。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-smart-檢查">DAS SMART 檢查<a href="#das-smart-檢查" class="hash-link" aria-label="Direct link to DAS SMART 檢查" title="Direct link to DAS SMART 檢查">​</a></h2>
<p>因為電腦沒有直接和硬碟建立連線而是隔著一層 DAS，因此不能使用普通的 <code>smartctl</code> 指令確認，而必須使用額外的參數<sup><a href="#user-content-fn-qnap-smart-c5ac0a" id="user-content-fnref-qnap-smart-c5ac0a" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,0 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,1 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,2 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,3 /dev/sdd</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-qnap-smart-c5ac0a">
<p>QNAP External RAID Manager - Export SMART Data - QNAP NAS Community Forum. Retrieved 2026-01-03, from <a href="https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575" target="_blank" rel="noopener noreferrer">https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575</a> <a href="#user-content-fnref-qnap-smart-c5ac0a" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/homelab">homelab</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="安裝"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-02_learn-k8s">安裝 K3s 與遠端連線</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-02T00:00:00.000Z" itemprop="datePublished">January 2, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="安裝">安裝<a href="#安裝" class="hash-link" aria-label="Direct link to 安裝" title="Direct link to 安裝">​</a></h2>
<p>懶人安裝法：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -sfL https://get.k3s.io | sh - </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>檢查一下有沒有正常：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">sudo k3s kubectl get node </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="設定">設定<a href="#設定" class="hash-link" aria-label="Direct link to 設定" title="Direct link to 設定">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_kubectl-f4117048f786e3eade61a1e20c3be2e3.webp" width="1571" height="1058" class="img_RpFt"></p>
<p>從安裝 K3s 的機器複製 <code>/etc/rancher/k3s/k3s.yaml</code> 到想要遠端連線的機器（Client 端）的 <code>~/.kube/config</code>。<sup><a href="#user-content-fn-cluster-access-f0e5eb" id="user-content-fnref-cluster-access-f0e5eb" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>要留意 K8s 的憑證會過期這件事。</p></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-cluster-access-f0e5eb">
<p>Cluster Access | K3s. Retrieved 2026-01-02, from <a href="https://docs.k3s.io/cluster-access" target="_blank" rel="noopener noreferrer">https://docs.k3s.io/cluster-access</a> <a href="#user-content-fnref-cluster-access-f0e5eb" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Pod"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-01_learn-k8s">K8s 學習筆記 - Pod 和它快樂的小夥伴們</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-01T00:00:00.000Z" itemprop="datePublished">January 1, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="pod">Pod<a href="#pod" class="hash-link" aria-label="Direct link to Pod" title="Direct link to Pod">​</a></h2>
<p>聲明一個 Pod：</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mendhak/http</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根據聲明建立資源（在這個例子中是建立 Pod）：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f sample.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接著使用這個指令建立隧道 (tunnel)：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward awesome-pod 3001:8080</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接著就可以透過這個連結訪問剛剛建立的 Pod 了： <code>http://localhost:3001</code></p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_k8s-pod-4679ba59c8b21a01407dcb07e0b49e7d.webp" width="1074" height="620" class="img_RpFt"></p>
<p>這個通道是臨時的，中止指令就會消滅通道，使用過 ngrok 的人或許會對這種感覺不陌生，它就像是「反向的 ngrok」，暫時將 Cluster 內特定的資源暴露到本機上。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>玩耍結束後不要忘記銷毀資源：</p><div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f sample.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="service">Service<a href="#service" class="hash-link" aria-label="Direct link to Service" title="Direct link to Service">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_k8s-pod-shocker-4a62540489c49f70c2306cd43a2bd76e.webp" width="819" height="394" class="img_RpFt"></p>
<p>Pod 在 K8s 的世界裡其實是雜魚、消耗品，可能會故障然後被清除掉之後被新建的 Pod 取代，又或是為了負載需求而被複製成一堆一樣參數的 Pod，Pod 的 IP 也因此是浮動的，實際使用你不會直接連線到特定的 Pod，而是透過一層抽象找到「在運行這種服務的 Pod」，那個抽象就是 Service。這個抽象不只是用於外部訪問，也包含 Pod 對 Pod 的內部連線。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="clusterip">ClusterIP<a href="#clusterip" class="hash-link" aria-label="Direct link to ClusterIP" title="Direct link to ClusterIP">​</a></h3>
<p>一個 Service 大概長得像這樣：</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>完整的檔案如下： sample.yaml</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mendhak/http</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># 用一樣的指令把服務帶起來：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f sample.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 開 tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward service/awesome-service 3002:3001</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>只是這次我們連線的目標不是 Pod 而是 Service： <code>http://localhost:3002</code></p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_k8s-service-b23941a8e7ef1812bb5f291b8c14f23d.webp" width="1053" height="685" class="img_RpFt"></p>
<p>ClusterIP 尚未真正對外暴露我們的服務，這個模式主要給 Pod 內部訪問用（路徑3→2）<sup><a href="#user-content-fn-k8s-clusterip-22292d" id="user-content-fnref-k8s-clusterip-22292d" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="415" height="156" class="img_RpFt"></p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="nodeport">NodePort<a href="#nodeport" class="hash-link" aria-label="Direct link to NodePort" title="Direct link to NodePort">​</a></h3>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mendhak/http</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30390</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接著用一樣的指令把服務帶起來：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f sample.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>這次從 Node 的 IP 訪問（例 如： <code>http://192.168.0.123:30390</code>）</p>
<p><img decoding="async" loading="lazy" src="/assets/images/05_k8s-nodeport-733b0e81bbfd709e4f47b3a762c5c38f.webp" width="699" height="572" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Service 除了 ClusterIP 和 NodePort 以外，還有其他種類，不過在此不做過多的解釋，因為不是本文重點。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/06_k8s-deployment-fa13c0794e54fff3e6c7ad95333b9d96.webp" width="838" height="460" class="img_RpFt"></p>
<blockquote>
<p>Pod 在 K8s 的世界裡其實是雜魚、消耗品</p>
</blockquote>
<p>是的，在 K8s 我們一般不會直接佈署 Pod，而是透過 Deployment 組件（或是其他類似功能的組件）來間接的佈署 Pod：</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mendhak/http</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesome</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> awesomeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30390</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可以用瀏覽器打開它（例如： <code>http://192.168.0.123:30390</code>）， 不過你可能只會看到相同的 <code>os.hostname</code>，試試多執行幾次 <code>curl</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://192.168.0.123:30390/ | jq .os.hostname</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-k8s-clusterip-22292d">
<p>Kubernetes Service 概念詳解 | Kubernetes. Retrieved 2026-01-01, from <a href="https://tachingchen.com/tw/blog/kubernetes-service/" target="_blank" rel="noopener noreferrer">https://tachingchen.com/tw/blog/kubernetes-service/</a> <a href="#user-content-fnref-k8s-clusterip-22292d" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="- Node"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-31_learn-k8s">K8s 學習筆記 - Cluster 和它快樂的小夥伴們</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-31T00:00:00.000Z" itemprop="datePublished">December 31, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p><img decoding="async" loading="lazy" src="/assets/images/01_k8s-cluster-09a98fe1c7869e5992052bef496c52f8.webp" width="1098" height="886" class="img_RpFt"></p>
<ul>
<li>Node<!-- -->
<ul>
<li>一個安裝 K8s 的實體機器或虛擬機器。</li>
</ul>
</li>
<li>Cluster<!-- -->
<ul>
<li>多個 Node 構成的叢集。</li>
</ul>
</li>
<li>Pod<!-- -->
<ul>
<li>K8s 的最小佈署單位。</li>
<li>通常包含一個 Container。</li>
<li>視情況可以包含多個 Container。</li>
</ul>
</li>
<li>Container<!-- -->
<ul>
<li>OCI (Open Container Initiative) 容器。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="namespace">Namespace<a href="#namespace" class="hash-link" aria-label="Direct link to Namespace" title="Direct link to Namespace">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_k8s-namespace-f552b3719c33f1302560005bf3988c57.webp" width="1181" height="424" class="img_RpFt"></p>
<p>在同一個 Cluster 下可以再設定一個 Namespace 來隔離資源，知道有這個東西就好，初學者可以先不管它的存在。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="作為一個網頁前端導向的開發者，接觸 Systemd 的角度較資深一輩的工程師（或正規 CS (Computer Science) 路線出生的人）不太一樣，當前輩們已經在進行「Systemd 大一統」跟「No Systemd」之間的宗教戰爭的時候，我才在 Docker 容器內接觸內接觸第一個行程的問題 (PID 1 Problem)。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-29_systemd-ish">從 Docker 開始的 Systemd 小宇宙</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-29T00:00:00.000Z" itemprop="datePublished">December 29, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>作為一個網頁前端導向的開發者，接觸 Systemd 的角度較資深一輩的工程師（或正規 CS (Computer Science) 路線出生的人）不太一樣，當前輩們已經在進行「Systemd 大一統」跟「No Systemd」之間的宗教戰爭的時候，我才在 Docker 容器內接觸內接觸第一個行程的問題 (PID 1 Problem)。</p>
<p>這裡紀錄並整理一下自己在這條路上的一些經歷和觀察。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>正確的術語應該是 OCI (Open Container Initiative) 容器，不過為了方便溝通本文會視情況使用俗稱的 Docker。另一方面，筆者在學習過程確實是先使用 Docker，使用 Docker 以外的 Runtime 其實也只是不久之前的事。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="dockerfile-中的-entrypoint-與-cmd"><code>Dockerfile</code> 中的 <code>ENTRYPOINT</code> 與 <code>CMD</code><a href="#dockerfile-中的-entrypoint-與-cmd" class="hash-link" aria-label="Direct link to dockerfile-中的-entrypoint-與-cmd" title="Direct link to dockerfile-中的-entrypoint-與-cmd">​</a></h2>
<p>實際上 <code>ENTRYPOINT</code> 才決定了第一個行程 (Process) 是誰，<code>CMD</code> 只是後面被帶進去的參數。</p>
<p>有沒有經歷過 <code>docker compose down</code> 但是某個服務 (service) 卻遲遲沒有被關閉，整個過程停頓了一會兒才把整套服務簇釋放掉？</p>
<p>這十之八九是因為 <code>ENTRYPOINT</code>  沒有處理 <code>SIGTERM</code> 的能力造成的，開發環境或許不打緊，但是在生產環境如果有請求 (request) 掛著還沒處理完，然而容器被更新強制關閉的話，帶來的問題是十分致命的。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="容器編排-container-orchestration">容器編排 (Container Orchestration)<a href="#容器編排-container-orchestration" class="hash-link" aria-label="Direct link to 容器編排 (Container Orchestration)" title="Direct link to 容器編排 (Container Orchestration)">​</a></h2>
<p>在 Docker Compose 允許用 YAML 將多個容器組織起來構成服務簇，並且使用 <code>depends_on</code> 來設定仰賴關係並控制容器的啟動順序、<code>restart</code> 來設定重啟策略、<code>healthcheck</code> 判斷容器狀態。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>一個 service 其實可以設定多個容器（透過 <code>replicas</code> 或是 <code>scale</code>），不過為了簡化描述我在上面並沒有直接指出。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="多個-process-的容器">多個 Process 的容器<a href="#多個-process-的容器" class="hash-link" aria-label="Direct link to 多個 Process 的容器" title="Direct link to 多個 Process 的容器">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>以下不少經驗來自工作上面對的問題，專案細節就不透漏了。</p></div></div>
<p>第一次遇到這樣的需求來自業務上的要求：</p>
<blockquote>
<p>將調用 SideFX Houdini 的 Python 伺服器容器化</p>
</blockquote>
<p>它要求運行一個授權伺服器 (License Server)，透過 Python 載入的 SDK 和這個伺服器之間會定時檢查彼此的存在。當時簡單使用 <code>entrypoint.sh</code> 、<code>&amp;</code> 語法和 <code>sleep</code> 把兩個行程跑了起來。</p>
<hr>
<p>後來遇到另外一個需要解決的問題：</p>
<blockquote>
<p>LibreOffice 作為一個無頭 (headless) 伺服器運作。
Python 程式使用 UNO (Universal Network Objects) 界面與之溝通。
佈署在單一容器的 Serverless 雲環境，因此只能有一個容器。</p>
</blockquote>
<p>這次我使用了 Supervisor 來解決問題<sup><a href="#user-content-fn-supervisor-23c52a" id="user-content-fnref-supervisor-23c52a" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p>
<hr>
<p>接下來的案例是真正讓我將 「Docker 內的 PID 1 問題」與「主機上的 PID 1 問題」連在一起的關鍵：LinuxServer.io。</p>
<p>Blender 是一個面向 3D 設計師的軟體，它是 Maya 或 3ds Max 這類軟體的開源競爭者。LinuxServer.io 使用了某種黑魔法允許 Blender 被運行在容器內，使用者則透過去網頁瀏覽器與之互動，並且 Blender 並不是唯一被這樣操作的軟體，除此之外 LinuxServer.io 還封裝了各種 GUI 軟體到 Dokcer 容器內。</p>
<p>LinuxServer.io 使用已經存在的實作 (KasmVNC) 來達成這些目標 ，不過魔法的關鍵在於：</p>
<blockquote>
<p>使用 s6-overlay 運行與管理包含 X Server 在內的多個程式。</p>
</blockquote>
<p><a href="https://github.com/just-containers/s6-overlay" target="_blank" rel="noopener noreferrer">s6-overlay</a> 不只能夠啟動多個程式，還能聲明程式與程式之間的仰賴關係，來依序啟動，甚至區分了「執行一次」和「持續在背景運作」的程式。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>因為不是本文重點，所以我沒有細談整個過程，大致上就是根據那個 Blender 容器的文件與原始碼找到實作的方式，留下 repo 供參考：</p><ul>
<li><a href="https://github.com/linuxserver/docker-blender" target="_blank" rel="noopener noreferrer">https://github.com/linuxserver/docker-blender</a></li>
<li><a href="https://github.com/linuxserver/docker-baseimage-kasmvnc" target="_blank" rel="noopener noreferrer">https://github.com/linuxserver/docker-baseimage-kasmvnc</a></li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="嵌入式-linux-中的-etcinitdrcs">嵌入式 Linux 中的 <code>/etc/init.d/rcS</code><a href="#嵌入式-linux-中的-etcinitdrcs" class="hash-link" aria-label="Direct link to 嵌入式-linux-中的-etcinitdrcs" title="Direct link to 嵌入式-linux-中的-etcinitdrcs">​</a></h2>
<p>我曾經在嵌入式 Linux 看到這樣的東西：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls /etc/init.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rcK  rcS  S01syslogd  S02klogd  S02sysctl</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>當時我也根據需求寫了一個簡單的 <code>S03sdmnt</code> 腳本來掛載 SD 卡。</p>
<p>後來才知道這是根據 System V Init 簡化後的設計。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>完整的故事跟細節我有寫另外一篇文章描述：</p><p><a href="https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple/" target="_blank" rel="noopener noreferrer">https://flyskypie.github.io/blog/2022-12-03_3ds_linux_javascript_bad_apple/</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="systemd-口味的容器編排軟體">Systemd 口味的容器編排軟體<a href="#systemd-口味的容器編排軟體" class="hash-link" aria-label="Direct link to Systemd 口味的容器編排軟體" title="Direct link to Systemd 口味的容器編排軟體">​</a></h2>
<p>Quadlet 是我試著轉向使用 Podman 得知的東西，雖然最後我並沒有用過就了，而是使用 <a href="https://github.com/containers/podman-compose" target="_blank" rel="noopener noreferrer">Podman Compose</a>，省得還要另外維護一份語法不一樣的東西。</p>
<p>下面是 Quadlet 聲明一個服務的例子<sup><a href="#user-content-fn-podman-orchestration-23c52a" id="user-content-fnref-podman-orchestration-23c52a" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=A minimal container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Container]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use the centos image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image=quay.io/centos/centos:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># In the container we just run sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exec=sleep 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Restart service when sleep finishes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start by default on boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target default.target</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="從領域驅動domain-driven的角度來看這件事">從領域驅動（Domain-driven）的角度來看這件事<a href="#從領域驅動domain-driven的角度來看這件事" class="hash-link" aria-label="Direct link to 從領域驅動（Domain-driven）的角度來看這件事" title="Direct link to 從領域驅動（Domain-driven）的角度來看這件事">​</a></h2>
<p>不難發現上述不同的工具都在解決幾個類似的問題：</p>
<ul>
<li>系 統初始化（啟動與關機），如：掛起背景程式。</li>
<li>根據背景程式的仰賴關係依序掛起，如：應用程式仰賴資料庫。</li>
<li>處理背景程式的異常狀態，如：崩潰重啟。</li>
</ul>
<p>這些問題構成的問題領域 (Problem Domain) 可以被定位為系統初始化 (<a href="https://en.wikipedia.org/wiki/Init" target="_blank" rel="noopener noreferrer">System Init</a>) 和行程管理 (<a href="https://en.wikipedia.org/wiki/Process_supervision" target="_blank" rel="noopener noreferrer">Process Supervision</a>)。</p>
<p>而上述工具則是這個 Problem Domain 對應的解決方案領域 (Solution Domain)。</p>
<p>Systemd 則是這個 Solution Domain 中最有名的工具之一。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-supervisor-23c52a">
<p>使用 Supervisor 來管理程式 | 《Docker —— 從入門到實踐》正體中文版. Retrieved 2025-12-29, from <a href="https://philipzheng.gitbook.io/docker_practice/cases/supervisor" target="_blank" rel="noopener noreferrer">https://philipzheng.gitbook.io/docker_practice/cases/supervisor</a> <a href="#user-content-fnref-supervisor-23c52a" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-podman-orchestration-23c52a">
<p>在 Podman 管理多個 container • 鰭狀漏斗. Retrieved 2025-12-29, from <a href="https://vrabe.tw/blog/manage-multi-containers-in-podman/" target="_blank" rel="noopener noreferrer">https://vrabe.tw/blog/manage-multi-containers-in-podman/</a> <a href="#user-content-fnref-podman-orchestration-23c52a" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/systemd">systemd</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="最近想學 K8s 然後陸續把 Homelab 的服務從 Docker Swarm 移過去，不過一直靜不下心好好讀它，思緒糊成一團，於是想說先把一些已經知道的事情整理一下。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-28_learn-k8s">教練我想學 K8s</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-28T00:00:00.000Z" itemprop="datePublished">December 28, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-cad795c3aa51f3adfc9ccdba21a8cf5e.webp" width="1024" height="1024" class="img_RpFt"></p>
<p>最近想學 K8s 然後陸續把 Homelab 的服務從 Docker Swarm 移過去，不過一直靜不下心好好讀它，思緒糊成一團，於是想說先把一些已經知道的事情整理一下。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="動機">動機<a href="#動機" class="hash-link" aria-label="Direct link to 動機" title="Direct link to 動機">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>因為我實際上還未實際使用 K8s，所以以下可以當成「對 K8s 的美好幻想」。</p></div></div>
<p>簡單紀錄一下幾個讓我想學 K8s 的動機。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="image-volume">Image Volume<a href="#image-volume" class="hash-link" aria-label="Direct link to Image Volume" title="Direct link to Image Volume">​</a></h3>
<p>前一陣子在鼓搗 Keyclaok，並且外掛了兩個組件：</p>
<ul>
<li><a href="https://github.com/keycloakify/keycloakify" target="_blank" rel="noopener noreferrer">https://github.com/keycloakify/keycloakify</a></li>
<li><a href="https://github.com/p2-inc/keycloak-magic-link" target="_blank" rel="noopener noreferrer">https://github.com/p2-inc/keycloak-magic-link</a></li>
</ul>
<p>Keycloak 的插件機制是將 <code>*.jar</code> 檔案放到 <code>/opt/keycloak/providers/</code> 下，待啟動時被載入。</p>
<p>在 OCI (Open Container Initiative) 佈署下處理這種這整合有兩種方法：</p>
<ul>
<li>建置階段：直接在 Dockerfile 用 COPY 完成組裝。</li>
<li>佈署階段：透過 Volume 將 jar 檔案掛載進容器。</li>
</ul>
<p>前者缺乏彈性；後者 Docker 不支援，但是 K8s 支援<sup><a href="#user-content-fn-k8s-image-volume-135bb9" id="user-content-fnref-k8s-image-volume-135bb9" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>話說回來這幾天在讀 Docker Compose 的 spec 看到這東西(<code>image</code>)：</p><div class="language-json codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-json codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">// service.volumes.type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;string&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;enum&quot;: [&quot;bind&quot;, &quot;volume&quot;, &quot;tmpfs&quot;, &quot;cluster&quot;, &quot;npipe&quot;, &quot;image&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;description&quot;: &quot;The mount type: bind for mounting host directories, volume for named volumes, tmpfs for temporary filesystems, cluster for cluster volumes, npipe for named pipes, or image for mounting from an image.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也許 Docker 也支援了說不定。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="depends_on"><code>depends_on</code><a href="#depends_on" class="hash-link" aria-label="Direct link to depends_on" title="Direct link to depends_on">​</a></h3>
<p>Docker Compose 使用 <code>depends_on</code> 來延遲一些容器的啟動，避免仰賴其他容器的服務過早的啟動，例如：後端嘗試對還沒準備完成的資料庫進行連線。</p>
<p>Docker Swarm 則不支援這個功能，它的邏輯是透過 health check：反正有仰賴的容器連線失敗會 health check 失敗，直接重啟容器直到成功為止。但是這樣的設計無法運行相對複雜的服務，例如：我嘗試在 Swarm 模式下運行 GVM (OpenVas) 並沒有成功過。</p>
<p>而 K8s 則是透過 <code>initContainers</code> 的機制來處理這類需求。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="serverless">Serverless<a href="#serverless" class="hash-link" aria-label="Direct link to Serverless" title="Direct link to Serverless">​</a></h3>
<p>工作時使用雲端的 Serverless 的服務 (GCP Cloud Run)，因此我對於自架 (selfhosted) 方案很感興趣，也有找到一些開源方案，不過它們多基於 K8s，例如：</p>
<ul>
<li><a href="https://github.com/fission/fission" target="_blank" rel="noopener noreferrer">https://github.com/fission/fission</a></li>
<li><a href="https://github.com/openfaas/faas" target="_blank" rel="noopener noreferrer">https://github.com/openfaas/faas</a></li>
<li><a href="https://github.com/knative/serving" target="_blank" rel="noopener noreferrer">https://github.com/knative/serving</a></li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>我這裡是指基於 OCI 的 Serverless，非 OCI 的 &quot;Function based&quot; Serverless 方案通常都有緊支援特定程式語言的限制。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="k3s-與遠端訪問">K3s 與遠端訪問<a href="#k3s-與遠端訪問" class="hash-link" aria-label="Direct link to K3s 與遠端訪問" title="Direct link to K3s 與遠端訪問">​</a></h2>
<p>前幾天 (2025-12-23) 安裝完 K3s 設定遠端訪問時看到這個：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl config view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    certificate-authority-data: DATA+OMITTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: https://127.0.0.1:6443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contexts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- context:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">current-context: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">preferences: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client-certificate-data: DATA+OMITTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client-key-data: DATA+OMITTED</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>雖然知道 <code>certificate-authority-data</code> 大概是為了 HTTPS 的加密機制而準備的，不過我其實不知所以然。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="k8s-架構圖">K8s 架構圖<a href="#k8s-架構圖" class="hash-link" aria-label="Direct link to K8s 架構圖" title="Direct link to K8s 架構圖">​</a></h2>
<p>查資料的時候看到這張架構圖：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_k8s-eb9afbe14a7063a5e37bbb93a531086e.webp" width="1602" height="2010" class="img_RpFt"></p>
<p>我注意到 K8s 的組件之間通訊都是加密的，這讓我想到之前透過「Kubernetes The Hard Way」學習 K8s 的經驗。</p>
<p>以及某篇文章，有個老兄抱怨 K8s 難用，伺服器癱瘓的原因似乎是憑證過期，並且它們最後在 AWS 找到了歸屬。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="kubernetes-the-hard-way">Kubernetes The Hard Way<a href="#kubernetes-the-hard-way" class="hash-link" aria-label="Direct link to Kubernetes The Hard Way" title="Direct link to Kubernetes The Hard Way">​</a></h2>
<p><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way" target="_blank" rel="noopener noreferrer">Kubernetes The Hard Way</a> 是一個架設 K8s 的教學，但是不使用現成的安裝精靈，而是手動安裝與配置每一個組件。</p>
<p>去年（2024 年 1 月）我其實試著依照這份指南的步驟嘗試在一台 x86 32 位元筆電上建立 K8s，雖然最後沒有持續下去，但是我隱約記得過程中一直在生成金鑰跟簽署憑證。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>我當時有試著將執行過得步驟寫成 Make/Ansible 腳本：</p><p><a href="https://github.com/FlySkyPie/k8s-builder-and-installer-for-x86-single-node" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/k8s-builder-and-installer-for-x86-single-node</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="正確打開-k8s-的方式難道是密碼學">正確打開 K8s 的方式...難道是密碼學？<a href="#正確打開-k8s-的方式難道是密碼學" class="hash-link" aria-label="Direct link to 正確打開 K8s 的方式...難道是密碼學？" title="Direct link to 正確打開 K8s 的方式...難道是密碼學？">​</a></h2>
<p>作為一個以開發前端業務邏輯為重心的開發者，密碼學相關的基礎概念可以說是很容易被輕忽的部份。或許我該好好的梳理以下對於加密技術的基礎概念作為。</p>
<p>當然，如果我只是要作為 K8s 的使用者，這些知識似乎沒有這麼重要，不過我同時還是要在 Homelab 架設 K8s 的維護者，我不認為紮紮時時的把基礎打好有什麼壞處。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-k8s-image-volume-135bb9">
<p>Use an Image Volume With a Pod | Kubernetes. <a href="https://kubernetes.io/docs/tasks/configure-pod-container/image-volumes/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/configure-pod-container/image-volumes/</a> <a href="#user-content-fnref-k8s-image-volume-135bb9" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/posts/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 FlyPie (Wei Ji)</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-post" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">廢文雜談 | 工程屍 FlyPie 的異想世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://flyskypie.github.io/posts"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" property="og:locale" content="zh_tw"><meta data-rh="true" property="og:title" content="廢文雜談 | 工程屍 FlyPie 的異想世界"><meta data-rh="true" name="description" content="Random post just like FB or Twitter."><meta data-rh="true" property="og:description" content="Random post just like FB or Twitter."><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><meta data-rh="true" property="og:image" content="https://raw.githubusercontent.com/FlySkyPie/flyskypie.github.io/main/post/2026-01-02_learn-k8s/01_kubectl.webp"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://flyskypie.github.io/posts"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts" hreflang="en"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="工程屍 FlyPie 的異想世界 JSON Feed">




<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4a9022c6.css">
<script src="/assets/js/runtime~main.00f2b490.js" defer="defer"></script>
<script src="/assets/js/main.6710aec6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LBgp" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--light_RyNI"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--dark_ntqO"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/the-key-of-huanche/">專案文件</a><a class="navbar__item navbar__link" href="/blogs">數位手記</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/posts">廢文雜談</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_s2nU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_DonJ colorModeToggle_KBLq"><button class="clean-btn toggleButton_qwn5 toggleButtonDisabled_tRn_" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_bYdl"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_D9Q4"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Cbrq"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_GUBX"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_UgN6 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_PkUw margin-bottom--md">Recent posts</div><ul class="sidebarItemList_HFnO clean-list"><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-12_search-engine">自架搜尋引擎套餐 (YaCy + SearXNG + Local Deep Research)</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-08_llm-observability">LLM 可觀測筆記</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-07_emoji">工作哲學 - 已讀 Emoji</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-07_observability-outage">Homelab 可觀測重建進度</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-05_k8s-is-framework">K8s 學習筆記 - K8s 只是框架</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="今天 (2026-01-12) 處理了一些 YaCy 跟 SearXNG 的故障排除，做個紀錄。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-12_search-engine">自架搜尋引擎套餐 (YaCy + SearXNG + Local Deep Research)</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-12T00:00:00.000Z" itemprop="datePublished">January 12, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>今天 (2026-01-12) 處理了一些 YaCy 跟 SearXNG 的故障排除，做個紀錄。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-3c93848b192b398bc68fbf431b8908c8.webp" width="1320" height="600" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="#前情提要" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>故事得從我最近愛用的 LLM 工具 LDR (<a href="https://github.com/LearningCircuit/local-deep-research" target="_blank" rel="noopener noreferrer">Local Deep Research</a>) 說起，LDR 能夠根據使用者的輸入拆分成數個 LLM 任務：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_local-deep-research-requests-68b55038b1b5be6ace8f9f5a9f7ee94c.webp" width="1191" height="309" class="img_RpFt"></p>
<p>其中一個任務長得像這樣：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_local-deep-research-task-ce78abea34956dad79bb826899acc988.webp" width="631" height="329" class="img_RpFt"></p>
<p>將使用者原始輸入轉換成精簡的搜尋引擎關鍵字之後，呼叫 <a href="https://github.com/searxng/searxng" target="_blank" rel="noopener noreferrer">SearXNG</a> 來取得搜尋結果。</p>
<p>SearXNG 本身不實做搜尋引擎，而是作為代理去呼叫多個搜尋引擎，諸如 Google, Bing, DuckDuckGo...</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_ldr-dependency-b88f787f7add166167f1a036e5c3c395.webp" width="1251" height="460" class="img_RpFt"></p>
<p>於是乎有時後會發生這種事情：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/04_search-error-04c944a86d78b1dce28146a1c4097c4f.webp" width="1171" height="312" class="img_RpFt"></p>
<p>呼叫太頻繁被外部的搜尋引擎封鎖，造成有的時候 LDR 會「研究失敗」，因為沒有可靠的外部資訊來源。</p>
<p>我架設 LDR 時使用官方的預設組態，沒有特別設定 SearXNG，於是想說趁這個機會改善這個問題。以上圖為例， 我被 Brave 搜尋引擎擋了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="天下沒有白吃的午餐">天下沒有白吃的午餐<a href="#天下沒有白吃的午餐" class="hash-link" aria-label="Direct link to 天下沒有白吃的午餐" title="Direct link to 天下沒有白吃的午餐">​</a></h2>
<p>老實說我不會特別怪罪搜尋引擎投放廣告、過濾內容...，畢竟：</p>
<blockquote>
<p>當使用者沒有為服務付費，使用者本身就是產品，而不是消費者。</p>
</blockquote>
<p>搜尋引擎自己有自己的營利模型，而 SearXNG 的使用者幾乎就是繞過這些措施白嫖搜尋引擎，即便搜尋引擎供應商本身有它的原罪，我也不認為應該正當化白嫖的行為。</p>
<p>找來找去，<a href="https://github.com/yacy/yacy_search_server" target="_blank" rel="noopener noreferrer">YaCy</a> 似乎是比較合理的方案，它是一個去中心化的搜尋引擎，能夠透過 P2P (Peer-to-peer) 的方式分享索引資訊跟分散爬蟲任務。</p>
<p>網際網路巨大無比，只靠自己建立與維護索引資料根本癡心妄想，YaCy 在這方面就相對理想，讓一群人分散 Google 這種資訊巨獸才能建立的資料庫難度。</p>
<p>話雖如此，架設過程才發現要對外暴露埠才能對整個 YaCy 網路進行貢獻：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/05_yacy-error-98ccb5c1af8cbcc81e0098a214ac581f.webp" width="1154" height="201" class="img_RpFt"></p>
<p>目前我的 Homelab 出於安全性考慮是沒有對外暴露的，不過我依然可以在本地建立自己的索引資料庫，至於「做出貢獻」這件事大概要緩緩以後再來處理了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="k8s-故障排除">K8s 故障排除<a href="#k8s-故障排除" class="hash-link" aria-label="Direct link to K8s 故障排除" title="Direct link to K8s 故障排除">​</a></h2>
<p>架設的過程有遇到一點問題，在這邊紀錄一下問題跟解決辦法。</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl logs yacy-0 -n search-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">****************** YaCy Web Crawler/Indexer &amp; Search Engine *******************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**** (C) by Michael Peter Christen, usage granted under the GPL Version 2  ****</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">****   USE AT YOUR OWN RISK! Project home and releases: https://yacy.net/  ****</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  LOG of       YaCy: DATA/LOG/yacy00.log (and yacy&lt;xx&gt;.log)                **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  STOP         YaCy: execute stopYACY.sh and wait some seconds             **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  GET HELP for YaCy: join our community at https://community.searchlab.eu  **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ YaCy v1.940 by Michael Christen / www.yacy.net ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:04 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: * could not create directories /opt/yacy_search_server/DATA/LOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">could not copy yacy.logging: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP: Trying to load logging configuration from file /opt/yacy_search_server/DATA/LOG/yacy.logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">could not find logging properties in homePath=/opt/yacy_search_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:04 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: * java.io.FileNotFoundException: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.io.FileNotFoundException: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.open0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.open(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.&lt;init&gt;(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.cora.util.ConcurrentLog.configureLogging(ConcurrentLog.java:385)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.startup(yacy.java:180)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.main(yacy.java:832)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:05 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SEVERE: * FATAL ERROR: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.io.IOException: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.UnixFileSystem.createFileExclusively0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.UnixFileSystem.createFileExclusively(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.File.createNewFile(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.startup(yacy.java:194)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.main(yacy.java:832)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:05 AM net.yacy.cora.util.ConcurrentLog shutdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: shutdown of ConcurrentLog.Worker void because it was not running.</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>典型的容器權限問題，在 K8s 可以透過 <code>securityContext</code> 處理：</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsUser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">fsGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是該如何找到正確的 UID 和 GID 呢？OCI image 調查神器：<a href="https://github.com/wagoodman/dive" target="_blank" rel="noopener noreferrer">dive</a></p>
<p><img decoding="async" loading="lazy" src="/assets/images/06_dive-yacy-4380099a0d4e3e3bfa90e22d9938ab1f.webp" width="1440" height="853" class="img_RpFt"></p>
<p>SearXNG 也有類似的問題：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/07_dive-searxng-b0b27156137503e7901c23830e4ea805.webp" width="1440" height="859" class="img_RpFt"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/homelab">homelab</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="其實自我架設 LLM 可觀測工具 (2025-10-05) 以後，陸續嘗試幾款 LLM 工具有獲得一些觀察，不過當時因為覺得缺乏嚴謹考證所以沒有發文，不過現在我可以說是往下一個階段前進了（？），大概也沒有做嚴謹實驗的計畫，就把當時的紀錄發出來水一篇廢文好了。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-08_llm-observability">LLM 可觀測筆記</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-08T00:00:00.000Z" itemprop="datePublished">January 8, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-14435b79b73ad7d429eb4e7f1d68b5ff.webp" width="620" height="382" class="img_RpFt"></p>
<p>其實自<a href="https://flyskypie.github.io/posts/2025-10-05_llm-api-chain/" target="_blank" rel="noopener noreferrer">我架設 LLM 可觀測工具</a> (2025-10-05) 以後，陸續嘗試幾款 LLM 工具有獲得一些觀察，不過當時因為覺得缺乏嚴謹考證所以沒有發文，不過現在我可以說是往下一個階段前進了（？），大概也沒有做嚴謹實驗的計畫，就把當時的紀錄發出來水一  篇廢文好了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="llm-可觀測">LLM 可觀測<a href="#llm-可觀測" class="hash-link" aria-label="Direct link to LLM 可觀測" title="Direct link to LLM 可觀測">​</a></h2>
<p>這邊簡單跟不知道發生什麼事情的讀者解釋一下「LLM 可觀測」是什麼。以下容我重複使用以前做的圖卡：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_llm-observability-feb98d9f322cf06d99b2d63e51d3c6ff.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_llm-observability-967a0eaae4abe131c4d041952e44682b.webp" width="1080" height="1080" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>「角色卡」是一種角色扮演類 LLM 應用軟體的資料包，本質上是包含一堆人物設定、世界觀設定、台詞樣板...的文字。</p></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/03_llm-observability-b6e151ba46fe9c05d4c17e0ac4b51592.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/04_llm-observability-9ac0c0eb44cc9b353fc5d9b84298da1d.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/05_llm-observability-0270b312ce9069c13e10e693304c4d10.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/06_llm-observability-12a537091b2b21eda7b56f3339555a30.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/07_llm-observability-f076524508fda25e403f6af549fc8336.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/08_llm-observability-a335d0a7f8fc4516572664588aa45f47.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/09_llm-observability-12fb6d23d84f4f46622a36dd51e4220a.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/10_llm-observability-6098d55e33ffed32118f540217ee4c78.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/11_llm-observability-bcf1a07fcccc5e234565accb11007c87.webp" width="1080" height="1080" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="anythingllm">AnythingLLM<a href="#anythingllm" class="hash-link" aria-label="Direct link to AnythingLLM" title="Direct link to AnythingLLM">​</a></h2>
<p><a href="https://github.com/Mintplex-Labs/anything-llm" target="_blank" rel="noopener noreferrer">AnythingLLM</a> 是一個很熱門的 LLM 應用軟體。不過正如我前面所說的，LLM 只是一個組件，要讓它發揮效用，關鍵在於應用程式是否擷取正確資料或資訊餵給 LLM 處理，因此「應用程式的外部連線能力」是我測試的重點。</p>
<p>這是我的測試題目；我知道正確答案，而我也知道這個題目不簡單，我只是想觀察這些 LLM 應用軟體會怎麼處理這個任務：</p>
<blockquote>
<p>幫我搜尋這個專案的歷史</p>
<p><a href="https://github.com/ill-inc/biomes-game" target="_blank" rel="noopener noreferrer">https://github.com/ill-inc/biomes-game</a></p>
</blockquote>
<p>最後得到的結果當然不符合我的預期，於是我開啟我的可觀測工具檢查剛剛發生了什麼事情。</p>
<p>我們可以觀察到，AnythingLLM 根據我的輸入觸發了一個「網頁爬蟲工具」：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/12_anythingllm-322c94904b094a6a20209ef1a36a2a11.webp" width="1440" height="827" class="img_RpFt"></p>
<p>然後我們可以看到它單純從 GitHub 爬了一堆垃圾就開始唬爛我試著回答剛剛那個問題。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/13_anythingllm-06d1af67f4f6aa77e5df805f042a64c7.webp" width="1440" height="831" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>正確答案是要用 <code>ill-inc</code> 找到 Global Illumination, Inc. 這間公司，接著找到 OpenAI 在 2023 年收購它們的新聞。
並且在專案的<a href="https://docs.biomes.gg/roadmap" target="_blank" rel="noopener noreferrer">文件網站</a>找到：「被收購之後，專案被團隊釋出後不再維護」的資訊。
我知道這個題目很難，所以後來我也沒有用這個題目測試了，加上我後來找到一些其他對於 LLM 軟體更重要的特性。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="perplexica">Perplexica<a href="#perplexica" class="hash-link" aria-label="Direct link to Perplexica" title="Direct link to Perplexica">​</a></h2>
<p><a href="https://github.com/ItzCrazyKns/Perplexica" target="_blank" rel="noopener noreferrer">Perplexica</a> 是一個自稱作為 Perplexity AI 開源替代方案的 LLM 軟體，Perplexity AI 則是一個以真實性為賣點的 SaaS (Software as a service)。</p>
<p>同一個題目，表現的跟 AnythingLLM 一樣差勁，不過除了外部連線的機制問題以外，我觀察到另外一個更可疑的行為：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/14_Perplexica-73d2856463931b9abbad70c26c2b97cf.webp" width="1440" height="833" class="img_RpFt"></p>
<p>它把對話紀錄的所有角色 (role) 都設定成 <code>assistant</code>！在 OpenAI API 的設計，role 至少有三種：<code>user</code>、<code>assistant</code>、<code>system</code>。</p>
<p>因此 LLM 實際上無法分辨歷史紀錄中誰說了什麼，因為全部都是 <code>assistant</code> 在自言自語。</p>
<p>實際上我在使用 google Gemini 的時候，很常發生：LLM 自己產生的某種結論 OOXX，在後續對話又說「正如你說的，OOXX」，把話塞到我嘴裡。我嚴重懷疑這是由類似的角色不分的提示詞工程造成的。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="local-deep-research">Local Deep Research<a href="#local-deep-research" class="hash-link" aria-label="Direct link to Local Deep Research" title="Direct link to Local Deep Research">​</a></h2>
<p><a href="https://github.com/LearningCircuit/local-deep-research" target="_blank" rel="noopener noreferrer">Local Deep Research</a> 是一個只有 3.8k 星星的專案（截至 2026-01-08），但是它嚴謹的特性深得我喜愛。</p>
<p>觀察到這個特性其實源自於一個意外，我搞錯搜尋引擎的設定，因此它當下無法使用搜尋引擎：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/15-local-deep-research-35d692bdd9e082eac8e0400538b08aed.webp" width="1440" height="835" class="img_RpFt"></p>
<p>但是我們看看它是怎麼回答使用者的：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/16-local-deep-research-69a309d7a0b0a1eeb0ff843113c53842.webp" width="1440" height="831" class="img_RpFt"></p>
<ul>
<li>它懂得回報使用者當下沒有對外連線、額外可供參考的資料，而不是直接試圖唬爛使用者。</li>
<li>這甚至是「光速是多少？」這種大部分 LLM 都可以應對的簡單問題。它也懂得自我檢討這個回答沒有參考資料佐證。</li>
<li>我使用的是普通的繼承 GPT 幹話王血統的 <code>openai/gpt-oss-20b</code>，並不是什麼特別調整的 LLM。</li>
</ul>
<p>我們可以看到它不像是其他 LLM 軟體直接把使用者輸入跟自己產生的資料填進去 OpenAI API 定義的對話紀錄裡面，而是紮紮實實的把任務切成多個 request 來處理：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/17-local-deep-research-1e77d5b7b569f49ee0decc5b7ff487c8.webp" width="1440" height="835" class="img_RpFt"></p>
<p>另外一個我在學習 VR 生態系時的例子，比對多個資料來源矛盾的敘述：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/18-local-deep-research-c54806eb5a9f2f27c973dac770ffed24.webp" width="1440" height="832" class="img_RpFt"></p>
<p>因此我可以簡單的把一些需要確認的主題丟給它研究，真正意義上的降低認知負荷，而不是時時要擔心 LLM 在唬爛我：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/19-local-deep-research-d0c49f8deecfd6456b839347120308b8.webp" width="1440" height="833" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="結論">結論<a href="#結論" class="hash-link" aria-label="Direct link to 結論" title="Direct link to 結論">​</a></h2>
<p>實際上提示詞工程跟正確的軟體架構可以有效處理 LLM 的「幻覺問題」，但是當今市場上的 LLM 軟體發展方向卻完全背道而馳：</p>
<ul>
<li>基於聊天形式的頁面設計，本質上是一個上下文極度不受控的環境，很容易讓 LLM 產生垃圾資料。</li>
<li>明明可以透過嚴謹的提示詞讓 LLM 做出更客觀的回應，但是大部分軟體都傾向取悅消費者，不斷的恭維跟唬爛使用者。</li>
<li>明明可以使用 one shot 的軟體形式提供更穩定的服務，但是就是要做成聊天機器人來欺騙投資人與使用者。</li>
</ul>
<p>就算不提閉源的 SaaS 方案（ChatGPT, Gemini...），AnythingLLM 或 Perplexica 這類譁眾取寵的實作反而贏得更多喝采（星星），而老實解決問題的 Local Deep Research 卻倍受冷落。</p>
<p>我用 LLM 可觀測性工具看見的不是邪惡的 LLM，更多的是整個產業帶有惡意的商業決策與人們的集體瘋狂。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="後記">後記<a href="#後記" class="hash-link" aria-label="Direct link to 後記" title="Direct link to 後記">​</a></h2>
<p>曾經有工程師問我，既然我想觀察提示詞工程，為什麼不乾脆看程式碼？畢竟那些自架軟體都有開源。</p>
<p>這是因為比起在可能不熟悉的程式語言裡探索、還要理解原始碼結構、最後早到提示詞模板跟相關實作，直接觀察界面簡單的多：</p>
<ul>
<li>當我送出一個指令，應用程式呼叫了幾次 LLM 來處理？<!-- -->
<ul>
<li>複雜問題但是只有一次呼叫，代表著實作的架構有問題。</li>
</ul>
</li>
<li>每次呼叫給了什麼輸入？<!-- -->
<ul>
<li>「Garbage in, garbage out」，如果 LLM 給了什麼糟糕的答案，十之八九來自應用程式給了糟糕的輸入。</li>
</ul>
</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/llm-proxy">LLM Proxy</a></li><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/llm-gateway">LLM Gateway</a></li><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/llm-observability">LLM Observability</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="我在工作上通常會用 Emoji 代表「已讀」，包含我日常使用通訊軟體也有這個習慣，前一陣子 Discord 幫我的帳號做的年度總結剛好紀錄了我這個習慣："><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-07_emoji">工作哲學 - 已讀 Emoji</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-07T00:00:00.000Z" itemprop="datePublished">January 7, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>我在工作上通常會用 Emoji 代表「已讀」，包含我日常使用通訊軟體也有這個習慣，前一陣子 Discord 幫我的帳號做的年度總結剛好紀錄了我這個習慣：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_eye-emoji-cfea5a88cf364503bb41cd5905d209e3.webp" width="1440" height="919" class="img_RpFt"></p>
<p>G 胖 (Gabe Newell) 曾經對「遊戲的樂趣」做出<a href="https://www.youtube.com/watch?v=MGpFEv1-mAo" target="_blank" rel="noopener noreferrer">見解</a>：「遊戲環境應該對玩家的行為做出反應，所以當你射擊牆壁時，它因此留下了彈孔」。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_game-fun-b11c3281fc992cb7b0cddc69e1261ed9.webp" width="1058" height="630" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/04_game-fun-68c624938b52a41dfa3e4fa4418d5275.webp" width="1058" height="623" class="img_RpFt"></p>
<p>因此我認為「代表已讀的 Emoji」就是對方訊息的彈孔，不要讓對方產生「訊息投入虛空之中」的挫折感。</p>
<p>從另外一個角度來看，職場是一個需要確定性、可靠性的環境，即時通訊軟體的溝通更是如此，這是一個關於 TCP/UDP 通訊協定的笑話：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_tcp-joke-aa84113a184e65c7824f98847afd1cc2.webp" width="802" height="928" class="img_RpFt"></p>
<p>在 TCP 通訊協定中，雙方需要多次的 ACK (Acknowledge)，確保封包有妥善送達而沒有遺失，如果有丟失的狀況就要重送來建立一個可靠的訊息交付管道；反觀 UDP 則是射後不理。</p>
<p>「代表已讀的 Emoji」就是一個 ACK，確保對方交待的事項你已經收到，並且開始承擔收到之後的責任。</p>
<p>你其實可以在無線電通訊觀察到類似的模式：「I COPY」「抄收」。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="前情提要"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-07_observability-outage">Homelab 可觀測重建進度</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-07T00:00:00.000Z" itemprop="datePublished">January 7, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="#前情提要" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>日期是根據 Git Commit 紀錄跟螢幕截圖時間推論的，但是不是真正精準的時間，因為 Git Commit 可能延後一段時間才推送，截圖的問題則是不是每一個當下都有截圖。</p></div></div>
<p>2025-10-04 左右： LiteLLM 和 Langfuse 上線。
2025-10-11 左右： Local Deep Research 上線。</p>
<p>2025-10-14 左右： 開始比較頻繁使用 Local Deep Research。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/2025-10-14-191907-c54806eb5a9f2f27c973dac770ffed24.webp" width="1440" height="832" class="img_RpFt"></p>
<p>2025-10-22 左右：Homelab 開始出現當機異常。</p>
<ul>
<li>圖表的斷層就是伺服器完全當機讓資料採集的機能癱瘓造成的。</li>
<li>可以觀察到 CPU 跟 RAM 異常使用是 Langfuse 服務簇的 ClickHouse 造成的。</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/2025-10-22-153923-070d3dfe4225019fee6cc35f5bf10da4.webp" width="1440" height="833" class="img_RpFt"></p>
<p>2025-10-23 的紀錄：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/2025-10-23-092053-f2a15f06adb99d31dca02af023e74401.webp" width="1440" height="831" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/2025-10-23-092111-0bd35fe2f3c3b8d0692b25ac204ddb45.webp" width="1440" height="836" class="img_RpFt"></p>
<p>2025-11-01 左右：連帶 Grafana 服務簇也失效，失效後就把 Langfuse 關掉然後沒有修復它了，直到最近 (2026-01) 佈署 K8s 才準備把服務遷移過去。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/2025-11-01-201633-9c9e7938cab3d2f3ec6377040c98742f.webp" width="1440" height="830" class="img_RpFt"></p>
<p>Grafana 失效前我有關查到 Docker 在重新拉取 image，推測是因為我忘記鎖定 image 版本造成的。</p>
<hr>
<p>整個過程中出現過幾種不同的情況：</p>
<ul>
<li>電源鍵強制關機後恢復正常。</li>
<li>電源鍵強制關機後 LiteLLM 異常。<!-- -->
<ul>
<li>Stack 刪掉後重新佈署後恢復正常。</li>
</ul>
</li>
<li>電源鍵強制關機後 Langfuse 異常。<!-- -->
<ul>
<li>根據 clickhouse log 找到有問題的 block，刪除後重新佈署恢復正常（如下）。</li>
</ul>
</li>
</ul>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">2025.11.01 11:00:20.208590 [ 652 ] {c14fc20e-f2b0-45cb-939c-0fe47de9811c::202510_16681_17212_76} &lt;Error&gt; virtual bool DB::MergePlainMergeTreeTask::executeStep(): Exception is in merge_task.: Code: 40. DB::Exception: Checksum doesn&#x27;t match: corrupted data. Reference: 52f594fc9d7f3ee0495f8f089d3882cf. Actual: c92bc03d0da25742da61b67ce5764aac. Size of compressed block: 3640. The mismatch is caused by single bit flip in data block at byte 2581, bit 2. This is most likely due to hardware failure. If you receive broken data over network and the error does not repeat every time, this can be caused by bad RAM on network interface controller or bad controller itself or bad RAM on network switches or bad CPU on network switches (look at the logs on related network switches; note that TCP checksums don&#x27;t help) or bad RAM on host (look at dmesg or kern.log for enormous amount of EDAC errors, ECC-related reports, Machine Check Exceptions, mcelog; note that ECC memory can fail if the number of errors is huge) or bad CPU on host. If you read data from disk, this can be caused by disk bit rot. This exception protects ClickHouse from data corruption due to hardware failures: While reading or decompressing /var/lib/clickhouse/store/c14/c14fc20e-f2b0-45cb-939c-0fe47de9811c/202510_16681_17060_75/data.bin (position: 824782, typename: DB::ReadBufferFromFilePReadWithDescriptorsCache, compressed data header: &lt;uninitialized&gt;): (while reading column ProfileEvent_ReadBufferFromFileDescriptorRead): (while reading from part /var/lib/clickhouse/store/c14/c14fc20e-f2b0-45cb-939c-0fe47de9811c/202510_16681_17060_75/ in table system.metric_log (c14fc20e-f2b0-45cb-939c-0fe47de9811c) located on disk default of type local, from mark 2 with max_rows_to_read = 916, offset = 0): While executing MergeTreeSequentialSource. (CHECKSUM_DOESNT_MATCH), Stack trace (when copying this message, always include the lines below):</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>電源鍵強制關機後 Langfuse 異常。</p>
<ul>
<li>根據 clickhouse log 找到有問題的 block，刪除後重新佈署依然無法恢復。</li>
<li>把 clickhouse 建立全新的 Volume 後恢復正常。</li>
</ul>
</li>
<li>
<p>有幾次伺服器是完全沒螢幕反應，有反應的幾次可以在終端觀察到 CPU Lock：</p>
</li>
</ul>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">watchdog: BUG: soft lockup - CPU#* stuck for **s!</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="仰賴鏈">仰賴鏈<a href="#仰賴鏈" class="hash-link" aria-label="Direct link to 仰賴鏈" title="Direct link to 仰賴鏈">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_dependencies-d48e34f6da96e43bd203ab5d2780b64d.webp" width="1072" height="638" class="img_RpFt"></p>
<ol>
<li>Biomes 重構的進展目前面臨大量的 Schema 型別修復工作，我需要借助 LLM 之力來解決。</li>
</ol>
<p><img decoding="async" loading="lazy" src="/assets/images/01_shared-build-errors-502be1013e64f362bd01b74967d4b8e6.webp" width="1421" height="776" class="img_RpFt"></p>
<ol start="2">
<li>我拒絕使用基於聊天或 IDE Agent 的 LLM 方案。</li>
<li>我想使用 ComfyUI 來構造專門用來處理 Schema 修復問題的 pipeline。</li>
<li>我在本地使用 LLM 工具我要求必須在有 LLM Observability 的前提下使用，所以我必須先修復我的 LLM Observability。</li>
<li>在有伺服器崩潰的前車之鑑，我要求必須在有 Observability 的前提下佈署 LLM Observability，所以我必須先修復我的 Observability。</li>
<li>但是我不想在現有的節點上修復 Observability，而是在新的節點使用 K8s 並佈署 Observability，因此我要先學習使用 K8s。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="observability-重建的當前狀態">Observability 重建的當前狀態<a href="#observability-重建的當前狀態" class="hash-link" aria-label="Direct link to Observability 重建的當前狀態" title="Direct link to Observability 重建的當前狀態">​</a></h2>
<p>到昨天 (2026-01-06) 為止，我已經：</p>
<ol>
<li>設定新的節點，安裝 K3s。(2025-12-24)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab/" target="_blank" rel="noopener noreferrer">筆記型 Homelab 飼養注意事項</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s/" target="_blank" rel="noopener noreferrer">安裝 K3s 與遠端連線</a></li>
</ul>
</li>
<li>整理之前跟 K8s 有關的知識點。(2025-12-28~2026-01-02)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2025-12-28_learn-k8s/" target="_blank" rel="noopener noreferrer">教練我想學 K8s</a></li>
<li><a href="https://flyskypie.github.io/posts/2025-12-29_systemd-ish/" target="_blank" rel="noopener noreferrer">從 Docker 開始的 Systemd 小宇宙</a></li>
<li><a href="https://flyskypie.github.io/posts/2025-12-31_learn-k8s/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Cluster 和它快樂的小夥伴們</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-01_learn-k8s/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Pod 和它快樂的小夥伴們</a></li>
</ul>
</li>
<li>釐清 Ingress/Load Balancer 的概念。(~2026-01-05)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - K8s 只是框架</a></li>
</ul>
</li>
<li>釐清 PV/PVC 的概念。(~2026-01-05)</li>
<li>用 Helm 安裝 Longhorn。(2026-01-05)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-intro/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Longhorn 簡介</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Longhorn 安裝與 Helm</a></li>
</ul>
</li>
<li>用 Helm 安裝 Kube-Prometheus-Stack。(2026-01-06)</li>
</ol>
<hr>
<p><img decoding="async" loading="lazy" src="/assets/images/03_migration-b30fe59a52f586312ec687216542c11b.webp" width="1578" height="772" class="img_RpFt"></p>
<p>用 K8s 內的 Prometheus 和 Grafana 實例取代原本的，原本的兩張 Dashboard 則是本來就有 JSON 檔直接移過去。原本的伺服器指保留 Cadvisor 供新的 Prometheus 採集資料。</p>
<p>目前關於容器的 Dashboard 是處於兩個節點資料混在一起的狀態，暫時先不處理 Query 需要更新的問題：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/2026-01-07-110633-75db9d2164912febd853c6d9d896dc67.webp" width="1440" height="836" class="img_RpFt"></p>
<p>Node Dashboard 則是直接接軌新的 Node Exporter 的資料，暫時也先不處理舊節點的資料：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/2026-01-07-125235-b3a4c6e35bbcb101d9d265977d9db27e.webp" width="1440" height="831" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Kube-Prometheus-Stack 其實有提供不少 Dashboard 用來觀察新節點，我就不在這邊一一列舉了。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="prometheus-安裝筆記">Prometheus 安裝筆記<a href="#prometheus-安裝筆記" class="hash-link" aria-label="Direct link to Prometheus 安裝筆記" title="Direct link to Prometheus 安裝筆記">​</a></h2>
<p>跟 Longhorn 一樣直接使用 Helm 安裝：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm show values prometheus-community/kube-prometheus-stack --version 51.6.0 &gt;values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install prometheus-stack prometheus-community/kube-prometheus-stack \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -f values.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -n prometheus-stack \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 51.6.0</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>values.yaml</code> 倒是有做一些調整：</p>
<ul>
<li>時區</li>
<li>適應當前 K8s (K3s) 的 Ingress 為 Traefik</li>
<li>對內網 DNS 暴露 Grafana</li>
<li>適應當前 K8s 持久化實例為 Longhorn</li>
<li>從舊 Node 的 Cadvisor 採集資料</li>
</ul>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">grafana</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultDashboardsTimezone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Asia/Taipei</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> grafana.observable.gas.arachne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">prometheusSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> longhorn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ReadWriteOnce&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 50Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">additionalScrapeConfigs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      - job_name: beta-cadvisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        static_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          - targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            - web.cadvisor.arachne</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="llm-observability-重建的當前狀態">LLM Observability 重建的當前狀態<a href="#llm-observability-重建的當前狀態" class="hash-link" aria-label="Direct link to LLM Observability 重建的當前狀態" title="Direct link to LLM Observability 重建的當前狀態">​</a></h2>
<p>LiteLLM 雖然在 OpenRouter 排行榜蟬聯前幾名，但是實際使用下來給我的感覺不太穩定（經歷過加密 Bug、當機後無法正常復位）。</p>
<p>另一方面，Langfuse 給我的感覺則是相對肥大（服務簇需要同時配置 ClickHouse、MinIO、Redis、PostgresSQL），但是我又沒有使用到裡面的每一個功能。更別提 ClickHouse 就是表面上這次事故的主因。</p>
<p>因此我打算評估其他 LLM Gateway/Observability 方案，目前看上 <a href="https://github.com/maximhq/bifrost" target="_blank" rel="noopener noreferrer">Bifrost</a>，試用了一下感覺不錯，就是它的資料庫配置稍微有點麻煩，這個部份可能之後再提。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="K8s 不是一個完整解決方案，K8s 只是框架。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-is-framework">K8s 學習筆記 - K8s 只是框架</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<blockquote>
<p>K8s 不是一個完整解決方案，K8s 只是框架。</p>
</blockquote>
<p>驚不驚喜？意不意外？</p>
<p>當你安裝了 Docker 之後就可以開始打包 image 並運行程式，甚至可以使用 Dokcer Compose 指令開始進行容器編排 (Orchestration)。</p>
<p>反觀，對於一個 K8s 使用者而言，生態系內有很多「口味」供你選擇：Minikube、MicroK8s、K3s、GKE、EKS...但是當你選擇原味 (Vanilla)時，你可能會發現歷經一番波折安裝完成之後，你還是什麼都不能幹：不能正常建立網路連線、不能正常的掛載持久化實體 (Volume)...</p>
<p>為什麼？因為 K8s 本身不是開箱即用解決方案，它只是一種框架。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的網路">不是開箱即用的網路<a href="#不是開箱即用的網路" class="hash-link" aria-label="Direct link to 不是開箱即用的網路" title="Direct link to 不是開箱即用的網路">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落會多次提及 OSI 的 L4 和 L7，對兩者差異不清楚的讀者建議先去查點資料，不然閱讀起來可能會有點吃力。</p></div></div>
<p>我在<a href="https://flyskypie.github.io/posts/2026-01-01_learn-k8s/" target="_blank" rel="noopener noreferrer">前一篇文章</a>中介紹了 Service，以及內網模式 ClusterIP 與節點開埠 NodePort，即便是 NodePort 也不像是標準佈署使用的模式，因為它只能開奇怪的埠號。這是因為 Service 其實還有兩個生產環境在使用的模式：LoadBalancer 模式或是加掛一個 Ingress。</p>
<p>以 ServiceLB (LoadBalancer) 為例，K8s 只提供一個 L4 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_lb-controller-9a70bb19a4e58307ba30e54f7e361770.webp" width="917" height="458" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>LB (LoadBalancer) Controller 是一個方便讀者理解的稱呼，實際情況比較複雜，有其他專門的術語用來稱呼這個東西。</p></div></div>
<p>在雲端環境（如 Google, AWS）這是由雲端供應商實作的，可能是一團閉源商業軟體和硬體級 LB 整合而成；在 K3s 中這是由 <a href="https://github.com/k3s-io/klipper-lb" target="_blank" rel="noopener noreferrer">klipper-lb</a> 透過 <code>hostPort</code> 實作的。</p>
<p>Ingress 也是相同的狀況，K8s 只提供一個 L7 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_ingress-controller-b0104efe4f8fed322b5ed08be65ff649.webp" width="1224" height="447" class="img_RpFt"></p>
<p>實作可以是 Nginx 也可以是 Traefik。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的持久化儲存">不是開箱即用的持久化儲存<a href="#不是開箱即用的持久化儲存" class="hash-link" aria-label="Direct link to 不是開箱即用的持久化儲存" title="Direct link to 不是開箱即用的持久化儲存">​</a></h2>
<p>K8s 在設計上就是一個分散式運行的框架，當 Pod 可能分散在多個不同的主機（節點）時，我們就不能像 Docker 那樣直接用某個路徑當作持久化實體。</p>
<p>在 K8s 的世界中，Volume 通常是一個 SDS (Software-defined storage)；
在 K8s 的世界中，網路線就是 SATA 線。</p>
<p>細節我不在此解釋，簡單來說在 K8s 要幫 Container 掛載 Volume 需要經過層層抽象，並且最後實際的儲存實體並不在 K8s 內實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>你也可以在 K8s 設定 <code>storageClassName: local-storage</code> 的 Volume，但是這樣你可能需要額外配置讓 Pod 只能佈署在特定的 Node 上。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Storage Backend 同樣是一個方便讀者理解的稱呼，並不是 K8s 內的標準術語。</p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Longhorn 可以用很多方式安裝，包含最基本的 kubectl 指令："><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-longhorn-install-and-helm">K8s 學習筆記 - Longhorn 安裝與 Helm</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>Longhorn 可以用很多方式安裝，包含最基本的 <code>kubectl</code> 指令：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不過等等！不要急著下指令！讓我們瞄一眼裡面有些什麼：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/01_longhorn-install-yaml-1f7ad17473887f8aa9a4cda144d179b1.webp" width="521" height="589" class="img_RpFt"></p>
<p>是的，這是一個有四千多行的 YAML，善於偷懶的聰明開發者們當然不會想直接跟這團東西打交道。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個數字可以當作一個參考，一個完整的雲原生軟體佈署到 K8s 需要的聲明的資訊大概會達到這個量體。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="helm">Helm<a href="#helm" class="hash-link" aria-label="Direct link to Helm" title="Direct link to Helm">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_helm-4306e187254cfeaddb4fbe25fa2d74ca.webp" width="1859" height="1035" class="img_RpFt"></p>
<p>就像 Longhorn 需要四千多行的 YAML 一樣，還有許許多多的雲原生應用軟體實際都是由大量的 K8s 資源或實體交錯編排而成，於是就有了 Helm 這個工具的誕生：一個 K8s 世界的 APT (Advanced Packaging Tool)。</p>
<p>在 Helm 的世界，這一堆聲明的 YAML 被包裝成一個稱作 Chart 的東西，「安裝」(佈署應用程式到 K8s)大概像這樣：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add longhorn https://charts.longhorn.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Helm 還有另外一個重要的功能：對 Chart 傳入變數，也是今天我要使用 Helm 的主要原因。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="用-helm-安裝-longhorn">用 Helm 安裝 Longhorn<a href="#用-helm-安裝-longhorn" class="hash-link" aria-label="Direct link to 用 Helm 安裝 Longhorn" title="Direct link to 用 Helm 安裝 Longhorn">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落的內容主要參考 Longhorn 的官方文件<sup><a href="#user-content-fn-longhorn-config-6a8af0" id="user-content-fnref-longhorn-config-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p></div></div>
<p>首先下載參數檔：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -Lo values.yaml https://raw.githubusercontent.com/longhorn/longhorn/refs/tags/v1.10.1/chart/values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根據需求修改 <code>values.yaml</code>，以我目前的需求為例，分別是：</p>
<ul>
<li>持久化須儲存到外部 DAS 的掛載點。</li>
<li>目前只有一個工作節點，所以副本只有一份。</li>
</ul>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">defaultSettings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultDataPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /mnt/das</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安裝 Longhorn 到 K8s：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --values values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>拉取 Image 需要時間，過程中可以使用指令檢查是不是所有 Pod 已經就位：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n longhorn-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS              RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine-image-ei-3154f3aa-tsq6p              0/1     ContainerCreating   0             23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-driver-deployer-58768fb7fd-ktpq8   1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-manager-bsqms                      2/2     Running             2 (44s ago)   2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-j8bxb                 1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-w2l6b                 1/1     Running             0             2m58s</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行 Tunnel 連線到 Longhorn 的 Dashboard<sup><a href="#user-content-fn-longhorn-ui-access-6a8af0" id="user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service/longhorn-frontend \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -n longhorn-system 3002:80 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --address 0.0.0.0</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/03_longhorn-frontend-181644ffe13d8e290aad61e70bb1b0b7.webp" width="1440" height="923" class="img_RpFt"></p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-longhorn-config-6a8af0">
<p>Longhorn | Documentation. Retrieved 2026-01-05, from <a href="https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/" target="_blank" rel="noopener noreferrer">https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/</a> <a href="#user-content-fnref-longhorn-config-6a8af0" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-longhorn-ui-access-6a8af0">
<p>Longhorn 部署筆記 | 翠鳥圖書館 Project Halcyon Library. Retrieved 2026-01-05, from <a href="https://wiki.pha.pub/books/109-TAs/page/longhorn" target="_blank" rel="noopener noreferrer">https://wiki.pha.pub/books/109-TAs/page/longhorn</a> <a href="#user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="接續我在前一篇貼文指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作："><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-05_k8s-longhorn-intro">K8s 學習筆記 - Longhorn 簡介</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>接續我  在<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework/" target="_blank" rel="noopener noreferrer">前一篇貼文</a>指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<p><a href="https://github.com/longhorn/longhorn" target="_blank" rel="noopener noreferrer">Longhorn</a> 則是其中一種 SDS 實作：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_longhorn-1983f6aeeeb627c39461978dd959b7fe.webp" width="1089" height="715" class="img_RpFt"></p>
<p>Longhorn 巧妙的運用 K8s 作為基礎設施，將 SDS 運行在 Cluster 內部，並且利用 K8s 的多節點特性運行多個實例，並在多個實例上建立資料冗餘實現分散式副本：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_longhorn-4e94a43f1813ec3e0cc932bd7e179964.webp" width="1040" height="802" class="img_RpFt"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-03_desktop-lighting">老兄，你真的找錯人推銷桌面照明了</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_lighting-690afe05eadfcf1199665470bbd0cf5c.webp" width="1024" height="542" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_lighting-26256caa9acafeb02a72529baacff36a.webp" width="1024" height="566" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_lighting-09ba04689c734ff899b541ee68538d75.webp" width="1024" height="506" class="img_RpFt"></p>
<p>就算真的有興趣想買的，大概也是手術燈那種東西，畢竟在做事的時候光源被手或是頭擋住真的很煩。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="背景"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-03_laptop-homelab">筆記型 Homelab 飼養注意事項</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-ea0a7e8308dd3ceda73995b20ee0532a.webp" width="1110" height="537" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="背景">背景<a href="#背景" class="hash-link" aria-label="Direct link to 背景" title="Direct link to 背景">​</a></h2>
<p>我的 Homelab 是透過筆電和 USB 外接 DAS (Direct Attached Storage) 建構的，並且採過一些小坑。最近在建置新的節點時，發現我把相關的資訊分散在不同的筆記和 IaC (Infrastructure as Code) 裡面，於是想說趁這個機會整理一下資訊。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="電池充電上限">電池充電上限<a href="#電池充電上限" class="hash-link" aria-label="Direct link to 電池充電上限" title="Direct link to 電池充電上限">​</a></h2>
<p>Framework 的話可以在 BIOS 設定充電上限：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_fw-bios-21176c994ed1627b3bac398a51874f91.webp" width="1600" height="900" class="img_RpFt"></p>
<p>（從 Framework 的論壇<a href="https://community.frame.work/t/framework-laptop-13-ryzen-7040-bios-3-07-release-held/65582" target="_blank" rel="noopener noreferrer">借用螢幕截圖</a>）</p>
<p>另外一台 Lenovo 的筆電則是靠這個設定：</p>
<p><a href="https://github.com/makifdb/lenopow" target="_blank" rel="noopener noreferrer">https://github.com/makifdb/lenopow</a></p>
<p>我會把把充電上限設在 80% 避免筆電作為伺服器長時間插著充電造成電池膨脹。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="筆電螢幕問題">筆電螢幕問題<a href="#筆電螢幕問題" class="hash-link" aria-label="Direct link to 筆電螢幕問題" title="Direct link to 筆電螢幕問題">​</a></h2>
<p>讓筆電不會因為螢幕蓋上而進入休眠模式，編輯 <code>/etc/systemd/logind.conf</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">HandleLidSwitch=ignore</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行指令重啟服務：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-logind.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是上述設定會造成另外一個問題：螢幕蓋著還是繼續發光，於是還需要一個步驟，編輯 <code>/etc/default/grub</code>：</p>
<p>在 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 插入 <code>consoleblank=60</code>。</p>
<p>這會讓螢幕在 60 秒後熄滅。</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>完整 Ansible Playbook</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup laptop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> arachne</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> check if consoleblank is configured in the boot command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^GRUB_CMDLINE_LINUX_DEFAULT=&quot;.*consoleblank=60&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> absent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">check_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">register</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">changed_when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> insert consoleblank if missing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^(GRUB_CMDLINE_LINUX_DEFAULT=&quot;.*)&quot;$&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\1 consoleblank=60&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check.found == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set HandleLidSwitch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/systemd/logind.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#?(HandleLidSwitch=)(?:.*)$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\1ignore&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.systemd_service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> systemd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> restarted</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-掛載">DAS 掛載<a href="#das-掛載" class="hash-link" aria-label="Direct link to DAS 掛載" title="Direct link to DAS 掛載">​</a></h2>
<p>當服務透過 Docker 跑在容器內，持久化資料卻儲存在透過 USB 連線的外部儲存中，這個仰賴關係需要額外處理。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="自動化載">自動化載<a href="#自動化載" class="hash-link" aria-label="Direct link to 自動化載" title="Direct link to 自動化載">​</a></h3>
<p>編輯 <code>/etc/fstab</code> 加入以下內容：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># DAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID=7f858b7e-f942-45b3-92dd-8c99b497b6a4 /mnt/das-storage ext4 defaults,nofail,x-systemd.automount 0 2</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改後執行：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>UUID 可以透過 <code>lsblk -f</code> 之類的指令獲得。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="設定仰賴">設定仰賴<a href="#設定仰賴" class="hash-link" aria-label="Direct link to 設定仰賴" title="Direct link to 設定仰賴">​</a></h3>
<p>新增檔案 <code>/etc/systemd/system/docker.service.d/override.conf</code>：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=mnt-das\\x2dstorage.automount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConditionPathExists=/mnt/das-storage</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>確保 Docker Daemon 在 DAS 掛載後才運行。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-smart-檢查">DAS SMART 檢查<a href="#das-smart-檢查" class="hash-link" aria-label="Direct link to DAS SMART 檢查" title="Direct link to DAS SMART 檢查">​</a></h2>
<p>因為電腦沒有直接和硬碟建立連線而是隔著一層 DAS，因此不能使用普通的 <code>smartctl</code> 指令確認，而必須使用額  外的參數<sup><a href="#user-content-fn-qnap-smart-c5ac0a" id="user-content-fnref-qnap-smart-c5ac0a" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,0 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,1 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,2 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,3 /dev/sdd</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-qnap-smart-c5ac0a">
<p>QNAP External RAID Manager - Export SMART Data - QNAP NAS Community Forum. Retrieved 2026-01-03, from <a href="https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575" target="_blank" rel="noopener noreferrer">https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575</a> <a href="#user-content-fnref-qnap-smart-c5ac0a" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/homelab">homelab</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="安裝"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2026-01-02_learn-k8s">安裝 K3s 與遠端連線</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2026-01-02T00:00:00.000Z" itemprop="datePublished">January 2, 2026</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="安裝">安裝<a href="#安裝" class="hash-link" aria-label="Direct link to 安裝" title="Direct link to 安裝">​</a></h2>
<p>懶人安裝法：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -sfL https://get.k3s.io | sh - </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>檢查一下有沒有正常：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">sudo k3s kubectl get node </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="設定">設定<a href="#設定" class="hash-link" aria-label="Direct link to 設定" title="Direct link to 設定">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_kubectl-f4117048f786e3eade61a1e20c3be2e3.webp" width="1571" height="1058" class="img_RpFt"></p>
<p>從安裝 K3s 的機器複製 <code>/etc/rancher/k3s/k3s.yaml</code> 到想要遠端連線的機器（Client 端）的 <code>~/.kube/config</code>。<sup><a href="#user-content-fn-cluster-access-f0e5eb" id="user-content-fnref-cluster-access-f0e5eb" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>要留意 K8s 的憑證會過期這件事。</p></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-cluster-access-f0e5eb">
<p>Cluster Access | K3s. Retrieved 2026-01-02, from <a href="https://docs.k3s.io/cluster-access" target="_blank" rel="noopener noreferrer">https://docs.k3s.io/cluster-access</a> <a href="#user-content-fnref-cluster-access-f0e5eb" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/k-8-s">k8s</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/posts/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 FlyPie (Wei Ji)</div></div></div></footer></div>
</body>
</html>
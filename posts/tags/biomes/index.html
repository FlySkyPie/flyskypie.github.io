<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-post" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">8 posts tagged with &quot;Biomes&quot; | 工程屍 FlyPie 的異想世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://flyskypie.github.io/posts/tags/biomes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" property="og:locale" content="zh_tw"><meta data-rh="true" property="og:title" content="8 posts tagged with &quot;Biomes&quot; | 工程屍 FlyPie 的異想世界"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" property="og:image" content="https://raw.githubusercontent.com/FlySkyPie/flyskypie.github.io/main/post/2025-11-02_biomes/00_cover.webp"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://flyskypie.github.io/posts/tags/biomes"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts/tags/biomes" hreflang="en"><link data-rh="true" rel="alternate" href="https://flyskypie.github.io/posts/tags/biomes" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="工程屍 FlyPie 的異想世界 JSON Feed">




<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="工程屍 FlyPie 的異想世界 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="工程屍 FlyPie 的異想世界 Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4a9022c6.css">
<script src="/assets/js/runtime~main.d010d5ba.js" defer="defer"></script>
<script src="/assets/js/main.c9ec5bb8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LBgp" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--light_RyNI"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_RjML themedComponent--dark_ntqO"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/the-key-of-huanche/">專案文件</a><a class="navbar__item navbar__link" href="/blogs">數位手記</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/posts">廢文雜談</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_s2nU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_DonJ colorModeToggle_KBLq"><button class="clean-btn toggleButton_qwn5 toggleButtonDisabled_tRn_" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_bYdl"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_D9Q4"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Cbrq"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_GUBX"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_UgN6 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_PkUw margin-bottom--md">Recent posts</div><ul class="sidebarItemList_HFnO clean-list"><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-02-23_superman">不對稱的紀律</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-02-04_homelab-hardware-strategy">仰望群星 (Satellites) - 我的 Homelab 戰略</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-29_evil-of-financial">股東 x 金融性產品 x 資本主義</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-25_dequadtree-puzzle-game">一種有限像素影像辨識謎題</a></li><li class="sidebarItem_NmoJ"><a class="sidebarItemLink_GF4N" href="/posts/2026-01-25_marsh-screw-quadruped-mech">一種機甲構想與 Nano Banana 使用筆記</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>8 posts tagged with &quot;Biomes&quot;</h1><a href="/posts/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Assets"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-24_biomes">Biomes 研究筆記 7</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-24T00:00:00.000Z" itemprop="datePublished">December 24, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="assets">Assets<a href="#assets" class="hash-link" aria-label="Direct link to Assets" title="Direct link to Assets">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_assets-ffed5e017faaedd7e581476b43d1eea9.webp" width="978" height="420" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-assets" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-assets</a></li>
</ul>
<p>這個部份算是<a href="https://flyskypie.github.io/posts/2025-12-14_biomes/" target="_blank" rel="noopener noreferrer">上一次的研究筆記</a>漏掉了，這個模組沒什麼特別的，就是一堆放在 Git LFS 的檔案，只是我抽出來單獨放在一個 repository 內。</p>
<p>做這件事的時候，順便參考了幾個開源遊戲，看看它們處理遊戲素材的：</p>
<ul>
<li>0 .A.D.<!-- -->
<ul>
<li>使用 <a href="https://svn.wildfiregames.com/nightly-build/trunk/" target="_blank" rel="noopener noreferrer">SVN</a>， 因此不在 Git 討論範疇內。</li>
</ul>
</li>
<li>Luanti (Minetest)<!-- -->
<ul>
<li><a href="https://github.com/luanti-org/luanti" target="_blank" rel="noopener noreferrer">https://github.com/luanti-org/luanti</a></li>
<li>看起來是直接放在一個 repo 內。</li>
</ul>
</li>
<li>BAR (Beyond All Reason)<!-- -->
<ul>
<li><a href="https://github.com/beyond-all-reason/Beyond-All-Reason" target="_blank" rel="noopener noreferrer">https://github.com/beyond-all-reason/Beyond-All-Reason</a></li>
<li>看起來是直接放在一個 repo 內。</li>
</ul>
</li>
<li>Warzone 2100<!-- -->
<ul>
<li>不同性質的素材是分別放在獨立的 repo 內，再用 Git 的 Submodule 放到主要的 repo 內，例如：<!-- -->
<ul>
<li><a href="https://github.com/Warzone2100/data-music-opus" target="_blank" rel="noopener noreferrer">https://github.com/Warzone2100/data-music-opus</a></li>
<li><a href="https://github.com/Warzone2100/data-fonts" target="_blank" rel="noopener noreferrer">https://github.com/Warzone2100/data-fonts</a></li>
<li><a href="https://github.com/Warzone2100/data-texpages/" target="_blank" rel="noopener noreferrer">https://github.com/Warzone2100/data-texpages/</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="cayleyjs">Cayley.js<a href="#cayleyjs" class="hash-link" aria-label="Direct link to Cayley.js" title="Direct link to Cayley.js">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_cayley-ed677b3fbd414a18fd232be8245e6773.webp" width="1549" height="392" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-cayley-js" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-cayley-js</a></li>
</ul>
<p>Cayley.js 是一個 Cayley WASM 的再封裝，除了實做了一些東西以外，還提供一些單元測試跟 Benchmark 測試。</p>
<p>處理它  的時候算是踩了 Javascript 生態系一個很經典的小坑，原本我打算用 Vitest 取代原本的 AVA 單元測試框架，但是我忘記了 Vite 工具鏈是 ESM 本位主義，因此單元測試會 import Web 版本的 WASM 載入器。</p>
<p>然而 Web 與 Node.js 是屬於兩個不同的 Javascript Runtime，對於「如何載入 WASM」的方式也不同；Web 是使用 <code>fetch</code> <strong>從網路下載</strong> WASM；Node.js 則是使用 <code>fs</code> <strong>從檔案系統讀取</strong> WASM。</p>
<p>使用 Vitest 呼叫 <code>fetch</code> 會觸發 &quot;Not implemented yet&quot; 之類的錯誤訊息。最後是使用 Jest 取代 AVA，慶幸的是已經有人寫了遷移指南<sup><a href="#user-content-fn-ava-to-jest-f6f5a5" id="user-content-fnref-ava-to-jest-f6f5a5" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>，照著做就完成了。</p>
<p>Benchmark 那邊則是用 <code>tsx</code> 取代 <code>ts-node</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="zod">Zod<a href="#zod" class="hash-link" aria-label="Direct link to Zod" title="Direct link to Zod">​</a></h2>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-zod" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-zod</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-zod" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-zod</a></li>
<li><a href="https://github.com/ill-inc/zod" target="_blank" rel="noopener noreferrer">https://github.com/ill-inc/zod</a>
<ul>
<li>Biomes 專案自己的 Fork</li>
</ul>
</li>
</ul>
<p>Zod 是一個方便開發者在 Runtime 對 JSON 資料進行 Schema 驗證的函式庫，我其實不確定 Biomes 為什麼要刻意 fork 出一個版本，最明顯的差異是 Biomes 的版本多了這個方法：</p>
<div class="language-javascript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-javascript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">annotate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;some&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>並且 Symbol 並不在 Zod 的支援路線上：</p>
<blockquote>
<p>Symbols aren&#x27;t considered literal values, nor can they be simply compared with <code>===</code>. This was an oversight in Zod 3.<sup><a href="#user-content-fn-zod-f6f5a5" id="user-content-fnref-zod-f6f5a5" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
</blockquote>
<p>考慮到這並不屬於 JSON 解析的範疇，想想也合理，不過 Biomes 專案本身已經用下去了，我也不能在不熟悉的專案的情況下貿然移除這個客製化 Zod 轉而使用原本的。Biomes 原本是直接從 GitHub 安裝，我 fork 之後做了兩件事：</p>
<ul>
<li>將原本應該被 gitignore 的發布路徑 (<code>/lib</code>) 從 Git 紀錄中清除。</li>
<li>將打包結果發布到 NPM。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="shared">Shared<a href="#shared" class="hash-link" aria-label="Direct link to Shared" title="Direct link to Shared">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/03_shared-17f866e240d1a1e66c421e5f7e810c89.webp" width="2291" height="1121" class="img_RpFt"></p>
<p><code>ecs</code> 和 <code>shared</code> 之間有很嚴重的循環仰賴，無奈之下只好用 PNPM 的 workspace 處理。<code>ecs</code> 對 <code>server</code> 有輕微的仰賴，我直接複製那部份的程式碼進入 <code>ecs</code>，在我看來這裡解偶的效益遠比 DRY 還重要。</p>
<p><code>shared</code> 則是測試的部份對 <code>server</code> 仰賴，仰賴了 Voxeloo WASM loader 的部份，這一點我打算暫時忽略，之後再來處理，畢竟這個部份可以參考 Cayley 的處理方式。</p>
<p>這是我在 <code>shared</code> 上面臨另外一個比較麻煩的問題：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/04_shared-build-errors-502be1013e64f362bd01b74967d4b8e6.webp" width="1421" height="776" class="img_RpFt"></p>
<p><code>shared</code> 使用 Zod 大量定義 Schema，而一些複雜的 Schema 在編譯 Typescript 型別檔 (<code>.d.ts</code>) 時，無法正常推 論，因此必須透過手動聲明的方式來解決：</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> zChallengeCompleteMessage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ZodObject</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ZodLiteral</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token string" style="color:#e3116c">&quot;challenge_complete&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    challengeId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> zBiomesId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">literal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;challenge_complete&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    challengeId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> zBiomesId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>而且看起來跟前面提到的 Symbol 有關...F**k...</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-ava-to-jest-f6f5a5">
<p>Switching from Ava to Jest for TypeScript | by Gant Laborde | Red Shift. Retrieved 2025-12-24, from <a href="https://shift.infinite.red/a6dac7d1712f" target="_blank" rel="noopener noreferrer">https://shift.infinite.red/a6dac7d1712f</a> <a href="#user-content-fnref-ava-to-jest-f6f5a5" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-zod-f6f5a5">
<p>Migration guide | Zod. Retrieved 2025-12-24, from <a href="https://zod.dev/v4/changelog#drops-symbol-support" target="_blank" rel="noopener noreferrer">https://zod.dev/v4/changelog#drops-symbol-support</a> <a href="#user-content-fnref-zod-f6f5a5" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Galois"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-14_biomes">Biomes 研究筆記 6</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-14T00:00:00.000Z" itemprop="datePublished">December 14, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="galois">Galois<a href="#galois" class="hash-link" aria-label="Direct link to Galois" title="Direct link to Galois">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_galois-c1545fd97f5c0327e6931c437207ca2e.webp" width="1679" height="804" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-galois" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-galois</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-galois-core" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-galois-core</a></li>
</ul>
<p>上一篇已經說明過 Viewer/Editor 是以 Electron 實做，並且和一個副程式透過 <code>stdio</code> 通訊。</p>
<p>經過研究發現該副程式的工作依然是採取 request-response 模式，並沒有太複雜的非同步通訊行為，因此我把處理副程式的實做改到 Nest.js 建立的 API 伺服器內，並且把原本用 Electron 呈現的 Viewer/Editor 重 構成單純的 Web 應用程式。</p>
<p>呈現結果如下：</p>
<p><img decoding="async" loading="lazy" alt="viewer" src="/assets/images/02_viewer-ed3efca605176b4ae6e23c005c8ad040.webp" width="1431" height="833" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" alt="editor" src="/assets/images/03_editor-15f3da5acf1413467a134204cc5060b8.webp" width="1440" height="834" class="img_RpFt"></p>
<p>Editor 給我的感覺有點失望，因為它實際上並沒有編輯的能力，只是畫面更完整一點的 Viewer，並且 Block 類的素材是沒辦法讀取的，這方面的問題預計暫時先跳過，不過已知的資訊有：</p>
<ul>
<li>Trace 到 <code>voxeloo</code> 實做，看起來是單純的斷言失敗，而失敗的原因看起來是缺少 <code>texture</code> 參數。</li>
<li>Viewer 那邊是可以渲染方塊的，只是兩邊的 query 不太一樣。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="循環仰賴">循環仰賴<a href="#循環仰賴" class="hash-link" aria-label="Direct link to 循環仰賴" title="Direct link to 循環仰賴">​</a></h2>
<p>Galois 和 <code>shared</code> 之間原本有循環仰賴的問題，我試著移除一些看起來不是核心功能的東西，並且把真的消除不掉的仰賴直接從 <code>shared</code> 內抽出來直接放進 Galois 內。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="重構 Biomes 過程遇到的問題，涉及比較技術細節的故障排除所以額外發一篇文分開講。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-13_numpy-issue">ModuleNotFoundError: No module named &#x27;numpy.core.multiarray&#x27;</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-13T00:00:00.000Z" itemprop="datePublished">December 13, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>重構 <a href="https://github.com/ill-inc/biomes-game" target="_blank" rel="noopener noreferrer">Biomes</a> 過程遇到的問題，涉及比較技術細節的故障排除所以額外發一篇文分開講。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="原始錯誤">原始錯誤<a href="#原始錯誤" class="hash-link" aria-label="Direct link to 原始錯誤" title="Direct link to 原始錯誤">​</a></h2>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">Exception occurred during build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback (most recent call last):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/materializers.py&quot;, line 1783, in materialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/materializers.py&quot;, line 716, in materialize_ToIcon_Flora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/vox.py&quot;, line 739, in iconify_voxel_array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/render_voxels.py&quot;, line 111, in render_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ModuleNotFoundError: No module named &#x27;numpy.core.multiarray&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The above exception was the direct cause of the following exception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback (most recent call last):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;build.py&quot;, line 65, in exec_program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/lru_cache_by_hash.py&quot;, line 30, in set_default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/lru_cache_by_hash.py&quot;, line 24, in make_value_cached</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;build.py&quot;, line 66, in &lt;lambda&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;impl/materializers.py&quot;, line 1785, in materialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl.types.MaterializationError: Error materializing node: DerivedNode(kind=&#x27;ToIcon_Flora&#x27;, deps=[Flora:0x1fc2cb2e4002fa67], dep_hashes=[&#x27;57036fed7713db64e4fb917e35d1c6cc5436883b&#x27;])</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="執行上下文">執行上下文<a href="#執行上下文" class="hash-link" aria-label="Direct link to 執行上下文" title="Direct link to 執行上下文">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_dependency-03011884509efa3eb834f8d7193bfd1b.webp" width="1028" height="411" class="img_RpFt"></p>
<p>整個呼叫鏈是從 HTTP request 觸發，在 Nest.js 內部 <code>spawn</code> 一個副程式，
而該副程式是透過 <code>pyinstaller</code> 打包的 Python 程式，
並且該程式又 <code>import</code> 了另外一個透過 <code>pybind11</code> 打包的 C++ （實作的）動態函式庫。</p>
<p>出現問題的 <code>render_voxels.py</code> 則是「透過 <code>pyinstaller</code> 打包的 Python 程式」當中的一部分。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="解決方法">解決方法<a href="#解決方法" class="hash-link" aria-label="Direct link to 解決方法" title="Direct link to 解決方法">​</a></h2>
<p>在 <code>build.py</code> 所在的專案改變 numpy 的版本：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">// pyproject.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-    &quot;numpy&gt;=1.26.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+    &quot;numpy==1.26.4&quot;,</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>直後重新用 <code>pyinstaller</code> 打包一份新的執行檔。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="推論過程">推論過程<a href="#推論過程" class="hash-link" aria-label="Direct link to 推論過程" title="Direct link to 推論過程">​</a></h2>
<p>查資料的過程會發現常見的錯誤訊息跟我的有一點點不同，不是 <code>numpy.core.multiarray</code> 而是 <code>numpy._core.multiarray</code>：<sup><a href="#user-content-fn-multiarray-error-451c99" id="user-content-fnref-multiarray-error-451c99" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<blockquote>
<p>E   DeprecationWarning: numpy.core.multiarray is deprecated and has been renamed to numpy._core.multiarray. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core.multiarray._ARRAY_API.</p>
</blockquote>
<p>於是這個問題可能是來自 numpy 的破壞性更新。</p>
<p>確認一下 Biomes 專案下 <code>requirements.txt</code> 使用的版本：<code>numpy==1.24.2</code>。</p>
<p>檢查一下自己的專案配置使用 <code>&quot;numpy&gt;=1.26.0</code>，並且 lock 檔顯示實際安裝 <code>2.3.5</code>，到這邊為止幾乎可以確定是 numpy 版本的問題，不過以防萬一還是做更嚴謹的驗證。</p>
<p>如果我們根據錯誤訊息 <code>File &quot;impl/render_voxels.py&quot;, line 111, in render_map</code> 可以找到：</p>
<div class="language-python codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-python codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">    proj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">render_orthographic_color</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cm</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        normals</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dense_normals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        src</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">src_after_padding</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">dir</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lighting_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">lighting_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        up</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">up</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        far</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zoom</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zoom</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        distance_capacity</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>而 <code>rays.render_orthographic_color</code> 的實做實際是在 C++ 內完成的，現在我們回去看一下 C++ 實作：</p>
<div class="language-cpp codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-cpp codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;pybind11/numpy.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;pybind11/pybind11.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;pybind11/stl.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render_orthographic_color</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ColorMap</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> py</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">array_t</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">float</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> normals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vec2i size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vec3f src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vec3f dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vec3f lighting_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vec3f up </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> far </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> zoom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> distance_capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Vec3f z_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normalized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Vec3f x_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normalized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cross</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">z_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> up</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Vec3f y_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normalized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cross</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> py</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token generic-function function" style="color:#d73a49">array_t</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">float</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-function function" style="color:#d73a49">mutable_unchecked</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name number" style="color:#36acaa">3</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> inv_zoom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> zoom</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> x_shift </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> x_dir</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> y_shift </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">h </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> y_dir</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> src </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> inv_zoom </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_shift </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> y_shift</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">integrate_color</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> normals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lighting_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> far</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> distance_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">acc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">acc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">acc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">acc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pos </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> x_dir </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> inv_zoom</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因此我們知道這個試圖 import <code>numpy.core.multiarray</code> 的 numpy 實際上應該是 <code>pybind11</code> 提供的，確認一下我們正在使用哪個版本：<code>pybind/pybind11@2.9.2</code>。</p>
<p><code>README.md</code> 說得很清楚了<sup><a href="#user-content-fn-pybind11-451c99" id="user-content-fnref-pybind11-451c99" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<blockquote>
<p>Integrated NumPy support (NumPy 2 requires pybind11 2.12+)</p>
</blockquote>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-multiarray-error-451c99">
<p>MAINT: NumPy _ARRAY_API import deprecation warning · Issue #4886 · pybind/pybind11. Retrieved 2025-12-13, from <a href="https://github.com/pybind/pybind11/issues/4886" target="_blank" rel="noopener noreferrer">https://github.com/pybind/pybind11/issues/4886</a> <a href="#user-content-fnref-multiarray-error-451c99" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-pybind11-451c99">
<p>pybind/pybind11: Seamless operability between C++11 and Python. Retrieved 2025-12-13, from <a href="https://github.com/pybind/pybind11" target="_blank" rel="noopener noreferrer">https://github.com/pybind/pybind11</a> <a href="#user-content-fnref-pybind11-451c99" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/python">Python</a></li><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/numpy">numpy</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Galois Viewer"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-07_biomes">Biomes 研究筆記 5</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-07T00:00:00.000Z" itemprop="datePublished">December 7, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="galois-viewer">Galois Viewer<a href="#galois-viewer" class="hash-link" aria-label="Direct link to Galois Viewer" title="Direct link to Galois Viewer">​</a></h2>
<p><code>viewer</code> 是一個 Electron 實做。<code>server</code> 則是一個薄封裝，實作了簡單的佇列，並且會從 Python 那邊的實作 (<code>build.py</code>) spawn 一個 process。</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="625" height="275" class="img_RpFt"></p>
<p>從資料流的角度則如下圖所示：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_data-flow-f026ca7ba838b09fb8e9a7a53cc04973.webp" width="1069" height="532" class="img_RpFt"></p>
<p>spawn 出來的 process 是透過 FD (File descriptor) 3 和 4 跟 Electron 的後端※溝通。而兩者傳輸的資料格式則是使用 base64 編碼過得 JSON，而 JSON 的 sechma 可以在 <a href="https://github.com/FlySkyPie/biomes-aql-utils" target="_blank" rel="noopener noreferrer">biomes-aql-utils</a> 裡面找到。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>※更精確的說法是 main process，與之相對的瀏覽器端則是 renderer process，這裡選擇使用一個對 Electron 不熟悉的人應該也比較好理解的用詞。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="error-spawn-binsh-enoent-at-processchildprocess"><code>Error: spawn /bin/sh ENOENT at Process.ChildProcess</code><a href="#error-spawn-binsh-enoent-at-processchildprocess" class="hash-link" aria-label="Direct link to error-spawn-binsh-enoent-at-processchildprocess" title="Direct link to error-spawn-binsh-enoent-at-processchildprocess">​</a></h2>
<p>目前遇到的主要障礙是以下錯誤訊息：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">Error: A JavaScript error occurred in the main process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Uncaught Exception: Error: spawn /bin/sh ENOENT at Process.ChildProcess._handle.onexit (node:internal/child_process:282:19) at onErrorNT (node:internal/child_process:477:16) at processTicksAndRejections (node:internal/process/task_queues:83:21)</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">Uncaught Exception: Error: write EPIPE at afterWriteDispatched (node:internal/stream_base_commons:164:15) at writeGeneric (node:internal/stream_base_commons:155:3) at Socket._writeGeneric (node:net:780:11) at Socket._write (node:net:792:8) at writeOrBuffer (node:internal/streams/writable:389:12) at _write (node:internal/streams/writable:330:10) at Socket.Writable._write (node:internal/streams/writable:334:10) at BatchAssetServer.send (/home/flyskypie/Desktop/2025-10-22_biomes-game_research/2025-11-16_galois-extract/galois-fe-investigation/js/server/dist/server.cjs:93:30) at /home/flyskypie/Desktop/2025-10-22_biomes-game_research/2025-11-16_galois-extract/galois-fe-investigation/js/server/dist/server.cjs:110:9 at processTicksAndRejections (node:internal/process/task_queues:96:5)</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>目前盲猜是因為 spawn 發生在 Electron 內，在 Linux 上應屬於某種沙盒環境，因此「有 shell 的 spawn」沒辦法正常運作。</p>
<p>我不是很想處理 Electron 打包機制與虛擬目錄引入的複雜性，之後應該會把架構改寫成單純的 Web 前端跟 HTTP API 伺服器。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Galois Shader"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-12-01_biomes">Biomes 研究筆記 4</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-12-01T00:00:00.000Z" itemprop="datePublished">December 1, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="galois-shader">Galois Shader<a href="#galois-shader" class="hash-link" aria-label="Direct link to Galois Shader" title="Direct link to Galois Shader">​</a></h2>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="472" height="276" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-galois-shader" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-galois-shader</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-galois-shader" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-galois-shader</a></li>
</ul>
<p>這個組件在原本的專案有幾個神奇的事情：</p>
<ol>
<li>使用 Bazel 封裝 Rust 程式碼，而不是標準 Rust 專案的 <code>Cargo.toml</code>。</li>
<li>使用 Rust 當生成器，生成 Typescript。</li>
</ol>
<p>&quot;使用 Bazel 封裝&quot;是什麼意思？ <code>BUILD.bazel</code> 內容如下：</p>
<div class="language-bazel codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-bazel codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">load(&quot;@rules_rust//rust:defs.bzl&quot;, &quot;rust_binary&quot;, &quot;rust_library&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package(default_visibility = [&quot;//visibility:public&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rust_library(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = &quot;shader_preprocessor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srcs = [&quot;preprocess.rs&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:regex&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rust_library(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = &quot;materials&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srcs = [&quot;materials.rs&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:serde&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:serde_json&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rust_library(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = &quot;shader_link_info&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srcs = [&quot;link_info.rs&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:glsl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rust_binary(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = &quot;shader_gen_ts&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    srcs = [&quot;gen_ts.rs&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;:materials&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;:shader_link_info&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;:shader_preprocessor&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:clap&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:convert_case&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;@crate_index//:glsl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>編譯結果是一個 CLI 的執行檔。</p>
<p>回過來說，這個組件主要的目的是：</p>
<ul>
<li>把 Shader 檔案轉成 Typescript 字串。</li>
<li>提供可以 hot load 的 Three.js <code>RawShaderMaterial</code>。</li>
<li>懶得寫 Typescript，直接用生的（？）</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="galois-viewer">Galois Viewer<a href="#galois-viewer" class="hash-link" aria-label="Direct link to Galois Viewer" title="Direct link to Galois Viewer">​</a></h2>
<p>Galois 的部份還在重構中，所以還沒上傳，不過當前進度大概如下：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/02_galois-viewer-8c635fc82eec54ee6dee9bbc173db3e8.webp" width="1788" height="729" class="img_RpFt"></p>
<p>目前是使用 PNPM 的 workspace/monorepo 來同時包容所有子組件。沒有使用單純的專案架構是因為不同子組件的性質不盡相同，例如：<code>viewer</code> 是 Electron app；<code>server</code> 是 process 封裝；<code>editor</code> 是另外一個 Electron app。</p>
<p>有些組件會作為 app 發布、有些則是作為套件被 import、有些涉及 React 、有些又沒有涉及 React，透過 workspace 分別設定每個組件的組態我覺得比較恰當。</p>
<p>剛剛提到 <code>server</code> 實際上會呼叫 CLI spawn process，而呼叫的對象在原始實做是 <code>python py/assets/build.py</code>，目前我是直接使用 <code>pyinstaller</code> 來打包 Python CLI 成獨立的執行檔。</p>
<p>並且目前的進度， <code>viewer</code> 在跟 <code>server</code> 的執行檔整合還有一點問題需要排除：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/03_galois-viewer-0f19465cad9ba23638354106624a6b02.webp" width="1420" height="855" class="img_RpFt"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Galois"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-11-23_biomes">Biomes 研究筆記 3</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-11-23T00:00:00.000Z" itemprop="datePublished">November 23, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="galois">Galois<a href="#galois" class="hash-link" aria-label="Direct link to Galois" title="Direct link to Galois">​</a></h2>
<blockquote>
<p>Galois is a collection of tools for asset generation. Galois introduces a custom DSL for defining assets (e.g. meshes, textures, game objects, configuration files, maps, worlds), a build system for generating binary asset data, and tools for viewing and editing assets through a UI.</p>
</blockquote>
<p>以上是 README 的原始描述。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="遊戲素材">遊戲素材<a href="#遊戲素材" class="hash-link" aria-label="Direct link to 遊戲素材" title="Direct link to 遊戲素材">​</a></h3>
<p><code>src/galois/data</code> 目錄下是該專案大部分透過 Git LFS (Large File Storage) 儲存的資料所在的路徑，內容如下：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">tree -L 1 src/galois/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src/galois/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── animations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── audio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── color_palettes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── crops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── editor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── flora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── gaia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ├── glass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── icons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── item_meshes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── npcs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── placeables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── textures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── wearables</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>並且當中的結構與 <code>biomes_data_snapshot.tar.gz</code> 的內容大致吻合：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/01_biomes_data_snapshot.tar.gz-15f2dd92fb81e7a21c7ecf3a400cd8df.webp" width="780" height="430" class="img_RpFt"></p>
<p><code>biomes_data_snapshot.tar.gz</code> 是什麼呢？它是 Biomes 透過腳本在本地運行時，理論上應該被下載的檔案，但是官方的伺服器已經不再提供該檔案，GitHub 上有一些 issue 有反應這件事：</p>
<ul>
<li><a href="https://github.com/ill-inc/biomes-game/issues/93" target="_blank" rel="noopener noreferrer">Create a mirror for missing biomes_data_snapshot.tar.gz · Issue #93 · ill-inc/biomes-game</a></li>
<li><a href="https://github.com/ill-inc/biomes-game/issues/91" target="_blank" rel="noopener noreferrer">Unable to download biomes_data_snapshot.tar.gz | host - static.biomes.gg is down · Issue #91 · ill-inc/biomes-game</a></li>
</ul>
<p>換言之，這個 <code>biomes_data_snapshot.tar.gz</code> 是檔案想接手這個開源專案的人第一個會碰到的問題（在不理解程式直接使用官方提供的腳本試圖運行該專案的話），而這個 <code>biomes_data_snapshot.tar.gz</code> 檔案的祕密就藏在 Galois 組件內。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>打包用的腳本其實存在於 <code>scripts/b/data_snapshot.py</code>，不過我認為理解資料比輸出資料還重要。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="素材瀏覽器與編輯器">素材瀏覽器與編輯器<a href="#素材瀏覽器與編輯器" class="hash-link" aria-label="Direct link to 素材瀏覽器與編輯器" title="Direct link to 素材瀏覽器與編輯器">​</a></h3>
<p>在 <code>src/galois/js</code> 中可以看到 <code>editor</code> 和 <code>viewer</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">tree -L 1 src/galois/js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src/galois/js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── editor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── index.d.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── publish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── tsconfig.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── viewer</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根據程式碼判斷，它們應該是 Electron + React 實現的 GUI 工具。</p>
<p>這個組件的定位使其不涉及遊戲本身的實做，並且提供一些必要的封裝給遊戲開發使用，因此作為我的下一個解析目標。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="aql-asset-query-language-utilities">AQL (Asset Query Language) utilities<a href="#aql-asset-query-language-utilities" class="hash-link" aria-label="Direct link to AQL (Asset Query Language) utilities" title="Direct link to AQL (Asset Query Language) utilities">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_biomes-aql-utils-aa727af30982f25ae99afda2cc9ec683.webp" width="1028" height="614" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-aql-utils" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-aql-utils</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-aql-utils" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-aql-utils</a></li>
</ul>
<p>這個模組在 Biomes 的原始路徑是：<code>src/galois/js/lang</code>，
並且當中缺少一些的 Typescript 程式碼是由 <code>src/galois/py/assets</code> 下的 Python 腳本生成的，
因為涉及跨語言的操作，而且沒有其他仰賴，因此我將其抽出作為獨立的套件。</p>
<p>&quot;Asset Query Language&quot; 只是根據內部實現的邏輯跟被呼叫的方式先隨便取的暫時性名稱，它被呼叫的時候大致上長這樣：</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> l </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@/galois/lang&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> skeleton </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toSkeleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">animationInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">skeleton</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> tPose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ExtractInitialPose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">animationsGltf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> skeleton</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> posedVoxJointMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToPosedVoxJointMapFromVoxLayers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> skeleton</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gltf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToGLTF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meshJointMap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tPose</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ExtractAllAnimations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">animationsGltf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> skeleton</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不然 <code>lang</code> 並不是一個方便理解的名稱。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="當前挑戰">當前挑戰<a href="#當前挑戰" class="hash-link" aria-label="Direct link to 當前挑戰" title="Direct link to 當前挑戰">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/03_challenge-overview-39e769328e691c575c86acf45cd07d79.webp" width="765" height="690" class="img_RpFt"></p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="galois-的外部仰賴">Galois 的外部仰賴<a href="#galois-的外部仰賴" class="hash-link" aria-label="Direct link to Galois 的外部仰賴" title="Direct link to Galois 的外部仰賴">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/04_challenge-galois-be11980612527423c6c31de36ed1ad3e.webp" width="764" height="690" class="img_RpFt"></p>
<p>首先， Galois 對 <code>shared</code> 有仰賴，這個部份沒有什麼問題，畢竟 <code>shared</code> 職責上就是處理那些同時會被前端與後端使用的通用邏輯。</p>
<p>但是 Galois 對 <code>server</code> 仰賴就有問題了，因為 <code>server</code> 是應用程式的後端實做，在素材瀏覽或編輯階段不應該對後端邏輯有所仰賴。</p>
<p>仔細看發現跟發布有關，或許可以將該部份暫時從 Galois 中移除，剩下的部份一小部份如果實做不是很多可以視情況直接從 <code>server</code> 移過來。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="shared-的循環仰賴">shared 的循環仰賴<a href="#shared-的循環仰賴" class="hash-link" aria-label="Direct link to shared 的循環仰賴" title="Direct link to shared 的循環仰賴">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/05_challenge-circular-dependency-0eaf5c00a6d6c217d5989d50dc9de1bb.webp" width="765" height="690" class="img_RpFt"></p>
<p>因為 <code>ecs</code> 組件大部分的程式碼用 Python 生成的，可以的話我想拉出來變成單獨的套件，但是因為它跟 <code>shared</code> 之間有密切的耦合（循環仰賴），無奈之下只能用 monorepo 處理。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="shared-的測試仰賴">shared 的測試仰賴<a href="#shared-的測試仰賴" class="hash-link" aria-label="Direct link to shared 的測試仰賴" title="Direct link to shared 的測試仰賴">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/06_challenge-shared-194365ea6a41d60838e89a509db6ddff.webp" width="765" height="690" class="img_RpFt"></p>
<p><code>shared</code> 也有對 <code>server</code> 的仰賴，另外一個則是 <code>voxeloo</code>，但是它使用的是不明的實做：</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> wasmLoader </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@/gen/shared/cpp_ext/voxeloo-simd/wasm&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wasmLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wasmBinary</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wasmFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wasmMemory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeWasmMemory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之前我用 Emscripten 編譯出來的 Voxeloo WASM 本身並沒有符合上述 <code>wasmLoader</code> 界面的東西，Bazel 裡面我也看不出來這個東西是在哪裡實做的。</p>
<p>這個部份是寫在單元測試內的東西，不影響遊戲本體運作，因此我合理懷疑這個是專案經過重構後遺留的痕跡，某個時間點之後就不再維護單元測試而只注重遊戲運行正常與否，造成單元測試內的實作已經過期。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="voxeloo WASM 綁定"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-11-16_biomes">Biomes 研究筆記 2</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-11-16T00:00:00.000Z" itemprop="datePublished">November 16, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="voxeloo-wasm-綁定"><code>voxeloo</code> WASM 綁定<a href="#voxeloo-wasm-綁定" class="hash-link" aria-label="Direct link to voxeloo-wasm-綁定" title="Direct link to voxeloo-wasm-綁定">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/01_voxeloo-wasm-93981868a6eac61a244ae4e7db721f07.webp" width="842" height="614" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-voxeloo-wasm" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-voxeloo-wasm</a></li>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-voxeloo-wasm" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-voxeloo-wasm</a></li>
</ul>
<p>Biomes 對 <code>voxeloo</code> 實做了兩種綁定/交叉編譯，將其從 C++ 專案轉換成其他語言的函式庫，其中一個是 Python，並且透過 pybind11 實現；另外一個則是 WASM 並且透過 Emscripten 實現。要注意的是編譯結果有分成一般跟 SIMD (Single Instruction Multiple Data) 兩種。</p>
<p>考量 Biomes 有自己分別在 client 和 server 端實做自己的 WASM 載入函式：</p>
<p><a href="https://github.com/ill-inc/biomes-game/blob/main/src/server/shared/voxeloo.ts#L21" target="_blank" rel="noopener noreferrer"><code>src/server/shared/voxeloo.ts</code></a>:</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadVoxeloo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">VoxelooModule</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://github.com/ill-inc/biomes-game/blob/main/src/client/game/webasm.ts#L22" target="_blank" rel="noopener noreferrer"><code>src/client/game/webasm.ts</code></a>:</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadVoxeloo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WasmConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">VoxelooModule</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我就不在 WASM binding 這一層做其他處理了，直接將 Emscripten 編譯的結果發布到 NPN 上。</p>
<p>順道一提，我有試著讓編譯過程執行在 Docker 內，但是並沒有成功，換句話說當前編譯過程可能仰賴我的 host 安裝的某些東西，但是現階段我不打算處理這個問題，等有機會再回來看要怎麼解決，確保「能成功編譯的環境」不會失傳。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="cayley"><code>cayley</code><a href="#cayley" class="hash-link" aria-label="Direct link to cayley" title="Direct link to cayley">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/02_cayley-ccb5b2b2424e7b2cdcfa997f657bb4e2.webp" width="842" height="321" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-cayley-rs" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-cayley-rs</a></li>
</ul>
<p><code>cayley</code> 看起來是另外一個運算吃重的模組，以 Rust 撰寫。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="wasm-綁定">WASM 綁定<a href="#wasm-綁定" class="hash-link" aria-label="Direct link to WASM 綁定" title="Direct link to WASM 綁定">​</a></h3>
<ul>
<li><a href="https://www.npmjs.com/package/@flyskypie/biomes-cayley-wasm" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/@flyskypie/biomes-cayley-wasm</a></li>
</ul>
<p>這裡遇到一個小插曲：</p>
<ul>
<li><code>cayley</code>  專案使用 Rust <code>1.70.0</code>
<ul>
<li><code>WORKSPACE.bazel</code> 內有寫： <code>RUST_VERSION = &quot;1.70.0&quot;</code>。</li>
</ul>
</li>
<li>專案的 <code>wasm-bindgen</code> 是 <code>0.2.83</code>
<ul>
<li><code>Cargo.lock</code> 內有寫。</li>
</ul>
</li>
<li><code>wasm-bindgen</code> 要求 <code>wasm-bindgen-cli</code> <code>0.2.83</code></li>
<li><code>wasm-bindgen-cli</code> <code>0.2.83</code> 要求 Rust 1.82+<!-- -->
<ul>
<li><code>wasm-bindgen-cli</code> <code>0.2.83</code> 有一個仰賴要求 1.82+</li>
</ul>
</li>
</ul>
<p>我不知道這個相依性地獄 (dependency hell) 是怎麼產生的，也不打算深究，直接包進 Docker 裡面分階段在不同的 Rust 版本編譯。</p>
<p>Biomes 原本只有發布 <code>bundler</code> 和 <code>nodejs</code> 兩種版本，後者是給 CommonJS 用的，前者則是直接 <code>import</code> WASM 檔案，需要專案有使用 Webpack 或是 Loader 之類的自動翻譯模組，因此我額外加上了 <code>web</code> 當作 ESM 的預設包，顧名思義是給瀏覽器用的。</p>
<p><code>wasm-bindgen-cli</code> 工具蠻完整的，除了 WASM 載入器的 Javascript 有準備好，用來給 Typescript 的 <code>.d.ts</code> 也有生成，該說不愧是網頁前端友善（？）的 Rust 嗎？</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="python-綁定">Python 綁定<a href="#python-綁定" class="hash-link" aria-label="Direct link to Python 綁定" title="Direct link to Python 綁定">​</a></h3>
<ul>
<li><a href="https://pypi.org/project/biomes-cayley-py/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/biomes-cayley-py/</a></li>
</ul>
<p>Python 這邊是使用 pyo3/maturin 的工具完成，並且這次我試著發布到 PyPI 去，有點意外 Rust 的部份也一併被上傳，從 Python 安裝的時候似乎會在本地跑編譯。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="前一陣子在 GitHub 上找到有興趣的專案，放到口袋清單之後，終於在上週 (2025-10-22) 忍不住把它拿出來玩了，這裡紀錄一下到目前為止 (2025-11-02) 的進度。"><header><h2 class="title_BVkY" itemprop="headline"><a itemprop="url" href="/posts/2025-11-02_biomes">Biomes 研究筆記 1</a></h2><div class="container_sDB1 margin-vert--md"><time datetime="2025-11-02T00:00:00.000Z" itemprop="datePublished">November 2, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_SrKl"><div class="avatar margin-bottom--sm"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/9475660" alt="Wei Ji" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FlySkyPie" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Wei Ji</span></a></div><small class="avatar__subtitle" itemprop="description">閃亮症候群工程屍</small></div></div></div></div></header><div class="markdown" itemprop="articleBody">
<p>前一陣子在 GitHub 上找到有興趣的專案，放到口袋清單之後，終於在上週 (2025-10-22) 忍不住把它拿出來玩了，這裡紀錄一下到目前為止 (2025-11-02) 的進度。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="來自-global-illumination-inc-的-biomes">來自 Global Illumination, Inc. 的 Biomes<a href="#來自-global-illumination-inc-的-biomes" class="hash-link" aria-label="Direct link to 來自 Global Illumination, Inc. 的 Biomes" title="Direct link to 來自 Global Illumination, Inc. 的 Biomes">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/00_cover-1f4ed71723e8afa0911cef2ea6e1dcc0.webp" width="2861" height="1823" class="img_RpFt"></p>
<p>Biomes 是一個（理論上）能夠在瀏覽器執行的開源方塊沙盒多人連線角色扮演遊戲 (MMORPG)。</p>
<p>為什麼我說「理論上」呢？因為這個專案已經葛屁兩年了，在親眼看到以前說不準它的實際情況。</p>
<p>並且專案停滯的時間點剛好是 OpenAI 收購 Global Illumination （Biomes 背後的公司團隊） 的時間點<sup><a href="#user-content-fn-openai-acquisition-eacf67" id="user-content-fnref-openai-acquisition-eacf67" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="動機">動機<a href="#動  機" class="hash-link" aria-label="Direct link to 動機" title="Direct link to 動機">​</a></h2>
<p>不熟悉我的讀者可能不理解我沒事幹麻去撿一個死兩年專案的屍體，這些是我曾經寫過相關的文章：</p>
<ul>
<li><a href="https://flyskypie.github.io/blog/2024-05-29_I-like-minecraft-but-its-might-no-the-way-you-think/" target="_blank" rel="noopener noreferrer">我喜歡 Minecraft，不過可能不是一般人認知的那種</a></li>
<li><a href="https://flyskypie.github.io/blog/about-ecs-distributed-minecraft-rl-rbnn-bar-code-language/" target="_blank" rel="noopener noreferrer">關於我想用 ECS 實作 Minecraft 以分散式架構運行並在其中用增強式學習訓練完全視覺化之遞迴布林類神經網路以產出二維條碼人造語言那檔事</a></li>
<li><a href="https://flyskypie.github.io/blog/2021-12-04_from-goxel-to-blender/" target="_blank" rel="noopener noreferrer">從 Goxel 到 Blender (Voxel art → 綁人物模型骨架)</a></li>
<li><a href="https://flyskypie.github.io/blog/2021-07-18-Project_Malmo_Intro/" target="_blank" rel="noopener noreferrer">Project Malmo 簡介</a></li>
<li><a href="https://flyskypie.github.io/blog/2021-06-11_minerl-competition-structure/" target="_blank" rel="noopener noreferrer">MineRL 挑戰 2021 - 競賽流程（翻譯）</a></li>
<li><a href="https://flyskypie.github.io/blog/2021-06-10_minerl-challenge_rules/" target="_blank" rel="noopener noreferrer">MineRL 挑戰 2021 - 比賽規則（翻譯）</a></li>
<li><a href="https://flyskypie.github.io/blog/2020-05-23-A_Way_to_Reward_Agent_Which_Constructed_Voxel_World_Minecraft_by_Shannon_Entropy/" target="_blank" rel="noopener noreferrer">一種利用資訊熵獎勵智能體構建方塊世界(Minecraft)的方法</a></li>
</ul>
<p>作為一個開源 Minecraft 愛好者（？），我一直都有在關注開源軟體圈中與 Minecraft 的發展，特別是物色一個適合的目標 fork 它改成我想要的樣子。</p>
<p>Biomes 乍看之下完成度很高：</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vPHEtewFm3M?si=W_73CRz42ZFpddc1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>而且是使用貼近 Web 的技術（Typescript, WASM...）實做，對我而言理解的門檻會低得多（比起 C++ 實做的 Minetest）。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="專案的第一印象">專案的第一印象<a href="#專案的第一印象" class="hash-link" aria-label="Direct link to 專案的第一印象" title="Direct link to 專案的第一印象">​</a></h2>
<ul>
<li><a href="https://github.com/ill-inc/biomes-game" target="_blank" rel="noopener noreferrer">https://github.com/ill-inc/biomes-game</a>
<ul>
<li>2.6k ⭐</li>
</ul>
</li>
</ul>
<p>該專案使用異構單體庫結構，也就是：</p>
<ul>
<li>單庫(<a href="https://en.wikipedia.org/wiki/Monorepo" target="_blank" rel="noopener noreferrer">Monorepo</a>)：使用一個 Git 庫存放所有模組與程式碼。</li>
<li>異構(<a href="https://en.wikipedia.org/wiki/Polyglot_(computing)" target="_blank" rel="noopener noreferrer">Polyglot</a>)：多個模組涉及不同的程式語言與技術棧(Techstack)。</li>
<li>單體(<a href="https://en.wikipedia.org/wiki/Monolithic_application" target="_blank" rel="noopener noreferrer">Monolithic</a>)：所有程式碼會組裝成單一的 Web 服務。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>「異構單體庫」並不是一個正式用語，但是我試著用中文組裝成一個最簡要能表達多個複雜的概念的詞彙。</p></div></div>
<p>並且透過 <a href="https://github.com/bazelbuild/bazel" target="_blank" rel="noopener noreferrer">Bazel</a> 這個工具來處理複雜的仰賴鏈，接著在外面套一層 Python 腳本，所有操作都需要透過 <a href="https://github.com/ill-inc/biomes-game/blob/main/scripts/b/b.py" target="_blank" rel="noopener noreferrer">b.py</a> 完成。</p>
<p>雖然試著用 Bazel 把專案跑起來，但是似乎是工具版本不符的原因，整個過程並不順利。加上個人不是很喜歡這種「全家桶」結構，因此下一步就是開始拆專案。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="拆拆拆">拆拆拆<a href="#拆拆拆" class="hash-link" aria-label="Direct link to 拆拆拆" title="Direct link to 拆拆拆">​</a></h2>
<p>一些比較大型模組會有自己獨立的 <code>README.md</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">find . -name README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./voxeloo/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./docs/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/client/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/shared/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/server/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/server/bob/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/server/shared/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/benchmarks/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/galois/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./src/galois/js/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.githooks/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./scripts/tsconfig-replace-paths/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.devcontainer/README.md</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接著是找到外部仰賴最少，即仰賴鏈最上游的模組。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="docs"><code>docs</code><a href="#docs" class="hash-link" aria-label="Direct link to docs" title="Direct link to docs">​</a></h2>
<p><a href="https://flyskypie.github.io/biomes-docs/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="/assets/images/01_docs-045cbe97b415d71895a62b2487905427.webp" width="1434" height="821" class="img_RpFt"></a></p>
<p>第一個抽出的模組是網頁文件：</p>
<p><a href="https://github.com/FlySkyPie/biomes-docs" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-docs</a></p>
<p>它不仰賴別人的模組也沒有被仰賴，並且有自己獨立的 <code>package.json</code>，很容易抽出。</p>
<p>從 <code>yarn</code> 轉換成 <code>pnpm</code>、修復幽靈仰賴；並且處理的圖片都儲存在 git LFS 的問題之後就能正常運作了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="geometryhpp-和-light_kernelhpp"><code>geometry.hpp</code> 和 <code>light_kernel.hpp</code><a href="#geometryhpp-和-light_kernelhpp" class="hash-link" aria-label="Direct link to geometryhpp-和-light_kernelhpp" title="Direct link to geometryhpp-和-light_kernelhpp">​</a></h2>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="419" height="318" class="img_RpFt"></p>
<p>接下來的兩個模組則是用 Python 生成 <code>.hpp</code> 函式庫：</p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-voxeloo-geometry" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-voxeloo-geometry</a></li>
<li><a href="https://github.com/FlySkyPie/biomes-voxeloo-light-kernelry" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-voxeloo-light-kernelry</a></li>
</ul>
<p>其中一個還使用了 Jinja2 — 基於 Python 的樣板引擎/函式庫。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="voxeloo"><code>voxeloo</code><a href="#voxeloo" class="hash-link" aria-label="Direct link to voxeloo" title="Direct link to voxeloo">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/03_voxeloo-96d501775008dbb4c721c8b17cadd051.webp" width="689" height="614" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-voxeloo" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-voxeloo</a></li>
</ul>
<p>接著是名為 <code>voxeloo</code> 的組件，使用了前述程序化生成的 <code>.hpp</code>。</p>
<p>在原本使用 Bazel 處理的仰賴鏈中，還包含了一些指向 GitHub 的外部函式庫，例如：<code>catch2</code>、<code>eigen</code>、<code>robin-hood-hashing</code>、<code>zstd</code>...。</p>
<p>在這方面我使用 <a href="https://github.com/cpm-cmake/CPM.cmake" target="_blank" rel="noopener noreferrer">CPM.cmake</a> 來處理仰賴關係，只要目標有撰寫良好的 <code>CMakeLists.txt</code>，就可以把 C++ 專案當成套件拉進專案使用。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="第三方函式庫">第三方函式庫<a href="#第三方函式庫" class="hash-link" aria-label="Direct link to 第三方函式庫" title="Direct link to 第三方函式庫">​</a></h3>
<ul>
<li><a href="https://github.com/FlySkyPie/OpenSimplexNoise" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/OpenSimplexNoise</a></li>
</ul>
<p>OpenSimplexNoise 原本的 Git Repo 沒有 <code>CMakeLists.txt</code>，所以我 fork 之後加上 <code>CMakeLists.txt</code>。</p>
<ul>
<li><a href="https://github.com/FlySkyPie/tomasakeninemoeller" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/tomasakeninemoeller</a></li>
</ul>
<p><code>opttritri.h</code> 和 <code>tribox3.h</code> 這兩個檔案原本是直接放在專案內的，我就稍微朔源了一下然後一樣加上 <code>CMakeLists.txt</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="voxeloo-python-綁定"><code>voxeloo</code> Python 綁定<a href="#voxeloo-python-綁定" class="hash-link" aria-label="Direct link to voxeloo-python-綁定" title="Direct link to voxeloo-python-綁定">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/04-voxeloo-py-d6384fd2ce5389a633fbcfac78781a4f.webp" width="814" height="614" class="img_RpFt"></p>
<ul>
<li><a href="https://github.com/FlySkyPie/biomes-voxeloo-py" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/biomes-voxeloo-py</a></li>
</ul>
<p>Biomes 對 <code>voxeloo</code> 實做了兩種綁定/交叉編譯，將其從 C++ 專案轉換成其他語言的函式庫，其中一個是 Python，並且透過 pybind11 實現。</p>
<p>我使用 scikit-build 作為 Python 的建置後端 (Build Backend) 將奇打包成一個 Python 庫 (Python Wheel)，並且補上型別資訊 (Stub)。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-openai-acquisition-eacf67">
<p>OpenAI收購AI設計公司Global Illumination | iThome. Retrieved 2025-10-06 from <a href="https://www.ithome.com.tw/news/158307" target="_blank" rel="noopener noreferrer">https://www.ithome.com.tw/news/158307</a> <a href="#user-content-fnref-openai-acquisition-eacf67" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_Wp5O padding--none margin-left--sm"><li class="tag_UXKs"><a class="tag_lXMw tagRegular_c460" href="/posts/tags/biomes">Biomes</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 FlyPie (Wei Ji)</div></div></div></footer></div>
</body>
</html>
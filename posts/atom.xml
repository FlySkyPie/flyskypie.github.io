<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://flyskypie.github.io/posts</id>
    <title>工程屍 FlyPie 的異想世界 Blog</title>
    <updated>2026-02-25T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://flyskypie.github.io/posts"/>
    <subtitle>工程屍 FlyPie 的異想世界 Blog</subtitle>
    <icon>https://flyskypie.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Homelab 遷移近況]]></title>
        <id>https://flyskypie.github.io/posts/2026-02-25_homelabe-status</id>
        <link href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status"/>
        <updated>2026-02-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[最近在陸續把服務從運行在一台主機 Docker Swarm 遷移到另外一台主機的 Kubernetes 中，]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_homepage-221ce612a05bede3af5015db92d75f6c.webp" width="1440" height="1098" class="img_RpFt"></p>
<p>最近在陸續把服務從運行在一台主機 Docker Swarm 遷移到另外一台主機的 Kubernetes 中，</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_monitor-ecdebabba7aff4746511fbb2b457f969.webp" width="1440" height="837" class="img_RpFt"></p>
<p>一直到回老家過年前 (2026-02-15) 已經完成大部分服務的遷移，這裡紀錄一下剩餘的服務以及還沒完成遷移的原因。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="簡單遷移流程">簡單遷移流程<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#%E7%B0%A1%E5%96%AE%E9%81%B7%E7%A7%BB%E6%B5%81%E7%A8%8B" class="hash-link" aria-label="Direct link to 簡單遷移流程" title="Direct link to 簡單遷移流程">​</a></h2>
<p>因為我使用 Longhorn 作為 Volume Provider，資料並不是直接寫在 host 的檔案系統內的，而是寫在類似虛擬機硬碟映像檔的東西內，</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ ll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 14945644</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx------  2 root root        4096 Feb 20 07:01 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 22 root root        4096 Feb 24 12:16 ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root root 21474836480 Feb 25 00:56 volume-head-000.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root root         126 Jan 24 11:55 volume-head-000.img.meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--  1 root root         143 Feb 20 07:01 volume.meta</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因此不能直接單純的把資料從一個主機的硬碟複製到另外一個主機硬碟，而是需要經過一層 K8s 把資料寫入 Volume 內。目前使用的遷移步驟大致如下。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="1-起草-k8s-yaml">1. 起草 K8s YAML<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#1-%E8%B5%B7%E8%8D%89-k8s-yaml" class="hash-link" aria-label="Direct link to 1. 起草 K8s YAML" title="Direct link to 1. 起草 K8s YAML">​</a></h3>
<p>使用 Kompose 將 Docker Swarm 的 YAML 轉換成 K8s 資源，並且進行適當的修飾（例如：有狀態的服務從 Deployment 改成 StatefulSet）。</p>
<p>並且在目標 Pod 掛上臨時的 container，用於提供 PVC 寫入的 runtime，同時先註解掉真正的服務，如下：</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>K8s YAML</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rollingUpdate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># - image: docker.io/getpinry/pinry:2.1.13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   name: pinry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#     - containerPort: 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#       protocol: TCP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   volumeMounts:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#     - mountPath: /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#       name: pinry-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Used to do data migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/library/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3600"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pinry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="2-確認原始-volume-大小">2. 確認原始 Volume 大小<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#2-%E7%A2%BA%E8%AA%8D%E5%8E%9F%E5%A7%8B-volume-%E5%A4%A7%E5%B0%8F" class="hash-link" aria-label="Direct link to 2. 確認原始 Volume 大小" title="Direct link to 2. 確認原始 Volume 大小">​</a></h3>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">du -s -h</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="3-遷移">3. 遷移<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#3-%E9%81%B7%E7%A7%BB" class="hash-link" aria-label="Direct link to 3. 遷移" title="Direct link to 3. 遷移">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_mpuI" id="31-直接-cp適用小量遷移">3.1 直接 <code>cp</code>，適用小量遷移<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#31-%E7%9B%B4%E6%8E%A5-cp%E9%81%A9%E7%94%A8%E5%B0%8F%E9%87%8F%E9%81%B7%E7%A7%BB" class="hash-link" aria-label="Direct link to 31-直接-cp適用小量遷移" title="Direct link to 31-直接-cp適用小量遷移">​</a></h4>
<p>先遷移到本地：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">rsync -avh --info=progress2 --info=name0 --delete \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@arachne-node-beta:/mnt/das-storage/volumes/pinry_data/ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./pinry_data/</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之後上傳到 Pod：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cp -n pinry-stack ./pinry_data/ pinry-0:/pinry_data</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>移動檔案到 PV 掛載的路徑：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -n pinry-stack --stdin --tty pinry-0 -- /bin/sh</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">cp -rf  /pinry_data/* /data/.</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>需要拆分兩個步驟是因為 <code>kubectl cp</code> 指令只能複製資料夾，不能在兩個資料夾之間直接同步內容。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_mpuI" id="32-tar-打包後-cp適用小量遷移">3.2 tar 打包後 <code>cp</code>，適用小量遷移<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#32-tar-%E6%89%93%E5%8C%85%E5%BE%8C-cp%E9%81%A9%E7%94%A8%E5%B0%8F%E9%87%8F%E9%81%B7%E7%A7%BB" class="hash-link" aria-label="Direct link to 32-tar-打包後-cp適用小量遷移" title="Direct link to 32-tar-打包後-cp適用小量遷移">​</a></h4>
<p>步驟同上，只是多了一個打包/解包的步驟<sup><a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#user-content-fn-kube-cp-bundle-bd911c" id="user-content-fnref-kube-cp-bundle-bd911c" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># 打包壓縮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -czf gitea.tar.gz &lt;PATH&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解壓縮解包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xzf gitea.tar.gz</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_mpuI" id="33-hostpath適用中量遷移">3.3 <code>hostPath</code>，適用中量遷移<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#33-hostpath%E9%81%A9%E7%94%A8%E4%B8%AD%E9%87%8F%E9%81%B7%E7%A7%BB" class="hash-link" aria-label="Direct link to 33-hostpath適用中量遷移" title="Direct link to 33-hostpath適用中量遷移">​</a></h4>
<p>上述方法對於容量小的遷移尚可處理，但是我的 ArchiveBox 有 12 GB 的資料，<code>kubectl cp</code> 傳輸過程會遇到以下問題：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">error: unexpected EOF</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>於是我在 Deployment 上加掛一個 <code>hostPath</code> Volume：</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>K8s YAML</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rollingUpdate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">io.kompose.service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># - name: archivebox</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   image: docker.io/archivebox/archivebox:0.7.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#     - containerPort: 8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#       protocol: TCP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#   volumeMounts:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#     - mountPath: /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#       name: archivebox-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Used to do data migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/library/busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3600"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /archivebox_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">archivebox</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> archivebox</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Used to do data migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">archivebox</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /mnt/archivebox_data</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>先把資料從一台主機移到另外一台主機，再進入容器中把資料從  <code>hostPath</code> Volume 移到 Longhorn 去。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="4-切換-container">4. 切換 container<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#4-%E5%88%87%E6%8F%9B-container" class="hash-link" aria-label="Direct link to 4. 切換 container" title="Direct link to 4. 切換 container">​</a></h3>
<p>將遷移用暫時性的 container 註解並且把真實服務掛回。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="剩餘服務">剩餘服務<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#%E5%89%A9%E9%A4%98%E6%9C%8D%E5%8B%99" class="hash-link" aria-label="Direct link to 剩餘服務" title="Direct link to 剩餘服務">​</a></h2>
<p>以下是過年前尚未完成遷移的服務，主要是因為有額外的雜務需要處理，不適用上述簡單遷移方法。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="minio">MinIO<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#minio" class="hash-link" aria-label="Direct link to MinIO" title="Direct link to MinIO">​</a></h3>
<p>MinIO 的遷移比較特別，一來是已經停止維護了<sup><a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#user-content-fn-minio-dead-bd911c" id="user-content-fnref-minio-dead-bd911c" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>，雖然作為封閉的地端使用情況並不需要太過擔心安全性問題， 可以繼續使用已經存在的 OCI (Open Container Initiative) 映像檔，不過依然可能要物色一下其他替代方案。</p>
<p>二來是 MinIO 是一個 S3 (Simple Storage Service) 實例，本身就有 CRUD (Create, read, update and delete) 的 API，因此資料遷移時無須考慮 Volume 層級的問題，只要用 <code>mc</code> 指令同步兩個在不同實例上的 Bucket 即可。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="harbor">Harbor<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#harbor" class="hash-link" aria-label="Direct link to Harbor" title="Direct link to Harbor">​</a></h3>
<p>Harbor 本身就有 Helm 可以使用，但是因為我是客製化 <code>docker-compose.yaml</code> 的情況，考慮資料遷移的複雜性可能不能直接使用 Helm。</p>
<p>加上 Harbor 的微服務結構跟我 selfhosted 的其他服務相比複雜得多，翻譯成 K8s 的過程會比較麻煩。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="jellyfin">Jellyfin<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#jellyfin" class="hash-link" aria-label="Direct link to Jellyfin" title="Direct link to Jellyfin">​</a></h3>
<p>資料比較多 (1.3TB)，即便是 <code>hostPath</code> 方案也必須在新的主機上消費兩倍的硬碟空間，因此 <code>hostPath</code> 不適合用來遷移這種規模的資料。</p>
<p>我腦海浮現兩種解決方法，第一個是直接在舊將資料封裝成 SDS (Software-defined storage)，然後在新節點上作為 Volume 掛載後進行資料轉移。</p>
<p>第二個方法是把 Volume 在新節點上掛給一個 SSH 容器，由 SSH 完成資料轉移。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="gitea">Gitea<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#gitea" class="hash-link" aria-label="Direct link to Gitea" title="Direct link to Gitea">​</a></h3>
<p>Gitea 因為需要使用 SSH (Git over SSH)，無法透過 Ingress 處理，而必須設定 Load Balancer。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Ingress 是 L7 的 HTTP 反向代理，SSH 是建立在 L4 的 TCP 連線上，因此需要 L4 的 Gateway （即 Load Balancer） 處理。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="aptcacherng">AptCacherNg<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#aptcacherng" class="hash-link" aria-label="Direct link to AptCacherNg" title="Direct link to AptCacherNg">​</a></h3>
<p>AptCacherNg 雖然是使用 HTTP，但是 <code>apt</code> 指令的實做似乎不會帶上 hostname 之類的資訊，因此服務不能運行在反向代理之後，在 Docker Swarm 的舊節點我是直接找個 port 暴露出去。</p>
<p>在 K8s 則是類似於 Gitea 的情況，必須要用 Load Balancer 額外設定。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="dashy">Dashy<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#dashy" class="hash-link" aria-label="Direct link to Dashy" title="Direct link to Dashy">​</a></h3>
<p>Dashy 的運作方式是每次容器啟動時，都會根據配置檔「編譯」一份靜態網站。我有點懷疑在 K8s 這種「容器是經濟動物；隨便新增隨便刪除」的哲學下，這種運作是否恰當，視情況可能需要找其他的 homepage 替代方案。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-kube-cp-bundle-bd911c">
<p>Remco Kersten - Importing Data into Longhorn. aspberry Pi 5 for 4K Gaming - Jeff Geerling. Retrieved 2026-02-25, from <a href="https://www.remcokersten.nl/posts/import-data-into-longhorn/" target="_blank" rel="noopener noreferrer">https://www.remcokersten.nl/posts/import-data-into-longhorn/</a> <a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#user-content-fnref-kube-cp-bundle-bd911c" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-minio-dead-bd911c">
<p>MinIO 已死，MinIO 復生 - 知乎. Retrieved 2026-02-25, from <a href="https://zhuanlan.zhihu.com/p/2008215929461445776" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/2008215929461445776</a> <a href="https://flyskypie.github.io/posts/2026-02-25_homelabe-status#user-content-fnref-minio-dead-bd911c" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="homelab" term="homelab"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[不對稱的紀律]]></title>
        <id>https://flyskypie.github.io/posts/2026-02-23_superman</id>
        <link href="https://flyskypie.github.io/posts/2026-02-23_superman"/>
        <updated>2026-02-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[家庭、公司、政府...是常見構成國家的「最小協作單元」，當政府要買東西的時，往往受到預算法、採購法...等等法律的約制，以及制度構成的嚴謹紀錄；公司（大型企業）要買東西時的情況也差不多，受到內部的採購制度約束，以及透過 ERP、POS 等資通訊系統追蹤。]]></summary>
        <content type="html"><![CDATA[
<p>家庭、公司、政府...是常見構成國家的「最小協作單元」，當政府要買東西的時，往往受到預算法、採購法...等等法律的約制，以及制度構成的嚴謹紀錄；公司（大型企業）要買東西時的情況也差不多，受到內部的採購制度約束，以及透過 ERP、POS 等資通訊系統追蹤。</p>
<p>家庭或個人在「消費行為」這件事情上相較之下就顯得缺乏紀律，可能隨意購買路邊攤的小吃、短期承租店面的「出清小店」，缺乏審計制度。如果買了一個不合用的拖把，可能也不會特意去紀錄品牌跟製造商，避免下一次再購買它。換言之，企業會極力的紀錄、分析消費者，但是消費者往往不會追蹤企業的供應鍊、仔細比對不同廠商之間的差異。</p>
<p>這種不對稱性使得自然人在面對巨靈時，往往處於弱勢的地位。</p>
<hr>
<p>「舉證之所在，敗訴之所在」是一句法律圈的俗語，這點出了一個奇怪的現象，法律似乎假設了一種「超人」的存在，這個超人無所不知（不會出現記憶模糊）、無所不能（總是有證據），政府或企業透過嚴謹的制度與完善的基礎建設，能夠調閱報表、單據、POS、ERP 紀錄...作為證據，使其代表的法人能夠無限逼近這個「超人」，反觀憑感覺生活的家庭或個人在法律活動中往往處於弱勢。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[仰望群星 (Satellites) - 我的 Homelab 戰略]]></title>
        <id>https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy</id>
        <link href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy"/>
        <updated>2026-02-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[背景知識]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="背景知識">背景知識<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AD%98" class="hash-link" aria-label="Direct link to 背景知識" title="Direct link to 背景知識">​</a></h2>
<p>要明白我要表達什麼，需要具備一些先驗知識，包含：Dyason Swarm, Starlink 和 樹莓派叢集，我會先做一些簡單的解釋幫對這方面概念比較缺乏的讀者能夠搭上我的思路。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="戴森雲-dyason-swarm">戴森雲 (Dyason Swarm)<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E6%88%B4%E6%A3%AE%E9%9B%B2-dyason-swarm" class="hash-link" aria-label="Direct link to 戴森雲 (Dyason Swarm)" title="Direct link to 戴森雲 (Dyason Swarm)">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_dyson-swarm-13314a5dd3246851dcf0ccb807eab7a4.webp" width="1628" height="1152" class="img_RpFt"></p>
<p>戴森雲是一種科幻構想，簡單來說就是：</p>
<blockquote>
<p>用大量的人造衛星圍繞並運行在太陽附近來採集太陽能源。</p>
</blockquote>
<p>更具體的介紹可以觀看 Kurzgesagt 的影片，我就不在這邊細談了：</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pP44EPBMb8A?si=82rJJfioS3e55D4W" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Kurzgesagt 的影片算是高度簡化版本，例如有人指出「把人造衛星降到靠近太陽的軌道這件事本身就需要消費不少能源」<sup><a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#user-content-fn-dyson-swarm-criticism-f2f00d" id="user-content-fnref-dyson-swarm-criticism-f2f00d" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p></div></div>
<p>然後我的立場是：</p>
<blockquote>
<p>太酷了！我想蓋！</p>
</blockquote>
<p>不過我看完 Kurzgesagt 的第一個想法是，它一定需要有一個資料中心來遙測與控制這麼多的衛星。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="星鏈-starlink">星鏈 (Starlink)<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E6%98%9F%E9%8F%88-starlink" class="hash-link" aria-label="Direct link to 星鏈 (Starlink)" title="Direct link to 星鏈 (Starlink)">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_starlink-30bccc5ca1ecce97f0ad604c01dd429b.webp" width="640" height="789" class="img_RpFt"></p>
<p>星鏈是由接近一萬顆人造衛星構成的網路系統，讓消費者不用透過海底電纜就能使用高速的無線網路。尤其適合有線網路基礎設施不夠發達的國家，其他使用情境包含空運、海運等位於海洋中間或在深山之類缺乏基地台地方。</p>
<p>請特別留意 Starlink 佈署時堆疊在火箭內的樣子：</p>
<p><img decoding="async" loading="lazy" alt="https://www.space.com/spacex-starlink-falcon-9-rocket-fairing-video" src="https://flyskypie.github.io/assets/images/04_starlink-5e2ef1ff6c17b9e5c7541072b6feb929.webp" width="970" height="546" class="img_RpFt"></p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="樹莓派叢集">樹莓派叢集<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E6%A8%B9%E8%8E%93%E6%B4%BE%E5%8F%A2%E9%9B%86" class="hash-link" aria-label="Direct link to 樹莓派叢集" title="Direct link to 樹莓派叢集">​</a></h3>
<p>樹莓派 (Raspberry Pi) 是原先出於教育目的而被設計出來的單板電腦，它就像一個手長大小的電路板，卻具備電腦的完整功能。</p>
<p>預留腳位的設計讓它能夠作為開發板被客製化裝上各種感測器或擴充電路。其中一個例子是把它跟獨立顯示卡裝在一起<sup><a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#user-content-fn-pi-dgpu-f2f00d" id="user-content-fnref-pi-dgpu-f2f00d" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_amdgpu-rx-460-plugged-into-raspberry-pi-5-0432dd3fd4f5e8bace14c34d28be9b28.webp" width="1400" height="933" class="img_RpFt"></p>
<p>樹莓派叢集則是將多個樹莓派透過網路線連接在一起構成一個運算叢集：</p>
<p><img decoding="async" loading="lazy" alt="https://dev.to/fredinono/from-nas-to-kubernetes-setting-up-a-raspberry-pi-cluster-with-synology-nas-57f4" src="https://flyskypie.github.io/assets/images/03_raspberry-pi-cluster-6ec5dca3af6289143463f47809a2872c.webp" width="1000" height="420" class="img_RpFt"></p>
<p>是不是跟堆疊的衛星有幾分神似？</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="現實">現實<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E7%8F%BE%E5%AF%A6" class="hash-link" aria-label="Direct link to 現實" title="Direct link to 現實">​</a></h2>
<p>現在讓我把眼光從戴森雲、星鏈拉回我那 4.3 坪的租屋處，身處於寸土寸金的大台北，五年網頁前端開發經驗，混雜一些 3D、後端、Docker...的經驗。</p>
<p>這是我手上有的牌，接下來我該如何玩這個名為現實的遊戲呢？</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="kubernetes">Kubernetes<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#kubernetes" class="hash-link" aria-label="Direct link to Kubernetes" title="Direct link to Kubernetes">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_containers-c2a5c23b9afb5acf1f3dfa5149182da6.webp" width="1536" height="1024" class="img_RpFt"></p>
<blockquote>
<p>操作著數以百計的容器</p>
</blockquote>
<p>閱讀 K8s (Kubernetes) 相關的文章很常會看到類似的描述。</p>
<blockquote>
<p>「它一定需要有一個資料中心來遙測與控制這麼多的衛星」</p>
</blockquote>
<p>它跟 Dyason Swarm 的影子在我面前重疊，「Dyason Swarm 的科技樹上必然有 K8s 的存在」我如此確信。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="longhorn">Longhorn<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#longhorn" class="hash-link" aria-label="Direct link to Longhorn" title="Direct link to Longhorn">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_how-longhorn-works-ce2d8662288fcfd69a7a58148d703030.svg" width="1366" height="820" class="img_RpFt"></p>
<p><a href="https://github.com/longhorn/longhorn" target="_blank" rel="noopener noreferrer">Longhorn</a> 是基於 K8s 的分散式儲存，它可以和 K8s 以類似共生的關係運作在一起：透過 K8s 的叢集架構 Longhorn 可以運作在每一個節點上實現多節點冗餘，而當 K8s 內佈署的服務請求儲存區 (Persistent Volumes) 時，則由 Longhorn 直接向應用程式提供儲存空間。</p>
<p>因此一顆硬碟只要掛上一個堪用的電腦（比如一塊樹莓派），丟進 K8s 內就能讓它成為儲存資源池的一部分，多餘的運算能力則可以「順便」運行一些服務分攤叢集的負載。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="基於筆電的-k8s-叢集">基於筆電的 K8s 叢集<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#%E5%9F%BA%E6%96%BC%E7%AD%86%E9%9B%BB%E7%9A%84-k8s-%E5%8F%A2%E9%9B%86" class="hash-link" aria-label="Direct link to 基於筆電的 K8s 叢集" title="Direct link to 基於筆電的 K8s 叢集">​</a></h3>
<p>筆電有一些工程特性是一般桌機以及伺服器運算不會考量的：省電，即能源效率以及體積和輕量化，為了方便攜帶，可靠性也不會做得太脆弱。我認為這在台灣這種地狹人綢以及寸土寸金的都市中是十分重要的因素，我最為租屋族不太可能負擔得起充足的空間建設伺服器機櫃，遷移的頻率也遠比居住在大陸上的歐美人士來得高。</p>
<p>並且根據我的主觀體驗，很容易低成本獲得二手筆電，加上 K8s 和 Longhorn 的架構下，數個無須十分強大的節點就能提供儲存冗餘，從而解決基於筆電的設備無法使用硬碟陣列卡的問題；又或是避免管理軟體陣列帶來額外的麻煩，只要是能夠安裝並運行 K8s 節點的設備都能對這個叢集進行水平拓展。拓展叢集的關鍵零件，交換器本身又不會太昂貴。</p>
<p>筆電或是單板電腦的尺寸較小，比起機架伺服器或是一般的桌機來得更有空間彈性，必要時甚至可以把叢集拆成數個不同大小的單元分散在空間之中。</p>
<p>當然，要把二手筆電當作一個儲存節點，可能需要透過 USB 外掛硬碟，二手筆電低階的 CPU、低階的 USB 埠口、低階的乙太網路埠口都會成為系統的瓶頸。不過這種事情等遇到再說吧，瓶頸就是用來感受的，畢竟我都經歷過直接把 OS 灌在 DAS (Direct-attached storage) 外部儲存、最後 I/O await 高到會讓 Docker 不穩定才把系統裝回 SSD 了。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-dyson-swarm-criticism-f2f00d">
<p>The Dyson Swarm – A Personal Perspective - JMORE. Retrieved 2026-02-04, from <a href="https://jmoreliving.com/2020/06/08/the-dyson-swarm-a-personal-perspective/" target="_blank" rel="noopener noreferrer">https://jmoreliving.com/2020/06/08/the-dyson-swarm-a-personal-perspective/</a> <a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#user-content-fnref-dyson-swarm-criticism-f2f00d" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-pi-dgpu-f2f00d">
<p>Use an External GPU on Raspberry Pi 5 for 4K Gaming - Jeff Geerling. Retrieved 2026-02-04, from <a href="https://www.jeffgeerling.com/blog/2024/use-external-gpu-on-raspberry-pi-5-4k-gaming/" target="_blank" rel="noopener noreferrer">https://www.jeffgeerling.com/blog/2024/use-external-gpu-on-raspberry-pi-5-4k-gaming/</a> <a href="https://flyskypie.github.io/posts/2026-02-04_homelab-hardware-strategy#user-content-fnref-pi-dgpu-f2f00d" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="homelab" term="homelab"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[股東 x 金融性產品 x 資本主義]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-29_evil-of-financial</id>
        <link href="https://flyskypie.github.io/posts/2026-01-29_evil-of-financial"/>
        <updated>2026-01-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[G 胖]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="g-胖">G 胖<a href="https://flyskypie.github.io/posts/2026-01-29_evil-of-financial#g-%E8%83%96" class="hash-link" aria-label="Direct link to G 胖" title="Direct link to G 胖">​</a></h2>
<p>G 胖 (Gabe Newell) 並且是 Valve 公司的擁有者，Valve 則是 Steam 這個最大的遊戲平台背後的開發與維護者。G 胖在玩家圈中有著很高的聲望，這裡挑幾個論點或例子。</p>
<p>G 胖曾經表達他對於盜版遊戲的看法：盜版源自於缺乏服務，玩家都會花錢買電腦，他們不會單純為了省那一點遊戲的錢而刻意去使用盜版軟體，盜版通常猖獗在遊戲軟體的服務觸及不到的地區，你只要把服務做好，盜版就會自然消失。那些針對盜版機制努力的公司根本搞錯重點，他們這樣做反而在降低玩家的消費體驗。</p>
<p>G 胖稱呼玩家為客戶 (Our Client) 而不是消費者 (Consumer)。</p>
<p>Valve 不是上市公司的特性，讓它能夠在 G 胖的領導下真正提高產品的品質，而無須迎合股東。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="資本主義下的王者">資本主義下的王者<a href="https://flyskypie.github.io/posts/2026-01-29_evil-of-financial#%E8%B3%87%E6%9C%AC%E4%B8%BB%E7%BE%A9%E4%B8%8B%E7%9A%84%E7%8E%8B%E8%80%85" class="hash-link" aria-label="Direct link to 資本主義下的王者" title="Direct link to 資本主義下的王者">​</a></h2>
<p>關於上市公司與私人公司的比較我認為是一個很有趣的切入點，這也是很多人詬病的問題。在股份公司的架構下，權力集中在董事會上，但是股東通常不具備公司業務相關的知識背景，只是單純的出資者，並且要求金錢收益作為回報。結果就是造成「外行人領導內行人」的問題，經常讓公司推出一些「理論上有利於股東，但是不利於消費者」的策略。</p>
<p>反之，Valve 與 G 胖之間的關係是私人公司與唯一的資本持有者，G 胖本身又是具有遊戲相關背景的人，因此公司前進的方向通常是為了解決玩家（即消費者）的問題，而不是為了迎合股東的利益。</p>
<p>有趣的是，從權力結構上去觀察兩者，董事會反而是有分權的體系，私人公司則是完全獨裁的體系，G 胖的例子剛好成為「民主優於獨裁」的反向案例。不過有一點概念的人都知道，民主並沒有比獨裁才好，只是多了一些分散風險的機制，避免昏君帶領群體走向毀滅，而 G 胖剛好是「獨裁體制下的明君」。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="權利與義務的失衡">權利與義務的失衡<a href="https://flyskypie.github.io/posts/2026-01-29_evil-of-financial#%E6%AC%8A%E5%88%A9%E8%88%87%E7%BE%A9%E5%8B%99%E7%9A%84%E5%A4%B1%E8%A1%A1" class="hash-link" aria-label="Direct link to 權利與義務的失衡" title="Direct link to 權利與義務的失衡">​</a></h2>
<p>一個權利背後往往伴隨著對應的義務，這是社會契約運作的基本原理。上市公司的結構反而呈現微妙的權責分配方式：股東有獲得公司收益的權利，卻沒有理解公司業務邏輯的義務。</p>
<p>我認為這個權利義務的不對稱、失衡正是造成上市公司在資本主義的遊戲規則下變成一種罪惡之源的根本性原因。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="巨靈尺度下的集體惡意">巨靈尺度下的集體惡意<a href="https://flyskypie.github.io/posts/2026-01-29_evil-of-financial#%E5%B7%A8%E9%9D%88%E5%B0%BA%E5%BA%A6%E4%B8%8B%E7%9A%84%E9%9B%86%E9%AB%94%E6%83%A1%E6%84%8F" class="hash-link" aria-label="Direct link to 巨靈尺度下的集體惡意" title="Direct link to 巨靈尺度下的集體惡意">​</a></h2>
<p>霍布斯的巨靈論主要是一個論述透過匯集人民的權利義務到君主身上而構成君權合理性的理論，一個建立在人本上君權理論；而不是基於神學的君權神授。</p>
<p>我認為巨靈論可以描述一種集體惡意的狀態，例如：第一世界的公民購買巧克力這件事本身是非常中性的消費行為，但是無數的消費行為累積在巨靈尺度很有可能變成壓榨第三世界巧克力勞工的一種集體惡意，就像是一個第一世界巨靈在欺壓另外一個第三世界巨靈。</p>
<p>當我們用相同的概念來看帶「買股票、買基金」這種購買金融性產品的行為，會發現它在巨靈尺度同樣構成了一種惡意：無數人持有獲利的權利卻沒有理解基本底層邏輯（公司業務邏輯）的義務，其結果就是資本的代理人往往會做出很多傷害終端消費者的決策，完全有違資本運作最原始的目的：一個人幫助另外一個人，並用金錢衡量這個幫助。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[一種有限像素影像辨識謎題]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game</id>
        <link href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="1024" height="1024" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>前一陣子和人聊天，剛好提到了一個我六年前 (2020) 寫的一個小玩具，我似乎沒有把跟它相關的想法寫下來，於是試著在這邊文章做個整理。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="有限像素影像辨識謎題">有限像素影像辨識謎題<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#%E6%9C%89%E9%99%90%E5%83%8F%E7%B4%A0%E5%BD%B1%E5%83%8F%E8%BE%A8%E8%AD%98%E8%AC%8E%E9%A1%8C" class="hash-link" aria-label="Direct link to 有限像素影像辨識謎題" title="Direct link to 有限像素影像辨識謎題">​</a></h2>
<p>謎題規則如下：</p>
<ul>
<li>謎題本身為一張點陣圖</li>
<li>初始狀態為 1 pixel</li>
<li>點擊一次 1 pixel 會被切割成四等分</li>
<li>換句話說每點一次（探勘）就會多揭露 3px 的資訊</li>
<li>玩家必須用最少的探勘次數獲得的「馬賽克圖像」辨識出謎題</li>
</ul>
<p>舉例來說，這是初始狀態：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,UklGRs4FAABXRUJQVlA4IMIFAAAwnwCdASrSAkcDPpFIoUylpKMiIVfIULASCWlu4XdhG0AdmhEQoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoVCoU7OLCRS54LniBQZBc8QKDILniBQZBc8QJ/8HRBc8QKDILniBQZBc8QKDILniBQW3ym1FBkFzxAoMgueIFBkFzxAoMguc1MRiZi9kE8zMXsgnmZi9kE8zMXsgmrkQYmYvZBPMzF7IJ5mYvZBPMzF7IJq3X8r2QTzMxeyCeZmL2QTzMxeyCeZcjpxBc8QKDILniBQZBc8QKDILniBQW4BqxMxeyCeZmL2QTzMxeyCeZmL2QTVuv5XsgnmZi9kE8zMXsgnmZi9kE8y5HTiC54gUGQXPECgyC54gUGQXPECgtwDViZi9kE8zMXsgnmZi9kE8zMXsgmrdfyvZBPMzF7IJ5mYvZBPMzF7IJ5lyOnEFzxAoMgueIFBkFzxAoMgueIFBbgGrEzF7IJ5mYvZBPMzF7IJ5mYvZBNW6/leyCeZmL2QTzMxeyCeZmL2QTzLkdOILniBQZBc8QKDILniBQZBc8QKC3ANWJmL2QTzMxeyCeZmL2QTzMxeyCat1/K9kE8zMXsgnmZi9kE8zMXsgnmXI6cQXPECgyC54gUGQXPECgyC54gUFuAasTMXsgnmZi9kE8zMXsgnmZi9kE1br+V7IJ5mYvZBPMzF7IJ5mYvZBPMuR04gueIFBkFzxAoMgueIFBkFzxAoLcA1YmYvZBPMzF7IJ5mYvZBPMzF7IJq3X8r2QTzMxeyCeZmL2QTzMxeyCeZcjpxBc8QKDILniBQZBc8QKDILniBQW4BqxMxeyCeZmL2QTzMxeyCeZmL2QTVuv5XsgnmZi9kE8zMXsgnmZi9kE8y5HTiC54gUGQXPECgyC54gUGQXPECgtwDViZi9kE8zMXsgnmZi9kE8zMXsgmrdfyvZBPMzF7IJ5mYvZBPMzF7IJ5lyOnEFzxAoMgueIFBkFzxAoMgueIFBbgGrEzF7IJ5mYvZBPMzF7IJ5mYvZBNW6/leyCeZmL2QTzMxeyCeZmL2QTzLkdOILniBQZBc8QKDILniBQZBc8QKC3ANWJmL2QTzMxeyCeZmL2QTzMxeyCat1/K9kE8zMXsgnmZi9kE8zMXsgnmXI6cQXPECgyC54gUGQXPECgyC54gUFuAasTMXsgnmZi9kE8zMXsgnmZi9kE1br+V7IJ5mYvZBPMzF7IJ5mYvZBPMuR04gueIFBkFzxAoMgueIFBkFzxAoLcA1YmYvZBPMzF7IJ5mYvZBPMzF7IJq3X8r2QTzMxeyCeZmL2QTzMxeyCeZcjpxBc8QKDILniBQZBc8QKDILniBQW4BqxMxeyCeZmL2QTzMxeyCeZmL2QTVuv5XsgnmZi9kE8zMXsgnmZi9kE8y5HTiC54gUGQXPECgyC54gUGQXPECgtwDViZi9kE8zMXsgnmZi9kE8zMXsgmrdfyvZBPMzF7IJ5mYvZBPMzF7IJ5lyOnEFzxAoMgueIFBkFzxAoMgueIFBbgGrEzF7IJ5mYvZBPMzF7IJ5mYvZBNW6/leyCeZmL2QTzMxeyCeZmL2QTzLkdBHD+soxlsWrAkbYtWBI2xasCRti1YEjbFqwJG2LVgSNsWrAkbYtWBI2xasCRti1YEjbFqwJG2LVgSNsWrAkbYtWBI2xGRJAAAAP70qjz0gec3hNBfoPjK703rvAB+bBUBTGOj+LYjqqu8ADrp0FB1nuFDKCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCCi1AAQQUWoACCM5W3rLcrVof6yG+nvChXuCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwWCwUzkVQYkWovgA" width="722" height="839" class="img_RpFt"></p>
<p>這是第一次點擊：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="722" height="839" class="img_RpFt"></p>
<p>這是點擊了 55 次之後：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="722" height="839" class="img_RpFt"></p>
<p>經過 453 次之後，玩家可以辨識出這是「貓」：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_puzzle-6e9ca65dbb0f5a45603285054d5226ef.webp" width="722" height="839" class="img_RpFt"></p>
<p>453 就是這個玩家的量化成績，數字越小越好。</p>
<p>這個謎題的程式碼在此：</p>
<p><a href="https://github.com/FlySkyPie/dequadtree-puzzle-game" target="_blank" rel="noopener noreferrer">https://github.com/FlySkyPie/dequadtree-puzzle-game</a></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="cnn-問題">CNN 問題<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#cnn-%E5%95%8F%E9%A1%8C" class="hash-link" aria-label="Direct link to CNN 問題" title="Direct link to CNN 問題">​</a></h2>
<p>這個謎題啟發自卷積類神經網路 (CNN, Convolution Neural Network) 的問題。</p>
<p>CNN 會掃描整張圖片，並且偵測諸如邊界之類的微小特徵<sup><a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fn-cnn-explained-1a8114" id="user-content-fnref-cnn-explained-1a8114" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_features-1b63840f85db67ca481c873eccbfd1ab.webp" width="830" height="387" class="img_RpFt"></p>
<p>接著再透過這些微小特徵組合成比較高級的特徵，例如：臉、手...之類的。</p>
<p>這個特性為 CNN 帶來了一些問題：</p>
<ul>
<li>高頻下毒</li>
<li>重組可辨識性</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="高頻下毒">高頻下毒<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#%E9%AB%98%E9%A0%BB%E4%B8%8B%E6%AF%92" class="hash-link" aria-label="Direct link to 高頻下毒" title="Direct link to 高頻下毒">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_cnn-attack-b2fd1b7d38a142131f93936d1a3c3fc6.webp" width="3000" height="1687" class="img_RpFt"></p>
<p>攻擊者可以在影像內參入人類肉眼不可見的資訊，讓圖片無法被 CNN 正確的識別<sup><a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fn-cnn-attack-1a8114" id="user-content-fnref-cnn-attack-1a8114" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="重組可辨識性">重組可辨識性<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#%E9%87%8D%E7%B5%84%E5%8F%AF%E8%BE%A8%E8%AD%98%E6%80%A7" class="hash-link" aria-label="Direct link to 重組可辨識性" title="Direct link to 重組可辨識性">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_cnn-52e62f2f9c658af5485505cc4d3d23b7.webp" width="1100" height="203" class="img_RpFt"></p>
<p>當圖片被重組打亂，人類將會難以辨識，但是 CNN 仍然能夠維持辨識能力<sup><a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fn-cnn-puzzlingly-1a8114" id="user-content-fnref-cnn-puzzlingly-1a8114" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="模擬注意力">模擬注意力<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#%E6%A8%A1%E6%93%AC%E6%B3%A8%E6%84%8F%E5%8A%9B" class="hash-link" aria-label="Direct link to 模擬注意力" title="Direct link to 模擬注意力">​</a></h2>
<p>人類的視覺成像其實並不是均勻的，受到視網膜視錐細胞分佈的影響，實際上只有中間的區域具有比較多的成像資訊。另一方面任意瞬間視網膜接受的資訊其實是模糊的，是透過大腦在時間序上累積的資訊腦補成一個比較清晰的影像。</p>
<p>前面的謎題就是為了模擬這種特性而設計的，人類會將注意力放在最可疑、最有價值的區域去提高解析度，其他地方就算不管也沒關係。經過探索圖片本質上是一個四元樹 (Quadtree) 結構。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-cnn-explained-1a8114">
<p>Convolutional Neural Networks Explained. Retrieved 2026-01-25, from <a href="https://tvirdi.github.io/2017-10-29/cnn/" target="_blank" rel="noopener noreferrer">https://tvirdi.github.io/2017-10-29/cnn/</a> <a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fnref-cnn-explained-1a8114" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-cnn-attack-1a8114">
<p>How we might protect ourselves from malicious AI | MIT Technology Review. Retrieved 2026-01-25, from <a href="https://www.technologyreview.com/2019/05/19/135299/how-we-might-protect-ourselves-from-malicious-ai/" target="_blank" rel="noopener noreferrer">https://www.technologyreview.com/2019/05/19/135299/how-we-might-protect-ourselves-from-malicious-ai/</a> <a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fnref-cnn-attack-1a8114" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-cnn-puzzlingly-1a8114">
<p>Neural Networks seem to follow a puzzlingly simple strategy to classify images | by Wieland Brendel | Bethgelab | Medium. Retrieved 2026-01-25, from <a href="https://medium.com/bethgelab/neural-networks-seem-to-follow-a-puzzlingly-simple-strategy-to-classify-images-f4229317261f" target="_blank" rel="noopener noreferrer">https://medium.com/bethgelab/neural-networks-seem-to-follow-a-puzzlingly-simple-strategy-to-classify-images-f4229317261f</a> <a href="https://flyskypie.github.io/posts/2026-01-25_dequadtree-puzzle-game#user-content-fnref-cnn-puzzlingly-1a8114" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[一種機甲構想與 Nano Banana 使用筆記]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech</id>
        <link href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[背景]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="背景">背景<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E8%83%8C%E6%99%AF" class="hash-link" aria-label="Direct link to 背景" title="Direct link to 背景">​</a></h2>
<p>機戰傭兵 (Armored Core) 是一款我沒玩過的遊戲，但是很享受於它的衍生作品，包含遊戲預告、實機影片之類的。其中一個讓我感興趣的是機甲在遊戲中機動的方式：</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yFLYs8UzVVc?si=yRfRiO2BdN3A_bb4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>撇除誇張的瞬間噴射以及懸浮飛行以外，麥卡納姆輪 (Mecanum wheel) 在可控的室內平地同樣可以做出炫泡的機動：</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/I-tPQtsd-ls?si=M627JPSJSn4Rzoea" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>因為很炫泡，所以我想做，於是一個構想就在我腦海成型：</p>
<ul>
<li>以 50cm 的迷你尺度實現。</li>
<li>運行在草皮上，比室內平地粗曠，但是又保留考量可行性的平面。</li>
<li>四足機甲造型，四足設計用來作為主動式懸吊系統。</li>
<li>使用類似 ZIL-29061 螺旋輪結構，實現一般輪型或履帶型載具無法達成的漂移機動。</li>
<li>使用 360 攝影機實時進行 3D 點雲掃描與場景重建，因此可以在一個渲染的 3D 空間實現第三人稱操作（近似遊戲本身的體驗）。</li>
</ul>
<p>最近隨便用 Nano Banana 搓了一張概念圖，順便把這個想法做個筆記：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_mecha-b6b02bc26e5049e633b6de9cd62debed.webp" width="1014" height="686" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="nano-banana-使用筆記">Nano Banana 使用筆記<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#nano-banana-%E4%BD%BF%E7%94%A8%E7%AD%86%E8%A8%98" class="hash-link" aria-label="Direct link to Nano Banana 使用筆記" title="Direct link to Nano Banana 使用筆記">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>過程我省略原圖，所有使用過得原圖我放在文章最後面。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="第一次合成嘗試">第一次合成嘗試<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%88%E6%88%90%E5%98%97%E8%A9%A6" class="hash-link" aria-label="Direct link to 第一次合成嘗試" title="Direct link to 第一次合成嘗試">​</a></h3>
<p>提示詞：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">將第一章圖（水道橋重工機甲）的底盤改成第二張圖（ZiL-2906）的螺旋輪。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">保持原本的四足設計、將原本的兩個螺旋輪設計改成四個較小的尺寸的螺旋輪、對應原本的四足位置。 </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>結果：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_mecha-2878e1b548bb9c5dcb965eace3977ae5.webp" width="1344" height="784" class="img_RpFt"></p>
<p>左邊的東西很明顯是這個上下文讓模型推論出 bug 了，不能期望它 one shot 搞定了，於是後面採用不同的策略。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="提高解析度">提高解析度<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E6%8F%90%E9%AB%98%E8%A7%A3%E6%9E%90%E5%BA%A6" class="hash-link" aria-label="Direct link to 提高解析度" title="Direct link to 提高解析度">​</a></h3>
<p>第一次嘗試除了組裝失敗以外，底圖的解析度明顯太低，但是因為這張圖的角度剛剛好，所以我沒有再去尋找其他解析度比較高的圖片。</p>
<p>提示詞：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">提高畫質、提高解析度 </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="第一次預組裝">第一次預組裝<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%A0%90%E7%B5%84%E8%A3%9D" class="hash-link" aria-label="Direct link to 第一次預組裝" title="Direct link to 第一次預組裝">​</a></h3>
<p>將提昇過解析度的圖與第一次生成的螺旋輪做簡單的合成：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_gimp-edit-f14d83fda587afababe86816202e128f.webp" width="1440" height="920" class="img_RpFt"></p>
<p>之後再用 Nano Banana 進行揉合，提示詞：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">這是一個簡易合成的圖片，內容為四足人形機甲配上螺旋輪 (marsh screw)，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">有以下缺陷：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 不完整的去背</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 缺乏正確透視</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 機甲與螺旋輪缺乏真實的機械連接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你必須修復上述缺陷。 </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>結果：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_mecha-b9f7146327d1007bf4dacddd72afed25.webp" width="1152" height="912" class="img_RpFt"></p>
<p>提示詞：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">移除機甲的左右手，保留上半身與頭部</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>結果：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_mecha-444a45242e61db6bf7a3f231bdde4024.webp" width="1168" height="912" class="img_RpFt"></p>
<p>這個步驟是因為我不太喜歡人形這種高重心的設計，但是手部有部份遮擋到一些腿部，自行移除再修復有失敗的風險，乾脆一開始就用比較明確的語意讓 Banana 移除手部。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>我知道最後的圖還是重心偏高，但是我也說了：「隨便搓的」=3=</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="第二次預組裝">第二次預組裝<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%A0%90%E7%B5%84%E8%A3%9D" class="hash-link" aria-label="Direct link to 第二次預組裝" title="Direct link to 第二次預組裝">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_edit-0a2ad22feec763d72b85dc3c432ce3ac.webp" width="1440" height="921" class="img_RpFt"></p>
<p>提示詞：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">這是一個簡易合成的圖片，內容為四足機甲配上螺旋輪 (marsh screw)，配上砲塔以及格林機關槍，，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">有以下缺陷：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 機甲、砲塔、機關槍色彩不一致，將砲塔改成與機甲相同的德軍灰。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 缺乏正確透視</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 機甲-砲塔、砲塔-機關槍，兩個連接處缺乏真實的機械連接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你必須修復上述缺陷。</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>結果：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_mecha-283b4b1e36dc1bb5d8e7b59d0b1e70b3.webp" width="1248" height="832" class="img_RpFt"></p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="使用素材">使用素材<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E4%BD%BF%E7%94%A8%E7%B4%A0%E6%9D%90" class="hash-link" aria-label="Direct link to 使用素材" title="Direct link to 使用素材">​</a></h3>
<p>水道橋重工機甲<sup><a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fn-kuratasrobot-9ba084" id="user-content-fnref-kuratasrobot-9ba084" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/08_kuratasrobot-5eec4b3398c58d2cdf5ae6c3bdf3af0c.webp" width="580" height="435" class="img_RpFt"></p>
<p>ZiL-2906<sup><a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fn-zil-2906-9ba084" id="user-content-fnref-zil-2906-9ba084" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>:</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/09_ZiL-2906-43272980c7fc5762c5fe50f0fc99a250.webp" width="670" height="396" class="img_RpFt"></p>
<p>科幻戰車<sup><a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fn-scifi-tank-9ba084" id="user-content-fnref-scifi-tank-9ba084" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/10_scifi-tank-15b9c96a055a5207a8f881f3c8513f01.webp" width="992" height="544" class="img_RpFt"></p>
<p>格林機關槍<sup><a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fn-gatling-9ba084" id="user-content-fnref-gatling-9ba084" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/11_GAU8_A10-efeafba3ee5bb4b0dde805d0016ef2ce.webp" width="800" height="646" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="後記">後記<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#%E5%BE%8C%E8%A8%98" class="hash-link" aria-label="Direct link to 後記" title="Direct link to 後記">​</a></h2>
<p>後來稍微搜尋一下，發現 ZIL-29061 遙控車已經有人做了：</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wf4PqVhCTJA?si=SYqzQiLwQxDQE_VE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>所以除了四足機甲以外，其他部份的可行性算是已經被驗證過了（？）</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-kuratasrobot-9ba084">
<p>Suidobashi Heavy Industry – KURATAS – Retrenders. Retrieved 2026-01-25, from <a href="https://retrenders.com/2012/07/31/suidobashi-heavy-industry-kuratas/" target="_blank" rel="noopener noreferrer">https://retrenders.com/2012/07/31/suidobashi-heavy-industry-kuratas/</a> <a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fnref-kuratasrobot-9ba084" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-zil-2906-9ba084">
<p>ZIL Amphibious Screw Vehicles: a Cool Soviet Era Invention - autoevolution. Retrieved 2026-01-25, from <a href="https://www.autoevolution.com/news/zil-amphibious-screw-vehicles-a-cool-soviet-era-invention-79250.html" target="_blank" rel="noopener noreferrer">https://www.autoevolution.com/news/zil-amphibious-screw-vehicles-a-cool-soviet-era-invention-79250.html</a> <a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fnref-zil-2906-9ba084" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-scifi-tank-9ba084">
<p>Sci-fi Art: Mountain Urban Tank V07 | Coolvibe – Digital Art. Retrieved 2026-01-25, from <a href="https://coolvibe.com/2013/sci-fi-art-mountain-urban-tank-v07/" target="_blank" rel="noopener noreferrer">https://coolvibe.com/2013/sci-fi-art-mountain-urban-tank-v07/</a> <a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fnref-scifi-tank-9ba084" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-gatling-9ba084">
<p>GAU-8/A 30mm Gatling Gun.  Retrieved 2026-01-25, from <a href="https://www.gdots.com/armaments/aircraft-guns-gun-systems/gau8a/" target="_blank" rel="noopener noreferrer">https://www.gdots.com/armaments/aircraft-guns-gun-systems/gau8a/</a> <a href="https://flyskypie.github.io/posts/2026-01-25_marsh-screw-quadruped-mech#user-content-fnref-gatling-9ba084" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[TensorZero 筆記]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-22_tensorzero</id>
        <link href="https://flyskypie.github.io/posts/2026-01-22_tensorzero"/>
        <updated>2026-01-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>嘗試過 LiteLLM 和 Langfuse 的組合，LiteLLM 本身被我遇到錯誤實作的加密造成沒辦法設定 Langfuse Callback 的問題，Langfuse 則是仰賴的 ClickHouse 在缺乏設定的情況下在低端設備運作不太穩定，不只造成 CPU Lock，更在當機之後產生資料庫損毀無法正常運作的情況。</p>
<p>後來使用  Maxim AI 的 Bifrost，確有很高的代理失敗率（~6%），我用 Local Deep Research 跑一次搜尋要 4 次 LLM 請求，失敗一次就會造成整個研究失敗，換句話說有 22% 的機率會研究失敗，這蠻惱人的。</p>
<p>Bifrost 另外一個小問題是裡面埋了很多付費功能，主要是多租戶/多使用者管理一類的，雖然自架用不太到但是看著 UI 提醒你要買授權還是挺礙眼的。</p>
<p>最後決定再換一個 LLM 可觀測方案。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="tensorzero">TensorZero<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#tensorzero" class="hash-link" aria-label="Direct link to TensorZero" title="Direct link to TensorZero">​</a></h2>
<ul>
<li><a href="https://github.com/tensorzero/tensorzero" target="_blank" rel="noopener noreferrer">https://github.com/tensorzero/tensorzero</a>
<ul>
<li>10.8k ⭐</li>
</ul>
</li>
</ul>
<p>它使用前後端分離的架構，有 <code>gateway</code> 本體就能進行 LLM Gateway 了，如果需要使用可觀測 (LLM Observability) 的部份則必須設定 ClickHouse。</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/tensorzero/gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2026.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file /app/config/tensorzero.toml </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> OPENROUTER_API_KEY=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># - TENSORZERO_CLICKHOUSE_URL=http://clickhouse:clickhouse@clickhouse:8123/tensorzero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gateway</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/config/tensorzero.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3000:3000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ui</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/tensorzero/ui</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2026.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TENSORZERO_GATEWAY_URL=http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"4000:4000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="clickhouse">ClickHouse<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#clickhouse" class="hash-link" aria-label="Direct link to ClickHouse" title="Direct link to ClickHouse">​</a></h2>
<p>TensorZero 依然仰賴 ClickHouse 作為可觀測資料庫，不過既然有了前車之鑒，這次稍微在設定上做點功課。</p>
<blockquote>
<p>As an example, when using M-type CPUs, we recommend provisioning 100GB of memory per 25 CPU cores. <sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-clickhouse-hardware-604dec" id="user-content-fnref-clickhouse-hardware-604dec" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
</blockquote>
<blockquote>
<p><strong>Fortune 500 B2B SaaS</strong> <sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-clickhouse-hardware-604dec" id="user-content-fnref-clickhouse-hardware-604dec-2" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<table><thead><tr><th><em><strong>Storage</strong></em></th><th></th></tr></thead><tbody><tr><td><strong>Monthly new data volume</strong></td><td>30TB</td></tr><tr><td><strong>Total Storage (compressed)</strong></td><td>540TB</td></tr><tr><td><strong>Data retention</strong></td><td>18 months</td></tr><tr><td><strong>Disk per node</strong></td><td>25TB</td></tr><tr><td><em><strong>CPU</strong></em></td><td></td></tr><tr><td><strong>Concurrency</strong></td><td>200+ concurrent queries</td></tr><tr><td><strong># of replicas (including HA pair)</strong></td><td>44</td></tr><tr><td><strong>vCPU per node</strong></td><td>62</td></tr><tr><td><strong>Total vCPU</strong></td><td>2700</td></tr><tr><td><em><strong>Memory</strong></em></td><td></td></tr><tr><td><strong>Total RAM</strong></td><td>11TB</td></tr><tr><td><strong>RAM per replica</strong></td><td>256GB</td></tr><tr><td><strong>RAM-to-vCPU ratio</strong></td><td>4 GB:1</td></tr><tr><td><strong>RAM-to-disk ratio</strong></td><td>1:50</td></tr></tbody></table>
</blockquote>
<blockquote>
<p>For small amounts of data (up to ~200 GB compressed), it is best to use as much memory as the volume of data.<sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-clickhouse-tips-604dec" id="user-content-fnref-clickhouse-tips-604dec" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
</blockquote>
<blockquote>
<p>The recommended amount of RAM is 32 GB or more.<sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-clickhouse-tips-604dec" id="user-content-fnref-clickhouse-tips-604dec-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
</blockquote>
<p>種種跡象都顯示 ClickHouse 是為了大型業務需求設計的，對於 Homelab 這種小型使用者確實需要額外的設定。</p>
<p>於是我直接從網路上檢了別人的設定來用<sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-clickhouse-low-604dec" id="user-content-fnref-clickhouse-low-604dec" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>：</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary><code>config.xml</code> 和 <code>users.xml</code></summary><div><div class="collapsibleContent_UYJG"><div class="language-xml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-xml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- config.xml --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- These settinsg should allow to run clickhouse in nodes with 4GB/8GB RAM --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">clickhouse</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- disable some optional components/tables --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mysql_port</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">remove</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">postgresql_port</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">remove</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">query_thread_log</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">remove</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">opentelemetry_span_log</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">remove</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">processors_profile_log</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">remove</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- disable mlock, allowing binary pages to be unloaded from RAM, relying on Linux defaults --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mlock_executable</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mlock_executable</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- decrease the cache sizes --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mark_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">268435456</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mark_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 256 MB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">index_mark_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">67108864</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">index_mark_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 64 MB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">uncompressed_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">16777216</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">uncompressed_cache_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 16 MB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- control the concurrency --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_thread_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_thread_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_connections</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">64</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_connections</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_concurrent_queries</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_concurrent_queries</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_server_memory_usage_to_ram_ratio</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0.75</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_server_memory_usage_to_ram_ratio</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 75% of the RAM, leave more for the system --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_server_memory_usage</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_server_memory_usage</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- We leave the overcommiter to manage available ram for queries--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- reconfigure the main pool to limit the merges (those can create problems if the insert pressure is high) --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_merges_mutations_concurrency_ratio</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_merges_mutations_concurrency_ratio</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">merge_tree</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">merge_max_block_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1024</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">merge_max_block_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_bytes_to_merge_at_max_space_in_pool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1073741824</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_bytes_to_merge_at_max_space_in_pool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 1 GB max part--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_lower_max_size_of_merge</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_lower_max_size_of_merge</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_execute_mutation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_execute_mutation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_execute_optimize_entire_partition</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">number_of_free_entries_in_pool_to_execute_optimize_entire_partition</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Reduces memory usage during merges in system.metric_log table (enabled by default) by setting min_bytes_for_wide_part and vertical_merge_algorithm_min_bytes_to_activate to 128MB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">min_bytes_for_wide_part</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">134217728</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">min_bytes_for_wide_part</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vertical_merge_algorithm_min_bytes_to_activate</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">134217728</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">vertical_merge_algorithm_min_bytes_to_activate</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">merge_tree</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- shrink all pools to minimum--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_buffer_flush_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_buffer_flush_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_merges_mutations_scheduling_policy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">round_robin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_merges_mutations_scheduling_policy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_move_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_move_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_fetches_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_fetches_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_common_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_common_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_message_broker_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_message_broker_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">background_distributed_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">background_distributed_schedule_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tables_loader_foreground_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tables_loader_foreground_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tables_loader_background_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tables_loader_background_pool_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">clickhouse</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-xml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- users.xml --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">clickhouse</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profiles</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">default</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_threads</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_threads</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_block_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">8192</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_block_size</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">queue_max_wait_ms</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">queue_max_wait_ms</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_execution_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">600</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_execution_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input_format_parallel_parsing</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">input_format_parallel_parsing</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">output_format_parallel_formatting</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">output_format_parallel_formatting</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_bytes_before_external_group_by</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3221225472</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_bytes_before_external_group_by</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 3 GB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">max_bytes_before_external_sort</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3221225472</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">max_bytes_before_external_sort</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 3 GB --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">default</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profiles</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">clickhouse</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>不過 <code>max_concurrent_queries</code> 設成 8 在我的用例有點太少了，TensorZero 那邊會噴錯誤，所以我稍微調高到 100。（預設值是 0，沒有限制）</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="基本使用">基本使用<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to 基本使用" title="Direct link to 基本使用">​</a></h2>
<p>TensorZero 比較討厭的是它的官方文件會一直找機會推銷自己設計的 API：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST "http://localhost:3000/inference" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H "Content-Type: application/json" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d '{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "function_name": "generate_haiku",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "input": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "messages": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "role": "user",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "content": "Write a haiku about TensorZero."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }'</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不然就是使用自己特殊的 <code>function_name</code> 設計（等等會解釋這個東西）：</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> OpenAI </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"openai"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OpenAI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  baseURL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:3000/openai/v1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"tensorzero::function_name::generate_haiku"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      role</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Write a haiku about TensorZero."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是 TensorZero 本身是 OpenAI API 兼容的：</p>
<div class="language-typescript codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-typescript codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://awesome-tensorzero-service:8123/openai/v1/chat/completions"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string-property property" style="color:#36acaa">"Authorization"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer ANY</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"Content-Type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"application/json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"model"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"tensorzero::model_name::openrouter::openai/gpt-oss-20b"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"messages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"role"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"system"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"content"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"You are a helpful assistant."</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"role"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"content"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Hi"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"modalities"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"text"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>只要在環境變數針對特定的供應商 (Provider) 設定好 API key （例如：<code>OPENROUTER_API_KEY</code>），使用以下格式就可以直接調用對應的模型：</p>
<div class="language-plaintext codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-plaintext codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">tensorzero::model_name::&lt;PROVIDER&gt;::&lt;MODEL_NAME&gt;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>PROVIDER</code> 是 TensorZero 有實作支援的部份，具體清單請見官方文件<sup><a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fn-provider-604dec" id="user-content-fnref-provider-604dec" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="缺乏-reasoning">缺乏 Reasoning<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E7%BC%BA%E4%B9%8F-reasoning" class="hash-link" aria-label="Direct link to 缺乏 Reasoning" title="Direct link to 缺乏 Reasoning">​</a></h2>
<p>使用一陣子之後第一個觀察到的問題是缺少 Reasoning，不論是可觀測紀錄本身，或是 client 的 request 有帶上 Reasoning 的參數，都沒辦法獲得。</p>
<p>發現問題的當下，剛好被開發人員標記沒多久：</p>
<p><a href="https://github.com/tensorzero/tensorzero/issues/5703" target="_blank" rel="noopener noreferrer">Add reasoning support to OpenRouter model provider · Issue #5703 · tensorzero/tensorzero</a></p>
<p>幾天後撰寫本文的時候(2026-01-22)，再次查看似乎已經被解決了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="進階使用">進階使用<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E9%80%B2%E9%9A%8E%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to 進階使用" title="Direct link to 進階使用">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>除了基本使用，其他功能我並沒有親自實測（使用），單純是根據我閱讀文件的理解整理的。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>以下皆以 OpenAI API 舉例，畢竟已經是實質產業標準了。TensorZero 自己的 API 格式我完全沒興趣研究。</p></div></div>
<p>第一種是剛剛提過得，使用內建的 Provider 直接呼叫模型：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_tensorzero-eb290cd113bc05dd8508735fda6ba853.webp" width="674" height="530" class="img_RpFt"></p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="自定義模型">自定義模型<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E8%87%AA%E5%AE%9A%E7%BE%A9%E6%A8%A1%E5%9E%8B" class="hash-link" aria-label="Direct link to 自定義模型" title="Direct link to 自定義模型">​</a></h3>
<p>第二種是在組態檔裡配置自定義的模型：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_tensorzero-64e1bb4be1f8f283f4910b4a4e542f12.webp" width="657" height="701" class="img_RpFt"></p>
<p>一個自訂模型可以有多個 Provider/Routing，用來當作備援 (Fallbacks)，當一個 Provider 失敗會自動使用其他設定的 Routing，例如：</p>
<div class="language-toml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-toml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">[models.my_gpt_5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routing = ["my_openai_provider", "my_azure_provider"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[models.my_gpt_5.providers.my_openai_provider]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = "openai"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_name = "gpt-5"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[models.my_gpt_5.providers.my_azure_provider]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = "azure"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment_id = "gpt-5"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endpoint = "https://your-resource.openai.azure.com"</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="自定義函數">自定義函數<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#%E8%87%AA%E5%AE%9A%E7%BE%A9%E5%87%BD%E6%95%B8" class="hash-link" aria-label="Direct link to 自定義函數" title="Direct link to 自定義函數">​</a></h3>
<p>第三種是在組態檔裡配置自定義的函數：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_tensorzero-8e41d13eb9e9f5048809ae33bec79aa1.webp" width="726" height="646" class="img_RpFt"></p>
<p>可以使用標準的 Provider 和 Model；或是前一種自定義模型。另外除了備援之外，函數可以用來建立實驗 (Experimentation) 來進行 A/B 測試。</p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-clickhouse-hardware-604dec">
<p>Sizing and hardware recommendations | ClickHouse Docs. Retrieved 2026-01-22, from <a href="https://clickhouse.com/docs/guides/sizing-and-hardware-recommendations" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/guides/sizing-and-hardware-recommendations</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-clickhouse-hardware-604dec" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-clickhouse-hardware-604dec-2" data-footnote-backref="" aria-label="Back to reference 1-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li id="user-content-fn-clickhouse-tips-604dec">
<p>OSS usage recommendations | ClickHouse Docs. Retrieved 2026-01-22, from <a href="https://clickhouse.com/docs/operations/tips" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/operations/tips</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-clickhouse-tips-604dec" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-clickhouse-tips-604dec-2" data-footnote-backref="" aria-label="Back to reference 2-2" class="data-footnote-backref">↩<sup>2</sup></a></p>
</li>
<li id="user-content-fn-clickhouse-low-604dec">
<p>Configure ClickHouse® for low memory environments | Altinity® Knowledge Base for ClickHouse®. Retrieved 2026-01-22, from <a href="https://kb.altinity.com/altinity-kb-setup-and-maintenance/configure_clickhouse_for_low_mem_envs/" target="_blank" rel="noopener noreferrer">https://kb.altinity.com/altinity-kb-setup-and-maintenance/configure_clickhouse_for_low_mem_envs/</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-clickhouse-low-604dec" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-provider-604dec">
<p>Overview - TensorZero Docs. Retrieved 2026-01-22, from  <a href="https://www.tensorzero.com/docs/integrations/model-providers" target="_blank" rel="noopener noreferrer">https://www.tensorzero.com/docs/integrations/model-providers</a> <a href="https://flyskypie.github.io/posts/2026-01-22_tensorzero#user-content-fnref-provider-604dec" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="LLM Observability" term="LLM Observability"/>
        <category label="LLM Gateway" term="LLM Gateway"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[XPU 運行 Zero123++ 筆記 (Intel PyTorch)]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch</id>
        <link href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch"/>
        <updated>2026-01-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p><a href="https://github.com/SUDO-AI-3D/zero123plus" target="_blank" rel="noopener noreferrer">Zero123++</a> 是第一個我想要自己跑得模型，它是一個「多視圖重建」模型，通常作為 「2D image to 3D model」的前置處理。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_zero123plus-fae9d72604440c6ec795225077785d6e.webp" width="2560" height="1504" class="img_RpFt"></p>
<p>我對它有興趣有幾個原因，首先我對生成式 3D 模型有不小的興趣，對於獨立開發而言，經常使用基於 2D 的呈現方式，往往是受限於 3D 建模的成本高昂所致。</p>
<p>比起單純的文字提示詞生成，二維圖像生成三維模型具有有更高的可控性。在類神經模型領域，比起「one shot」我更喜歡將一個大問題切成數個小問題的方式，每個小問題都是單純的資料轉換過程，讓整體算法具有更高的透明度，以及更為可控的行為。並且正如我提到的，Zero123++ 是整個 「2D image to 3D model」 資料流 (pipeline) 的一個關鍵環節。</p>
<p>從高維度的資料萃取特徵，或是轉換成其他低微度資料，是一個不那麼有趣的過程。反之，「多視圖重建」本質是一個提高資料維度任務，因此是一個不適定問題 (ill-posed problem)，不知道為什麼我對這類問題反而比較興奮（？）</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_wakuwaku-6cc867d0237ae2c01ebec9991a3af955.webp" width="750" height="500" class="img_RpFt"></p>
<p>至於為什麼要「自己跑」呢？因為這種需求算不上特別普遍，不像 LLM 已經有不少雲端供應商可以拿 API 直接打，這種野雞模型幾乎只能自己想辦法。</p>
<p>BUT，要運行 Zero123++ 需要大約 5GB 的 vRAM，我手上支援 CUDA 的外接 GPU 只有 4GB，這也是為什麼它是我「想自己跑」而不是「自己跑過」的模型...</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_vram-6c428a9d7437d4a07f60d2c1f210d3a7.webp" width="1200" height="675" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="ram-就是-ram">RAM 就是 RAM<a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#ram-%E5%B0%B1%E6%98%AF-ram" class="hash-link" aria-label="Direct link to RAM 就是 RAM" title="Direct link to RAM 就是 RAM">​</a></h2>
<p>最近突然心想：</p>
<blockquote>
<p>vRAM 來 vRAM 去的，啊不然我的內顯也是顯卡唄，它有多少 vRAM？</p>
</blockquote>
<p>於是我試著下了個指令：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ glxinfo | grep -E -i 'device|memory'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Device: Mesa Intel(R) Iris(R) Xe Graphics (RPL-P) (0xa7a0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Video memory: 23941MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unified memory: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_AMD_performance_monitor, GL_AMD_pinned_memory, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_framebuffer_object, GL_EXT_framebuffer_sRGB, GL_EXT_memory_object, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_memory_object_fd, GL_EXT_packed_depth_stencil, GL_EXT_packed_float, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_AMD_pinned_memory, GL_AMD_query_buffer_object, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_gpu_program_parameters, GL_EXT_gpu_shader4, GL_EXT_memory_object, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_memory_object_fd, GL_EXT_multi_draw_arrays, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_instanced_arrays, GL_EXT_map_buffer_range, GL_EXT_memory_object, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GL_EXT_memory_object_fd, GL_EXT_multi_draw_arrays,</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>恩？我什麼時候 vRAM 自由了？</p>
<p>學習了一下才知道 GPU 和 RAM 之間有著頻寬限制，於是 Nvidia 乾脆把 RAM 塞進 GPU 內變成 vRAM，高度整合帶來的優勢就是速度提昇。</p>
<p>但是我不管啊，我就窮啊，要我等可以等啊，明明就有 RAM 卻不給我跑是怎樣？</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_ram-is-ram-e635e7da25f6ae75970df62619ed2e9f.webp" width="824" height="458" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="zluda">ZLUDA<a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#zluda" class="hash-link" aria-label="Direct link to ZLUDA" title="Direct link to ZLUDA">​</a></h2>
<p>當世界壟罩在 Nvidia 的 CUDA 的淫威（？）之下，我越想越覺得這個走向不太對勁，為什麼我想要跑個軟體需要被特定的硬體綁架？vRAM 不夠，請買更多？為什麼用低階設備跑的妥協不存在？</p>
<p>於是最近我其實默默的在蒐集「反 CUDA 對策」口袋清單：</p>
<ul>
<li><a href="https://github.com/jgbit/vuda" target="_blank" rel="noopener noreferrer">https://github.com/jgbit/vuda</a>
<ul>
<li>901 ⭐</li>
</ul>
</li>
<li><a href="https://github.com/vosen/ZLUDA" target="_blank" rel="noopener noreferrer">https://github.com/vosen/ZLUDA</a>
<ul>
<li>13.8k ⭐</li>
</ul>
</li>
</ul>
<p>VUDA 使用的是替換標頭檔的方式處理：</p>
<div class="language-cpp codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-cpp codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">defined</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">__NVCC__</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;cuda_runtime.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;vuda_runtime.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是這在已經編譯、打包好的 Python 環境顯得不太有效。</p>
<p>反觀，ZLUDA 的處理方式就簡單的多：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">LD_LIBRARY_PATH="&lt;ZLUDA_DIRECTORY&gt;:$LD_LIBRARY_PATH" &lt;APPLICATION&gt; &lt;APPLICATION_ARGUMENTS&gt;</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>也就是直接用實做了 CUDA 界面的動態函式庫直接替換真正的 CUDA。</p>
<p>不過實際試過之後發現不能如預期的運行，調查了一下發現雖然 ZLUDA 自稱「CUDA on non-NVIDIA GPUs」，但是它的首要支援 (First class) 是 Windows + AMD。至於 Intel 嘛...翻來翻去才找到我要的解釋：</p>
<blockquote>
<p>Firstly, if you simply want those frameworks to run on an Intel GPUs, then ZLUDA might not be the best way. Deep Learning is quite high on the Intel priority list. Every major framework (certainly PyTorch, Tensorflow, MXNet, PaddlePaddle) has a dedicated team working on it to bring the best performance on CPU and GPU.
...
cuDNN API is really massive, it is a lot of work<sup><a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fn-zluda-pytorch-d0e8de" id="user-content-fnref-zluda-pytorch-d0e8de" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
</blockquote>
<p>這才知道 Intel 本身就有在這方面做一些努力，並且工作量也十分龐大，因此 ZLUDA 專案並不優先處理這方面 (Intel) 的需求。</p>
<p>加上 ZLUDA 專案本身跟 AMD 就走得比較近，底層實做也高度仰賴 ROCm <sup><a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fn-zluda-amd-d0e8de" id="user-content-fnref-zluda-amd-d0e8de" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="intel-extension-for-pytorch">Intel Extension for PyTorch<a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#intel-extension-for-pytorch" class="hash-link" aria-label="Direct link to Intel Extension for PyTorch" title="Direct link to Intel Extension for PyTorch">​</a></h2>
<ul>
<li>Intel Extension for PyTorch<!-- -->
<ul>
<li>2k ⭐</li>
</ul>
</li>
</ul>
<p>有一些教學會說要安裝 oneAPI，一開始我也照做了，但是問題依然無法排除，直到我看到：</p>
<blockquote>
<p>When using torch-xpu from the PyTorch channel, <strong>you do not need to manually source your oneAPI environment</strong>. Instead, you can install it directly as follows:</p>
</blockquote>
<p>所以關於 oneAPI 的東西我這裡就不提了。</p>
<p>而 Intel 官方的安裝指引則是如下<sup><a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fn-intel-torch-install-d0e8de" id="user-content-fnref-intel-torch-install-d0e8de" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">python -m pip install torch==2.8.0 torchvision==0.23.0 torchaudio==2.8.0 --index-url https://download.pytorch.org/whl/xpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -m pip install intel-extension-for-pytorch==2.8.10+xpu --extra-index-url https://pytorch-extension.intel.com/release-whl/stable/xpu/us/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -m pip install oneccl_bind_pt==2.8.0+xpu --index-url https://pytorch-extension.intel.com/release-whl/stable/xpu/us/</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>翻譯成 PDM 大概長這樣：</p>
<div class="language-toml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-toml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># pyproject.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dependencies = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "torch==2.8.0",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "torchvision==0.23.0",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "torchaudio==2.8.0",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "intel-extension-for-pytorch==2.8.10+xpu",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "oneccl_bind_pt==2.8.0+xpu",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tool.pdm.scripts]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start.cmd = "python examples/img_to_mv.py"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start.env = { OverrideDefaultFP64Settings = "1", IGC_EnableDPEmulation = "1" }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[tool.pdm.source]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = "pytorch"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url = "https://download.pytorch.org/whl/xpu"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include_packages = ["torch", "torchvision", "torchaudio", "pytorch-triton-xpu"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exclude_packages = ["*"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[tool.pdm.source]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = "intel"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url = "https://pytorch-extension.intel.com/release-whl/stable/xpu/us/"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include_packages = ["intel-extension-for-pytorch", "oneccl_bind_pt"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exclude_packages = ["*"]</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>這兩個環境變數則是用來修復 <code>UR error</code> 的問題<sup><a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fn-ur-error-d0e8de" id="user-content-fnref-ur-error-d0e8de" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">set OverrideDefaultFP64Settings=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set IGC_EnableDPEmulation=1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最後成功花了 15 分鐘把這個：</p>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="256" height="256" class="img_RpFt"></p>
<p>變成這個：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_output-d847a67d4642c6a2f685a798ef3ed310.webp" width="640" height="960" class="img_RpFt"></p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-zluda-pytorch-d0e8de">
<p>Any plans for testing this with Pytorch/Tensorflow/mxnet? · Issue #17 · vosen/ZLUDA. <a href="https://github.com/vosen/ZLUDA/issues/17" target="_blank" rel="noopener noreferrer">https://github.com/vosen/ZLUDA/issues/17</a> <a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fnref-zluda-pytorch-d0e8de" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-zluda-amd-d0e8de">
<p>讓 IntelAMD GPU 直接跑 CUDA 程式的 ZLUDA – Gea-Suan Lin's BLOG. Retrieved 2026-01-22, from <a href="https://blog.gslin.org/archives/2024/02/13/11655/%E8%AE%93-intelamd-gpu-%E7%9B%B4%E6%8E%A5%E8%B7%91-cuda-%E7%A8%8B%E5%BC%8F%E7%9A%84-zluda/" target="_blank" rel="noopener noreferrer">https://blog.gslin.org/archives/2024/02/13/11655/%E8%AE%93-intelamd-gpu-%E7%9B%B4%E6%8E%A5%E8%B7%91-cuda-%E7%A8%8B%E5%BC%8F%E7%9A%84-zluda/</a> <a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fnref-zluda-amd-d0e8de" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-intel-torch-install-d0e8de">
<p>Intel® Extension for PyTorch* Installation Guide. Retrieved 2026-01-22, from <a href="https://pytorch-extension.intel.com/installation" target="_blank" rel="noopener noreferrer">https://pytorch-extension.intel.com/installation</a> <a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fnref-intel-torch-install-d0e8de" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-ur-error-d0e8de">
<p>RuntimeError: UR error on ADL-N with IPEX 2.5/2.6 using .to(torch.float16) · Issue #800 · intel/intel-extension-for-pytorch. <a href="https://github.com/intel/intel-extension-for-pytorch/issues/800#issuecomment-3166243912" target="_blank" rel="noopener noreferrer">https://github.com/intel/intel-extension-for-pytorch/issues/800#issuecomment-3166243912</a> <a href="https://flyskypie.github.io/posts/2026-01-22_zero123plus-intel-pytorch#user-content-fnref-ur-error-d0e8de" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bifrost 採坑筆記]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-18_bifrost</id>
        <link href="https://flyskypie.github.io/posts/2026-01-18_bifrost"/>
        <updated>2026-01-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[試用了 Bifrost 大概九天，有很高的請求失敗率（~6%）：]]></summary>
        <content type="html"><![CDATA[
<p>試用了 Bifrost 大概九天，有很高的請求失敗率（~6%）：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_bifrost-6c4dc2fc719fc17599b35a84ae54680d.webp" width="1440" height="835" class="img_RpFt"></p>
<p>少數是可以透過修改應用層級的超時 (Timeout) 配置改善的，不過多數是實作本身的問題，預計下一個要嘗試的是 TensorZero ，不過在更換前先把 Bifrost 的問題紀錄一下。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="io-timeout"><code>i/o timeout</code><a href="https://flyskypie.github.io/posts/2026-01-18_bifrost#io-timeout" class="hash-link" aria-label="Direct link to io-timeout" title="Direct link to io-timeout">​</a></h2>
<p><img decoding="async" loading="lazy" src="data:image/webp;base64,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" width="629" height="258" class="img_RpFt"></p>
<p>這個 bug 看起來已經被紀錄在案一個月了，但是還沒有被修復：</p>
<p><a href="https://github.com/maximhq/bifrost/issues/1157" target="_blank" rel="noopener noreferrer">[Bug]: Getting I/O timeout · Issue #1157 · maximhq/bifrost</a></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="websocket-異常">Websocket 異常<a href="https://flyskypie.github.io/posts/2026-01-18_bifrost#websocket-%E7%95%B0%E5%B8%B8" class="hash-link" aria-label="Direct link to Websocket 異常" title="Direct link to Websocket 異常">​</a></h2>
<p>原本 Logs 頁面是會自動更新的，但是不知道為什麼不能正常運作，後台則有大量的錯誤訊息：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">{"level":"error","time":"2026-01-18T01:03:28Z","message":"websocket upgrade error: websocket: request origin not allowed by FastHTTPUpgrader.CheckOrigin"}</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="LLM Observability" term="LLM Observability"/>
        <category label="LLM Gateway" term="LLM Gateway"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[LLM 可觀測筆記]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-15_llm-observability</id>
        <link href="https://flyskypie.github.io/posts/2026-01-15_llm-observability"/>
        <updated>2026-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天觀察到一個有趣的現象，紀錄一下。]]></summary>
        <content type="html"><![CDATA[
<p>今天觀察到一個有趣的現象，紀錄一下。</p>
<p>原始請求：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"> You will have follow up questions. First, identify if your knowledge is outdated (high chance). Today: 2026-01-15. Generate 3 high-quality internet search questions to exactly answer: Which text structure is better for LLM prompts?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Markdown based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- XML based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consider the case with a task have multiple output, output blocks with XML tags seems is more reliable approach?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Language Rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process the task in English (sort questions, search with English, search ranking...). </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Only final response (the task is doing Summary) with Chinese (zh_TW).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Format: One question per line, e.g. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Q: question1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Q: question2</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>LLM 的回答：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">以下是三個高品質的搜尋問題，適用於查詢 Markdown 與 XML 在 LLM 提示語中的可靠性比較：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Is XML-based prompt structure more reliable than Markdown for multi-output LLM tasks?  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: What are the advantages and disadvantages of Markdown-based vs XML-based prompt structures for large language models?  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Does XML-based output formatting improve consistency and parsing reliability compared to Markdown in LLM prompts?</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不過 OpenAI API 其實也會透露推理過程（Reasoning）：</p>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">We need to respond: "You will have follow up questions. First, identify if your knowledge is outdated (high chance). Today: 2026-01-15. Generate 3 high-quality internet search questions to exactly answer: Which text structure is better for LLM prompts? - Markdown based - XML based Consider the case with a task have multiple output, output blocks with XML tags seems is more reliable approach? Language Rules: Process the task in English (sort questions, search with English, search ranking...). Only final response (the task is doing Summary) with Chinese (zh_TW). Format: One question per line, e.g. Q: question1 Q: question2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We need to produce 3 search questions. They must be high-quality, for search queries. Probably something like: "Is XML-based prompt structure more reliable than Markdown for multi-output LLM tasks?" etc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We need to output only the final response with Chinese (zh_TW). That means the final output should be Chinese? But the questions themselves are in English. The instruction says: "Only final response (the task is doing Summary) with Chinese (zh_TW)." Wait. The user wants 3 high-quality internet search questions to exactly answer the query. But then the system says only final response with Chinese. That seems contradictory. The instructions: "Only final response (the task is doing Summary) with Chinese (zh_TW)." So the final response should be in Chinese. But the format: "One question per line, e.g. Q: question1 Q: question2". That format presumably remains. But the content is in English? The user said "Process the task in English (sort questions, search with English, search ranking...). Only final response (the task is doing Summary) with Chinese (zh_TW)."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">So we need to produce the final response in Chinese. But the questions themselves? The example shows "Q: question1" etc, presumably in English. But the final response should be in Chinese. Maybe we can write the questions in Chinese? But the instruction says "Process the task in English". That might refer to sorting, search queries, etc. But the final output should be Chinese. So maybe we produce the questions in Chinese? Or we produce them in English but the final response is Chinese? The example is in English.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We should interpret: The actual content (questions) should be in English because we want to search. But the final response (the entire output) should be in Chinese. So we can say:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Is using XML tags for multi-output LLM prompts more reliable than using Markdown formatting? </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: What are the advantages and disadvantages of Markdown-based vs XML-based prompt structures for large language models? </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: In LLM prompt design, does XML-based output formatting improve consistency and parsing reliability compared to Markdown?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">But we must output this in Chinese. Maybe we can translate the entire set into Chinese? But then the search queries would be in Chinese, which might not be as effective for search. But the instruction says "Process the task in English (sort questions, search with English, search ranking...). Only final response (the task is doing Summary) with Chinese (zh_TW)." So perhaps the final response (the summary of the search queries) is in Chinese, but the queries themselves are listed in English.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thus we produce:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Is XML-based prompt structure more reliable than Markdown for multi-output LLM tasks?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">But maybe we need to phrase them as search queries. So maybe like:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "XML vs Markdown prompt structure reliability for multiple outputs in LLM"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "Advantages of XML tags in LLM prompt design over Markdown formatting"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "How does XML-based output block improve consistency and parsing for LLM prompts compared to Markdown"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">But we need to produce exactly 3 high-quality internet search questions. We'll produce them as:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "Is XML-based prompt structure more reliable than Markdown for multi-output LLM tasks?"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "What are the advantages and disadvantages of Markdown-based vs XML-based prompt structures for large language models?"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: "Does XML-based output formatting improve consistency and parsing reliability compared to Markdown in LLM prompts?"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Then we output in Chinese: "以下是三個高品質的搜尋問題..." But we need to follow the format: one question per line, prefixed with Q:. That format likely stays in English. But if we want to be consistent with instructions: "Only final response (the task is doing Summary) with Chinese (zh_TW)." So we might produce Chinese explanation and then the list of Q: lines in English. But the output must be Chinese. So maybe we can put the questions in Chinese too. But then they'd not be English search queries. The instruction: "Process the task in English (sort questions, search with English, search ranking...). Only final response (the task is doing Summary) with Chinese (zh_TW)." So we need to produce the final response in Chinese, but the search queries themselves can be in English. But we need to output them as part of the final response. The final response should be in Chinese, but we can include English lines. It's ambiguous.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Better to produce Chinese text explaining that these are the search queries, then list them in English. That keeps final response Chinese. So:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">以下是三個高品質的搜尋問題，適用於查詢 Markdown 與 XML 在 LLM 提示語中的可靠性比較：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Is XML-based prompt structure more reliable than Markdown for multi-output LLM tasks?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: What are the advantages and disadvantages of Markdown-based vs XML-based prompt structures for large language models?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Does XML-based output formatting improve consistency and parsing reliability compared to Markdown in LLM prompts?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We can do that. That satisfies the instructions.</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>But then the system says only final response with Chinese. That seems contradictory.</p>
</blockquote>
<p>指出當下的提示詞對 LLM 來說可能不夠直觀，Reasoning 的內容在一般的 LLM 應用程式基本上是不可見的，但是它似乎是調試提示詞的重要工具。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="LLM Observability" term="LLM Observability"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[自架搜尋引擎套餐 (YaCy + SearXNG + Local Deep Research)]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-12_search-engine</id>
        <link href="https://flyskypie.github.io/posts/2026-01-12_search-engine"/>
        <updated>2026-01-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天 (2026-01-12) 處理了一些 YaCy 跟 SearXNG 的故障排除，做個紀錄。]]></summary>
        <content type="html"><![CDATA[
<p>今天 (2026-01-12) 處理了一些 YaCy 跟 SearXNG 的故障排除，做個紀錄。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/00_cover-3c93848b192b398bc68fbf431b8908c8.webp" width="1320" height="600" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="https://flyskypie.github.io/posts/2026-01-12_search-engine#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<p>故事得從我最近愛用的 LLM 工具 LDR (<a href="https://github.com/LearningCircuit/local-deep-research" target="_blank" rel="noopener noreferrer">Local Deep Research</a>) 說起，LDR 能夠根據使用者的輸入拆分成數個 LLM 任務：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_local-deep-research-requests-68b55038b1b5be6ace8f9f5a9f7ee94c.webp" width="1191" height="309" class="img_RpFt"></p>
<p>其中一個任務長得像這樣：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_local-deep-research-task-ce78abea34956dad79bb826899acc988.webp" width="631" height="329" class="img_RpFt"></p>
<p>將使用者原始輸入轉換成精簡的搜尋引擎關鍵字之後，呼叫 <a href="https://github.com/searxng/searxng" target="_blank" rel="noopener noreferrer">SearXNG</a> 來取得搜尋結果。</p>
<p>SearXNG 本身不實做搜尋引擎，而是作為代理去呼叫多個搜尋引擎，諸如 Google, Bing, DuckDuckGo...</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_ldr-dependency-b88f787f7add166167f1a036e5c3c395.webp" width="1251" height="460" class="img_RpFt"></p>
<p>於是乎有時後會發生這種事情：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_search-error-04c944a86d78b1dce28146a1c4097c4f.webp" width="1171" height="312" class="img_RpFt"></p>
<p>呼叫太頻繁被外部的搜尋引擎封鎖，造成有的時候 LDR 會「研究失敗」，因為沒有可靠的外部資訊來源。</p>
<p>我架設 LDR 時使用官方的預設組態，沒有特別設定 SearXNG，於是想說趁這個機會改善這個問題。以上圖為例， 我被 Brave 搜尋引擎擋了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="天下沒有白吃的午餐">天下沒有白吃的午餐<a href="https://flyskypie.github.io/posts/2026-01-12_search-engine#%E5%A4%A9%E4%B8%8B%E6%B2%92%E6%9C%89%E7%99%BD%E5%90%83%E7%9A%84%E5%8D%88%E9%A4%90" class="hash-link" aria-label="Direct link to 天下沒有白吃的午餐" title="Direct link to 天下沒有白吃的午餐">​</a></h2>
<p>老實說我不會特別怪罪搜尋引擎投放廣告、過濾內容...，畢竟：</p>
<blockquote>
<p>當使用者沒有為服務付費，使用者本身就是產品，而不是消費者。</p>
</blockquote>
<p>搜尋引擎自己有自己的營利模型，而 SearXNG 的使用者幾乎就是繞過這些措施白嫖搜尋引擎，即便搜尋引擎供應商本身有它的原罪，我也不認為應該正當化白嫖的行為。</p>
<p>找來找去，<a href="https://github.com/yacy/yacy_search_server" target="_blank" rel="noopener noreferrer">YaCy</a> 似乎是比較合理的方案，它是一個去中心化的搜尋引擎，能夠透過 P2P (Peer-to-peer) 的方式分享索引資訊跟分散爬蟲任務。</p>
<p>網際網路巨大無比，只靠自己建立與維護索引資料根本癡心妄想，YaCy 在這方面就相對理想，讓一群人分散 Google 這種資訊巨獸才能建立的資料庫難度。</p>
<p>話雖如此，架設過程才發現要對外暴露埠才能對整個 YaCy 網路進行貢獻：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_yacy-error-98ccb5c1af8cbcc81e0098a214ac581f.webp" width="1154" height="201" class="img_RpFt"></p>
<p>目前我的 Homelab 出於安全性考慮是沒有對外暴露的，不過我依然可以在本地建立自己的索引資料庫，至於「做出貢獻」這件事大概要緩緩以後再來處理了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="k8s-故障排除">K8s 故障排除<a href="https://flyskypie.github.io/posts/2026-01-12_search-engine#k8s-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4" class="hash-link" aria-label="Direct link to K8s 故障排除" title="Direct link to K8s 故障排除">​</a></h2>
<p>架設的過程有遇到一點問題，在這邊紀錄一下問題跟解決辦法。</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl logs yacy-0 -n search-stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">****************** YaCy Web Crawler/Indexer &amp; Search Engine *******************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**** (C) by Michael Peter Christen, usage granted under the GPL Version 2  ****</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">****   USE AT YOUR OWN RISK! Project home and releases: https://yacy.net/  ****</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  LOG of       YaCy: DATA/LOG/yacy00.log (and yacy&lt;xx&gt;.log)                **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  STOP         YaCy: execute stopYACY.sh and wait some seconds             **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**  GET HELP for YaCy: join our community at https://community.searchlab.eu  **</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ YaCy v1.940 by Michael Christen / www.yacy.net ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:04 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: * could not create directories /opt/yacy_search_server/DATA/LOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">could not copy yacy.logging: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP: Trying to load logging configuration from file /opt/yacy_search_server/DATA/LOG/yacy.logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">could not find logging properties in homePath=/opt/yacy_search_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:04 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: * java.io.FileNotFoundException: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.io.FileNotFoundException: /opt/yacy_search_server/DATA/LOG/yacy.logging (No such file or directory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.open0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.open(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.FileInputStream.&lt;init&gt;(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.cora.util.ConcurrentLog.configureLogging(ConcurrentLog.java:385)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.startup(yacy.java:180)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.main(yacy.java:832)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:05 AM net.yacy.cora.util.ConcurrentLog enQueueLog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SEVERE: * FATAL ERROR: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.io.IOException: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.UnixFileSystem.createFileExclusively0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.UnixFileSystem.createFileExclusively(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at java.base/java.io.File.createNewFile(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.startup(yacy.java:194)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at net.yacy.yacy.main(yacy.java:832)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jan 12, 2026 11:49:05 AM net.yacy.cora.util.ConcurrentLog shutdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: shutdown of ConcurrentLog.Worker void because it was not running.</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>典型的容器權限問題，在 K8s 可以透過 <code>securityContext</code> 處理：</p>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsUser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">fsGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是該如何找到正確的 UID 和 GID 呢？OCI image 調查神器：<a href="https://github.com/wagoodman/dive" target="_blank" rel="noopener noreferrer">dive</a></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_dive-yacy-4380099a0d4e3e3bfa90e22d9938ab1f.webp" width="1440" height="853" class="img_RpFt"></p>
<p>SearXNG 也有類似的問題：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_dive-searxng-b0b27156137503e7901c23830e4ea805.webp" width="1440" height="859" class="img_RpFt"></p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="homelab" term="homelab"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[LLM 可觀測筆記]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-08_llm-observability</id>
        <link href="https://flyskypie.github.io/posts/2026-01-08_llm-observability"/>
        <updated>2026-01-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[其實自我架設 LLM 可觀測工具 (2025-10-05) 以後，陸續嘗試幾款 LLM 工具有獲得一些觀察，不過當時因為覺得缺乏嚴謹考證所以沒有發文，不過現在我可以說是往下一個階段前進了（？），大概也沒有做嚴謹實驗的計畫，就把當時的紀錄發出來水一篇廢文好了。]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/00_cover-14435b79b73ad7d429eb4e7f1d68b5ff.webp" width="620" height="382" class="img_RpFt"></p>
<p>其實自<a href="https://flyskypie.github.io/posts/2025-10-05_llm-api-chain/" target="_blank" rel="noopener noreferrer">我架設 LLM 可觀測工具</a> (2025-10-05) 以後，陸續嘗試幾款 LLM 工具有獲得一些觀察，不過當時因為覺得缺乏嚴謹考證所以沒有發文，不過現在我可以說是往下一個階段前進了（？），大概也沒有做嚴謹實驗的計畫，就把當時的紀錄發出來水一篇廢文好了。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="llm-可觀測">LLM 可觀測<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#llm-%E5%8F%AF%E8%A7%80%E6%B8%AC" class="hash-link" aria-label="Direct link to LLM 可觀測" title="Direct link to LLM 可觀測">​</a></h2>
<p>這邊簡單跟不知道發生什麼事情的讀者解釋一下「LLM 可觀測」是什麼。以下容我重複使用以前做的圖卡：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_llm-observability-feb98d9f322cf06d99b2d63e51d3c6ff.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_llm-observability-967a0eaae4abe131c4d041952e44682b.webp" width="1080" height="1080" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>「角色卡」是一種角色扮演類 LLM 應用軟體的資料包，本質上是包含一堆人物設定、世界觀設定、台詞樣板...的文字。</p></div></div>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_llm-observability-b6e151ba46fe9c05d4c17e0ac4b51592.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_llm-observability-9ac0c0eb44cc9b353fc5d9b84298da1d.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/05_llm-observability-0270b312ce9069c13e10e693304c4d10.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/06_llm-observability-12a537091b2b21eda7b56f3339555a30.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/07_llm-observability-f076524508fda25e403f6af549fc8336.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/08_llm-observability-a335d0a7f8fc4516572664588aa45f47.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/09_llm-observability-12fb6d23d84f4f46622a36dd51e4220a.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/10_llm-observability-6098d55e33ffed32118f540217ee4c78.webp" width="1080" height="1080" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/11_llm-observability-bcf1a07fcccc5e234565accb11007c87.webp" width="1080" height="1080" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="anythingllm">AnythingLLM<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#anythingllm" class="hash-link" aria-label="Direct link to AnythingLLM" title="Direct link to AnythingLLM">​</a></h2>
<p><a href="https://github.com/Mintplex-Labs/anything-llm" target="_blank" rel="noopener noreferrer">AnythingLLM</a> 是一個很熱門的 LLM 應用軟體。不過正如我前面所說的，LLM 只是一個組件，要讓它發揮效用，關鍵在於應用程式是否擷取正確資料或資訊餵給 LLM 處理，因此「應用程式的外部連線能力」是我測試的重點。</p>
<p>這是我的測試題目；我知道正確答案，而我也知道這個題目不簡單，我只是想觀察這些 LLM 應用軟體會怎麼處理這個任務：</p>
<blockquote>
<p>幫我搜尋這個專案的歷史</p>
<p><a href="https://github.com/ill-inc/biomes-game" target="_blank" rel="noopener noreferrer">https://github.com/ill-inc/biomes-game</a></p>
</blockquote>
<p>最後得到的結果當然不符合我的預期，於是我開啟我的可觀測工具檢查剛剛發生了什麼事情。</p>
<p>我們可以觀察到，AnythingLLM 根據我的輸入觸發了一個「網頁爬蟲工具」：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/12_anythingllm-322c94904b094a6a20209ef1a36a2a11.webp" width="1440" height="827" class="img_RpFt"></p>
<p>然後我們可以看到它單純從 GitHub 爬了一堆垃圾就開始唬爛我試著回答剛剛那個問題。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/13_anythingllm-06d1af67f4f6aa77e5df805f042a64c7.webp" width="1440" height="831" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>正確答案是要用 <code>ill-inc</code> 找到 Global Illumination, Inc. 這間公司，接著找到 OpenAI 在 2023 年收購它們的新聞。
並且在專案的<a href="https://docs.biomes.gg/roadmap" target="_blank" rel="noopener noreferrer">文件網站</a>找到：「被收購之後，專案被團隊釋出後不再維護」的資訊。
我知道這個題目很難，所以後來我也沒有用這個題目測試了，加上我後來找到一些其他對於 LLM 軟體更重要的特性。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="perplexica">Perplexica<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#perplexica" class="hash-link" aria-label="Direct link to Perplexica" title="Direct link to Perplexica">​</a></h2>
<p><a href="https://github.com/ItzCrazyKns/Perplexica" target="_blank" rel="noopener noreferrer">Perplexica</a> 是一個自稱作為 Perplexity AI 開源替代方案的 LLM 軟體，Perplexity AI 則是一個以真實性為賣點的 SaaS (Software as a service)。</p>
<p>同一個題目，表現的跟 AnythingLLM 一樣差勁，不過除了外部連線的機制問題以外，我觀察到另外一個更可疑的行為：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/14_Perplexica-73d2856463931b9abbad70c26c2b97cf.webp" width="1440" height="833" class="img_RpFt"></p>
<p>它把對話紀錄的所有角色 (role) 都設定成 <code>assistant</code>！在 OpenAI API 的設計，role 至少有三種：<code>user</code>、<code>assistant</code>、<code>system</code>。</p>
<p>因此 LLM 實際上無法分辨歷史紀錄中誰說了什麼，因為全部都是 <code>assistant</code> 在自言自語。</p>
<p>實際上我在使用 google Gemini 的時候，很常發生：LLM 自己產生的某種結論 OOXX，在後續對話又說「正如你說的，OOXX」，把話塞到我嘴裡。我嚴重懷疑這是由類似的角色不分的提示詞工程造成的。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="local-deep-research">Local Deep Research<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#local-deep-research" class="hash-link" aria-label="Direct link to Local Deep Research" title="Direct link to Local Deep Research">​</a></h2>
<p><a href="https://github.com/LearningCircuit/local-deep-research" target="_blank" rel="noopener noreferrer">Local Deep Research</a> 是一個只有 3.8k 星星的專案（截至 2026-01-08），但是它嚴謹的特性深得我喜愛。</p>
<p>觀察到這個特性其實源自於一個意外，我搞錯搜尋引擎的設定，因此它當下無法使用搜尋引擎：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/15-local-deep-research-35d692bdd9e082eac8e0400538b08aed.webp" width="1440" height="835" class="img_RpFt"></p>
<p>但是我們看看它是怎麼回答使用者的：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/16-local-deep-research-69a309d7a0b0a1eeb0ff843113c53842.webp" width="1440" height="831" class="img_RpFt"></p>
<ul>
<li>它懂得回報使用者當下沒有對外連線、額外可供參考的資料，而不是直接試圖唬爛使用者。</li>
<li>這甚至是「光速是多少？」這種大部分 LLM 都可以應對的簡單問題。它也懂得自我檢討這個回答沒有參考資料佐證。</li>
<li>我使用的是普通的繼承 GPT 幹話王血統的 <code>openai/gpt-oss-20b</code>，並不是什麼特別調整的 LLM。</li>
</ul>
<p>我們可以看到它不像是其他 LLM 軟體直接把使用者輸入跟自己產生的資料填進去 OpenAI API 定義的對話紀錄裡面，而是紮紮實實的把任務切成多個 request 來處理：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/17-local-deep-research-1e77d5b7b569f49ee0decc5b7ff487c8.webp" width="1440" height="835" class="img_RpFt"></p>
<p>另外一個我在學習 VR 生態系時的例子，比對多個資料來源矛盾的敘述：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/18-local-deep-research-c54806eb5a9f2f27c973dac770ffed24.webp" width="1440" height="832" class="img_RpFt"></p>
<p>因此我可以簡單的把一些需要確認的主題丟給它研究，真正意義上的降低認知負荷，而不是時時要擔心 LLM 在唬爛我：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/19-local-deep-research-d0c49f8deecfd6456b839347120308b8.webp" width="1440" height="833" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="結論">結論<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#%E7%B5%90%E8%AB%96" class="hash-link" aria-label="Direct link to 結論" title="Direct link to 結論">​</a></h2>
<p>實際上提示詞工程跟正確的軟體架構可以有效處理 LLM 的「幻覺問題」，但是當今市場上的 LLM 軟體發展方向卻完全背道而馳：</p>
<ul>
<li>基於聊天形式的頁面設計，本質上是一個上下文極度不受控的環境，很容易讓 LLM 產生垃圾資料。</li>
<li>明明可以透過嚴謹的提示詞讓 LLM 做出更客觀的回應，但是大部分軟體都傾向取悅消費者，不斷的恭維跟唬爛使用者。</li>
<li>明明可以使用 one shot 的軟體形式提供更穩定的服務，但是就是要做成聊天機器人來欺騙投資人與使用者。</li>
</ul>
<p>就算不提閉源的 SaaS 方案（ChatGPT, Gemini...），AnythingLLM 或 Perplexica 這類譁眾取寵的實作反而贏得更多喝采（星星），而老實解決問題的 Local Deep Research 卻倍受冷落。</p>
<p>我用 LLM 可觀測性工具看見的不是邪惡的 LLM，更多的是整個產業帶有惡意的商業決策與人們的集體瘋狂。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="後記">後記<a href="https://flyskypie.github.io/posts/2026-01-08_llm-observability#%E5%BE%8C%E8%A8%98" class="hash-link" aria-label="Direct link to 後記" title="Direct link to 後記">​</a></h2>
<p>曾經有工程師問我，既然我想觀察提示詞工程，為什麼不乾脆看程式碼？畢竟那些自架軟體都有開源。</p>
<p>這是因為比起在可能不熟悉的程式語言裡探索、還要理解原始碼結構、最後早到提示詞模板跟相關實作，直接觀察界面簡單的多：</p>
<ul>
<li>當我送出一個指令，應用程式呼叫了幾次 LLM 來處理？<!-- -->
<ul>
<li>複雜問題但是只有一次呼叫，代表著實作的架構有問題。</li>
</ul>
</li>
<li>每次呼叫給了什麼輸入？<!-- -->
<ul>
<li>「Garbage in, garbage out」，如果 LLM 給了什麼糟糕的答案，十之八九來自應用程式給了糟糕的輸入。</li>
</ul>
</li>
</ul>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="LLM Proxy" term="LLM Proxy"/>
        <category label="LLM Gateway" term="LLM Gateway"/>
        <category label="LLM Observability" term="LLM Observability"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[工作哲學 - 已讀 Emoji]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-07_emoji</id>
        <link href="https://flyskypie.github.io/posts/2026-01-07_emoji"/>
        <updated>2026-01-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我在工作上通常會用 Emoji 代表「已讀」，包含我日常使用通訊軟體也有這個習慣，前一陣子 Discord 幫我的帳號做的年度總結剛好紀錄了我這個習慣：]]></summary>
        <content type="html"><![CDATA[
<p>我在工作上通常會用 Emoji 代表「已讀」，包含我日常使用通訊軟體也有這個習慣，前一陣子 Discord 幫我的帳號做的年度總結剛好紀錄了我這個習慣：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_eye-emoji-cfea5a88cf364503bb41cd5905d209e3.webp" width="1440" height="919" class="img_RpFt"></p>
<p>G 胖 (Gabe Newell) 曾經對「遊戲的樂趣」做出<a href="https://www.youtube.com/watch?v=MGpFEv1-mAo" target="_blank" rel="noopener noreferrer">見解</a>：「遊戲環境應該對玩家的行為做出反應，所以當你射擊牆壁時，它因此留下了彈孔」。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_game-fun-b11c3281fc992cb7b0cddc69e1261ed9.webp" width="1058" height="630" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/04_game-fun-68c624938b52a41dfa3e4fa4418d5275.webp" width="1058" height="623" class="img_RpFt"></p>
<p>因此我認為「代表已讀的 Emoji」就是對方訊息的彈孔，不要讓對方產生「訊息投入虛空之中」的挫折感。</p>
<p>從另外一個角度來看，職場是一個需要確定性、可靠性的環境，即時通訊軟體的溝通更是如此，這是一個關於 TCP/UDP 通訊協定的笑話：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_tcp-joke-aa84113a184e65c7824f98847afd1cc2.webp" width="802" height="928" class="img_RpFt"></p>
<p>在 TCP 通訊協定中，雙方需要多次的 ACK (Acknowledge)，確保封包有妥善送達而沒有遺失，如果有丟失的狀況就要重送來建立一個可靠的訊息交付管道；反觀 UDP 則是射後不理。</p>
<p>「代表已讀的 Emoji」就是一個 ACK，確保對方交待的事項你已經收到，並且開始承擔收到之後的責任。</p>
<p>你其實可以在無線電通訊觀察到類似的模式：「I COPY」「抄收」。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Homelab 可觀測重建進度]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-07_observability-outage</id>
        <link href="https://flyskypie.github.io/posts/2026-01-07_observability-outage"/>
        <updated>2026-01-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前情提要]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="前情提要">前情提要<a href="https://flyskypie.github.io/posts/2026-01-07_observability-outage#%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="Direct link to 前情提要" title="Direct link to 前情提要">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>日期是根據 Git Commit 紀錄跟螢幕截圖時間推論的，但是不是真正精準的時間，因為 Git Commit 可能延後一段時間才推送，截圖的問題則是不是每一個當下都有截圖。</p></div></div>
<p>2025-10-04 左右： LiteLLM 和 Langfuse 上線。
2025-10-11 左右： Local Deep Research 上線。</p>
<p>2025-10-14 左右： 開始比較頻繁使用 Local Deep Research。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2025-10-14-191907-c54806eb5a9f2f27c973dac770ffed24.webp" width="1440" height="832" class="img_RpFt"></p>
<p>2025-10-22 左右：Homelab 開始出現當機異常。</p>
<ul>
<li>圖表的斷層就是伺服器完全當機讓資料採集的機能癱瘓造成的。</li>
<li>可以觀察到 CPU 跟 RAM 異常使用是 Langfuse 服務簇的 ClickHouse 造成的。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2025-10-22-153923-070d3dfe4225019fee6cc35f5bf10da4.webp" width="1440" height="833" class="img_RpFt"></p>
<p>2025-10-23 的紀錄：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2025-10-23-092053-f2a15f06adb99d31dca02af023e74401.webp" width="1440" height="831" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2025-10-23-092111-0bd35fe2f3c3b8d0692b25ac204ddb45.webp" width="1440" height="836" class="img_RpFt"></p>
<p>2025-11-01 左右：連帶 Grafana 服務簇也失效，失效後就把 Langfuse 關掉然後沒有修復它了，直到最近 (2026-01) 佈署 K8s 才準備把服務遷移過去。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2025-11-01-201633-9c9e7938cab3d2f3ec6377040c98742f.webp" width="1440" height="830" class="img_RpFt"></p>
<p>Grafana 失效前我有關查到 Docker 在重新拉取 image，推測是因為我忘記鎖定 image 版本造成的。</p>
<hr>
<p>整個過程中出現過幾種不同的情況：</p>
<ul>
<li>電源鍵強制關機後恢復正常。</li>
<li>電源鍵強制關機後 LiteLLM 異常。<!-- -->
<ul>
<li>Stack 刪掉後重新佈署後恢復正常。</li>
</ul>
</li>
<li>電源鍵強制關機後 Langfuse 異常。<!-- -->
<ul>
<li>根據 clickhouse log 找到有問題的 block，刪除後重新佈署恢復正常（如下）。</li>
</ul>
</li>
</ul>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">2025.11.01 11:00:20.208590 [ 652 ] {c14fc20e-f2b0-45cb-939c-0fe47de9811c::202510_16681_17212_76} &lt;Error&gt; virtual bool DB::MergePlainMergeTreeTask::executeStep(): Exception is in merge_task.: Code: 40. DB::Exception: Checksum doesn't match: corrupted data. Reference: 52f594fc9d7f3ee0495f8f089d3882cf. Actual: c92bc03d0da25742da61b67ce5764aac. Size of compressed block: 3640. The mismatch is caused by single bit flip in data block at byte 2581, bit 2. This is most likely due to hardware failure. If you receive broken data over network and the error does not repeat every time, this can be caused by bad RAM on network interface controller or bad controller itself or bad RAM on network switches or bad CPU on network switches (look at the logs on related network switches; note that TCP checksums don't help) or bad RAM on host (look at dmesg or kern.log for enormous amount of EDAC errors, ECC-related reports, Machine Check Exceptions, mcelog; note that ECC memory can fail if the number of errors is huge) or bad CPU on host. If you read data from disk, this can be caused by disk bit rot. This exception protects ClickHouse from data corruption due to hardware failures: While reading or decompressing /var/lib/clickhouse/store/c14/c14fc20e-f2b0-45cb-939c-0fe47de9811c/202510_16681_17060_75/data.bin (position: 824782, typename: DB::ReadBufferFromFilePReadWithDescriptorsCache, compressed data header: &lt;uninitialized&gt;): (while reading column ProfileEvent_ReadBufferFromFileDescriptorRead): (while reading from part /var/lib/clickhouse/store/c14/c14fc20e-f2b0-45cb-939c-0fe47de9811c/202510_16681_17060_75/ in table system.metric_log (c14fc20e-f2b0-45cb-939c-0fe47de9811c) located on disk default of type local, from mark 2 with max_rows_to_read = 916, offset = 0): While executing MergeTreeSequentialSource. (CHECKSUM_DOESNT_MATCH), Stack trace (when copying this message, always include the lines below):</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>電源鍵強制關機後 Langfuse 異常。</p>
<ul>
<li>根據 clickhouse log 找到有問題的 block，刪除後重新佈署依然無法恢復。</li>
<li>把 clickhouse 建立全新的 Volume 後恢復正常。</li>
</ul>
</li>
<li>
<p>有幾次伺服器是完全沒螢幕反應，有反應的幾次可以在終端觀察到 CPU Lock：</p>
</li>
</ul>
<div class="codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-text codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">watchdog: BUG: soft lockup - CPU#* stuck for **s!</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="仰賴鏈">仰賴鏈<a href="https://flyskypie.github.io/posts/2026-01-07_observability-outage#%E4%BB%B0%E8%B3%B4%E9%8F%88" class="hash-link" aria-label="Direct link to 仰賴鏈" title="Direct link to 仰賴鏈">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_dependencies-d48e34f6da96e43bd203ab5d2780b64d.webp" width="1072" height="638" class="img_RpFt"></p>
<ol>
<li>Biomes 重構的進展目前面臨大量的 Schema 型別修復工作，我需要借助 LLM 之力來解決。</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_shared-build-errors-502be1013e64f362bd01b74967d4b8e6.webp" width="1421" height="776" class="img_RpFt"></p>
<ol start="2">
<li>我拒絕使用基於聊天或 IDE Agent 的 LLM 方案。</li>
<li>我想使用 ComfyUI 來構造專門用來處理 Schema 修復問題的 pipeline。</li>
<li>我在本地使用 LLM 工具我要求必須在有 LLM Observability 的前提下使用，所以我必須先修復我的 LLM Observability。</li>
<li>在有伺服器崩潰的前車之鑑，我要求必須在有 Observability 的前提下佈署 LLM Observability，所以我必須先修復我的 Observability。</li>
<li>但是我不想在現有的節點上修復 Observability，而是在新的節點使用 K8s 並佈署 Observability，因此我要先學習使用 K8s。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="observability-重建的當前狀態">Observability 重建的當前狀態<a href="https://flyskypie.github.io/posts/2026-01-07_observability-outage#observability-%E9%87%8D%E5%BB%BA%E7%9A%84%E7%95%B6%E5%89%8D%E7%8B%80%E6%85%8B" class="hash-link" aria-label="Direct link to Observability 重建的當前狀態" title="Direct link to Observability 重建的當前狀態">​</a></h2>
<p>到昨天 (2026-01-06) 為止，我已經：</p>
<ol>
<li>設定新的節點，安裝 K3s。(2025-12-24)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab/" target="_blank" rel="noopener noreferrer">筆記型 Homelab 飼養注意事項</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s/" target="_blank" rel="noopener noreferrer">安裝 K3s 與遠端連線</a></li>
</ul>
</li>
<li>整理之前跟 K8s 有關的知識點。(2025-12-28~2026-01-02)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2025-12-28_learn-k8s/" target="_blank" rel="noopener noreferrer">教練我想學 K8s</a></li>
<li><a href="https://flyskypie.github.io/posts/2025-12-29_systemd-ish/" target="_blank" rel="noopener noreferrer">從 Docker 開始的 Systemd 小宇宙</a></li>
<li><a href="https://flyskypie.github.io/posts/2025-12-31_learn-k8s/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Cluster 和它快樂的小夥伴們</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-01_learn-k8s/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Pod 和它快樂的小夥伴們</a></li>
</ul>
</li>
<li>釐清 Ingress/Load Balancer 的概念。(~2026-01-05)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - K8s 只是框架</a></li>
</ul>
</li>
<li>釐清 PV/PVC 的概念。(~2026-01-05)</li>
<li>用 Helm 安裝 Longhorn。(2026-01-05)<!-- -->
<ul>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-intro/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Longhorn 簡介</a></li>
<li><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm/" target="_blank" rel="noopener noreferrer">K8s 學習筆記 - Longhorn 安裝與 Helm</a></li>
</ul>
</li>
<li>用 Helm 安裝 Kube-Prometheus-Stack。(2026-01-06)</li>
</ol>
<hr>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_migration-b30fe59a52f586312ec687216542c11b.webp" width="1578" height="772" class="img_RpFt"></p>
<p>用 K8s 內的 Prometheus 和 Grafana 實例取代原本的，原本的兩張 Dashboard 則是本來就有 JSON 檔直接移過去。原本的伺服器指保留 Cadvisor 供新的 Prometheus 採集資料。</p>
<p>目前關於容器的 Dashboard 是處於兩個節點資料混在一起的狀態，暫時先不處理 Query 需要更新的問題：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2026-01-07-110633-75db9d2164912febd853c6d9d896dc67.webp" width="1440" height="836" class="img_RpFt"></p>
<p>Node Dashboard 則是直接接軌新的 Node Exporter 的資料，暫時也先不處理舊節點的資料：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/2026-01-07-125235-b3a4c6e35bbcb101d9d265977d9db27e.webp" width="1440" height="831" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Kube-Prometheus-Stack 其實有提供不少 Dashboard 用來觀察新節點，我就不在這邊一一列舉了。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="prometheus-安裝筆記">Prometheus 安裝筆記<a href="https://flyskypie.github.io/posts/2026-01-07_observability-outage#prometheus-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98" class="hash-link" aria-label="Direct link to Prometheus 安裝筆記" title="Direct link to Prometheus 安裝筆記">​</a></h2>
<p>跟 Longhorn 一樣直接使用 Helm 安裝：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm show values prometheus-community/kube-prometheus-stack --version 51.6.0 &gt;values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install prometheus-stack prometheus-community/kube-prometheus-stack \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -f values.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -n prometheus-stack \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 51.6.0</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>values.yaml</code> 倒是有做一些調整：</p>
<ul>
<li>時區</li>
<li>適應當前 K8s (K3s) 的 Ingress 為 Traefik</li>
<li>對內網 DNS 暴露 Grafana</li>
<li>適應當前 K8s 持久化實例為 Longhorn</li>
<li>從舊 Node 的 Cadvisor 採集資料</li>
</ul>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">grafana</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultDashboardsTimezone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Asia/Taipei</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> grafana.observable.gas.arachne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">prometheusSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> longhorn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"ReadWriteOnce"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 50Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">additionalScrapeConfigs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      - job_name: beta-cadvisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        static_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          - targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            - web.cadvisor.arachne</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="llm-observability-重建的當前狀態">LLM Observability 重建的當前狀態<a href="https://flyskypie.github.io/posts/2026-01-07_observability-outage#llm-observability-%E9%87%8D%E5%BB%BA%E7%9A%84%E7%95%B6%E5%89%8D%E7%8B%80%E6%85%8B" class="hash-link" aria-label="Direct link to LLM Observability 重建的當前狀態" title="Direct link to LLM Observability 重建的當前狀態">​</a></h2>
<p>LiteLLM 雖然在 OpenRouter 排行榜蟬聯前幾名，但是實際使用下來給我的感覺不太穩定（經歷過加密 Bug、當機後無法正常復位）。</p>
<p>另一方面，Langfuse 給我的感覺則是相對肥大（服務簇需要同時配置 ClickHouse、MinIO、Redis、PostgresSQL），但是我又沒有使用到裡面的每一個功能。更別提 ClickHouse 就是表面上這次事故的主因。</p>
<p>因此我打算評估其他 LLM Gateway/Observability 方案，目前看上 <a href="https://github.com/maximhq/bifrost" target="_blank" rel="noopener noreferrer">Bifrost</a>，試用了一下感覺不錯，就是它的資料庫配置稍微有點麻煩，這個部份可能之後再提。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s 學習筆記 - K8s 只是框架]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework</id>
        <link href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework"/>
        <updated>2026-01-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[K8s 不是一個完整解決方案，K8s 只是框架。]]></summary>
        <content type="html"><![CDATA[
<blockquote>
<p>K8s 不是一個完整解決方案，K8s 只是框架。</p>
</blockquote>
<p>驚不驚喜？意不意外？</p>
<p>當你安裝了 Docker 之後就可以開始打包 image 並運行程式，甚至可以使用 Dokcer Compose 指令開始進行容器編排 (Orchestration)。</p>
<p>反觀，對於一個 K8s 使用者而言，生態系內有很多「口味」供你選擇：Minikube、MicroK8s、K3s、GKE、EKS...但是當你選擇原味 (Vanilla)時，你可能會發現歷經一番波折安裝完成之後，你還是什麼都不能幹：不能正常建立網路連線、不能正常的掛載持久化實體 (Volume)...</p>
<p>為什麼？因為 K8s 本身不是開箱即用解決方案，它只是一種框架。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的網路">不是開箱即用的網路<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework#%E4%B8%8D%E6%98%AF%E9%96%8B%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84%E7%B6%B2%E8%B7%AF" class="hash-link" aria-label="Direct link to 不是開箱即用的網路" title="Direct link to 不是開箱即用的網路">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落會多次提及 OSI 的 L4 和 L7，對兩者差異不清楚的讀者建議先去查點資料，不然閱讀起來可能會有點吃力。</p></div></div>
<p>我在<a href="https://flyskypie.github.io/posts/2026-01-01_learn-k8s/" target="_blank" rel="noopener noreferrer">前一篇文章</a>中介紹了 Service，以及內網模式 ClusterIP 與節點開埠 NodePort，即便是 NodePort 也不像是標準佈署使用的模式，因為它只能開奇怪的埠號。這是因為 Service 其實還有兩個生產環境在使用的模式：LoadBalancer 模式或是加掛一個 Ingress。</p>
<p>以 ServiceLB (LoadBalancer) 為例，K8s 只提供一個 L4 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_lb-controller-9a70bb19a4e58307ba30e54f7e361770.webp" width="917" height="458" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>LB (LoadBalancer) Controller 是一個方便讀者理解的稱呼，實際情況比較複雜，有其他專門的術語用來稱呼這個東西。</p></div></div>
<p>在雲端環境（如 Google, AWS）這是由雲端供應商實作的，可能是一團閉源商業軟體和硬體級 LB 整合而成；在 K3s 中這是由 <a href="https://github.com/k3s-io/klipper-lb" target="_blank" rel="noopener noreferrer">klipper-lb</a> 透過 <code>hostPort</code> 實作的。</p>
<p>Ingress 也是相同的狀況，K8s 只提供一個 L7 的抽象層，具體的實做依然需要別人來完成：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_ingress-controller-b0104efe4f8fed322b5ed08be65ff649.webp" width="1224" height="447" class="img_RpFt"></p>
<p>實作可以是 Nginx 也可以是 Traefik。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="不是開箱即用的持久化儲存">不是開箱即用的持久化儲存<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework#%E4%B8%8D%E6%98%AF%E9%96%8B%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%84%B2%E5%AD%98" class="hash-link" aria-label="Direct link to 不是開箱即用的持久化儲存" title="Direct link to 不是開箱即用的持久化儲存">​</a></h2>
<p>K8s 在設計上就是一個分散式運行的框架，當 Pod 可能分散在多個不同的主機（節點）時，我們就不能像 Docker 那樣直接用某個路徑當作持久化實體。</p>
<p>在 K8s 的世界中，Volume 通常是一個 SDS (Software-defined storage)；
在 K8s 的世界中，網路線就是 SATA 線。</p>
<p>細節我不在此解釋，簡單來說在 K8s 要幫 Container 掛載 Volume 需要經過層層抽象，並且最後實際的儲存實體並不在 K8s 內實作：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>你也可以在 K8s 設定 <code>storageClassName: local-storage</code> 的 Volume，但是這樣你可能需要額外配置讓 Pod 只能佈署在特定的 Node 上。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>Storage Backend 同樣是一個方便讀者理解的稱呼，並不是 K8s 內的標準術語。</p></div></div>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="k8s" term="k8s"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s 學習筆記 - Longhorn 安裝與 Helm]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm</id>
        <link href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm"/>
        <updated>2026-01-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Longhorn 可以用很多方式安裝，包含最基本的 kubectl 指令：]]></summary>
        <content type="html"><![CDATA[
<p>Longhorn 可以用很多方式安裝，包含最基本的 <code>kubectl</code> 指令：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不過等等！不要急著下指令！讓我們瞄一眼裡面有些什麼：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://raw.githubusercontent.com/longhorn/longhorn/v1.10.1/deploy/longhorn.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_longhorn-install-yaml-1f7ad17473887f8aa9a4cda144d179b1.webp" width="521" height="589" class="img_RpFt"></p>
<p>是的，這是一個有四千多行的 YAML，善於偷懶的聰明開發者們當然不會想直接跟這團東西打交道。</p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個數字可以當作一個參考，一個完整的雲原生軟體佈署到 K8s 需要的聲明的資訊大概會達到這個量體。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="helm">Helm<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#helm" class="hash-link" aria-label="Direct link to Helm" title="Direct link to Helm">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_helm-4306e187254cfeaddb4fbe25fa2d74ca.webp" width="1859" height="1035" class="img_RpFt"></p>
<p>就像 Longhorn 需要四千多行的 YAML 一樣，還有許許多多的雲原生應用軟體實際都是由大量的 K8s 資源或實體交錯編排而成，於是就有了 Helm 這個工具的誕生：一個 K8s 世界的 APT (Advanced Packaging Tool)。</p>
<p>在 Helm 的世界，這一堆聲明的 YAML 被包裝成一個稱作 Chart 的東西，「安裝」(佈署應用程式到 K8s)大概像這樣：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add longhorn https://charts.longhorn.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Helm 還有另外一個重要的功能：對 Chart 傳入變數，也是今天我要使用 Helm 的主要原因。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="用-helm-安裝-longhorn">用 Helm 安裝 Longhorn<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#%E7%94%A8-helm-%E5%AE%89%E8%A3%9D-longhorn" class="hash-link" aria-label="Direct link to 用 Helm 安裝 Longhorn" title="Direct link to 用 Helm 安裝 Longhorn">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>這個段落的內容主要參考 Longhorn 的官方文件<sup><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#user-content-fn-longhorn-config-6a8af0" id="user-content-fnref-longhorn-config-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。</p></div></div>
<p>首先下載參數檔：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -Lo values.yaml https://raw.githubusercontent.com/longhorn/longhorn/refs/tags/v1.10.1/chart/values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根據需求修改 <code>values.yaml</code>，以我目前的需求為例，分別是：</p>
<ul>
<li>持久化須儲存到外部 DAS 的掛載點。</li>
<li>目前只有一個工作節點，所以副本只有一份。</li>
</ul>
<div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">defaultSettings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultDataPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /mnt/das</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">defaultReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安裝 Longhorn 到 K8s：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">helm install longhorn longhorn/longhorn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace longhorn-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 1.10.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --values values.yaml</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>拉取 Image 需要時間，過程中可以使用指令檢查是不是所有 Pod 已經就位：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n longhorn-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS              RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine-image-ei-3154f3aa-tsq6p              0/1     ContainerCreating   0             23s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-driver-deployer-58768fb7fd-ktpq8   1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-manager-bsqms                      2/2     Running             2 (44s ago)   2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-j8bxb                 1/1     Running             0             2m58s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longhorn-ui-7b9c99fd9-w2l6b                 1/1     Running             0             2m58s</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行 Tunnel 連線到 Longhorn 的 Dashboard<sup><a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#user-content-fn-longhorn-ui-access-6a8af0" id="user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service/longhorn-frontend \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -n longhorn-system 3002:80 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --address 0.0.0.0</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_longhorn-frontend-181644ffe13d8e290aad61e70bb1b0b7.webp" width="1440" height="923" class="img_RpFt"></p>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-longhorn-config-6a8af0">
<p>Longhorn | Documentation. Retrieved 2026-01-05, from <a href="https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/" target="_blank" rel="noopener noreferrer">https://longhorn.io/docs/1.10.1/advanced-resources/deploy/customizing-default-settings/</a> <a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#user-content-fnref-longhorn-config-6a8af0" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-longhorn-ui-access-6a8af0">
<p>Longhorn 部署筆記 | 翠鳥圖書館 Project Halcyon Library. Retrieved 2026-01-05, from <a href="https://wiki.pha.pub/books/109-TAs/page/longhorn" target="_blank" rel="noopener noreferrer">https://wiki.pha.pub/books/109-TAs/page/longhorn</a> <a href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-install-and-helm#user-content-fnref-longhorn-ui-access-6a8af0" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="k8s" term="k8s"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8s 學習筆記 - Longhorn 簡介]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-intro</id>
        <link href="https://flyskypie.github.io/posts/2026-01-05_k8s-longhorn-intro"/>
        <updated>2026-01-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[接續我在前一篇貼文指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作：]]></summary>
        <content type="html"><![CDATA[<p>接續我在<a href="https://flyskypie.github.io/posts/2026-01-05_k8s-is-framework/" target="_blank" rel="noopener noreferrer">前一篇貼文</a>指出的：K8s 本身只是框架，並沒有包含 SDS (Software-defined storage) 的具體實作：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_storage-backend-e7a9cba39ddcedd48bddc96779f8936b.webp" width="1089" height="715" class="img_RpFt"></p>
<p><a href="https://github.com/longhorn/longhorn" target="_blank" rel="noopener noreferrer">Longhorn</a> 則是其中一種 SDS 實作：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_longhorn-1983f6aeeeb627c39461978dd959b7fe.webp" width="1089" height="715" class="img_RpFt"></p>
<p>Longhorn 巧妙的運用 K8s 作為基礎設施，將 SDS 運行在 Cluster 內部，並且利用 K8s 的多節點特性運行多個實例，並在多個實例上建立資料冗餘實現分散式副本：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_longhorn-4e94a43f1813ec3e0cc932bd7e179964.webp" width="1040" height="802" class="img_RpFt"></p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="k8s" term="k8s"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[老兄，你真的找錯人推銷桌面照明了]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-03_desktop-lighting</id>
        <link href="https://flyskypie.github.io/posts/2026-01-03_desktop-lighting"/>
        <updated>2026-01-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。]]></summary>
        <content type="html"><![CDATA[
<p>前一陣子跟一個硬體工程師聊天，然後他順便推銷他們公司出的桌面燈，因為是他經手過的產品。老兄，不是我要貶低你的努力，只是我的消費水準是隨便找個鋁擠、幾顆 M4 螺絲、一支 USB 燈條就處理掉桌面照明的人，找我推銷桌面燈是真的找錯人了。</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_lighting-690afe05eadfcf1199665470bbd0cf5c.webp" width="1024" height="542" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/02_lighting-26256caa9acafeb02a72529baacff36a.webp" width="1024" height="566" class="img_RpFt"></p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/03_lighting-09ba04689c734ff899b541ee68538d75.webp" width="1024" height="506" class="img_RpFt"></p>
<p>就算真的有興趣想買的，大概也是手術燈那種東西，畢竟在做事的時候光源被手或是頭擋住真的很煩。</p>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[筆記型 Homelab 飼養注意事項]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-03_laptop-homelab</id>
        <link href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab"/>
        <updated>2026-01-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[背景]]></summary>
        <content type="html"><![CDATA[
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/00_cover-ea0a7e8308dd3ceda73995b20ee0532a.webp" width="1110" height="537" class="img_RpFt"></p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="背景">背景<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#%E8%83%8C%E6%99%AF" class="hash-link" aria-label="Direct link to 背景" title="Direct link to 背景">​</a></h2>
<p>我的 Homelab 是透過筆電和 USB 外接 DAS (Direct Attached Storage) 建構的，並且採過一些小坑。最近在建置新的節點時，發現我把相關的資訊分散在不同的筆記和 IaC (Infrastructure as Code) 裡面，於是想說趁這個機會整理一下資訊。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="電池充電上限">電池充電上限<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#%E9%9B%BB%E6%B1%A0%E5%85%85%E9%9B%BB%E4%B8%8A%E9%99%90" class="hash-link" aria-label="Direct link to 電池充電上限" title="Direct link to 電池充電上限">​</a></h2>
<p>Framework 的話可以在 BIOS 設定充電上限：</p>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_fw-bios-21176c994ed1627b3bac398a51874f91.webp" width="1600" height="900" class="img_RpFt"></p>
<p>（從 Framework 的論壇<a href="https://community.frame.work/t/framework-laptop-13-ryzen-7040-bios-3-07-release-held/65582" target="_blank" rel="noopener noreferrer">借用螢幕截圖</a>）</p>
<p>另外一台 Lenovo 的筆電則是靠這個設定：</p>
<p><a href="https://github.com/makifdb/lenopow" target="_blank" rel="noopener noreferrer">https://github.com/makifdb/lenopow</a></p>
<p>我會把把充電上限設在 80% 避免筆電作為伺服器長時間插著充電造成電池膨脹。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="筆電螢幕問題">筆電螢幕問題<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#%E7%AD%86%E9%9B%BB%E8%9E%A2%E5%B9%95%E5%95%8F%E9%A1%8C" class="hash-link" aria-label="Direct link to 筆電螢幕問題" title="Direct link to 筆電螢幕問題">​</a></h2>
<p>讓筆電不會因為螢幕蓋上而進入休眠模式，編輯 <code>/etc/systemd/logind.conf</code>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">HandleLidSwitch=ignore</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>執行指令重啟服務：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-logind.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是上述設定會造成另外一個問題：螢幕蓋著還是繼續發光，於是還需要一個步驟，編輯 <code>/etc/default/grub</code>：</p>
<p>在 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 插入 <code>consoleblank=60</code>。</p>
<p>這會讓螢幕在 60 秒後熄滅。</p>
<details class="details_kzw7 alert alert--info details_D2hA" data-collapsed="true"><summary>完整 Ansible Playbook</summary><div><div class="collapsibleContent_UYJG"><div class="language-yaml codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-yaml codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup laptop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> arachne</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> check if consoleblank is configured in the boot command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'^GRUB_CMDLINE_LINUX_DEFAULT=".*consoleblank=60'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> absent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">check_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">register</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">changed_when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> insert consoleblank if missing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'^(GRUB_CMDLINE_LINUX_DEFAULT=".*)"$'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\1 consoleblank=60"'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grub_cmdline_check.found == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set HandleLidSwitch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backrefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/systemd/logind.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#?(HandleLidSwitch=)(?:.*)$"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'\1ignore'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ansible.builtin.systemd_service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> systemd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> restarted</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-掛載">DAS 掛載<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#das-%E6%8E%9B%E8%BC%89" class="hash-link" aria-label="Direct link to DAS 掛載" title="Direct link to DAS 掛載">​</a></h2>
<p>當服務透過 Docker 跑在容器內，持久化資料卻儲存在透過 USB 連線的外部儲存中，這個仰賴關係需要額外處理。</p>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="自動化載">自動化載<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#%E8%87%AA%E5%8B%95%E5%8C%96%EF%BF%BD%EF%BF%BD%E8%BC%89" class="hash-link" aria-label="Direct link to 自動化載" title="Direct link to 自動化載">​</a></h3>
<p>編輯 <code>/etc/fstab</code> 加入以下內容：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain"># DAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID=7f858b7e-f942-45b3-92dd-8c99b497b6a4 /mnt/das-storage ext4 defaults,nofail,x-systemd.automount 0 2</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改後執行：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>UUID 可以透過 <code>lsblk -f</code> 之類的指令獲得。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_mpuI" id="設定仰賴">設定仰賴<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#%E8%A8%AD%E5%AE%9A%E4%BB%B0%E8%B3%B4" class="hash-link" aria-label="Direct link to 設定仰賴" title="Direct link to 設定仰賴">​</a></h3>
<p>新增檔案 <code>/etc/systemd/system/docker.service.d/override.conf</code>：</p>
<div class="language-ini codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-ini codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=mnt-das\\x2dstorage.automount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConditionPathExists=/mnt/das-storage</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>確保 Docker Daemon 在 DAS 掛載後才運行。</p>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="das-smart-檢查">DAS SMART 檢查<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#das-smart-%E6%AA%A2%E6%9F%A5" class="hash-link" aria-label="Direct link to DAS SMART 檢查" title="Direct link to DAS SMART 檢查">​</a></h2>
<p>因為電腦沒有直接和硬碟建立連線而是隔著一層 DAS，因此不能使用普通的 <code>smartctl</code> 指令確認，而必須使用額外的參數<sup><a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#user-content-fn-qnap-smart-c5ac0a" id="user-content-fnref-qnap-smart-c5ac0a" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,0 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,1 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a -d jmb39x-q,2 /dev/sdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smartctl -a --device jmb39x-q,3 /dev/sdd</span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-qnap-smart-c5ac0a">
<p>QNAP External RAID Manager - Export SMART Data - QNAP NAS Community Forum. Retrieved 2026-01-03, from <a href="https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575" target="_blank" rel="noopener noreferrer">https://forum.qnap.com/viewtopic.php?p=873575&amp;sid=573c6149a1276e4ab8d9f4785f1c6029#p873575</a> <a href="https://flyskypie.github.io/posts/2026-01-03_laptop-homelab#user-content-fnref-qnap-smart-c5ac0a" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="homelab" term="homelab"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[安裝 K3s 與遠端連線]]></title>
        <id>https://flyskypie.github.io/posts/2026-01-02_learn-k8s</id>
        <link href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s"/>
        <updated>2026-01-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[安裝]]></summary>
        <content type="html"><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="安裝">安裝<a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s#%E5%AE%89%E8%A3%9D" class="hash-link" aria-label="Direct link to 安裝" title="Direct link to 安裝">​</a></h2>
<p>懶人安裝法：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">curl -sfL https://get.k3s.io | sh - </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>檢查一下有沒有正常：</p>
<div class="language-shell codeBlockContainer_HtHN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_XzDj"><pre tabindex="0" class="prism-code language-shell codeBlock_Kgad thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_xOgw"><span class="token-line" style="color:#393A34"><span class="token plain">sudo k3s kubectl get node </span><br></span></code></pre><div class="buttonGroup_PN__"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lePV" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mz7K"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_aySJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_mpuI" id="設定">設定<a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s#%E8%A8%AD%E5%AE%9A" class="hash-link" aria-label="Direct link to 設定" title="Direct link to 設定">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://flyskypie.github.io/assets/images/01_kubectl-f4117048f786e3eade61a1e20c3be2e3.webp" width="1571" height="1058" class="img_RpFt"></p>
<p>從安裝 K3s 的機器複製 <code>/etc/rancher/k3s/k3s.yaml</code> 到想要遠端連線的機器（Client 端）的 <code>~/.kube/config</code>。<sup><a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s#user-content-fn-cluster-access-f0e5eb" id="user-content-fnref-cluster-access-f0e5eb" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<div class="theme-admonition theme-admonition-info admonition_a71W alert alert--info"><div class="admonitionHeading_ZphC"><span class="admonitionIcon_vqjX"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fKWC"><p>要留意 K8s 的憑證會過期這件事。</p></div></div>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_mpuI sr-only" id="footnote-label">Footnotes<a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-cluster-access-f0e5eb">
<p>Cluster Access | K3s. Retrieved 2026-01-02, from <a href="https://docs.k3s.io/cluster-access" target="_blank" rel="noopener noreferrer">https://docs.k3s.io/cluster-access</a> <a href="https://flyskypie.github.io/posts/2026-01-02_learn-k8s#user-content-fnref-cluster-access-f0e5eb" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>Wei Ji</name>
            <uri>https://github.com/FlySkyPie</uri>
        </author>
        <category label="k8s" term="k8s"/>
    </entry>
</feed>